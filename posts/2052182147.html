<!DOCTYPE HTML><html lang="zh-CN"><head><meta charset="utf-8"><meta name="keywords" content="【Netty学习】7.Protocol Buffer序列化, Back-End Dev Java"><meta name="description" content="1 定义一种结构化数据的数据存储格式（类似于XML、Json）

Google出品 （开源）
Protocol Buffer目前有两个版本：proto2和proto3

1.1 proto2与proto3的区别
在第一行非空白非注释行，必须"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><meta name="renderer" content="webkit|ie-stand|ie-comp"><meta name="mobile-web-app-capable" content="yes"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="referrer" content="no-referrer-when-downgrade"><title>【Netty学习】7.Protocol Buffer序列化 | Kezade</title><link rel="icon" type="image/jpeg" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/medias/avatar/avatar2.jpg"><style>body{background-image:url(https://it-ark-dev.oss-cn-shenzhen.aliyuncs.com/464e9ac7a5a729ae67f91f7cf0cf6fe2.jpg);background-repeat:no-repeat;background-attachment:fixed;background-size:cover;background-position:center center}</style><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/awesome/css/all.min.css"><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/materialize/materialize.min.css"><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/aos/aos.css"><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/animate/animate.min.css"><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/lightGallery/css/lightgallery.min.css"><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/picgo@v3.1/css/matery.css?v3"><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/css/my.css"><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/css/dark.css" media="none" onload='"all"!=media&&(media="all")'><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/tocbot/tocbot.css"><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/css/post.css"><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/css/reward.css"><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/jquery/jquery-3.6.0.min.js"></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/picgo@v3.3/js/function.js?v88"></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/picgo@v1.3/js/imgStatus.min.js"></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/picgo@v1.3/js/waterfall.min.js"></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/picgo@v1.3/js/lately.min.js"></script><script>var memos={host:"https://s.dusays.com/",limit:"10",creatorId:"49",username:"zyxelva",name:"Kezade",domId:"#memos",path:"api/v1/memo"},douban={api:"https://douban-api.edui.fun/"}</script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/rss2.xml" title="Kezade" type="application/rss+xml"></head><body><header class="navbar-fixed"><nav id="headNav" class="bg-color nav-transparent"><div id="navContainer" class="nav-wrapper container"><div class="brand-logo"><a href="/" class="waves-effect waves-light"><img src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/medias/avatar/avatar2.jpg" class="logo-img k-avatar" alt="LOGO"> <span class="logo-span">Kezade</span></a></div><a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a><ul class="right nav-menu"><li class="hide-on-med-and-down nav-item"><a href="/" class="waves-effect waves-light"><i class="fas fa-home" style="zoom:0.6"></i> <span>首页</span></a></li><li class="hide-on-med-and-down nav-item"><a href="" class="waves-effect waves-light"><i class="fa-solid fa-newspaper" style="zoom:0.6"></i> <span>文章</span><i class="fas fa-chevron-down" aria-hidden="true" style="zoom:0.6"></i></a><ul class="sub-nav menus_item_child"><li><a href="/tags"><i class="fas fa-tags" style="margin-top:-20px;zoom:0.6"></i> <span>标签</span></a></li><li><a href="/categories"><i class="fas fa-bookmark" style="margin-top:-20px;zoom:0.6"></i> <span>分类</span></a></li><li><a href="/archives"><i class="fas fa-archive" style="margin-top:-20px;zoom:0.6"></i> <span>归档</span></a></li></ul></li><li class="hide-on-med-and-down nav-item"><a href="" class="waves-effect waves-light"><i class="fa-solid fa-sitemap" style="zoom:0.6"></i> <span>系列</span><i class="fas fa-chevron-down" aria-hidden="true" style="zoom:0.6"></i></a><ul class="sub-nav menus_item_child"><li><a href="/categories/%E7%AE%97%E6%B3%95"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>算法学习</span></a></li><li><a href="/categories/RocketMQ%E5%AD%A6%E4%B9%A0"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>RMQ学习</span></a></li><li><a href="/categories/Netty%E5%AD%A6%E4%B9%A0"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>Netty学习</span></a></li><li><a href="/categories/Spring%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>Spring学习</span></a></li><li><a href="/categories/JVM%E5%AD%A6%E4%B9%A0"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>JVM学习</span></a></li><li><a href="/categories/MySQL%E5%AD%A6%E4%B9%A0"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>MySQL学习</span></a></li><li><a href="/categories/MyBatis%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>MyBatis学习</span></a></li><li><a href="/categories/Zookeeper%E5%AD%A6%E4%B9%A0"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>ZK学习</span></a></li><li><a href="/categories/Hexo"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>Hexo学习</span></a></li><li><a href="/categories/Redis%E5%AD%A6%E4%B9%A0"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>Redis学习</span></a></li><li><a href="/categories/Docker%E5%AD%A6%E4%B9%A0"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>Docker学习</span></a></li><li><a href="/categories/AP-Calculus"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>AP学习</span></a></li><li><a href="/categories/A-Level"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>A-Level学习</span></a></li><li><a href="/categories/SAT"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>SAT学习</span></a></li><li><a href="/categories/%E8%80%83%E7%A0%94"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>考研</span></a></li><li><a href="/categories/OSSD"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>OSSD</span></a></li><li><a href="/categories/%E9%AB%98%E8%80%83"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>高考</span></a></li></ul></li><li class="hide-on-med-and-down nav-item"><a href="" class="waves-effect waves-light"><i class="fa-solid fa-place-of-worship" style="zoom:0.6"></i> <span>我的</span><i class="fas fa-chevron-down" aria-hidden="true" style="zoom:0.6"></i></a><ul class="sub-nav menus_item_child"><li><a href="/galleries"><i class="fas fa-image" style="margin-top:-20px;zoom:0.6"></i> <span>相册</span></a></li><li><a href="/bibi"><i class="fa-fw fa-solid fa-cloud-rain" style="margin-top:-20px;zoom:0.6"></i> <span>哔哔</span></a></li><li><a href="/todolist"><i class="fa-fw fa-solid fa-circle-check" style="margin-top:-20px;zoom:0.6"></i> <span>清单</span></a></li><li><a href="/musics"><i class="fas fa-music" style="margin-top:-20px;zoom:0.6"></i> <span>音乐</span></a></li></ul></li><li class="hide-on-med-and-down nav-item"><a href="" class="waves-effect waves-light"><i class="fa-solid fa-circle-info" style="zoom:0.6"></i> <span>更多</span><i class="fas fa-chevron-down" aria-hidden="true" style="zoom:0.6"></i></a><ul class="sub-nav menus_item_child"><li><a href="/contact"><i class="fas fa-comments" style="margin-top:-20px;zoom:0.6"></i> <span>留言</span></a></li><li><a href="/friends"><i class="fa-solid fa-link" style="margin-top:-20px;zoom:0.6"></i> <span>友链</span></a></li><li><a href="/friend-circle"><i class="fa-solid fa-rss" style="margin-top:-20px;zoom:0.6"></i> <span>圈圈</span></a></li><li><a href="/about"><i class="fas fa-user-circle" style="margin-top:-20px;zoom:0.6"></i> <span>关于</span></a></li></ul></li><li><a href="#searchModal" class="modal-trigger waves-effect waves-light"><i id="searchIcon" class="fas fa-search" title="搜索" style="zoom:0.85"></i></a></li><li><a href="javascript:;" class="waves-effect waves-light" onclick="switchNightMode()" title="深色/浅色模式"><i id="sum-moon-icon" class="fas fa-sun" style="zoom:0.85"></i></a></li></ul><div id="mobile-nav" class="side-nav sidenav"><div class="mobile-head bg-color"><img src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/medias/avatar/avatar2.jpg" class="logo-img circle responsive-img"><div class="logo-name">Kezade</div><div class="logo-desc">7 年 Java 开发经验，其中 3 年以上大型系统架构设计经验，以及 2 年以上的团队管理经验 | 具有分布式、高并发、高可用、大数据量的系统架构设计以及研发经验 | 对 Zookeeper、Netty、Dubbo、Spring Cloud、 Spring 等开源框架源码有过深入研究，并且有一定的框架定制开发经验</div></div><ul class="menu-list mobile-menu-list"><li class="m-nav-item"><a href="/" class="waves-effect waves-light"><i class="fa-fw fas fa-home"></i> 首页</a></li><li class="m-nav-item"><a href="javascript:;"><i class="fa-fw fa-solid fa-newspaper"></i> 文章<span class="m-icon"><i class="fas fa-chevron-right"></i></span></a><ul><li><a href="/tags" style="margin-left:75px"><i class="fa fas fa-tags" style="position:absolute;left:50px"></i> <span>标签</span></a></li><li><a href="/categories" style="margin-left:75px"><i class="fa fas fa-bookmark" style="position:absolute;left:50px"></i> <span>分类</span></a></li><li><a href="/archives" style="margin-left:75px"><i class="fa fas fa-archive" style="position:absolute;left:50px"></i> <span>归档</span></a></li></ul></li><li class="m-nav-item"><a href="javascript:;"><i class="fa-fw fa-solid fa-sitemap"></i> 系列<span class="m-icon"><i class="fas fa-chevron-right"></i></span></a><ul><li><a href="/categories/%E7%AE%97%E6%B3%95" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>算法学习</span></a></li><li><a href="/categories/RocketMQ%E5%AD%A6%E4%B9%A0" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>RMQ学习</span></a></li><li><a href="/categories/Netty%E5%AD%A6%E4%B9%A0" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>Netty学习</span></a></li><li><a href="/categories/Spring%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>Spring学习</span></a></li><li><a href="/categories/JVM%E5%AD%A6%E4%B9%A0" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>JVM学习</span></a></li><li><a href="/categories/MySQL%E5%AD%A6%E4%B9%A0" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>MySQL学习</span></a></li><li><a href="/categories/MyBatis%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>MyBatis学习</span></a></li><li><a href="/categories/Zookeeper%E5%AD%A6%E4%B9%A0" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>ZK学习</span></a></li><li><a href="/categories/Hexo" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>Hexo学习</span></a></li><li><a href="/categories/Redis%E5%AD%A6%E4%B9%A0" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>Redis学习</span></a></li><li><a href="/categories/Docker%E5%AD%A6%E4%B9%A0" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>Docker学习</span></a></li><li><a href="/categories/AP-Calculus" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>AP学习</span></a></li><li><a href="/categories/A-Level" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>A-Level学习</span></a></li><li><a href="/categories/SAT" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>SAT学习</span></a></li><li><a href="/categories/%E8%80%83%E7%A0%94" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>考研</span></a></li><li><a href="/categories/OSSD" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>OSSD</span></a></li><li><a href="/categories/%E9%AB%98%E8%80%83" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>高考</span></a></li></ul></li><li class="m-nav-item"><a href="javascript:;"><i class="fa-fw fa-solid fa-place-of-worship"></i> 我的<span class="m-icon"><i class="fas fa-chevron-right"></i></span></a><ul><li><a href="/galleries" style="margin-left:75px"><i class="fa fas fa-image" style="position:absolute;left:50px"></i> <span>相册</span></a></li><li><a href="/bibi" style="margin-left:75px"><i class="fa fa-fw fa-solid fa-cloud-rain" style="position:absolute;left:50px"></i> <span>哔哔</span></a></li><li><a href="/todolist" style="margin-left:75px"><i class="fa fa-fw fa-solid fa-circle-check" style="position:absolute;left:50px"></i> <span>清单</span></a></li><li><a href="/musics" style="margin-left:75px"><i class="fa fas fa-music" style="position:absolute;left:50px"></i> <span>音乐</span></a></li></ul></li><li class="m-nav-item"><a href="javascript:;"><i class="fa-fw fa-solid fa-circle-info"></i> 更多<span class="m-icon"><i class="fas fa-chevron-right"></i></span></a><ul><li><a href="/contact" style="margin-left:75px"><i class="fa fas fa-comments" style="position:absolute;left:50px"></i> <span>留言</span></a></li><li><a href="/friends" style="margin-left:75px"><i class="fa fa-solid fa-link" style="position:absolute;left:50px"></i> <span>友链</span></a></li><li><a href="/friend-circle" style="margin-left:75px"><i class="fa fa-solid fa-rss" style="position:absolute;left:50px"></i> <span>圈圈</span></a></li><li><a href="/about" style="margin-left:75px"><i class="fa fas fa-user-circle" style="position:absolute;left:50px"></i> <span>关于</span></a></li></ul></li><li><div class="divider"></div></li><li><a href="https://github.com/blinkfox/hexo-theme-matery" class="waves-effect waves-light" target="_blank"><i class="fab fa-github-square fa-fw"></i> Fork Me</a></li></ul></div></div><style>.nav-transparent .github-corner{display:none!important}.github-corner{position:absolute;z-index:10;top:0;right:0;border:0;transform:scale(1.1)}.github-corner svg{color:#0f9d58;fill:#fff;height:64px;width:64px}.github-corner:hover .octo-arm{animation:a .56s ease-in-out}.github-corner .octo-arm{animation:none}@keyframes a{0%,to{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}</style><a href="https://github.com/blinkfox/hexo-theme-matery" class="github-corner tooltipped hide-on-med-and-down" target="_blank" data-tooltip="Fork Me" data-position="left" data-delay="50"><svg viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a></nav></header><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/cryptojs/crypto-js.min.js"></script><script></script><style>:root{--post-bg-image:url('https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/medias/Netty.png')}</style><div class="bg-cover pd-header post-cover"><div class="container" style="right:0;left:0"><div class="row"><div class="col s12 m12 l12"><div class="brand"><h1 class="description center-align post-title">【Netty学习】7.Protocol Buffer序列化</h1></div></div></div></div></div><main class="post-container content"><div class="row"><div id="main-content" class="col s12 m12 l9"><div id="artDetail"><div class="card"><div class="card-content article-info"><div class="row tag-cate"><div class="col s7"><div class="article-tag"><a href="/tags/Netty/"><span class="chip bg-color">Netty</span></a> <a href="/tags/Protocol-Buffer/"><span class="chip bg-color">Protocol Buffer</span></a></div></div><div class="col s5 right-align"><div class="post-cate"><i class="fas fa-bookmark fa-fw icon-category"></i> <a href="/categories/Netty%E5%AD%A6%E4%B9%A0/" class="post-category">Netty学习</a></div></div></div><div class="post-info"><div class="post-date info-break-policy"><i class="far fa-calendar-minus fa-fw"></i> 发布日期:&nbsp;&nbsp; 2023-06-09</div><div class="info-break-policy"><i class="far fa-file-word fa-fw"></i> 文章字数:&nbsp;&nbsp; 4.1k</div><div class="info-break-policy"><i class="far fa-clock fa-fw"></i> 阅读时长:&nbsp;&nbsp; 15 分</div></div></div><hr class="clearfix"><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/prism/prism.min.css"><div class="card-content article-card-content"><div id="articleContent"><h1 id="1-定义"><a href="#1-定义" class="headerlink" title="1 定义"></a>1 定义</h1><p>一种<code>结构化数据</code>的<code>数据存储格式</code>（类似于<code>XML</code>、<code>Json</code>）</p><ul><li><code>Google</code>出品 （开源）</li><li><code>Protocol Buffer</code>目前有两个版本：<code>proto2</code>和<code>proto3</code></li></ul><h2 id="1-1-proto2与proto3的区别"><a href="#1-1-proto2与proto3的区别" class="headerlink" title="1.1 proto2与proto3的区别"></a>1.1 <code>proto2</code>与<code>proto3</code>的区别</h2><ul><li><p>在第一行非空白非注释行，必须写：</p><pre class="line-numbers language-proto3" data-language="proto3"><code class="language-proto3">syntax &#x3D; “proto3”;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>字段规则<strong>移除</strong>了<code>required</code>，并把<code>optional</code>改名为<code>singular</code>；</p></li></ul><p>在 <code>proto2</code> 中 <code>required</code> 也是<strong>不推荐</strong>使用的。<code>proto3</code> 直接从语法层面上移除了 required 规则。其实可以做的更彻底，把所有字段规则描述都撤销，原来的 <code>repeated</code> 改为在类型或字段名后加一对中括号。这样是不是更简洁？</p><ul><li><code>repeated</code>字段默认采用 <code>packed 编码</code>；</li></ul><p>在 <code>proto2</code> 中，需要明确使用 <code>[packed=true]</code> 来为字段指定比较紧凑的 <code>packed 编码</code>方式。</p><ul><li>语言增加<code>Go</code>、<code>Ruby</code>、<code>JavaNano</code> 支持；</li><li>移除了 <code>default</code> 选项；</li></ul><p>在 <code>proto2</code> 中，可以使用 <code>default</code> 选项为某一字段指定<code>默认值</code>。在 <code>proto3</code> 中，字段的默认值只能根据字段类型由<code>系统决定</code>。也就是说，默认值全部是约定好的，而不再提供指定默认值的语法。</p><p>在字段被设置为默认值的时候，该字段不会被序列化。这样可以节省空间，提高效率。但这样就无法区分某字段是根本没赋值，还是赋值了默认值。这在 <code>proto3</code> 中问题不大，但在 <code>proto2</code> 中会有问题。</p><p>比如，在更新协议的时候使用 <code>default</code> 选项为某个字段指定了一个与原来不同的默认值，旧代码获取到的该字段的值会与新代码不一样。</p><p>另一个重约定而弱语法的例子是<code>go</code>语言里的公共/私有对象。Go 语言约定，首字母大写的为公共对象，否则为私有对象。所以在 Go 语言中是没有 <code>public</code>、<code>private</code> 这样的语法的。</p><ul><li>枚举类型的第一个字段必须为 0 ；<br>这也是一个约定。</li><li>移除了对分组的支持；</li></ul><p>分组的功能完全可以用消息嵌套的方式来实现，并且更清晰。在 <code>proto2</code> 中已经把分组语法标注为『过期』了。这次也算清理垃圾了。</p><ul><li>旧代码在解析新增字段时，会把不认识的字段丢弃，再序列化后新增的字段就没了；</li></ul><p>在 <code>proto2</code> 中，旧代码虽然会忽视不认识的新增字段，但并不会将其丢弃，再序列化的时候那些字段会被原样保留。</p><p>我觉得还是 proto2 的处理方式更好一些。能尽量保持兼容性和扩展能力，或许实现起来也更简单。proto3 现在的处理方式，没有带来明显的好处，但丢掉了部分兼容性和灵活性。</p><ul><li>[2017-06-15 更新]：经过漫长的讨论，官方终于同意在 proto3 中恢复 proto2 的处理方式了。</li><li>移除了对扩展的支持，新增了 <code>Any 类型</code>；</li></ul><p>Any 类型是用来替代 proto2 中的扩展的。<code>proto2</code>中的扩展特性很像<code>Swift</code>语言中的扩展。理解起来有点困难，使用起来更是会带来不少混乱。相比之下，<code>proto3</code> 中新增的<code>Any类型</code>有点像<code>C/C++</code>中的<code>void*</code>，好理解，使用起来逻辑也更清晰。</p><ul><li>增加了 <code>JSON</code> 映射特性；</li></ul><p>语言的活力来自于与时俱进。当前，<code>JSON</code>的流行有其充分的理由。很多『现代化』的语言都内置了对<code>JSON</code>的支持，比如<code>Go</code>、<code>PHP</code>等。而<code>C++</code>这种看似保罗万象的学院派语言，因循守旧、故步自封，以致于现出了式微的苗头。</p><h1 id="2-作用"><a href="#2-作用" class="headerlink" title="2 作用"></a>2 作用</h1><p>通过将<code>结构化的数据</code>进行<code>串行化</code>（序列化），从而实现<code>数据存储</code>/<code>RPC</code>数据交换的功能</p><ul><li>序列化：将<code>数据结构或对象</code>转换成<code>二进制串</code>的过程；</li><li>反序列化：将在序列化过程中所生成的<code>二进制串</code>转换成<code>数据结构或者对象</code>的过程。</li></ul><h2 id="2-1-优点"><a href="#2-1-优点" class="headerlink" title="2.1 优点"></a>2.1 优点</h2><ul><li>性能方面<ul><li>体积小：序列化后，数据大小可縮小约3倍</li><li>序列化遮度快：比<code>XML</code>和<code>JSON</code>快20~100倍</li><li>传输速度快：因为体积小，传输起来带宽和速度会有优化</li></ul></li><li><p>使用方面</p><ul><li>使用简单：proto编译器<strong>自动</strong>进行<code>序列化</code>和<code>反序列化</code></li><li>维护成本低：多平台仅需维护一套对象协议文件 (.proto)</li><li>向后兼容性好：即圹展性好，不必破坏旧数据格式就可以直接对数怒结抅进行更新</li><li>加密性好：<code>Http</code>传输内容抓包只能看到字节</li></ul></li><li><p>使用范围方面</p><ul><li>跨平台</li><li>跨语吉</li><li>可拓展性好</li></ul></li></ul><h2 id="2-2-缺点"><a href="#2-2-缺点" class="headerlink" title="2.2 缺点"></a>2.2 缺点</h2><ul><li>功能方面：不适合用于对基于文本的标记文档（如 HTML）建模，因为文本不适合描述数据結构</li><li>其他方面<ul><li>通用性较差：<code>Json</code>、<code>XML</code>已经成为多种行业标准的编写工具，而<code>protobuf</code>只是 Google 公司内部使用的工具</li><li>自解释性差：以<code>二进制数据流</code>方式存储（不可设），需要通过<code>.proto</code>文件才能了解到数据結构.</li></ul></li></ul><h2 id="2-3-总结"><a href="#2-3-总结" class="headerlink" title="2.3 总结"></a>2.3 总结</h2><blockquote><p><code>protocol Buffer</code>比<code>XML</code>、 <code>Json</code>更小、更快、使用且维护更简单。</p></blockquote><h1 id="3-应用场景"><a href="#3-应用场景" class="headerlink" title="3 应用场景"></a>3 应用场景</h1><p><code>传输数据量大</code>且<code>网络环境不稳定</code>的数据存储、RPC 数据交换的需求场景。如<code>即时IM</code>（QQ、微信）的需求场景。</p><h1 id="4-各个语言标量类型对应关系"><a href="#4-各个语言标量类型对应关系" class="headerlink" title="4 各个语言标量类型对应关系"></a>4 各个语言标量类型对应关系</h1><p><img src="https://img.halfrost.com/Blog/ArticleImage/84_3.png" alt="各语言字段类型与PB对应关系"><br><pre class="line-numbers language-text" data-language="text"><code class="language-text">[1] 在 Java 中，无符号的 32 位和 64 位整数使用对应带符号的表示方法，最高位存储符号位。
[2] 在所有情况下，给一个字段设置一个值的时候都会执行类型检查以确保其有效。
[3] 64 位或无符号 32 位整数在解码时始终表示为 long，但是如果在设置字段的时候设置了 int，则可以为 int。 在所有情况下，该值都必须符合设置时表示的类型。参见[2]。
[4] Python 字符串在解码时表示为 unicode，但如果给出了 ASCII 字符串，则可以为 str（此字符串可能会发生变化）。
[5] 在 64 位计算机上使用 Integer，在 32 位计算机上使用 string。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h1 id="5-Protocol-Buffer-编码原理"><a href="#5-Protocol-Buffer-编码原理" class="headerlink" title="5 Protocol Buffer 编码原理"></a>5 Protocol Buffer 编码原理</h1><p>先给出以下三个结论：</p><ul><li><code>Protocol Buffer</code>将消息里的每个字段进行编码后，再利用<code>T - L - V</code>存储方式进行数据的存储，最终得到的是一个<code>二进制字节流</code>。其中<code>Length</code>可选存储，如储存<code>Varint编码</code>数据就不需要存储Length；</li><li><code>Protocol Buffer</code>对于不同数据类型采用不同的<code>序列化方式</code>（编码方式 &amp; 数据存储方式），如下图：<img src="https://gcore.jsdelivr.net/gh/zyxelva/picgo/markdown/944365-7f288f7aef7d6d15.png"><div class="caption"><b class="center-caption">数据类型对应的编码方式</b></div><blockquote><p>注意上图中，3 和 4 已经被废弃了，所以 wire_type 取值目前只有 0、1、2、5。</p></blockquote></li><li>因为<code>Protocol Buffer</code>对于数据字段值的独特<code>编码方式</code> &amp; <code>T - L - V数据存储方式</code>，使得<code>Protocol Buffer</code>序列化后数据量体积如此小。</li></ul><h2 id="5-0-T-L-V存储方式详解"><a href="#5-0-T-L-V存储方式详解" class="headerlink" title="5.0 T-L-V存储方式详解"></a>5.0 T-L-V存储方式详解</h2><p>即<code>Tag - Length - Value</code>，<code>标识</code> - <code>长度</code> - <code>字段值</code>存储方式。</p><img src="https://gcore.jsdelivr.net/gh/zyxelva/picgo/markdown/PB-TLV.png"><div class="caption"><b class="center-caption">T-L-V</b></div><p>其中：</p><ul><li>T：Tag，字段标识号，由<code>标识号</code>（field_number）和<code>数据类型</code>（wire_type），即：<pre class="line-numbers language-none"><code class="language-none">Tag &#x3D; 字段数据类型（wire_type） + 标识号（field_number）<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>举例：<pre class="line-numbers language-protobuf" data-language="protobuf"><code class="language-protobuf"><span class="token comment">// 消息对象</span>
 <span class="token keyword">message</span> <span class="token class-name">person</span>
 <span class="token punctuation">&#123;</span> 
    <span class="token keyword">required</span> <span class="token builtin">int32</span>     id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// wire type = 0，field_number =1 </span>
    <span class="token keyword">required</span> <span class="token builtin">string</span>    name <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// wire type = 2，field_number =2 </span>
  <span class="token punctuation">&#125;</span>

<span class="token comment">// 以字段【name】为例，其Tag的二进制 = 0001 0010，由这个【0001 0010】可以推出：</span>
<span class="token comment">// 标识号( field_number) = Tag >> 3(Tag右移3位) =  0000 0010 = 2</span>
<span class="token comment">// 数据类型(wire_type) = Tag的最低三位表示 = 010 = 2</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li>L：Length，Value的字节长度，可选；<blockquote><p>对于 <code>Varint</code> 和 <code>Zigzag</code> 编码，省略了<code>T - L - V</code>中的字节长度<code>Length</code>。</p></blockquote></li><li>V：Value，消息字段经过编码后的值。<ul><li>对于<code>wire_type=0</code>，那就是经过 Protocol Buffer采用<code>Varint &amp; Zigzag</code>编码后的消息字段的值；</li><li>对于<code>wire_type=2</code>，如果是String类型，那就是经过<code>UTF-8</code>编码过后的值；如果是嵌套类型，那就是根据里面的字段数据类型进行编码后的值；</li></ul></li><li>具体使用：<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">// Tag 的具体表达式如下
 Tag  <span class="token operator">=</span> <span class="token punctuation">(</span>field_number <span class="token operator">&lt;&lt;</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">|</span> wire_type
// 参数说明：
// field_number：对应于 .proto文件中消息字段的标识号，表示这是消息里的第几个字段
// field_number <span class="token operator">&lt;&lt;</span> <span class="token number">3</span>：表示 field_number <span class="token operator">=</span> 将 Tag的二进制表示【右移三位】后的值（反推标识号怎么从Tag算出）
// field_number左移3位不会导致数据丢失，因为表示范围还是足够大地去表示消息里的字段数目

//  wire_type：表示 字段 的数据类型
//  wire_type <span class="token operator">=</span> Tag的二进制表示的最低三位值
//  wire_type的取值
 enum WireType <span class="token punctuation">&#123;</span> 
      WIRETYPE_VARINT <span class="token operator">=</span> <span class="token number">0</span>, 
      WIRETYPE_FIXED64 <span class="token operator">=</span> <span class="token number">1</span>, 
      WIRETYPE_LENGTH_DELIMITED <span class="token operator">=</span> <span class="token number">2</span>, 
      WIRETYPE_START_GROUP <span class="token operator">=</span> <span class="token number">3</span>, 
      WIRETYPE_END_GROUP <span class="token operator">=</span> <span class="token number">4</span>, 
      WIRETYPE_FIXED32 <span class="token operator">=</span> <span class="token number">5</span>
   <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

// 从上面可以看出，【wire_type】最多占用【3位】的内存空间（因为3位足以表示 <span class="token number">0</span>-5 的二进制）<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h2 id="5-1-无符号数"><a href="#5-1-无符号数" class="headerlink" title="5.1 无符号数"></a>5.1 无符号数</h2><h3 id="5-1-1-Varint编码方式介绍"><a href="#5-1-1-Varint编码方式介绍" class="headerlink" title="5.1.1 Varint编码方式介绍"></a>5.1.1 <code>Varint</code>编码方式介绍</h3><ul><li>定义：一种<code>变长</code>的编码方式</li><li>原理：用<code>字节</code>表示<code>数字</code>：值越小的数字，使用越少的字节数表示</li><li>作用：通过减少表示数字的字节数，从而进行数据压缩</li><li>源码：<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">writeVarint32</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                                                                                    
  <span class="token keyword">int</span> idx <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  
  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>n <span class="token operator">&amp;</span> <span class="token operator">~</span><span class="token number">0x7F</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  
      i32buf<span class="token punctuation">[</span>idx<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>byte<span class="token punctuation">)</span>n<span class="token punctuation">;</span>  
      <span class="token keyword">break</span><span class="token punctuation">;</span>  
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>  
      i32buf<span class="token punctuation">[</span>idx<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>byte<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span>n <span class="token operator">&amp;</span> <span class="token number">0x7F</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token number">0x80</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
      <span class="token comment">// 步骤1：取出字节串末7位</span>
      <span class="token comment">// 对于上述取出的7位：在最高位添加1构成一个字节</span>
      <span class="token comment">// 如果是最后一次取出，则在最高位添加0构成1个字节</span>

      n <span class="token operator">>></span><span class="token operator">>=</span> <span class="token number">7</span><span class="token punctuation">;</span>  
      <span class="token comment">// 步骤2：通过将字节串整体往右移7位，继续从字节串的末尾选取7位，直到取完为止。</span>
    <span class="token punctuation">&#125;</span>  
  <span class="token punctuation">&#125;</span>  
  trans_<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>i32buf<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> idx<span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token comment">// 步骤3： 将上述形成的每个字节 按序拼接 成一个字节串</span>
      <span class="token comment">// 即该字节串就是经过Varint编码后的字节</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><p><code>Varint</code>中的每个字节（最后一个字节除外）都设置了<code>最高有效位</code>（msb），这一位表示还会有更多字节出现。每个字节的低 7 位用于以 7 位组的形式存储数字的二进制补码表示，最低有效组首位。</p><p>因此：</p><ul><li>小于 128 的数字都可以用 1个字节 表示；</li><li>大于 128 的数字，比如 <code>300</code>，会用两个字节来表示：<code>10101100 00000010</code></li></ul><h3 id="5-1-2-编码"><a href="#5-1-2-编码" class="headerlink" title="5.1.2 编码"></a>5.1.2 编码</h3><p>以 <code>300</code> 举例：<br><pre class="line-numbers language-C" data-language="C"><code class="language-C">if (v &lt; (1&lt;&lt;14)) &#123;
*(ptr++) &#x3D; v | B;
*(ptr++) &#x3D; v&gt;&gt;7;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></p><ul><li>100101100 | 10000000 = 1 1010 1100</li><li>110101100 取出末尾 7 位 = 010 1100</li><li>100101100 &gt;&gt; 7 = 10 = 0000 0010</li><li>1010 1100 0000 0010 (最终 Varint 结果)</li></ul><p>两个字节就搞定<code>300</code>的编码。</p><h3 id="5-1-3-解码"><a href="#5-1-3-解码" class="headerlink" title="5.1.3 解码"></a>5.1.3 解码</h3><ul><li>如果是多个字节，先去掉每个字节的 msb（通过逻辑或运算），每个字节只留下 7 位。</li><li>逆序整个结果，最多是 5 个字节，排序是 1-2-3-4-5，逆序之后就是 5-4-3-2-1，字节内部的二进制位的顺序不变，变的是字节的相对位置。</li></ul><img src="https://gcore.jsdelivr.net/gh/zyxelva/picgo/markdown/944365-2c08dd56bfe0cba5.png"><div class="caption"><b class="center-caption">300的解码过程</b></div><h3 id="5-1-4-Varint-编码方式的不足"><a href="#5-1-4-Varint-编码方式的不足" class="headerlink" title="5.1.4 Varint 编码方式的不足"></a>5.1.4 Varint 编码方式的不足</h3><p>在计算机内，负数一般会被表示为很大的整数，因为计算机定义<code>负数</code>的符号位为数字的<code>最高位</code>。</p><ul><li>问题：如果采用<code>Varint编码</code>方式表示一个<code>负数</code>，那么一定需要 5 个 byte（因为负数的最高位是1，会被当做很大的整数去处理）</li><li>解决方案： <code>Protocol Buffer</code>定义了 <code>sint32</code> / <code>sint64</code> 类型表示<code>负数</code>，通过先采用<code>Zigzag 编码</code>（将<code>有符号数</code>转换成<code>无符号数</code>），再采用<code>Varint编码</code>，从而用于减少编码后的字节数。</li></ul><h3 id="5-1-5-存储方式"><a href="#5-1-5-存储方式" class="headerlink" title="5.1.5 存储方式"></a>5.1.5 存储方式</h3><p>存储方式：<code>T - V</code></p><h2 id="5-2-有符号数"><a href="#5-2-有符号数" class="headerlink" title="5.2 有符号数"></a>5.2 有符号数</h2><h3 id="5-2-1-Zigzag编码方式"><a href="#5-2-1-Zigzag编码方式" class="headerlink" title="5.2.1 Zigzag编码方式"></a>5.2.1 <code>Zigzag</code>编码方式</h3><ul><li>定义：一种<code>变长</code>的编码方式；</li><li>原理：使用<code>无符号数</code>来表示<code>有符号</code>数字；</li><li>作用：使得绝对值小的数字都可以采用较少字节来表示；</li><li>源码分析<pre class="line-numbers language-C" data-language="C"><code class="language-C">public int int_to_zigzag(int n)
&#x2F;&#x2F; 传入的参数n &#x3D; 传入字段值的二进制表示（此处以负数为例）
&#x2F;&#x2F; 负数的二进制 &#x3D; 符号位为1，剩余的位数为 该数绝对值的原码按位取反；然后整个二进制数+1
&#123;
return (n &lt;&lt;1) ^ (n &gt;&gt;31);   
&#x2F;&#x2F; 对于sint 32 数据类型，使用Zigzag编码过程如下：
&#x2F;&#x2F; 1. 将二进制表示数 左移1位（左移 &#x3D; 整个二进制左移，低位补0）
&#x2F;&#x2F; 2. 将二进制表示数 右移31位
&#x2F;&#x2F; 对于右移：
&#x2F;&#x2F; 首位是1的二进制（有符号数），是算数右移，即右移后左边补1
&#x2F;&#x2F; 首位是0的二进制（无符号数），是逻辑左移，即右移后左边补0
&#x2F;&#x2F; 3. 将上述二者进行异或

        &#x2F;&#x2F; 对于sint 64 数据类型 则为： return  (n &lt;&lt; 1&gt; ^ (n &gt;&gt; 63) ；
&#125;


&#x2F;&#x2F; 附：将Zigzag值解码为整型值
public int zigzag_to_int(int n)
&#123;
return(n &gt;&gt;&gt; 1) ^ -(n &amp; 1);
&#x2F;&#x2F; 右移时，需要用不带符号的移动，否则如果第一位数据位是1的话，就会补1
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><p>以<code>-2</code>进行编码为例：<br><img src="https://gcore.jsdelivr.net/gh/zyxelva/picgo/markdown/944365-0809177f42d0e362.png"></p><div class="caption"><b class="center-caption">-2的zigzag编码过程</b></div><p></p><h3 id="5-2-2-存储方式"><a href="#5-2-2-存储方式" class="headerlink" title="5.2.2 存储方式"></a>5.2.2 存储方式</h3><p>存储方式：<code>T - V</code></p><h2 id="5-3-定长数"><a href="#5-3-定长数" class="headerlink" title="5.3 定长数"></a>5.3 定长数</h2><p><code>double</code> 、<code>fixed64</code> 的 wire_type 为 1，在解析时告诉解析器，该类型的数据需要一个 <code>64 位</code>大小的数据块即可。</p><p>同理，<code>float</code> 和 <code>fixed32</code> 的 wire_type 为5，给其 32 位数据块即可。两种情况下，都是高位在后，低位在前。</p><ul><li><code>64(32)-bit</code>编码方式较简单：编码后的数据具备固定大小 = 64位（8字节）or 32位（4字节）</li><li>采用<code>T - V</code>方式进行数据存储。<blockquote><p>说 <code>Protocol Buffer</code> 压缩数据没有到极限，原因就在这里，因为并没有压缩 <code>float</code>、<code>double</code> 这些浮点类型。</p></blockquote></li></ul><h2 id="5-4-String类型"><a href="#5-4-String类型" class="headerlink" title="5.4 String类型"></a>5.4 String类型</h2><img src="https://gcore.jsdelivr.net/gh/zyxelva/picgo/markdown/PB-String3.png"><div class="caption"><b class="center-caption">String类型编码方式</b></div><img src="https://gcore.jsdelivr.net/gh/zyxelva/picgo/markdown/PB-String2.png"><div class="caption"><b class="center-caption">String类型存储方式</b></div><p><code>Value</code>采用<code>UTF-8</code>编码，存储方式则采用<code>T-L-V</code>，比如：<br><pre class="line-numbers language-protobuf" data-language="protobuf"><code class="language-protobuf"><span class="token keyword">message</span> <span class="token class-name">Test2</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">required</span> <span class="token builtin">string</span> str <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 将str设置为：testing</span>
<span class="token comment">// Test2.setStr（“testing”） </span>

<span class="token comment">// 经过protobuf编码序列化后的数据以二进制的方式输出</span>
<span class="token comment">// 输出为：18, 7, 116, 101, 115, 116, 105, 110, 103</span>

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><img src="https://gcore.jsdelivr.net/gh/zyxelva/picgo/markdown/PB-String.png"><div class="caption"><b class="center-caption">String类型编码举例</b></div><h2 id="5-5-嵌套消息类型"><a href="#5-5-嵌套消息类型" class="headerlink" title="5.5 嵌套消息类型"></a>5.5 嵌套消息类型</h2><img src="https://gcore.jsdelivr.net/gh/zyxelva/picgo/markdown/944365-6eafc7964085f380.png"><div class="caption"><b class="center-caption">嵌套类型的编码和存储方式</b></div><p>定义如下嵌套消息：<br><pre class="line-numbers language-protobuf" data-language="protobuf"><code class="language-protobuf"><span class="token keyword">message</span> <span class="token class-name">Test2</span>
<span class="token punctuation">&#123;</span>
  <span class="token comment">// wire type = 2，field_number =2 </span>
  <span class="token keyword">required</span> <span class="token builtin">string</span> str <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token comment">// wire type = 0，field_number =2 </span>
  <span class="token keyword">required</span> <span class="token builtin">int32</span> id1 <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">message</span> <span class="token class-name">Test3</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">required</span> <span class="token positional-class-name class-name">Test2</span> c <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 将Test2中的字段str设置为：testing</span>
<span class="token comment">// 将Test2中的字段id1设置为：296</span>
<span class="token comment">// 编码后的字节为：10 ，12 ，18，7，116, 101, 115, 116, 105, 110, 103，16，-88，2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><br><img src="https://gcore.jsdelivr.net/gh/zyxelva/picgo/markdown/944365-8a8bab1a3a427f25.png"></p><div class="caption"><b class="center-caption">举例</b></div><p></p><h2 id="5-6-通过packed修饰的-repeat-字段"><a href="#5-6-通过packed修饰的-repeat-字段" class="headerlink" title="5.6 通过packed修饰的 repeat 字段"></a>5.6 通过packed修饰的 repeat 字段</h2><blockquote><p>repeated类型可以看成是数组/列表</p></blockquote><ul><li><p>背景：对于同一个<code>repeated</code>字段、多个字段值来说，他们的<code>Tag</code>都是相同的，即<code>数据类型</code> &amp; <code>标识号</code>都相同;</p></li><li><p>问题：若以传统的多个 <code>T - V</code>对存储（不带packed=true），则会导致<code>Tag</code>的冗余，即相同的Tag存储多次；</p><img src="https://gcore.jsdelivr.net/gh/zyxelva/picgo/markdown/PB-without-pack.jpg"><div class="caption"><b class="center-caption">不带pack的存储方式</b></div></li><li>解决方案：采用带packed=true 的 repeated 字段存储方式，即将相同的 Tag 只存储一次、添加 <code>repeated</code> 字段下所有字段值的长度<code>Length</code>、连续存储 <code>repeated</code> 字段值，组成一个大的<code>Tag - Length - Value -Value -Value</code>对，即<code>T - L - V - V - V</code>对。</li></ul><img src="https://gcore.jsdelivr.net/gh/zyxelva/picgo/markdown/944365-3f82002508a4f880.png"><div class="caption"><b class="center-caption">带pack的存储方式</b></div><p>例如有如下 message 类型：<br><pre class="line-numbers language-protobuf" data-language="protobuf"><code class="language-protobuf"><span class="token keyword">message</span> <span class="token class-name">Test4</span> <span class="token punctuation">&#123;</span>
<span class="token keyword">repeated</span> <span class="token builtin">int32</span> d <span class="token operator">=</span> <span class="token number">4</span> <span class="token punctuation">[</span><span class="token annotation">packed</span><span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><br>构造一个 <code>Test4</code> 字段，并且设置 <code>repeated</code> 字段 <code>d</code> 3个值：3，270和86942，编码后：<br><pre class="line-numbers language-C" data-language="C"><code class="language-C">22 &#x2F;&#x2F; tag 0010 0010(field number 010 0 &#x3D; 4, wire type 010 &#x3D; 2)

06 &#x2F;&#x2F; payload size (设置的length &#x3D; 6 bytes)

03 &#x2F;&#x2F; first element (varint 3)

8E 02 &#x2F;&#x2F; second element (varint 270)

9E A7 05 &#x2F;&#x2F; third element (varint 86942)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><blockquote><p>特别注意</p><ul><li>required字段<code>必须</code>要被设置字段值</li><li>序列化顺序是根据<code>Tag标识号</code>从小到大进行编码，和 .proto文件内字段定义的数据<code>无关</code></li><li>Protocol Buffer 的 <code>packed</code>修饰只用于<code>repeated字段</code>或<code>基本类型的repeated字段</code></li><li>用在其他字段，编译 <code>.proto</code> 文件时会报错</li></ul></blockquote><h1 id="6-参考文章"><a href="#6-参考文章" class="headerlink" title="6 参考文章"></a>6 参考文章</h1><ul><li><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/30ef9b3780d9">Protocol Buffer 序列化原理大揭秘 - 为什么Protocol Buffer性能这么好？</a></li><li><a target="_blank" rel="noopener" href="https://halfrost.com/protobuf_encode/">高效的数据压缩编码方式 Protobuf</a></li></ul></div><hr><div class="reprint" id="reprint-statement"><div class="reprint__author"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-user">文章作者:</i></span> <span class="reprint-info"><a href="/about" rel="external nofollow noreferrer">Kezade</a></span></div><div class="reprint__type"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-link">文章链接:</i></span> <span class="reprint-info"><a href="https://zyxelva.github.io/posts/2052182147.html">https://zyxelva.github.io/posts/2052182147.html</a></span></div><div class="reprint__notice"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-copyright">版权声明:</i></span> <span class="reprint-info">本博客所有文章除特別声明外，均采用 <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a> 许可协议。转载请注明来源 <a href="/about" target="_blank">Kezade</a> !</span></div></div><script async defer>function navToReprintStatement(){$("html, body").animate({scrollTop:$("#reprint-statement").offset().top-80},800)}document.addEventListener("copy",function(t){M.toast({html:'<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>'})})</script><div class="tag_share" style="display:block"><div class="post-meta__tag-list" style="display:inline-block"><div class="article-tag"><a href="/tags/Netty/"><span class="chip bg-color">Netty</span></a> <a href="/tags/Protocol-Buffer/"><span class="chip bg-color">Protocol Buffer</span></a></div></div><div class="post_share" style="zoom:80%;width:fit-content;display:inline-block;float:right;margin:-.15rem 0"><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/share/css/share.min.css"><div id="article-share"><div class="social-share" data-sites="google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/share/js/social-share.min.js"></script></div></div></div><div id="reward"><a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a><div id="rewardModal" class="modal"><div class="modal-content"><a class="close modal-close"><i class="fas fa-times"></i></a><h4 class="reward-title">你的赏识是我前进的动力</h4><div class="reward-content"><div class="reward-tabs"><ul class="tabs row"><li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li><li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li></ul><div id="alipay"><img src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码"></div><div id="wechat"><img src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码"></div></div></div></div></div></div><script>$(function(){$(".tabs").tabs()})</script></div></div><style>.twikoo-card{margin:1.5rem auto}.twikoo-card .card-content{padding:20px}#tcomments textarea{box-sizing:border-box;background:url("/") 100% 100% no-repeat}#tcomments p{margin:2px 2px 10px;font-size:1.05rem;line-height:1.78rem;text-align:left}#tcomments blockquote p{text-indent:.2rem}#tcomments a{padding:0 2px;color:#4cbf30;font-weight:500;text-decoration:none}#tcomments img{max-width:100%;height:auto;cursor:pointer}#tcomments ol li{list-style-type:decimal}#tcomments ol,ul{display:block;padding-left:2em;word-spacing:0.05rem}#tcomments ul li,ol li{display:list-item;line-height:1.8rem;font-size:1rem}#tcomments ul li{list-style-type:disc}#tcomments ul ul li{list-style-type:circle}#tcomments table,td,th{padding:12px 13px;border:1px solid #dfe2e5}#tcomments table,td,th{border:0}table tr:nth-child(2n),thead{background-color:#fafafa}#tcomments table th{background-color:#f2f2f2;min-width:80px}#tcomments table td{min-width:80px}#tcomments h1{font-size:1.85rem;font-weight:700;line-height:2.2rem}#tcomments h2{font-size:1.65rem;font-weight:700;line-height:1.9rem}#tcomments h3{font-size:1.45rem;font-weight:700;line-height:1.7rem}#tcomments h4{font-size:1.25rem;font-weight:700;line-height:1.5rem}#tcomments h5{font-size:1.1rem;font-weight:700;line-height:1.4rem}#tcomments h6{font-size:1rem;line-height:1.3rem}#tcomments p{font-size:1rem;line-height:1.5rem}#tcomments hr{margin:12px 0;border:0;border-top:1px solid #ccc}#tcomments blockquote{margin:15px 0;border-left:5px solid #42b983;padding:1rem .8rem .3rem .8rem;color:#666;background-color:rgba(66,185,131,.1)}#tcomments pre{font-family:monospace,monospace;padding:1.2em;margin:.5em 0;background:#272822;overflow:auto;border-radius:.3em;tab-size:4}#tcomments code{font-family:monospace,monospace;padding:1px 3px;font-size:.92rem;color:#e96900;background-color:#f8f8f8;border-radius:2px}#tcomments pre code{font-family:monospace,monospace;padding:0;color:#e8eaf6;background-color:#272822}#tcomments pre[class*=language-]{padding:1.2em;margin:.5em 0}#tcomments code[class*=language-],pre[class*=language-]{color:#e8eaf6}#tcomments [type=checkbox]:not(:checked),[type=checkbox]:checked{position:inherit;margin-left:-1.3rem;margin-right:.4rem;margin-top:-1px;vertical-align:middle;left:unset;visibility:visible}#tcomments b,strong{font-weight:700}#tcomments dfn{font-style:italic}#tcomments small{font-size:85%}#tcomments cite{font-style:normal}#tcomments mark{background-color:#fcf8e3;padding:.2em}#tcomments table,td,th{padding:12px 13px;border:1px solid #dfe2e5}table tr:nth-child(2n),thead{background-color:#fafafa}#tcomments table th{background-color:#f2f2f2;min-width:80px}#tcomments table td{min-width:80px}#tcomments [type=checkbox]:not(:checked),[type=checkbox]:checked{position:inherit;margin-left:-1.3rem;margin-right:.4rem;margin-top:-1px;vertical-align:middle;left:unset;visibility:visible}</style><div class="card twikoo-card" data-aos="fade-up"><div class="comment_headling" style="font-size:20px;font-weight:700;position:relative;padding-left:20px;top:15px;padding-bottom:5px"><i class="fas fa-comments fa-fw" aria-hidden="true"></i> <span>评论</span></div><div class="card-content" style="display:grid"><div id="tcomments"></div></div></div><script src="https://gcore.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js"></script><script>twikoo.init({envId:"https://kezadetwikoo.netlify.app/.netlify/functions/twikoo",el:"#tcomments",region:"",path:""}).then(function(){for(var t=document.querySelector("#twikoo").getElementsByTagName("input"),e=0;e<t.length;e++)t[e]&&t[e].classList.add("browser-default")})</script><article id="prenext-posts" class="prev-next articles"><div class="row article-row"><div class="article col s12 m6" data-aos="fade-up"><div class="article-badge left-badge text-color"><i class="fas fa-chevron-left"></i> &nbsp;上一篇</div><div class="card"><a href="/posts/1366461558.html"><div class="card-image"><img src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/medias/featureimages/9.jpg" class="responsive-img" alt="【Hexo】基于Matery主题将博客接入Umami"> <span class="card-title">【Hexo】基于Matery主题将博客接入Umami</span></div></a><div class="card-content article-content"><div class="summary block-with-text"></div><div class="publish-info"><span class="publish-date"><i class="far fa-clock fa-fw icon-date"></i> 2023-06-14</span><span class="publish-author"><i class="fas fa-bookmark fa-fw icon-category"></i> <a href="/categories/Hexo/" class="post-category">Hexo</a></span></div></div><div class="card-action article-tags"><a href="/tags/Hexo%E5%8D%9A%E5%AE%A2/"><span class="chip bg-color">Hexo博客</span></a></div></div></div><div class="article col s12 m6" data-aos="fade-up"><div class="article-badge right-badge text-color">下一篇&nbsp;<i class="fas fa-chevron-right"></i></div><div class="card"><a href="/posts/1598177646.html"><div class="card-image"><img src="/images/uploads/123f761ecece285af724e41f.jpg" class="responsive-img" alt="【Hexo】Github博客内容管理解决方案 - netlifycms"> <span class="card-title">【Hexo】Github博客内容管理解决方案 - netlifycms</span></div></a><div class="card-content article-content"><div class="summary block-with-text">这个是个从CMS撰写页面的实现方案</div><div class="publish-info"><span class="publish-date"><i class="far fa-clock fa-fw icon-date"></i> 2023-06-08</span><span class="publish-author"><i class="fas fa-bookmark fa-fw icon-category"></i> <a href="/categories/Hexo/" class="post-category">Hexo</a></span></div></div><div class="card-action article-tags"><a href="/tags/Hexo/"><span class="chip bg-color">Hexo</span></a></div></div></div></div></article></div><script>$("#articleContent").on("copy",function(e){if(void 0!==window.getSelection){var n=window.getSelection();if(!((""+n).length<Number.parseInt("120"))){var t=document.getElementsByTagName("body")[0],o=document.createElement("div");o.style.position="absolute",o.style.left="-99999px",t.appendChild(o),o.appendChild(n.getRangeAt(0).cloneContents()),"PRE"!==n.getRangeAt(0).commonAncestorContainer.nodeName&&"CODE"!==n.getRangeAt(0).commonAncestorContainer.nodeName||(o.innerHTML="<pre>"+o.innerHTML+"</pre>");var i=document.location.href;o.innerHTML+='<br />来源: Kezade<br />文章作者: Kezade<br />文章链接: <a href="'+i+'">'+i+"</a><br />本文章著作权归作者所有，任何形式的转载都请注明出处。",n.selectAllChildren(o),window.setTimeout(function(){t.removeChild(o)},200)}}})</script><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/codeBlock/codeBlockFuction.js"></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/prism/prism.min.js"></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/codeBlock/codeLang.js"></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/codeBlock/codeCopy.js"></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/codeBlock/codeShrink.js"></script></div><div id="toc-aside" class="expanded col l3 hide-on-med-and-down"><div class="toc-widget card" style="background-color:#fff"><div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div><div id="toc-content"></div></div></div></div><div id="floating-toc-btn" class="hide-on-med-and-down"><a class="btn-floating btn-large bg-color"><i class="fas fa-list-ul"></i></a></div><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/tocbot/tocbot.min.js"></script><script>$(function(){tocbot.init({tocSelector:"#toc-content",contentSelector:"#articleContent",headingsOffset:-(.4*$(window).height()-45),collapseDepth:Number("0"),headingSelector:"h1, h2, h3, h4, h5"});let t=parseInt(.4*$(window).height()-64),e=$(".toc-widget");$(window).scroll(function(){$(window).scrollTop()>t?e.addClass("toc-fixed"):e.removeClass("toc-fixed")});const o="expanded";let n=$("#toc-aside"),i=$("#main-content");$("#floating-toc-btn .btn-floating").click(function(){n.hasClass(o)?(n.removeClass(o).hide(),i.removeClass("l9")):(n.addClass(o).show(),i.addClass("l9")),function(t,e){let o=$("#"+t);if(0===o.length)return;let n=o.width();n+=n>=450?21:n>=350&&n<450?18:n>=300&&n<350?16:14,$("#"+e).width(n)}("artDetail","prenext-posts")})})</script></main><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script>MathJax.Hub.Config({tex2jax:{inlineMath:[["$","$"],["\\(","\\)"]]}})</script><footer class="page-footer bg-color"><div class="container row center-align" style="margin-bottom:15px!important"><div class="col s12 m8 l8 copy-right">Copyright&nbsp;&copy; <span id="year">2019-2025</span> <a href="/about" target="_blank">Kezade</a> |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a> |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a><br><br><span id="sitetime">Loading ...</span><script>var calcSiteTime=function(){var e=6e4,t=36e5,n=864e5,a=365*n,i=new Date,r="2019",o=i.getFullYear(),s=i.getMonth()+1,l=i.getDate(),m=i.getHours(),c=i.getMinutes(),d=i.getSeconds(),g=Date.UTC(r,"6","28","0","0","0"),h=Date.UTC(o,s,l,m,c,d)-g,u=Math.floor(h/a),M=Math.floor(h/n-365*u),T=Math.floor((h-(365*u+M)*n)/t),f=Math.floor((h-(365*u+M)*n-T*t)/e),y=Math.floor((h-(365*u+M)*n-T*t-f*e)/1e3);if(r===String(o)){document.getElementById("year").innerHTML=o;var v="This site has been running for "+M+" days";v="本站已运行 "+M+" 天",document.getElementById("sitetime").innerHTML=v}else{document.getElementById("year").innerHTML=r+" - "+o;var H="This site has been running for "+u+" years and "+M+" days "+T+" hours "+f+" mins "+y+" seconds";H="本站已苟且偷生 "+u+" 年 "+M+" 天 "+T+" 小时 "+f+" 分钟 "+y+" 秒",document.getElementById("sitetime").innerHTML=H}};calcSiteTime(),setInterval(calcSiteTime,1e3)</script><br></div><div class="col s12 m4 l4 social-link"><a href="https://github.com/zyxelva" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50"><i class="fab fa-github"></i></a><a href="mailto:zyxelva@gmail.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50"><i class="fas fa-envelope-open"></i></a><a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=1807401971" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 1807401971" data-position="top" data-delay="50"><i class="fab fa-qq"></i></a> <a href="https://www.zhihu.com/people/kezade" class="tooltipped" target="_blank" data-tooltip="关注我的知乎: https://www.zhihu.com/people/kezade" data-position="top" data-delay="50"><i class="fab fa-zhihu1">知</i></a><a href="../rss2.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50"><i class="fas fa-rss"></i></a></div></div></footer><div class="progress-bar"></div><div id="searchModal" class="modal"><div class="modal-content"><div class="search-header"><span class="title"><i class="fas fa-search"></i> &nbsp;&nbsp;搜索</span> <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字" class="search-input"></div><div id="searchResult"></div></div></div><script>$(function(){!function(t,e,r){"use strict";$.ajax({url:t,dataType:"xml",success:function(t){var n=$("entry",t).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get(),a=document.getElementById(e),s=document.getElementById(r);a.addEventListener("input",function(){var t='<ul class="search-result-list">',e=this.value.trim().toLowerCase().split(/[\s\-]+/);s.innerHTML="",this.value.trim().length<=0||(n.forEach(function(r){var n=!0,a=r.title.trim().toLowerCase(),s=r.content.trim().replace(/<[^>]+>/g,"").toLowerCase(),i=r.url;i=0===i.indexOf("/")?r.url:"/"+i;var l=-1,c=-1,u=-1;if(""!==a&&""!==s&&e.forEach(function(t,e){l=a.indexOf(t),c=s.indexOf(t),l<0&&c<0?n=!1:(c<0&&(c=0),0===e&&(u=c))}),n){t+="<li><a href='"+i+"' class='search-result-title'>"+a+"</a>";var o=r.content.trim().replace(/<[^>]+>/g,"");if(u>=0){var h=u-20,f=u+80;h<0&&(h=0),0===h&&(f=100),f>o.length&&(f=o.length);var m=o.substr(h,f);e.forEach(function(t){var e=new RegExp(t,"gi");m=m.replace(e,'<em class="search-keyword">'+t+"</em>")}),t+='<p class="search-result">'+m+"...</p>"}t+="</li>"}}),t+="</ul>",s.innerHTML=t)})}})}("/search.xml","searchInput","searchResult")})</script><div class="stars-con"><div id="stars"></div><div id="stars2"></div><div id="stars3"></div></div><script>function switchNightMode(){$('<div class="Cuteen_DarkSky"><div class="Cuteen_DarkPlanet"></div></div>').appendTo($("body")),setTimeout(function(){$("body").hasClass("DarkMode")?($("body").removeClass("DarkMode"),localStorage.setItem("isDark","0"),$("#sum-moon-icon").removeClass("fa-sun").addClass("fa-moon")):($("body").addClass("DarkMode"),localStorage.setItem("isDark","1"),$("#sum-moon-icon").addClass("fa-sun").removeClass("fa-moon")),setTimeout(function(){$(".Cuteen_DarkSky").fadeOut(1e3,function(){$(this).remove()})},2e3)})}</script><div id="backTop" class="top-scroll"><a class="btn-floating btn-large waves-effect waves-light" href="#!"><i class="fas fa-arrow-up"></i></a></div><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/materialize/materialize.min.js"></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/masonry/masonry.pkgd.min.js"></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/aos/aos.js"></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/scrollprogress/scrollProgress.min.js"></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/lightGallery/js/lightgallery-all.min.js"></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/js/matery.js"></script><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/mermaid/mermaid.min.css"><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/mermaid/mermaid.min.js"></script><script>window.mermaid&&mermaid.initialize({theme:"forest"})</script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/background/ribbon-dynamic.js" async></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/instantpage/instantpage.js" type="module"></script></body></html>
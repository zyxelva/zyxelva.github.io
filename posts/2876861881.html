<!DOCTYPE HTML><html lang="zh-CN"><head><meta charset="utf-8"><meta name="keywords" content="【Redis学习】3.高可用之主从复制, Back-End Dev Java"><meta name="description" content="1 概述复制，主要用于解决单点问题。生产上通常会备用多个节点，以备主节点宕机之患。同时，对于读场景多的情况，也可以做到负载均衡的效果。

主从复制，是指将一台Redis服务器的数据，复制到其他的Redis服务器。前者称为主节点(master"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><meta name="renderer" content="webkit|ie-stand|ie-comp"><meta name="mobile-web-app-capable" content="yes"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="referrer" content="no-referrer-when-downgrade"><title>【Redis学习】3.高可用之主从复制 | Kezade</title><link rel="icon" type="image/jpeg" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/medias/avatar/avatar2.jpg"><style>body{background-image:url(https://it-ark-dev.oss-cn-shenzhen.aliyuncs.com/464e9ac7a5a729ae67f91f7cf0cf6fe2.jpg);background-repeat:no-repeat;background-attachment:fixed;background-size:cover;background-position:center center}</style><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/awesome/css/all.min.css"><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/materialize/materialize.min.css"><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/aos/aos.css"><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/animate/animate.min.css"><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/lightGallery/css/lightgallery.min.css"><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/picgo@v3.1/css/matery.css?v3"><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/css/my.css"><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/css/dark.css" media="none" onload='"all"!=media&&(media="all")'><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/tocbot/tocbot.css"><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/css/post.css"><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/css/reward.css"><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/jquery/jquery-3.6.0.min.js"></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/picgo@v3.3/js/function.js?v88"></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/picgo@v1.3/js/imgStatus.min.js"></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/picgo@v1.3/js/waterfall.min.js"></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/picgo@v1.3/js/lately.min.js"></script><script>var memos={host:"https://s.dusays.com/",limit:"10",creatorId:"49",username:"zyxelva",name:"Kezade",domId:"#memos",path:"api/v1/memo"},douban={api:"https://douban-api.edui.fun/"}</script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/rss2.xml" title="Kezade" type="application/rss+xml"></head><body><header class="navbar-fixed"><nav id="headNav" class="bg-color nav-transparent"><div id="navContainer" class="nav-wrapper container"><div class="brand-logo"><a href="/" class="waves-effect waves-light"><img src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/medias/avatar/avatar2.jpg" class="logo-img k-avatar" alt="LOGO"> <span class="logo-span">Kezade</span></a></div><a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a><ul class="right nav-menu"><li class="hide-on-med-and-down nav-item"><a href="/" class="waves-effect waves-light"><i class="fas fa-home" style="zoom:0.6"></i> <span>首页</span></a></li><li class="hide-on-med-and-down nav-item"><a href="" class="waves-effect waves-light"><i class="fa-solid fa-newspaper" style="zoom:0.6"></i> <span>文章</span><i class="fas fa-chevron-down" aria-hidden="true" style="zoom:0.6"></i></a><ul class="sub-nav menus_item_child"><li><a href="/tags"><i class="fas fa-tags" style="margin-top:-20px;zoom:0.6"></i> <span>标签</span></a></li><li><a href="/categories"><i class="fas fa-bookmark" style="margin-top:-20px;zoom:0.6"></i> <span>分类</span></a></li><li><a href="/archives"><i class="fas fa-archive" style="margin-top:-20px;zoom:0.6"></i> <span>归档</span></a></li></ul></li><li class="hide-on-med-and-down nav-item"><a href="" class="waves-effect waves-light"><i class="fa-solid fa-sitemap" style="zoom:0.6"></i> <span>系列</span><i class="fas fa-chevron-down" aria-hidden="true" style="zoom:0.6"></i></a><ul class="sub-nav menus_item_child"><li><a href="/categories/%E7%AE%97%E6%B3%95"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>算法学习</span></a></li><li><a href="/categories/RocketMQ%E5%AD%A6%E4%B9%A0"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>RMQ学习</span></a></li><li><a href="/categories/Netty%E5%AD%A6%E4%B9%A0"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>Netty学习</span></a></li><li><a href="/categories/Spring%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>Spring学习</span></a></li><li><a href="/categories/JVM%E5%AD%A6%E4%B9%A0"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>JVM学习</span></a></li><li><a href="/categories/MySQL%E5%AD%A6%E4%B9%A0"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>MySQL学习</span></a></li><li><a href="/categories/MyBatis%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>MyBatis学习</span></a></li><li><a href="/categories/Zookeeper%E5%AD%A6%E4%B9%A0"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>ZK学习</span></a></li><li><a href="/categories/Hexo"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>Hexo学习</span></a></li><li><a href="/categories/Redis%E5%AD%A6%E4%B9%A0"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>Redis学习</span></a></li><li><a href="/categories/Docker%E5%AD%A6%E4%B9%A0"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>Docker学习</span></a></li><li><a href="/categories/AP-Calculus"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>AP学习</span></a></li><li><a href="/categories/A-Level"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>A-Level学习</span></a></li><li><a href="/categories/SAT"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>SAT学习</span></a></li><li><a href="/categories/%E8%80%83%E7%A0%94"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>考研</span></a></li><li><a href="/categories/OSSD"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>OSSD</span></a></li><li><a href="/categories/%E9%AB%98%E8%80%83"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>高考</span></a></li></ul></li><li class="hide-on-med-and-down nav-item"><a href="" class="waves-effect waves-light"><i class="fa-solid fa-place-of-worship" style="zoom:0.6"></i> <span>我的</span><i class="fas fa-chevron-down" aria-hidden="true" style="zoom:0.6"></i></a><ul class="sub-nav menus_item_child"><li><a href="/galleries"><i class="fas fa-image" style="margin-top:-20px;zoom:0.6"></i> <span>相册</span></a></li><li><a href="/bibi"><i class="fa-fw fa-solid fa-cloud-rain" style="margin-top:-20px;zoom:0.6"></i> <span>哔哔</span></a></li><li><a href="/todolist"><i class="fa-fw fa-solid fa-circle-check" style="margin-top:-20px;zoom:0.6"></i> <span>清单</span></a></li><li><a href="/musics"><i class="fas fa-music" style="margin-top:-20px;zoom:0.6"></i> <span>音乐</span></a></li></ul></li><li class="hide-on-med-and-down nav-item"><a href="" class="waves-effect waves-light"><i class="fa-solid fa-circle-info" style="zoom:0.6"></i> <span>更多</span><i class="fas fa-chevron-down" aria-hidden="true" style="zoom:0.6"></i></a><ul class="sub-nav menus_item_child"><li><a href="/contact"><i class="fas fa-comments" style="margin-top:-20px;zoom:0.6"></i> <span>留言</span></a></li><li><a href="/friends"><i class="fa-solid fa-link" style="margin-top:-20px;zoom:0.6"></i> <span>友链</span></a></li><li><a href="/friend-circle"><i class="fa-solid fa-rss" style="margin-top:-20px;zoom:0.6"></i> <span>圈圈</span></a></li><li><a href="/about"><i class="fas fa-user-circle" style="margin-top:-20px;zoom:0.6"></i> <span>关于</span></a></li></ul></li><li><a href="#searchModal" class="modal-trigger waves-effect waves-light"><i id="searchIcon" class="fas fa-search" title="搜索" style="zoom:0.85"></i></a></li><li><a href="javascript:;" class="waves-effect waves-light" onclick="switchNightMode()" title="深色/浅色模式"><i id="sum-moon-icon" class="fas fa-sun" style="zoom:0.85"></i></a></li></ul><div id="mobile-nav" class="side-nav sidenav"><div class="mobile-head bg-color"><img src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/medias/avatar/avatar2.jpg" class="logo-img circle responsive-img"><div class="logo-name">Kezade</div><div class="logo-desc">7 年 Java 开发经验，其中 3 年以上大型系统架构设计经验，以及 2 年以上的团队管理经验 | 具有分布式、高并发、高可用、大数据量的系统架构设计以及研发经验 | 对 Zookeeper、Netty、Dubbo、Spring Cloud、 Spring 等开源框架源码有过深入研究，并且有一定的框架定制开发经验</div></div><ul class="menu-list mobile-menu-list"><li class="m-nav-item"><a href="/" class="waves-effect waves-light"><i class="fa-fw fas fa-home"></i> 首页</a></li><li class="m-nav-item"><a href="javascript:;"><i class="fa-fw fa-solid fa-newspaper"></i> 文章<span class="m-icon"><i class="fas fa-chevron-right"></i></span></a><ul><li><a href="/tags" style="margin-left:75px"><i class="fa fas fa-tags" style="position:absolute;left:50px"></i> <span>标签</span></a></li><li><a href="/categories" style="margin-left:75px"><i class="fa fas fa-bookmark" style="position:absolute;left:50px"></i> <span>分类</span></a></li><li><a href="/archives" style="margin-left:75px"><i class="fa fas fa-archive" style="position:absolute;left:50px"></i> <span>归档</span></a></li></ul></li><li class="m-nav-item"><a href="javascript:;"><i class="fa-fw fa-solid fa-sitemap"></i> 系列<span class="m-icon"><i class="fas fa-chevron-right"></i></span></a><ul><li><a href="/categories/%E7%AE%97%E6%B3%95" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>算法学习</span></a></li><li><a href="/categories/RocketMQ%E5%AD%A6%E4%B9%A0" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>RMQ学习</span></a></li><li><a href="/categories/Netty%E5%AD%A6%E4%B9%A0" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>Netty学习</span></a></li><li><a href="/categories/Spring%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>Spring学习</span></a></li><li><a href="/categories/JVM%E5%AD%A6%E4%B9%A0" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>JVM学习</span></a></li><li><a href="/categories/MySQL%E5%AD%A6%E4%B9%A0" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>MySQL学习</span></a></li><li><a href="/categories/MyBatis%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>MyBatis学习</span></a></li><li><a href="/categories/Zookeeper%E5%AD%A6%E4%B9%A0" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>ZK学习</span></a></li><li><a href="/categories/Hexo" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>Hexo学习</span></a></li><li><a href="/categories/Redis%E5%AD%A6%E4%B9%A0" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>Redis学习</span></a></li><li><a href="/categories/Docker%E5%AD%A6%E4%B9%A0" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>Docker学习</span></a></li><li><a href="/categories/AP-Calculus" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>AP学习</span></a></li><li><a href="/categories/A-Level" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>A-Level学习</span></a></li><li><a href="/categories/SAT" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>SAT学习</span></a></li><li><a href="/categories/%E8%80%83%E7%A0%94" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>考研</span></a></li><li><a href="/categories/OSSD" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>OSSD</span></a></li><li><a href="/categories/%E9%AB%98%E8%80%83" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>高考</span></a></li></ul></li><li class="m-nav-item"><a href="javascript:;"><i class="fa-fw fa-solid fa-place-of-worship"></i> 我的<span class="m-icon"><i class="fas fa-chevron-right"></i></span></a><ul><li><a href="/galleries" style="margin-left:75px"><i class="fa fas fa-image" style="position:absolute;left:50px"></i> <span>相册</span></a></li><li><a href="/bibi" style="margin-left:75px"><i class="fa fa-fw fa-solid fa-cloud-rain" style="position:absolute;left:50px"></i> <span>哔哔</span></a></li><li><a href="/todolist" style="margin-left:75px"><i class="fa fa-fw fa-solid fa-circle-check" style="position:absolute;left:50px"></i> <span>清单</span></a></li><li><a href="/musics" style="margin-left:75px"><i class="fa fas fa-music" style="position:absolute;left:50px"></i> <span>音乐</span></a></li></ul></li><li class="m-nav-item"><a href="javascript:;"><i class="fa-fw fa-solid fa-circle-info"></i> 更多<span class="m-icon"><i class="fas fa-chevron-right"></i></span></a><ul><li><a href="/contact" style="margin-left:75px"><i class="fa fas fa-comments" style="position:absolute;left:50px"></i> <span>留言</span></a></li><li><a href="/friends" style="margin-left:75px"><i class="fa fa-solid fa-link" style="position:absolute;left:50px"></i> <span>友链</span></a></li><li><a href="/friend-circle" style="margin-left:75px"><i class="fa fa-solid fa-rss" style="position:absolute;left:50px"></i> <span>圈圈</span></a></li><li><a href="/about" style="margin-left:75px"><i class="fa fas fa-user-circle" style="position:absolute;left:50px"></i> <span>关于</span></a></li></ul></li><li><div class="divider"></div></li><li><a href="https://github.com/blinkfox/hexo-theme-matery" class="waves-effect waves-light" target="_blank"><i class="fab fa-github-square fa-fw"></i> Fork Me</a></li></ul></div></div><style>.nav-transparent .github-corner{display:none!important}.github-corner{position:absolute;z-index:10;top:0;right:0;border:0;transform:scale(1.1)}.github-corner svg{color:#0f9d58;fill:#fff;height:64px;width:64px}.github-corner:hover .octo-arm{animation:a .56s ease-in-out}.github-corner .octo-arm{animation:none}@keyframes a{0%,to{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}</style><a href="https://github.com/blinkfox/hexo-theme-matery" class="github-corner tooltipped hide-on-med-and-down" target="_blank" data-tooltip="Fork Me" data-position="left" data-delay="50"><svg viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a></nav></header><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/cryptojs/crypto-js.min.js"></script><script></script><style>:root{--post-bg-image:url('https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/medias/featureimages/5.jpg')}</style><div class="bg-cover pd-header post-cover"><div class="container" style="right:0;left:0"><div class="row"><div class="col s12 m12 l12"><div class="brand"><h1 class="description center-align post-title">【Redis学习】3.高可用之主从复制</h1></div></div></div></div></div><main class="post-container content"><div class="row"><div id="main-content" class="col s12 m12 l9"><div id="artDetail"><div class="card"><div class="card-content article-info"><div class="row tag-cate"><div class="col s7"><div class="article-tag"><a href="/tags/Redis/"><span class="chip bg-color">Redis</span></a> <a href="/tags/%E4%B8%BB%E4%BB%8E%E6%A8%A1%E5%BC%8F/"><span class="chip bg-color">主从模式</span></a></div></div><div class="col s5 right-align"><div class="post-cate"><i class="fas fa-bookmark fa-fw icon-category"></i> <a href="/categories/Redis%E5%AD%A6%E4%B9%A0/" class="post-category">Redis学习</a></div></div></div><div class="post-info"><div class="post-date info-break-policy"><i class="far fa-calendar-minus fa-fw"></i> 发布日期:&nbsp;&nbsp; 2023-08-30</div><div class="info-break-policy"><i class="far fa-file-word fa-fw"></i> 文章字数:&nbsp;&nbsp; 3.9k</div><div class="info-break-policy"><i class="far fa-clock fa-fw"></i> 阅读时长:&nbsp;&nbsp; 13 分</div></div></div><hr class="clearfix"><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/prism/prism.min.css"><div class="card-content article-card-content"><div id="articleContent"><h1 id="1-概述"><a href="#1-概述" class="headerlink" title="1 概述"></a>1 概述</h1><p>复制，主要用于解决单点问题。生产上通常会备用多个节点，以备主节点宕机之患。同时，对于读场景多的情况，也可以做到负载均衡的效果。</p><blockquote><p>主从复制，是指将一台Redis服务器的数据，复制到其他的Redis服务器。前者称为<code>主节点</code>(master)，后者称为<code>从节点</code>(slave)；</p><p>数据的复制是<code>单向的</code>，只能由<strong>主节点到从节点</strong>。</p></blockquote><p>主从复制的<code>作用</code>主要包括：</p><ul><li><code>数据冗余</code>：主从复制实现了数据的热备份，是持久化之外的一种<code>数据冗余</code>方式。</li><li><code>故障恢复</code>：当主节点出现问题时，可以由从节点提供服务，实现快速的故障恢复；实际上是一种<code>服务的冗余</code>。</li><li><code>负载均衡</code>：在主从复制的基础上，配合<code>读写分离</code>，可以由主节点提供写服务，由从节点提供读服务（即写Redis数据时应用连接主节点，读Redis数据时应用连接从节点），分担服务器负载；尤其是在<code>写少读多</code>的场景下，通过多个从节点分担读负载，可以大大提高Redis服务器的并发量。</li><li><code>高可用基石</code>：除了上述作用以外，主从复制还是哨兵和集群能够实施的基础，因此说主从复制是Redis高可用的基础。</li></ul><h1 id="2-原理"><a href="#2-原理" class="headerlink" title="2 原理"></a>2 原理</h1><p>Redis 提供了<code>主从复制模式</code>，可以保证多台服务器的<code>数据一致性</code>，且主从服务器之间采用的是<code>「读写分离」</code>的方式。</p><ul><li>读操作：主节点、从节点都可以接收；</li><li>写操作：首先到主节点执行，然后，主节点将写操作<code>同步</code>给从节点。<img src="https://gcore.jsdelivr.net/gh/zyxelva/picgo/markdown/Redis-Replication.png"><div class="caption"><b class="center-caption">主从复制示意图</b></div></li></ul><h2 id="2-1-过程"><a href="#2-1-过程" class="headerlink" title="2.1 过程"></a>2.1 过程</h2><h3 id="2-1-1-建立连接"><a href="#2-1-1-建立连接" class="headerlink" title="2.1.1 建立连接"></a>2.1.1 建立连接</h3><blockquote><p>主从复制的开启，完全是在<code>从节点</code>发起的；不需要我们在主节点做任何事情。</p></blockquote><p>使用 <code>replicaof</code>（Redis 5.0 之前使用 <code>slaveof</code>）命令形成主节点和从节点的关系。</p><p>从节点开启主从复制，有<code>3种方式</code>：</p><ul><li>配置文件：在<code>从节点</code>服务器的<code>配置文件</code>中加入：<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">replicaof <span class="token operator">&lt;</span>masterip<span class="token operator">></span> <span class="token operator">&lt;</span>masterport<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li>启动命令：<code>redis-server</code>启动命令后加入 <code>--replicaof &lt;masterip&gt; &lt;masterport&gt;</code></li><li>客户端命令：Redis服务器启动后，直接通过客户端执行命令：<code>replicaof &lt;masterip&gt; &lt;masterport&gt;</code>，则该Redis实例成为从节点。</li></ul><blockquote><p>ps: 通过命令<code>replicaof no one</code>，可以断开主从复制关系。</p></blockquote><p>通过<code>replicaof</code>命令启动成功后，从节点会保存主节点的<code>ip</code>、<code>port</code>，然后通过定时任务（间隔1s）向主节点发送建立连接请求，主节点通过后，从节点会发送<code>ping</code>命令验证连接的联通情况，通过之后，若从节点开启了身份验证，则还要经过这一步的验证，验证成功，从节点再向主节点发送端口号，以后主向从发送信息则通过这个端口进行；验证失败，断开连接，重试操作。</p><p>上述流程图如下所示：<br><img src="https://gcore.jsdelivr.net/gh/zyxelva/picgo/markdown/Redis-Replication-Connect.png"></p><div class="caption"><b class="center-caption">建立连接过程</b></div><p></p><h3 id="2-1-2-数据同步"><a href="#2-1-2-数据同步" class="headerlink" title="2.1.2 数据同步"></a>2.1.2 数据同步</h3><p>主从复制连接建立起来后，主、从节点就可以开始进行数据同步了。</p><blockquote><p>注意：在<code>2.8版本之前</code>只有全量复制，而<code>2.8版本之后</code>有<code>全量复制</code>和<code>增量复制</code>。</p><ul><li>全量复制：比如第一次同步时.</li><li>增量复制：只会把主从节点<code>网络断连期间</code>，主节点收到的命令，同步给从节点.</li></ul></blockquote><p>这里以<code>2.8版本之后</code>的Redis为例。从节点发送命令：<br><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">psync <span class="token operator">&lt;</span>runId<span class="token operator">></span> <span class="token operator">&lt;</span>offset<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><br>其中，<code>runId</code>为<code>主节点的runID</code>，<code>offset</code>为从节点的复制进度。首次主从同步，<code>runId</code>为<code>?</code>，<code>offset</code>为<code>-1</code>。</p><blockquote><p>每个 Redis 服务器在<code>启动时</code>都会<code>自动产生</code>一个<code>随机的 ID</code>来唯一标识自己。即：<code>runId</code>。<br><code>offset</code>为从节点目前从主节点同步的进度，首次同步时，由于没有，所以会给个默认值<code>-1</code>。</p></blockquote><p>主节点收到从节点的同步请求后，根据<code>runId</code>、<code>offset</code>进行判定，该从节点是否曾经同步过。若同步过，则<code>runId</code>必等于自己的<code>runId</code>；否则，从节点为新的节点，需要全量复制进行同步。</p><p><code>runId</code>验证通过，还要验证其<code>offset</code>，主节点自身维护的有一个叫做<code>复制积压缓冲区</code>的东东，用于存储写入的命令及其对应的偏移量，若<code>offset</code>存在于这个<code>复制积压缓冲区</code>中，则可进行<code>增量复制</code>，反之，则需进行<code>全量复制</code>。</p><p>首次同步，主节点返回<br><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">FULLRESYNC <span class="token operator">&lt;</span>主节点的 runID<span class="token operator">></span> <span class="token operator">&lt;</span>主节点目前的复制进度 offset<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>从节点收到响应后，会记录下这两个参数。这里有个地方需要注意，<code>FULLRESYNC</code>响应表示<code>第一次</code>复制采用的全量复制，也就是说，主节点会把当前<code>所有的数据</code>都复制给从节点。</p><p>接着，主节点执行<code>bgsave</code>，将<code>RDB文件</code>发送给从节点，从节点接收到 RDB 文件后，会先<code>清空</code>当前数据节点，然后加载 RDB 文件。</p><p>在主节点将数据同步给从节点的过程中，主节点<code>不会被阻塞</code>，仍然可以正常接收请求。但是，这些请求中的写操作<code>并没有</code>记录到刚刚生成的 RDB 文件中。为了保证主从节点的数据一致性，主节点会在内存中用专门的 <code>replication buffer</code>，<strong>记录 RDB 文件生成后收到的所有写操作</strong>。</p><p>有<code>三个时间间隙</code>，主节点会将收到的写操作命令，写入到 <code>replication buffer</code> 缓冲区里：</p><ul><li>主节点生成 RDB 文件期间；</li><li>主节点发送 RDB 文件给从节点期间；</li><li>「从节点」加载 RDB 文件期间。</li></ul><h3 id="2-1-3-命令传播"><a href="#2-1-3-命令传播" class="headerlink" title="2.1.3 命令传播"></a>2.1.3 命令传播</h3><p>从节点完成 RDB 文件的载入后，会回复一个<code>确认消息</code>给主节点。</p><p>接着，主节点将 replication buffer 缓冲区里所记录的写操作命令发送给从节点，从节点执行来自主节点 replication buffer 缓冲区里发来的命令，这时主从节点的数据就一致了。</p><p>至此，主从节点的第一次同步的工作就完成了。</p><p>主从节点在完成第一次同步后，双方之间就会维护一个 <code>TCP 连接</code>，用于命令传播。<br><img src="https://gcore.jsdelivr.net/gh/zyxelva/picgo/markdown/Redis-Replication-TCP.png"></p><div class="caption"><b class="center-caption">命令传播</b></div><p></p><p>后续主节点可以通过这个连接继续将写操作命令传播给从节点，然后从节点执行该命令，使得与主节点的数据库状态相同。</p><p>而且这个连接是<code>长连接</code>的，目的是<strong>避免频繁的 TCP 连接和断开带来的性能开销</strong>。</p><p>上面的这个过程被称为<code>基于长连接的命令传播</code>，通过这种方式来保证第一次同步后的<code>主从节点的数据一致性</code>。</p><blockquote><p>在命令传播阶段，除了发送写命令，主从节点还维持着<code>心跳机制</code>：<code>PING</code>和<code>REPLCONF ACK</code>。心跳机制对于主从复制的超时判断、数据安全等有作用。<br><img src="https://gcore.jsdelivr.net/gh/zyxelva/picgo/markdown/Redis-Heartbeat.png"></p><div class="caption"><b class="center-caption">主从节点心跳机制</b></div><p></p><ul><li><code>主-&gt;从</code>：默认<code>每隔 10 秒</code>发送 <code>ping</code> 命令给从节点，判断其存活性和连接状态，由<code>repl-ping-slave-period</code>参数控制，单位是<code>秒</code>；</li><li><code>从-&gt;主</code>：<code>每隔 1 秒</code>发送 <code>replconf ack &lt;offset&gt;</code>，上报自己的 <code>offset</code>，实时监测主从节点网络状态，检测命令丢失（没有断线情况下）。</li></ul></blockquote><p>上述<code>全量复制同步</code>的过程，总结如下图：<br><img src="https://gcore.jsdelivr.net/gh/zyxelva/picgo/markdown/Redis-Replication-FullSyn.jpg"></p><div class="caption"><b class="center-caption">全量复制过程</b></div><p></p><p>如果为<code>增量复制</code>，其流程如下：<br><img src="https://gcore.jsdelivr.net/gh/zyxelva/picgo/markdown/Redis-Replication-AppendSyn.jpg"></p><div class="caption"><b class="center-caption">增量复制过程</b></div><p></p><p>能够完成<code>增量复制</code>的前提主要有：</p><ul><li>主节点复制积压缓冲区（repl_backlog_buffer）：是一个「环形」缓冲区，默认大小是 1M，用于主从节点断连后，从中找到差异的数据；</li><li>主从节点各自的复制偏移量（replication offset）：标记上面那个缓冲区的同步进度，主从节点都有各自的偏移量，主节点使用 <code>master_repl_offset</code> 来记录自己「写」到的位置，从节点使用 <code>slave_repl_offset</code>来记录自己「读」到的位置。</li><li>主节点（runId）</li></ul><blockquote><p>那<code>repl_backlog_buffer</code>缓冲区是什么时候写入的呢？</p></blockquote><p>在主节点进行命令传播时，不仅会将<code>写命令</code>发送给从节点，还会将写命令写入到 <code>repl_backlog_buffer</code> 缓冲区里，因此这个缓冲区里会保存着<strong>最近传播的写命令</strong>。</p><p>网络断开后，当从节点<strong>重新连上</strong>主节点时，从节点会通过 <code>psync 命令</code>将自己的复制偏移量 <code>slave_repl_offset</code>发送给主节点，主节点根据自己的 <code>master_repl_offset</code> 和 <code>slave_repl_offset</code> 之间的差距，然后来决定<strong>对从节点执行哪种同步操作</strong>：</p><ul><li>如果判断出从节点要读取的数据还在 <code>repl_backlog_buffer</code> 缓冲区里，那么主节点将采用<code>增量复制</code>的方式；</li><li>如果判断出从节点要读取的数据已经<strong>不存在</strong> <code>repl_backlog_buffer</code> 缓冲区里，那么主节点将采用<code>全量复制</code>的方式。</li></ul><p>当主节点在 <code>repl_backlog_buffer</code> 中找到主从节点差异（增量）的数据后，就会将增量的数据写入到 <code>replication buffer</code> 缓冲区，这个缓冲区我们前面也提到过，它是缓存将要传播给从节点的命令。<br><img src="https://gcore.jsdelivr.net/gh/zyxelva/picgo/markdown/Redis-Replication-AppendSyn2.jpg"></p><div class="caption"><b class="center-caption">增量复制过程</b></div><p></p><p><code>repl_backlog_buffer</code> 缓行缓冲区的默认大小是 <code>1M</code>，并且由于它是一个<code>环形缓冲区</code>，所以当缓冲区写满后，主节点继续写入的话，就会覆盖之前的数据。因此，当主节点的<code>写入速度</code><strong>远超于</strong>从节点的<code>读取速度</code>，缓冲区的数据一下就会被覆盖。</p><p>那么在网络恢复时，如果从节点想读的数据已经被覆盖了，主节点就会采用<code>全量复制</code>，这个方式比<code>增量复制</code>的<strong>性能损耗要大很多</strong>。</p><p>因此，为了避免在网络恢复时，主节点<code>频繁地</code>使用<code>全量复制</code>的方式，我们应该调整下 <code>repl_backlog_buffer</code> 缓冲区大小，尽可能的大一些，减少出现从节点要读取的数据被覆盖的概率，从而使得主节点采用<code>增量复制</code>的方式。<br>一般经验，<code>repl_backlog_buffer</code>大小采用如下方案设定：<br><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">repl-backlog-size <span class="token operator">=</span> second * write_size_per_second<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><br>其中，</p><ul><li><code>second</code>：为从节点断线后<code>重新连接</code>上主节点所需的<code>平均时间</code>(以秒计算)。</li><li><code>write_size_per_second</code>：则是主节点平均每秒产生的写命令数据量大小。</li></ul><blockquote><p>举个例子，如果主节点平均每秒产生 <code>1 MB</code> 的写命令，而从节点断线之后平均要 <code>5 秒</code>才能重新连接主节点。</p><p>那么 <code>repl_backlog_buffer</code> 大小就不能低于 <code>5 MB</code>，否则新写地命令就会覆盖旧数据了。</p><p>当然，为了应对一些突发的情况，可以将 <code>repl_backlog_buffer</code> 的大小设置为此基础上的 <code>2 倍</code>，也就是 <code>10 MB</code>。</p><h1 id="3-问题"><a href="#3-问题" class="headerlink" title="3 问题"></a>3 问题</h1><h2 id="3-1-Redis主从节点时长连接还是短连接？"><a href="#3-1-Redis主从节点时长连接还是短连接？" class="headerlink" title="3.1 Redis主从节点时长连接还是短连接？"></a>3.1 Redis主从节点时长连接还是短连接？</h2><p>长连接</p></blockquote><h2 id="3-2-怎么判断-Redis-某个节点是否正常工作？"><a href="#3-2-怎么判断-Redis-某个节点是否正常工作？" class="headerlink" title="3.2 怎么判断 Redis 某个节点是否正常工作？"></a>3.2 怎么判断 Redis 某个节点是否正常工作？</h2><p>Redis 判断节点是否正常工作，基本都是通过互相的 <code>ping-pong</code> 心态检测机制，如果有<code>一半以上</code>的节点去 <code>ping</code> 一个节点的时候没有 <code>pong</code> 回应，集群就会认为这个节点挂掉了，会断开与这个节点的连接。</p><p>Redis 主从节点发送的心态间隔是不一样的，而且作用也有一点区别：</p><ul><li>Redis 主节点默认<code>每隔 10 秒</code>对从节点发送 <code>ping</code> 命令，判断从节点的存活性和连接状态，可通过参数<code>repl-ping-slave-period</code>控制发送频率。</li><li>Redis 从节点<code>每隔 1 秒</code>发送 <code>replconf ack&#123;offset&#125;</code> 命令，给主节点上报自身当前的复制偏移量，目的是为了：<ul><li>实时监测主从节点网络状态；</li><li>上报自身复制偏移量， 检查复制数据是否丢失， 如果从节点数据丢失， 再从主节点的复制缓冲区中拉取丢失数据。</li></ul></li></ul><h2 id="3-3-主从复制架构中，过期key如何处理？"><a href="#3-3-主从复制架构中，过期key如何处理？" class="headerlink" title="3.3 主从复制架构中，过期key如何处理？"></a>3.3 主从复制架构中，过期key如何处理？</h2><p>主节点处理了一个key或者通过淘汰算法淘汰了一个key，这个时间主节点模拟一条<code>del命令</code>发送给从节点，从节点收到该命令后，就进行<code>删除key的操作</code>。</p><h2 id="3-4-Redis-是同步复制还是异步复制？"><a href="#3-4-Redis-是同步复制还是异步复制？" class="headerlink" title="3.4 Redis 是同步复制还是异步复制？"></a>3.4 Redis 是同步复制还是异步复制？</h2><p>Redis 主节点每次收到写命令之后，先写到内部的缓冲区，然后<code>异步</code>发送给从节点。</p><h2 id="3-5-主从复制中两个-Buffer-replication-buffer-、repl-backlog-buffer-有什么区别？"><a href="#3-5-主从复制中两个-Buffer-replication-buffer-、repl-backlog-buffer-有什么区别？" class="headerlink" title="3.5 主从复制中两个 Buffer(replication buffer 、repl backlog buffer)有什么区别？"></a>3.5 主从复制中两个 Buffer(replication buffer 、repl backlog buffer)有什么区别？</h2><p><code>replication buffer</code> 、<code>repl backlog buffer</code> 区别如下：</p><ul><li>出现的阶段不一样：<ul><li><code>repl backlog buffer</code> 是在<code>增量复制阶段</code>出现，一个主节点只分配一个 <code>repl backlog buffer</code>；</li><li><code>replication buffer</code> 是在<code>全量复制阶段</code>和<code>增量复制阶段</code>都会出现，主节点会给每个新连接的从节点，分配一个 <code>replication buffer</code>；</li></ul></li><li>这两个 Buffer 都有<code>大小限制</code>的，当缓冲区满了之后，发生的事情不一样：<ul><li>当 <code>repl backlog buffer</code> 满了，因为是环形结构，会直接<code>覆盖</code>起始位置数据;</li><li>当 <code>replication buffer</code> 满了，会导致连接断开，删除缓存，从节点重新连接，重新开始全量复制。</li></ul></li></ul><h2 id="3-6-如何应对主从数据不一致？"><a href="#3-6-如何应对主从数据不一致？" class="headerlink" title="3.6 如何应对主从数据不一致？"></a>3.6 如何应对主从数据不一致？</h2><blockquote><p>为什么会出现主从数据不一致？</p></blockquote><p>主从数据不一致，就是指客户端从从节点中读取到的值和主节点中的最新值并不一致。</p><p>之所以会出现主从数据不一致的现象，是因为主从节点间的<code>命令复制</code>(命令传播)是<code>异步</code>进行的，所以无法实现<code>强一致性</code>保证（主从数据时时刻刻保持一致）。</p><p>具体来说，在主从节点<code>命令传播阶段</code>，主节点收到新的写命令后，会发送给从节点。但是，主节点并不会等到从节点实际执行完命令后，再把结果返回给客户端，而是主节点自己在本地执行完命令后，就会向客户端返回结果了。如果从节点还没有执行主节点同步过来的命令，主从节点间的数据就不一致了。</p><blockquote><p>如何如何应对主从数据不一致？</p></blockquote><ul><li>第一种方法，尽量保证主从节点间的网络连接状况良好，避免主从节点在不同的机房。</li><li>第二种方法，可以开发一个外部程序来监控主从节点间的复制进度。具体做法：<ul><li>Redis 的 <code>INFO replication</code> 命令可以查看主节点接收写命令的进度信息（<code>master_repl_offset</code>）和从节点复制写命令的进度信息（<code>slave_repl_offset</code>），所以，我们就可以开发一个监控程序，先用 <code>INFO replication</code> 命令查到主、从节点的进度，然后，我们用 <code>master_repl_offset</code> 减去 <code>slave_repl_offset</code>，这样就能得到从节点和主节点间的复制进度差值了。</li><li>如果某个从节点的进度差值<code>大于</code>我们预设的阈值，我们可以让客户端不再和这个从节点连接进行数据读取，这样就可以减少读到不一致数据的情况。不过，为了避免出现客户端和所有从节点都不能连接的情况，我们需要把<code>复制进度差值的阈值</code>设置得<code>大</code>一些。</li></ul></li></ul><h1 id="4-参考"><a href="#4-参考" class="headerlink" title="4 参考"></a>4 参考</h1><ul><li><a target="_blank" rel="noopener" href="https://www.xiaolincoding.com/redis/cluster/master_slave_replication.html#%E7%AC%AC%E4%B8%80%E6%AC%A1%E5%90%8C%E6%AD%A5">主从复制是怎么实现的？</a></li><li><a target="_blank" rel="noopener" href="https://pdai.tech/md/db/nosql-redis/db-redis-x-copy.html">Redis进阶 - 高可用：主从复制详解</a></li><li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/kismetv/p/9236731.html#t61">深入学习Redis（3）：主从复制</a></li></ul></div><hr><div class="reprint" id="reprint-statement"><div class="reprint__author"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-user">文章作者:</i></span> <span class="reprint-info"><a href="/about" rel="external nofollow noreferrer">Kezade</a></span></div><div class="reprint__type"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-link">文章链接:</i></span> <span class="reprint-info"><a href="https://zyxelva.github.io/posts/2876861881.html">https://zyxelva.github.io/posts/2876861881.html</a></span></div><div class="reprint__notice"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-copyright">版权声明:</i></span> <span class="reprint-info">本博客所有文章除特別声明外，均采用 <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a> 许可协议。转载请注明来源 <a href="/about" target="_blank">Kezade</a> !</span></div></div><script async defer>function navToReprintStatement(){$("html, body").animate({scrollTop:$("#reprint-statement").offset().top-80},800)}document.addEventListener("copy",function(t){M.toast({html:'<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>'})})</script><div class="tag_share" style="display:block"><div class="post-meta__tag-list" style="display:inline-block"><div class="article-tag"><a href="/tags/Redis/"><span class="chip bg-color">Redis</span></a> <a href="/tags/%E4%B8%BB%E4%BB%8E%E6%A8%A1%E5%BC%8F/"><span class="chip bg-color">主从模式</span></a></div></div><div class="post_share" style="zoom:80%;width:fit-content;display:inline-block;float:right;margin:-.15rem 0"><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/share/css/share.min.css"><div id="article-share"><div class="social-share" data-sites="google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/share/js/social-share.min.js"></script></div></div></div><div id="reward"><a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a><div id="rewardModal" class="modal"><div class="modal-content"><a class="close modal-close"><i class="fas fa-times"></i></a><h4 class="reward-title">你的赏识是我前进的动力</h4><div class="reward-content"><div class="reward-tabs"><ul class="tabs row"><li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li><li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li></ul><div id="alipay"><img src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码"></div><div id="wechat"><img src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码"></div></div></div></div></div></div><script>$(function(){$(".tabs").tabs()})</script></div></div><style>.twikoo-card{margin:1.5rem auto}.twikoo-card .card-content{padding:20px}#tcomments textarea{box-sizing:border-box;background:url("/") 100% 100% no-repeat}#tcomments p{margin:2px 2px 10px;font-size:1.05rem;line-height:1.78rem;text-align:left}#tcomments blockquote p{text-indent:.2rem}#tcomments a{padding:0 2px;color:#4cbf30;font-weight:500;text-decoration:none}#tcomments img{max-width:100%;height:auto;cursor:pointer}#tcomments ol li{list-style-type:decimal}#tcomments ol,ul{display:block;padding-left:2em;word-spacing:0.05rem}#tcomments ul li,ol li{display:list-item;line-height:1.8rem;font-size:1rem}#tcomments ul li{list-style-type:disc}#tcomments ul ul li{list-style-type:circle}#tcomments table,td,th{padding:12px 13px;border:1px solid #dfe2e5}#tcomments table,td,th{border:0}table tr:nth-child(2n),thead{background-color:#fafafa}#tcomments table th{background-color:#f2f2f2;min-width:80px}#tcomments table td{min-width:80px}#tcomments h1{font-size:1.85rem;font-weight:700;line-height:2.2rem}#tcomments h2{font-size:1.65rem;font-weight:700;line-height:1.9rem}#tcomments h3{font-size:1.45rem;font-weight:700;line-height:1.7rem}#tcomments h4{font-size:1.25rem;font-weight:700;line-height:1.5rem}#tcomments h5{font-size:1.1rem;font-weight:700;line-height:1.4rem}#tcomments h6{font-size:1rem;line-height:1.3rem}#tcomments p{font-size:1rem;line-height:1.5rem}#tcomments hr{margin:12px 0;border:0;border-top:1px solid #ccc}#tcomments blockquote{margin:15px 0;border-left:5px solid #42b983;padding:1rem .8rem .3rem .8rem;color:#666;background-color:rgba(66,185,131,.1)}#tcomments pre{font-family:monospace,monospace;padding:1.2em;margin:.5em 0;background:#272822;overflow:auto;border-radius:.3em;tab-size:4}#tcomments code{font-family:monospace,monospace;padding:1px 3px;font-size:.92rem;color:#e96900;background-color:#f8f8f8;border-radius:2px}#tcomments pre code{font-family:monospace,monospace;padding:0;color:#e8eaf6;background-color:#272822}#tcomments pre[class*=language-]{padding:1.2em;margin:.5em 0}#tcomments code[class*=language-],pre[class*=language-]{color:#e8eaf6}#tcomments [type=checkbox]:not(:checked),[type=checkbox]:checked{position:inherit;margin-left:-1.3rem;margin-right:.4rem;margin-top:-1px;vertical-align:middle;left:unset;visibility:visible}#tcomments b,strong{font-weight:700}#tcomments dfn{font-style:italic}#tcomments small{font-size:85%}#tcomments cite{font-style:normal}#tcomments mark{background-color:#fcf8e3;padding:.2em}#tcomments table,td,th{padding:12px 13px;border:1px solid #dfe2e5}table tr:nth-child(2n),thead{background-color:#fafafa}#tcomments table th{background-color:#f2f2f2;min-width:80px}#tcomments table td{min-width:80px}#tcomments [type=checkbox]:not(:checked),[type=checkbox]:checked{position:inherit;margin-left:-1.3rem;margin-right:.4rem;margin-top:-1px;vertical-align:middle;left:unset;visibility:visible}</style><div class="card twikoo-card" data-aos="fade-up"><div class="comment_headling" style="font-size:20px;font-weight:700;position:relative;padding-left:20px;top:15px;padding-bottom:5px"><i class="fas fa-comments fa-fw" aria-hidden="true"></i> <span>评论</span></div><div class="card-content" style="display:grid"><div id="tcomments"></div></div></div><script src="https://gcore.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js"></script><script>twikoo.init({envId:"https://kezadetwikoo.netlify.app/.netlify/functions/twikoo",el:"#tcomments",region:"",path:""}).then(function(){for(var t=document.querySelector("#twikoo").getElementsByTagName("input"),e=0;e<t.length;e++)t[e]&&t[e].classList.add("browser-default")})</script><article id="prenext-posts" class="prev-next articles"><div class="row article-row"><div class="article col s12 m6" data-aos="fade-up"><div class="article-badge left-badge text-color"><i class="fas fa-chevron-left"></i> &nbsp;上一篇</div><div class="card"><a href="/posts/1235835282.html"><div class="card-image"><img src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/medias/featureimages/20.jpg" class="responsive-img" alt="【Redis学习】4.高可用之Sentinel"> <span class="card-title">【Redis学习】4.高可用之Sentinel</span></div></a><div class="card-content article-content"><div class="summary block-with-text"></div><div class="publish-info"><span class="publish-date"><i class="far fa-clock fa-fw icon-date"></i> 2023-08-30</span><span class="publish-author"><i class="fas fa-bookmark fa-fw icon-category"></i> <a href="/categories/Redis%E5%AD%A6%E4%B9%A0/" class="post-category">Redis学习</a></span></div></div><div class="card-action article-tags"><a href="/tags/Redis/"><span class="chip bg-color">Redis</span></a> <a href="/tags/%E5%93%A8%E5%85%B5%E6%A8%A1%E5%BC%8F/"><span class="chip bg-color">哨兵模式</span></a></div></div></div><div class="article col s12 m6" data-aos="fade-up"><div class="article-badge right-badge text-color">下一篇&nbsp;<i class="fas fa-chevron-right"></i></div><div class="card"><a href="/posts/2249264199.html"><div class="card-image"><img src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/medias/featureimages/6.jpg" class="responsive-img" alt="【Redis学习】2.持久化"> <span class="card-title">【Redis学习】2.持久化</span></div></a><div class="card-content article-content"><div class="summary block-with-text"></div><div class="publish-info"><span class="publish-date"><i class="far fa-clock fa-fw icon-date"></i> 2023-08-28</span><span class="publish-author"><i class="fas fa-bookmark fa-fw icon-category"></i> <a href="/categories/Redis%E5%AD%A6%E4%B9%A0/" class="post-category">Redis学习</a></span></div></div><div class="card-action article-tags"><a href="/tags/Redis/"><span class="chip bg-color">Redis</span></a> <a href="/tags/AOF/"><span class="chip bg-color">AOF</span></a> <a href="/tags/RDB/"><span class="chip bg-color">RDB</span></a></div></div></div></div></article></div><script>$("#articleContent").on("copy",function(e){if(void 0!==window.getSelection){var n=window.getSelection();if(!((""+n).length<Number.parseInt("120"))){var t=document.getElementsByTagName("body")[0],o=document.createElement("div");o.style.position="absolute",o.style.left="-99999px",t.appendChild(o),o.appendChild(n.getRangeAt(0).cloneContents()),"PRE"!==n.getRangeAt(0).commonAncestorContainer.nodeName&&"CODE"!==n.getRangeAt(0).commonAncestorContainer.nodeName||(o.innerHTML="<pre>"+o.innerHTML+"</pre>");var i=document.location.href;o.innerHTML+='<br />来源: Kezade<br />文章作者: Kezade<br />文章链接: <a href="'+i+'">'+i+"</a><br />本文章著作权归作者所有，任何形式的转载都请注明出处。",n.selectAllChildren(o),window.setTimeout(function(){t.removeChild(o)},200)}}})</script><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/codeBlock/codeBlockFuction.js"></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/prism/prism.min.js"></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/codeBlock/codeLang.js"></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/codeBlock/codeCopy.js"></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/codeBlock/codeShrink.js"></script></div><div id="toc-aside" class="expanded col l3 hide-on-med-and-down"><div class="toc-widget card" style="background-color:#fff"><div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div><div id="toc-content"></div></div></div></div><div id="floating-toc-btn" class="hide-on-med-and-down"><a class="btn-floating btn-large bg-color"><i class="fas fa-list-ul"></i></a></div><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/tocbot/tocbot.min.js"></script><script>$(function(){tocbot.init({tocSelector:"#toc-content",contentSelector:"#articleContent",headingsOffset:-(.4*$(window).height()-45),collapseDepth:Number("0"),headingSelector:"h1, h2, h3, h4, h5"});let t=parseInt(.4*$(window).height()-64),e=$(".toc-widget");$(window).scroll(function(){$(window).scrollTop()>t?e.addClass("toc-fixed"):e.removeClass("toc-fixed")});const o="expanded";let n=$("#toc-aside"),i=$("#main-content");$("#floating-toc-btn .btn-floating").click(function(){n.hasClass(o)?(n.removeClass(o).hide(),i.removeClass("l9")):(n.addClass(o).show(),i.addClass("l9")),function(t,e){let o=$("#"+t);if(0===o.length)return;let n=o.width();n+=n>=450?21:n>=350&&n<450?18:n>=300&&n<350?16:14,$("#"+e).width(n)}("artDetail","prenext-posts")})})</script></main><footer class="page-footer bg-color"><div class="container row center-align" style="margin-bottom:15px!important"><div class="col s12 m8 l8 copy-right">Copyright&nbsp;&copy; <span id="year">2019-2025</span> <a href="/about" target="_blank">Kezade</a> |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a> |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a><br><br><span id="sitetime">Loading ...</span><script>var calcSiteTime=function(){var e=6e4,t=36e5,n=864e5,a=365*n,i=new Date,r="2019",o=i.getFullYear(),s=i.getMonth()+1,l=i.getDate(),m=i.getHours(),c=i.getMinutes(),d=i.getSeconds(),g=Date.UTC(r,"6","28","0","0","0"),h=Date.UTC(o,s,l,m,c,d)-g,u=Math.floor(h/a),M=Math.floor(h/n-365*u),T=Math.floor((h-(365*u+M)*n)/t),f=Math.floor((h-(365*u+M)*n-T*t)/e),y=Math.floor((h-(365*u+M)*n-T*t-f*e)/1e3);if(r===String(o)){document.getElementById("year").innerHTML=o;var v="This site has been running for "+M+" days";v="本站已运行 "+M+" 天",document.getElementById("sitetime").innerHTML=v}else{document.getElementById("year").innerHTML=r+" - "+o;var H="This site has been running for "+u+" years and "+M+" days "+T+" hours "+f+" mins "+y+" seconds";H="本站已苟且偷生 "+u+" 年 "+M+" 天 "+T+" 小时 "+f+" 分钟 "+y+" 秒",document.getElementById("sitetime").innerHTML=H}};calcSiteTime(),setInterval(calcSiteTime,1e3)</script><br></div><div class="col s12 m4 l4 social-link"><a href="https://github.com/zyxelva" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50"><i class="fab fa-github"></i></a><a href="mailto:zyxelva@gmail.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50"><i class="fas fa-envelope-open"></i></a><a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=1807401971" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 1807401971" data-position="top" data-delay="50"><i class="fab fa-qq"></i></a> <a href="https://www.zhihu.com/people/kezade" class="tooltipped" target="_blank" data-tooltip="关注我的知乎: https://www.zhihu.com/people/kezade" data-position="top" data-delay="50"><i class="fab fa-zhihu1">知</i></a><a href="../rss2.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50"><i class="fas fa-rss"></i></a></div></div></footer><div class="progress-bar"></div><div id="searchModal" class="modal"><div class="modal-content"><div class="search-header"><span class="title"><i class="fas fa-search"></i> &nbsp;&nbsp;搜索</span> <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字" class="search-input"></div><div id="searchResult"></div></div></div><script>$(function(){!function(t,e,r){"use strict";$.ajax({url:t,dataType:"xml",success:function(t){var n=$("entry",t).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get(),a=document.getElementById(e),s=document.getElementById(r);a.addEventListener("input",function(){var t='<ul class="search-result-list">',e=this.value.trim().toLowerCase().split(/[\s\-]+/);s.innerHTML="",this.value.trim().length<=0||(n.forEach(function(r){var n=!0,a=r.title.trim().toLowerCase(),s=r.content.trim().replace(/<[^>]+>/g,"").toLowerCase(),i=r.url;i=0===i.indexOf("/")?r.url:"/"+i;var l=-1,c=-1,u=-1;if(""!==a&&""!==s&&e.forEach(function(t,e){l=a.indexOf(t),c=s.indexOf(t),l<0&&c<0?n=!1:(c<0&&(c=0),0===e&&(u=c))}),n){t+="<li><a href='"+i+"' class='search-result-title'>"+a+"</a>";var o=r.content.trim().replace(/<[^>]+>/g,"");if(u>=0){var h=u-20,f=u+80;h<0&&(h=0),0===h&&(f=100),f>o.length&&(f=o.length);var m=o.substr(h,f);e.forEach(function(t){var e=new RegExp(t,"gi");m=m.replace(e,'<em class="search-keyword">'+t+"</em>")}),t+='<p class="search-result">'+m+"...</p>"}t+="</li>"}}),t+="</ul>",s.innerHTML=t)})}})}("/search.xml","searchInput","searchResult")})</script><div class="stars-con"><div id="stars"></div><div id="stars2"></div><div id="stars3"></div></div><script>function switchNightMode(){$('<div class="Cuteen_DarkSky"><div class="Cuteen_DarkPlanet"></div></div>').appendTo($("body")),setTimeout(function(){$("body").hasClass("DarkMode")?($("body").removeClass("DarkMode"),localStorage.setItem("isDark","0"),$("#sum-moon-icon").removeClass("fa-sun").addClass("fa-moon")):($("body").addClass("DarkMode"),localStorage.setItem("isDark","1"),$("#sum-moon-icon").addClass("fa-sun").removeClass("fa-moon")),setTimeout(function(){$(".Cuteen_DarkSky").fadeOut(1e3,function(){$(this).remove()})},2e3)})}</script><div id="backTop" class="top-scroll"><a class="btn-floating btn-large waves-effect waves-light" href="#!"><i class="fas fa-arrow-up"></i></a></div><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/materialize/materialize.min.js"></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/masonry/masonry.pkgd.min.js"></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/aos/aos.js"></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/scrollprogress/scrollProgress.min.js"></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/lightGallery/js/lightgallery-all.min.js"></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/js/matery.js"></script><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/mermaid/mermaid.min.css"><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/mermaid/mermaid.min.js"></script><script>window.mermaid&&mermaid.initialize({theme:"forest"})</script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/background/ribbon-dynamic.js" async></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/instantpage/instantpage.js" type="module"></script></body></html>
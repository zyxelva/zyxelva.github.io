<!DOCTYPE HTML><html lang="zh-CN"><head><meta charset="utf-8"><meta name="keywords" content="【MySQL学习】6.执行原理, Back-End Dev Java"><meta name="description" content="1 单表访问之索引合并MySQL在一般情况下执行一个查询时最多只会用到单个二级索引，但存在有特殊情况，也可能在一个查询中使用到多个二级索引，MySQL中这种使用到多个索引来完成一次查询的执行方法称之为：索引合并/index merg。e
1"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><meta name="renderer" content="webkit|ie-stand|ie-comp"><meta name="mobile-web-app-capable" content="yes"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="referrer" content="no-referrer-when-downgrade"><title>【MySQL学习】6.执行原理 | Kezade</title><link rel="icon" type="image/jpeg" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/medias/avatar/avatar2.jpg"><style>body{background-image:url(https://it-ark-dev.oss-cn-shenzhen.aliyuncs.com/464e9ac7a5a729ae67f91f7cf0cf6fe2.jpg);background-repeat:no-repeat;background-attachment:fixed;background-size:cover;background-position:center center}</style><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/awesome/css/all.min.css"><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/materialize/materialize.min.css"><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/aos/aos.css"><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/animate/animate.min.css"><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/lightGallery/css/lightgallery.min.css"><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/picgo@v3.1/css/matery.css?v3"><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/css/my.css"><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/css/dark.css" media="none" onload='"all"!=media&&(media="all")'><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/tocbot/tocbot.css"><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/css/post.css"><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/css/reward.css"><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/jquery/jquery-3.6.0.min.js"></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/picgo@v3.3/js/function.js?v88"></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/picgo@v1.3/js/imgStatus.min.js"></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/picgo@v1.3/js/waterfall.min.js"></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/picgo@v1.3/js/lately.min.js"></script><script>var memos={host:"https://s.dusays.com/",limit:"10",creatorId:"49",username:"zyxelva",name:"Kezade",domId:"#memos",path:"api/v1/memo"},douban={api:"https://douban-api.edui.fun/"}</script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/rss2.xml" title="Kezade" type="application/rss+xml"></head><body><header class="navbar-fixed"><nav id="headNav" class="bg-color nav-transparent"><div id="navContainer" class="nav-wrapper container"><div class="brand-logo"><a href="/" class="waves-effect waves-light"><img src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/medias/avatar/avatar2.jpg" class="logo-img k-avatar" alt="LOGO"> <span class="logo-span">Kezade</span></a></div><a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a><ul class="right nav-menu"><li class="hide-on-med-and-down nav-item"><a href="/" class="waves-effect waves-light"><i class="fas fa-home" style="zoom:0.6"></i> <span>首页</span></a></li><li class="hide-on-med-and-down nav-item"><a href="" class="waves-effect waves-light"><i class="fa-solid fa-newspaper" style="zoom:0.6"></i> <span>文章</span><i class="fas fa-chevron-down" aria-hidden="true" style="zoom:0.6"></i></a><ul class="sub-nav menus_item_child"><li><a href="/tags"><i class="fas fa-tags" style="margin-top:-20px;zoom:0.6"></i> <span>标签</span></a></li><li><a href="/categories"><i class="fas fa-bookmark" style="margin-top:-20px;zoom:0.6"></i> <span>分类</span></a></li><li><a href="/archives"><i class="fas fa-archive" style="margin-top:-20px;zoom:0.6"></i> <span>归档</span></a></li></ul></li><li class="hide-on-med-and-down nav-item"><a href="" class="waves-effect waves-light"><i class="fa-solid fa-sitemap" style="zoom:0.6"></i> <span>系列</span><i class="fas fa-chevron-down" aria-hidden="true" style="zoom:0.6"></i></a><ul class="sub-nav menus_item_child"><li><a href="/categories/%E7%AE%97%E6%B3%95"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>算法学习</span></a></li><li><a href="/categories/RocketMQ%E5%AD%A6%E4%B9%A0"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>RMQ学习</span></a></li><li><a href="/categories/Netty%E5%AD%A6%E4%B9%A0"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>Netty学习</span></a></li><li><a href="/categories/Spring%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>Spring学习</span></a></li><li><a href="/categories/JVM%E5%AD%A6%E4%B9%A0"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>JVM学习</span></a></li><li><a href="/categories/MySQL%E5%AD%A6%E4%B9%A0"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>MySQL学习</span></a></li><li><a href="/categories/MyBatis%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>MyBatis学习</span></a></li><li><a href="/categories/Zookeeper%E5%AD%A6%E4%B9%A0"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>ZK学习</span></a></li><li><a href="/categories/Hexo"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>Hexo学习</span></a></li><li><a href="/categories/Redis%E5%AD%A6%E4%B9%A0"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>Redis学习</span></a></li><li><a href="/categories/Docker%E5%AD%A6%E4%B9%A0"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>Docker学习</span></a></li><li><a href="/categories/AP-Calculus"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>AP学习</span></a></li><li><a href="/categories/A-Level"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>A-Level学习</span></a></li><li><a href="/categories/SAT"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>SAT学习</span></a></li><li><a href="/categories/%E8%80%83%E7%A0%94"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>考研</span></a></li><li><a href="/categories/OSSD"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>OSSD</span></a></li><li><a href="/categories/%E9%AB%98%E8%80%83"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>高考</span></a></li></ul></li><li class="hide-on-med-and-down nav-item"><a href="" class="waves-effect waves-light"><i class="fa-solid fa-place-of-worship" style="zoom:0.6"></i> <span>我的</span><i class="fas fa-chevron-down" aria-hidden="true" style="zoom:0.6"></i></a><ul class="sub-nav menus_item_child"><li><a href="/galleries"><i class="fas fa-image" style="margin-top:-20px;zoom:0.6"></i> <span>相册</span></a></li><li><a href="/bibi"><i class="fa-fw fa-solid fa-cloud-rain" style="margin-top:-20px;zoom:0.6"></i> <span>哔哔</span></a></li><li><a href="/todolist"><i class="fa-fw fa-solid fa-circle-check" style="margin-top:-20px;zoom:0.6"></i> <span>清单</span></a></li><li><a href="/musics"><i class="fas fa-music" style="margin-top:-20px;zoom:0.6"></i> <span>音乐</span></a></li></ul></li><li class="hide-on-med-and-down nav-item"><a href="" class="waves-effect waves-light"><i class="fa-solid fa-circle-info" style="zoom:0.6"></i> <span>更多</span><i class="fas fa-chevron-down" aria-hidden="true" style="zoom:0.6"></i></a><ul class="sub-nav menus_item_child"><li><a href="/contact"><i class="fas fa-comments" style="margin-top:-20px;zoom:0.6"></i> <span>留言</span></a></li><li><a href="/friends"><i class="fa-solid fa-link" style="margin-top:-20px;zoom:0.6"></i> <span>友链</span></a></li><li><a href="/friend-circle"><i class="fa-solid fa-rss" style="margin-top:-20px;zoom:0.6"></i> <span>圈圈</span></a></li><li><a href="/about"><i class="fas fa-user-circle" style="margin-top:-20px;zoom:0.6"></i> <span>关于</span></a></li></ul></li><li><a href="#searchModal" class="modal-trigger waves-effect waves-light"><i id="searchIcon" class="fas fa-search" title="搜索" style="zoom:0.85"></i></a></li><li><a href="javascript:;" class="waves-effect waves-light" onclick="switchNightMode()" title="深色/浅色模式"><i id="sum-moon-icon" class="fas fa-sun" style="zoom:0.85"></i></a></li></ul><div id="mobile-nav" class="side-nav sidenav"><div class="mobile-head bg-color"><img src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/medias/avatar/avatar2.jpg" class="logo-img circle responsive-img"><div class="logo-name">Kezade</div><div class="logo-desc">7 年 Java 开发经验，其中 3 年以上大型系统架构设计经验，以及 2 年以上的团队管理经验 | 具有分布式、高并发、高可用、大数据量的系统架构设计以及研发经验 | 对 Zookeeper、Netty、Dubbo、Spring Cloud、 Spring 等开源框架源码有过深入研究，并且有一定的框架定制开发经验</div></div><ul class="menu-list mobile-menu-list"><li class="m-nav-item"><a href="/" class="waves-effect waves-light"><i class="fa-fw fas fa-home"></i> 首页</a></li><li class="m-nav-item"><a href="javascript:;"><i class="fa-fw fa-solid fa-newspaper"></i> 文章<span class="m-icon"><i class="fas fa-chevron-right"></i></span></a><ul><li><a href="/tags" style="margin-left:75px"><i class="fa fas fa-tags" style="position:absolute;left:50px"></i> <span>标签</span></a></li><li><a href="/categories" style="margin-left:75px"><i class="fa fas fa-bookmark" style="position:absolute;left:50px"></i> <span>分类</span></a></li><li><a href="/archives" style="margin-left:75px"><i class="fa fas fa-archive" style="position:absolute;left:50px"></i> <span>归档</span></a></li></ul></li><li class="m-nav-item"><a href="javascript:;"><i class="fa-fw fa-solid fa-sitemap"></i> 系列<span class="m-icon"><i class="fas fa-chevron-right"></i></span></a><ul><li><a href="/categories/%E7%AE%97%E6%B3%95" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>算法学习</span></a></li><li><a href="/categories/RocketMQ%E5%AD%A6%E4%B9%A0" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>RMQ学习</span></a></li><li><a href="/categories/Netty%E5%AD%A6%E4%B9%A0" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>Netty学习</span></a></li><li><a href="/categories/Spring%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>Spring学习</span></a></li><li><a href="/categories/JVM%E5%AD%A6%E4%B9%A0" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>JVM学习</span></a></li><li><a href="/categories/MySQL%E5%AD%A6%E4%B9%A0" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>MySQL学习</span></a></li><li><a href="/categories/MyBatis%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>MyBatis学习</span></a></li><li><a href="/categories/Zookeeper%E5%AD%A6%E4%B9%A0" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>ZK学习</span></a></li><li><a href="/categories/Hexo" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>Hexo学习</span></a></li><li><a href="/categories/Redis%E5%AD%A6%E4%B9%A0" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>Redis学习</span></a></li><li><a href="/categories/Docker%E5%AD%A6%E4%B9%A0" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>Docker学习</span></a></li><li><a href="/categories/AP-Calculus" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>AP学习</span></a></li><li><a href="/categories/A-Level" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>A-Level学习</span></a></li><li><a href="/categories/SAT" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>SAT学习</span></a></li><li><a href="/categories/%E8%80%83%E7%A0%94" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>考研</span></a></li><li><a href="/categories/OSSD" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>OSSD</span></a></li><li><a href="/categories/%E9%AB%98%E8%80%83" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>高考</span></a></li></ul></li><li class="m-nav-item"><a href="javascript:;"><i class="fa-fw fa-solid fa-place-of-worship"></i> 我的<span class="m-icon"><i class="fas fa-chevron-right"></i></span></a><ul><li><a href="/galleries" style="margin-left:75px"><i class="fa fas fa-image" style="position:absolute;left:50px"></i> <span>相册</span></a></li><li><a href="/bibi" style="margin-left:75px"><i class="fa fa-fw fa-solid fa-cloud-rain" style="position:absolute;left:50px"></i> <span>哔哔</span></a></li><li><a href="/todolist" style="margin-left:75px"><i class="fa fa-fw fa-solid fa-circle-check" style="position:absolute;left:50px"></i> <span>清单</span></a></li><li><a href="/musics" style="margin-left:75px"><i class="fa fas fa-music" style="position:absolute;left:50px"></i> <span>音乐</span></a></li></ul></li><li class="m-nav-item"><a href="javascript:;"><i class="fa-fw fa-solid fa-circle-info"></i> 更多<span class="m-icon"><i class="fas fa-chevron-right"></i></span></a><ul><li><a href="/contact" style="margin-left:75px"><i class="fa fas fa-comments" style="position:absolute;left:50px"></i> <span>留言</span></a></li><li><a href="/friends" style="margin-left:75px"><i class="fa fa-solid fa-link" style="position:absolute;left:50px"></i> <span>友链</span></a></li><li><a href="/friend-circle" style="margin-left:75px"><i class="fa fa-solid fa-rss" style="position:absolute;left:50px"></i> <span>圈圈</span></a></li><li><a href="/about" style="margin-left:75px"><i class="fa fas fa-user-circle" style="position:absolute;left:50px"></i> <span>关于</span></a></li></ul></li><li><div class="divider"></div></li><li><a href="https://github.com/blinkfox/hexo-theme-matery" class="waves-effect waves-light" target="_blank"><i class="fab fa-github-square fa-fw"></i> Fork Me</a></li></ul></div></div><style>.nav-transparent .github-corner{display:none!important}.github-corner{position:absolute;z-index:10;top:0;right:0;border:0;transform:scale(1.1)}.github-corner svg{color:#0f9d58;fill:#fff;height:64px;width:64px}.github-corner:hover .octo-arm{animation:a .56s ease-in-out}.github-corner .octo-arm{animation:none}@keyframes a{0%,to{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}</style><a href="https://github.com/blinkfox/hexo-theme-matery" class="github-corner tooltipped hide-on-med-and-down" target="_blank" data-tooltip="Fork Me" data-position="left" data-delay="50"><svg viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a></nav></header><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/cryptojs/crypto-js.min.js"></script><script></script><style>:root{--post-bg-image:url('https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/medias/MySQL.jpeg')}</style><div class="bg-cover pd-header post-cover"><div class="container" style="right:0;left:0"><div class="row"><div class="col s12 m12 l12"><div class="brand"><h1 class="description center-align post-title">【MySQL学习】6.执行原理</h1></div></div></div></div></div><main class="post-container content"><div class="row"><div id="main-content" class="col s12 m12 l9"><div id="artDetail"><div class="card"><div class="card-content article-info"><div class="row tag-cate"><div class="col s7"><div class="article-tag"><a href="/tags/MySQL/"><span class="chip bg-color">MySQL</span></a> <a href="/tags/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/"><span class="chip bg-color">性能优化</span></a></div></div><div class="col s5 right-align"><div class="post-cate"><i class="fas fa-bookmark fa-fw icon-category"></i> <a href="/categories/MySQL%E5%AD%A6%E4%B9%A0/" class="post-category">MySQL学习</a></div></div></div><div class="post-info"><div class="post-date info-break-policy"><i class="far fa-calendar-minus fa-fw"></i> 发布日期:&nbsp;&nbsp; 2023-06-07</div><div class="info-break-policy"><i class="far fa-file-word fa-fw"></i> 文章字数:&nbsp;&nbsp; 6.1k</div><div class="info-break-policy"><i class="far fa-clock fa-fw"></i> 阅读时长:&nbsp;&nbsp; 22 分</div></div></div><hr class="clearfix"><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/prism/prism.min.css"><div class="card-content article-card-content"><div id="articleContent"><h1 id="1-单表访问之索引合并"><a href="#1-单表访问之索引合并" class="headerlink" title="1 单表访问之索引合并"></a>1 单表访问之索引合并</h1><p>MySQL在一般情况下执行一个查询时<code>最多</code>只会用到单个<code>二级索引</code>，但存在有特殊情况，也可能在一个查询中使用到多个二级索引，MySQL中这种使用到多个索引来完成一次查询的执行方法称之为：<code>索引合并/index merg</code>。e</p><h2 id="1-1-Intersection-合并"><a href="#1-1-Intersection-合并" class="headerlink" title="1.1 Intersection 合并"></a>1.1 Intersection 合并</h2><p>这里是说某个查询可以使用<code>多个二级索引</code>，将从多个二级索引中查询到的结果取<code>交集</code>，比方说下边这个查询:<br><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> order_exp <span class="token keyword">WHERE</span> order_no <span class="token operator">=</span> <span class="token string">'a'</span> <span class="token operator">AND</span> expire_time <span class="token operator">=</span> <span class="token string">'b'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><br>假设这个查询使用 Intersection 合并的方式执行的话，那这个过程就是这样的:</p><ul><li>从 <code>idx_order_no</code> 二级索引对应的 <code>B+树</code>中取出 <code>order_no= &#39;a&#39;</code>的相关记录。</li><li>从 <code>idx_expire_time</code> 二级索引对应的 <code>B+树</code>中取出 <code>expire_time= &#39;b&#39;</code>的相关记录。</li><li>二级索引的记录都是由<code>索引列 + 主键</code>构成的，所以我们可以计算出这两个结果集中 <code>id</code> 值的<code>交集</code>。</li><li>按照上一步生成的 <code>id</code> 值列表进行<code>回表</code>操作，也就是从<code>聚簇索引</code>中把<code>指定 id 值</code>的完整用户记录取出来，返回给用户。</li></ul><blockquote><p>为啥不直接使用 <code>idx_order_no</code> 或者 <code>idx_expire_time</code> 只根据某个搜索条件去读取<code>一个二级索引</code>，然后<code>回表</code>后再<code>过滤</code>另外一个搜索条件呢?</p></blockquote><p>这里要分析一下两种查询执行方式之间需要的<code>成本代价</code>。</p><ul><li>只读取一个二级索引的成本：按照某个搜索条件读取一个二级索引，根据该二级索引得到的主键值进行<code>回表</code>操作，然后再<code>过滤</code>其他的搜索条件</li><li>读取多个二级索引之后取交集成本：按照不同的搜索条件<code>分别读取</code>不同的二级索引，将从多个二级索引得到的<code>主键值</code>取<code>交集</code>，然后进行<code>回表</code>操作。</li></ul><p>虽然读取多个二级索引比读取一个二级索引消耗性能，但是大部分情况下读取二级索引的操作是<code>顺序 I/O</code>，而<code>回表</code>操作是<code>随机 I/O</code>，所以如果只读取一个二级索引时需要回表的记录数特别多，而读取多个二级索引之后取交集的记录数非常少，当节省的因为回表而造成的性能损耗比访问多个二级索引带来的性能损耗更高时，读取多个二级索引后取交集比只读取一个二级索引的<code>成本更低</code>。</p><blockquote><p>MySQL 在某些特定的情况下才可能会使用到 <code>Intersection 索引合并</code>，哪些情况呢?</p><ul><li>情况一：<code>等值匹配</code>：二级索引列是等值匹配的情况，对于<code>联合索引</code>来说，在联合索引中的每个列都必须<code>等值匹配</code>，不能出现只匹配部分列的情况。</li><li>情况二：主键列可以是范围匹配。</li></ul><p>之所以在二级索引列都是<code>等值匹配</code>的情况下才可能使用 <code>Intersection 索引合并</code>，是因为只有在这种情况下根据二级索引查询出的结果集是<code>按照主键值排序的</code>。Intersection 索引合并会把从多个二级索引中查询出的主键值求交集，如果从各个二级索引中查询的到的结果集本身就是已经按照主键排好序的，那么求交集的过程就很容易。</p></blockquote><h2 id="1-2-Union-合并"><a href="#1-2-Union-合并" class="headerlink" title="1.2 Union 合并"></a>1.2 Union 合并</h2><p>Union 是<code>并集</code>的意思，适用于使用不同索引的搜索条件之间使用 <code>OR</code> 连接起来的情况。</p><p>比如：<br><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> order_exp <span class="token keyword">WHERE</span> order_no <span class="token operator">=</span> <span class="token string">'a'</span> <span class="token operator">OR</span> expire_time <span class="token operator">=</span> <span class="token string">'b'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>与 <code>Intersection 索引合并</code>类似，MySQL 在某些特定的情况下才可能会使用到 <code>Union 索引合并</code>:</p><ul><li>情况一：等值匹配分析同 Intersection 合并</li><li>情况二：主键列可以是范围匹配 分析同 Intersection 合并</li><li>情况三：使用 Intersection 索引合并的搜索条件。就是搜索条件的<code>某些部分</code>使用 <code>Intersection 索引合并</code>的方式得到的<strong>主键集合</strong>和<code>其他方式</code>得到的<strong>主键集合</strong>取<code>交集</code>，比方说这个查询:<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> order_exp <span class="token keyword">WHERE</span> insert_time <span class="token operator">=</span> <span class="token string">'a'</span> <span class="token operator">AND</span> order_status <span class="token operator">=</span> <span class="token string">'b'</span> <span class="token operator">AND</span> expire_time <span class="token operator">=</span> <span class="token string">'c'</span> <span class="token operator">OR</span> <span class="token punctuation">(</span>order_no <span class="token operator">=</span> <span class="token string">'a'</span> <span class="token operator">AND</span> expire_time <span class="token operator">=</span> <span class="token string">'b'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>优化器<code>可能</code>采用这样的方式来执行这个查询:</li></ul><ul><li>先按照搜索条件 <code>order_no = &#39;a&#39; AND expire_time = &#39;b&#39;</code>从索引 <code>idx_order_no</code> 和 <code>idx_expire_time</code> 中使用 <code>Intersection 索引合并</code>的方式得到一个主键集合。</li><li>再按照搜索条件 <code>insert_time = &#39;a&#39; AND order_status = &#39;b&#39; AND expire_time = &#39;c&#39;</code>从联合索引 <code>u_idx_day_status</code> 中得到另一个主键集合。</li><li>采用 <code>Union 索引合并</code>的方式把上述两个主键集合取<code>并集</code>，然后进行<code>回表</code>操作，将结果返回给用户。</li></ul><p>当然，查询条件符合了这些情况也<code>不一定</code>就会采用 Union 索引合并，也得<strong>看优化器的心情</strong>。优化器只有在单独根据搜索条件从某个二级索引中获取的记录数比较少，通过 Union 索引合并后进行访问的<code>代价</code>比全表扫描<code>更小</code>时才会使用 Union 索引合并。</p><h2 id="1-3-Sort-Union-合并"><a href="#1-3-Sort-Union-合并" class="headerlink" title="1.3 Sort_Union 合并"></a>1.3 Sort_Union 合并</h2><p>先按照二级索引记录的主键值进行<code>排序</code>，之后按照 <code>Union 索引合并</code>方式执行的方式称之为 <code>Sort-Union 索引合并</code>.</p><h2 id="1-4-联合索引替代Intersection-索引合并"><a href="#1-4-联合索引替代Intersection-索引合并" class="headerlink" title="1.4 联合索引替代Intersection 索引合并"></a>1.4 联合索引替代Intersection 索引合并</h2><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> order_exp <span class="token keyword">WHERE</span> order_no<span class="token operator">=</span> <span class="token string">'a'</span> <span class="token operator">And</span> expire_time<span class="token operator">=</span> <span class="token string">'z'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>这个查询之所以可能使用 Intersection 索引合并的方式执行，还不是因为 <code>idx_order_no</code> 和 <code>idx_expire_time</code> 是两个单独的 B+树索引，要是把这两个列搞一个<code>联合索引</code>，那直接使用这个联合索引就把事情搞定了，何必用啥索引合并呢，就像这样:<br><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> order_exp <span class="token keyword">drop</span> <span class="token keyword">index</span> idx_order_no<span class="token punctuation">,</span> idx_expire_time<span class="token punctuation">,</span>
<span class="token keyword">add</span> <span class="token keyword">index</span> idx_order_no_expire_time<span class="token punctuation">(</span>order_no<span class="token punctuation">,</span> expire_time<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p><p>这样我们把 idx_order_no, idx_expire_time 都干掉，再添加一个<code>联合索引 idx_order_no_expire_time</code>，使用这个联合索引进行查询简直是又快又好，既不用多读一棵 B+树，也不用合并结果。</p><h1 id="2-连接查询"><a href="#2-连接查询" class="headerlink" title="2 连接查询"></a>2 连接查询</h1><blockquote><p>连接的<code>本质</code>就是把各个连接表中的记录都取出来依次匹配的<code>组合</code>加入结果集并返回给用户。</p></blockquote><h1 id="3-MySQL-的查询成本"><a href="#3-MySQL-的查询成本" class="headerlink" title="3 MySQL 的查询成本"></a>3 MySQL 的查询成本</h1><h2 id="3-1-成本组成"><a href="#3-1-成本组成" class="headerlink" title="3.1 成本组成"></a>3.1 成本组成</h2><p>MySQL 执行一个查询可以有不同的执行方案，它会选择其中<code>成本最低</code>，或者说<code>代价最低</code>的那种方案去真正地执行查询。</p><p>在 MySQL 中一条<code>查询语句</code>的<code>执行成本</code>是由下边这<code>两个方面</code>组成的:</p><ul><li>I/O成本：表、索引等数据是存储在磁盘上的，当用户查询表数据时，MySQL需要先把数据或者索引加载到<code>内存</code>中然后再操作。这个从<code>磁盘到内存</code>这个加载的过程<code>损耗的时间</code>称之为 <code>I/O 成本</code>。</li><li>CPU成本：<code>读取以及检测记录是否满足对应的搜索条件</code>、<code>对结果集进行排序</code>等这些操作<code>损耗的时间</code>称之为 <code>CPU 成本</code>。</li><li>成本常数：对于 <code>InnoDB</code> 存储引擎来说，<code>页</code>是<code>磁盘</code>和<code>内存</code>之间交互的<code>基本单位</code>。常用的成本常数有（当然还有其他的成本常数）：<ul><li>读取一个页面花费的成本默认是 <code>1.0</code></li><li>读取以及检测一条记录是否符合搜索条件的成本默认是 <code>0.2</code>。<blockquote><p>注意，不管读取记录时需不需要检测是否满足搜索条件，其成本都算是 0.2。</p></blockquote></li></ul></li></ul><h2 id="3-2-单表查询的成本"><a href="#3-2-单表查询的成本" class="headerlink" title="3.2 单表查询的成本"></a>3.2 单表查询的成本</h2><h3 id="3-2-1-基于成本的优化步骤实战"><a href="#3-2-1-基于成本的优化步骤实战" class="headerlink" title="3.2.1 基于成本的优化步骤实战"></a>3.2.1 基于成本的优化步骤实战</h3><p>在一条单表查询语句真正执行之前，MySQL 的<code>查询优化器</code>会找出执行该语句<code>所有可能</code>使用的方案，对比之后找出<code>成本最低的方案</code>，这个成本最低的方案就是所谓的<code>执行计划</code>，之后才会调用存储引擎提供的接口真正地执行查询，这个过程总结一下就是这样:</p><ul><li>根据搜索条件，找出所有可能使用的索引</li><li>计算全表扫描的代价</li><li>计算使用不同索引执行查询的代价</li><li>对比各种执行方案的代价，找出成本最低的那一个</li></ul><h3 id="3-2-2-举例"><a href="#3-2-2-举例" class="headerlink" title="3.2.2 举例"></a>3.2.2 举例</h3><p>现有以下表结构<br><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> order_exp
<span class="token punctuation">(</span>
    <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span>              <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">22</span><span class="token punctuation">)</span>   <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span> <span class="token string">'订单的主键'</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>order_no<span class="token punctuation">`</span></span>        <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span>  <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'订单的编号'</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>order_note<span class="token punctuation">`</span></span>      <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'订单说明'</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>insert time<span class="token punctuation">`</span></span>     <span class="token keyword">datetime</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>  <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'插入订单的时间'</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>expire_duration<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">22</span><span class="token punctuation">)</span>   <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'订单的过期时长, 单位秒'</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>expire_time<span class="token punctuation">`</span></span>     <span class="token keyword">datetime</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>  <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'订单的过期时间'</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>order_status<span class="token punctuation">`</span></span>    <span class="token keyword">smallint</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>  <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token number">0</span> <span class="token keyword">COMMENT</span> <span class="token string">'订单状态：0:未支付，1:已支付，-1: 已过期、关闭'</span><span class="token punctuation">,</span>
    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">USING</span> <span class="token keyword">BTREE</span><span class="token punctuation">,</span>
    <span class="token keyword">UNIQUE</span> <span class="token keyword">INDEX</span> <span class="token string">'idx day status'</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>insert time<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>order_status<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">USING</span> <span class="token keyword">BTREE</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">InnoDB</span>
  <span class="token keyword">AUTO_INCREMENT</span> <span class="token operator">=</span> <span class="token number">16</span>
  <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8mb4
  <span class="token keyword">COLLATE</span> utf8_general_ci <span class="token keyword">COMMENT</span> <span class="token operator">=</span><span class="token string">'订单表'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>查询语句如下:<br><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> order_exp
<span class="token keyword">WHERE</span> order_no <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token string">'DD00_6S'</span><span class="token punctuation">,</span> <span class="token string">'DD00_9S'</span><span class="token punctuation">,</span> <span class="token string">'DD00_10S'</span><span class="token punctuation">)</span>
  <span class="token operator">AND</span> expire_time <span class="token operator">></span> <span class="token string">'2021-03-22 18:28:28'</span>
  <span class="token operator">AND</span> expire_time <span class="token operator">&lt;=</span> <span class="token string">'2021-03-22 18:35:09'</span>
  <span class="token operator">AND</span> insert_time <span class="token operator">></span> expire_time
  <span class="token operator">AND</span> order_note <span class="token operator">LIKE</span> <span class="token string">'%hello%'</span>
  <span class="token operator">AND</span> order_status <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="3.2.2.1">3.2.2.1 根据搜索条件，找出所有可能使用的索引</h4><p>我们分析一下上边查询中涉及到的几个搜索条件:</p><ul><li><code>order_no IN (&#39;DD00_6S&#39;, &#39;DD00_9S&#39;, &#39;DD00_10S&#39;)</code> ，这个搜索条件可以使用二级索引<code>idx_order_no</code>。</li><li><code>expire_time&gt; &#39;2021-03-22 18:28:28&#39; AND expire_time&lt;= &#39;2021-03-22 18:35:09&#39;</code>，这个搜索条件可以使用二级索引<code>idx_expire_time</code>。</li><li><code>insert_time&gt; expire_time</code>，这个搜索条件的索引列由于没有和常数比较，所以并不能使用到索引。</li><li><code>order_note LIKE &#39;%hello%&#39;</code>，<code>order_note</code>即使有索引，但是通过 <code>LIKE</code> 操作符和以<code>通配符开头</code>的字符串做比较，不可以适用索引。</li><li><code>order_status = 0</code>，由于该列上只有联合索引，而且<strong>不符合</strong><code>最左前缀原则</code>，所以不会用到索引。</li></ul><p>综上所述，上边的查询语句可能用到的索引，也就是 <code>possible keys</code> 只有 <code>idx_order_no</code>,<code>idx_expire_time</code>。</p><blockquote><p>Tips：MySQL把一个查询中<code>可能</code>使用到的<code>索引</code>称之为 <code>possible keys</code>。</p></blockquote><h4 id="3-2-2-2-计算全表扫描的代价"><a href="#3-2-2-2-计算全表扫描的代价" class="headerlink" title="3.2.2.2 计算全表扫描的代价"></a>3.2.2.2 计算全表扫描的代价</h4><p>对于<code>InnoDB存储引擎</code>来说，<code>全表扫描</code>的意思就是把<code>聚簇索引</code>中的记录都依次和给定的搜索条件做一下比较，把符合搜索条件的记录加入到<code>结果集</code>，所以需要将聚簇索引对应的页面加载到内存中，然后再检测记录是否符合搜索条件。</p><p>由于<code>查询成本 = I/O 成本 + CPU 成本</code>，所以计算全表扫描的代价需要两个信息:</p><ul><li>聚簇索引占用的页面数</li><li>该表中的记录数</li></ul><p>MySQL给我们提供了 <code>SHOW TABLE STATUS</code> 语句来查看表的统计信息，以上表<code>order_exp</code>为例，查询该表的统计信息语句如下：<br><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SHOW</span> <span class="token keyword">TABLE</span> <span class="token keyword">STATUS</span> <span class="token operator">LIKE</span> <span class="token string">'order_exp'</span> \G<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>结果如下：<br><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">SHOW</span> <span class="token keyword">TABLE</span> <span class="token keyword">STATUS</span> <span class="token operator">LIKE</span> <span class="token string">'order_exp'</span> \G
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1.</span><span class="token keyword">row</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
Name: order_exp
<span class="token keyword">Engine</span>: <span class="token keyword">InnoDB</span>
Version: <span class="token number">10</span>
Row_format: Dynamic
<span class="token keyword">Rows</span>: <span class="token number">10350</span>
Avg_row_length: <span class="token number">153</span>
Data_length: <span class="token number">1589248</span>
Max_data_length: <span class="token number">0</span>
Index_length: <span class="token number">1130496</span>
Data_free: <span class="token number">4194304</span>
<span class="token keyword">Auto_increment</span>: <span class="token number">10819</span>
Create_time: <span class="token number">2021</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">31</span> <span class="token number">15</span>:<span class="token number">39</span>:<span class="token number">43</span>
Update_time: <span class="token number">2021</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">05</span> <span class="token number">18</span>:<span class="token number">43</span>:<span class="token number">17</span>
Check_time: <span class="token boolean">NULL</span>
Collation: utf8_general_ci
Checksum: <span class="token boolean">NULL</span>
Create_options:
<span class="token keyword">Comment</span>:
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>我们只需要关心这两个参数：</p><ul><li>Rows：表示表中的记录条数。对于使用 <code>MyISAM</code> 存储引擎的表来说，该值是<code>准确的</code>，对于使用 <code>InnoDB</code> 存储引擎的表来说，该值是一个<code>估计值</code>。</li><li>Data_length：表示表占用的存储空间字节数。使用 <code>MyISAM</code> 存储引擎的表来说，该值就是<code>数据文件的大小</code>，对于使用 <code>InnoDB</code> 存储引擎的表来说，该值就相当于<code>聚簇索引占用的存储空间大小</code>，也就是说可以这样计算该值的大小:<pre class="line-numbers language-none"><code class="language-none">Data_length &#x3D; 聚簇索引的页面数量 * 每个页面的大小<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>这里 <code>order_exp</code> 使用默认 <code>16KB</code> 的页面大小，而上边查询结果显示<code>Data_length</code>的值是<code>1589248</code>，所以我们可以反向来推导出聚簇索引的页面数量:<pre class="line-numbers language-none"><code class="language-none">聚簇索引的页面数量 &#x3D; 1589248 ÷ 16 ÷ 1024 &#x3D; 97<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ul><p>现在已经得到了<code>聚簇索引占用的页面数量</code>以及该表<code>记录数的估计值</code>，所以就可以计算<code>全表扫描成本</code>了。</p><ul><li>I/O 成本：<code>97 * 1.0 + 1.1 = 98.1</code>，<code>97</code>指的是聚簇索引占用的页面数，<code>1.0</code>指的是加载一个页面的成本常数，后边的<code>1.1</code>是一个微调值。<blockquote><p>TIPS：MySQL 在真实计算成本时会进行一些微调，这些微调的值是直接硬编码到代码里的，没有注释而且这些微调的值十分的小，并不影响我们分析。</p></blockquote></li><li>CPU 成本：<code>10350 * 0.2 + 1.0 = 2071</code>，<code>10350</code>指的是统计数据中表的记录数，对于InnoDB存储引擎来说是一个估计值，<code>0.2</code>指的是访问一条记录所需的成本常数，后边的<code>1.0</code>是一个微调值。</li><li>总成本：<code>98.1 + 2071 = 2169.1</code></li></ul><p>综上所述，对于 <code>order_exp</code> 的<code>全表扫描</code>所需的<code>总成本</code>就是<code>2169.1</code>。</p><blockquote><p>TIPS：表中的记录其实都存储在<code>聚簇索引</code>对应<code>B+树</code>的<code>叶子节点</code>中，所以只要我们通过根节点获得了最左边的叶子节点，就可以沿着叶子节点组成的<code>双向链表</code>把所有记录都查看一遍。<br>也就是说全表扫描这个过程其实有的<code>B+树非叶子节点</code>是不需要访问的，但是<code>MySQL</code>在计算<code>全表扫描成本</code>时直接使用<code>聚簇索引占用的页面数</code>作为计算<code>I/O成本</code>的依据，是<code>不区分</code>非叶子节点和叶子节点的。</p></blockquote><h4 id="3-2-2-3-计算使用不同索引执行查询的代价"><a href="#3-2-2-3-计算使用不同索引执行查询的代价" class="headerlink" title="3.2.2.3 计算使用不同索引执行查询的代价"></a>3.2.2.3 计算使用不同索引执行查询的代价</h4><p>MySQL<code>查询优化器</code>先分析使用<code>唯一二级索引</code>的成本，再分析使用<code>普通索引</code>的成本。这里的表<code>order_exp</code>只有两个普通二级索引，先算哪个都可以。</p><p>在<a href="#3.2.2.1">计算全表扫描的代价</a>一节中，可能用到的索引有<code>idx_order_no</code>,<code>idx_expire_time</code>。因而接下来，我们分析这两个索引的查询成本分别是多少。</p><h5 id="3-2-2-3-1-使用-idx-expire-time-执行查询的成本分析"><a href="#3-2-2-3-1-使用-idx-expire-time-执行查询的成本分析" class="headerlink" title="3.2.2.3.1 使用 idx_expire_time 执行查询的成本分析"></a>3.2.2.3.1 使用 <code>idx_expire_time</code> 执行查询的成本分析</h5><p><code>idx_expire_time</code> 对应的搜索条件是：<code>expire_time&gt; &#39;2021-03-22 18:28:28&#39; AND expire_time&lt;= &#39;2021-03-22 18:35:09&#39;</code> ，也就是说对应的范围区间就是: <code>(&#39;2021-03-22 18:28:28&#39; , &#39;2021-03-22 18:35:09&#39; )</code>。</p><p>使用 <code>idx_expire_time</code> 搜索会使用用<code>二级索引 + 回表方式</code>的查询，MySQL 计算这种查询的成本依赖<code>两个方面</code>的数据:</p><ul><li><p>范围区间数量：不论某个范围区间的二级索引到底占用了多少页面，查询优化器认为读取<code>索引的一个范围区间</code>的 <code>I/O 成本</code>和读取<code>一个页面</code>是<strong>相同的</strong>。</p><p>本例中使用 <code>idx_expire_time</code> 的范围区间<code>只有一个</code>，所以相当于访问这个范围区间的二级索引付出的 <code>I/O 成本</code>就是：<code>1 * 1.0 = 1.0</code></p></li><li>需要回表的记录数：优化器需要计算二级索引的某个范围区间到底包含多少条记录，对于本例来说就是要计算 <code>idx_expire_time</code> 在<code>(&#39;2021-03-22 18:28:28&#39; ，&#39;2021-03-22 18:35:09&#39;)</code>这个范围区间中包含多少二级索引记录，计算过程是这样的:<ul><li>先根据 <code>expire_time&gt; &#39;2021-03-22 18:28:28&#39;</code>这个条件访问一下 <code>idx_expire_time</code> 对应的 B+树索引，找到满足 <code>expire_time&gt; &#39;2021-03-22 18:28:28&#39;</code> 这个条件的<code>第一条记录</code>，我们把这条记录称之为<code>区间最左记录</code>。</li><li>再根据 <code>expire_time&lt;= &#39;2021-03-22 18:35:09&#39;</code>这个条件继续从 <code>idx_expire_time</code> 对应的 B+树索引中找出<code>最后一条</code>满足这个条件的记录，我们把这条记录称之为<code>区间最右记录</code>。</li><li>如果<code>区间最左记录</code>和<code>区间最右记录</code>相隔不太远(在 <code>MySQL 5.7</code> 这个版本里，只要相隔<code>不大于 10 个页面</code>即可)，那就可以<code>精确</code>统计出满足 <code>expire_time&gt; &#39;2021-03-22 18:28:28&#39; AND expire_time&lt;= &#39;2021-03-22 18:35:09&#39;</code>条件的二级索引<code>记录条数</code>。否则只沿着区间最左记录<code>向右</code>读<code>10个页面</code>，计算平均每个页面中包含多少记录，然后用这个<code>平均值</code>乘以<code>区间最左记录和区间最右记录之间的页面数量</code>就可以了。</li></ul></li></ul><blockquote><p>那么问题又来了，怎么估计<code>区间最左记录</code>和<code>区间最右记录</code>之间有多少个页面呢？</p><p>解决这个问题还得回到B+树索引的结构中来。我们假设区间<strong>最左记录</strong>在<code>页b</code>中，区间<strong>最右记录</strong>在<code>页c</code>中，那么我们想计算区间最左记录和区间最右记录之间的页面数量，就相当于计算页b和页c之间有多少页面，而它们<code>父节点</code>中记录的每一条目录项记录都对应一个数据页，所以计算页b和页c之间有多少页面就相当于计算它们<code>父节点</code>(也就是页a)中对应的目录项记录之间隔着几条记录。在一个页面中统计两条记录之间有几条记录的成本就很小了。</p><p>不过还有问题，如果页 b 和页 c 之间的页面实在太多，以至于页 b 和页 c 对应的目录项记录都不在一个父页面中怎么办？</p><p>既然是树，那就继续<code>递归</code>，一个B+树有<code>4层</code>高已经很不得了了，所以这个统计过程也不是很耗费性能。</p></blockquote><p>回到正题，现在计算<code>idx_expire_time</code>所花费的<code>CPU成本</code>。</p><p>MySQL根据上述算法测得 <code>idx_expire_time</code> 在区间<code>(&#39;2021-03-22 18:28:28&#39; ， &#39;2021-03-22 18:35:09&#39;)</code>之间大约有 <code>39</code> 条记录。可执行以下语句得到记录数Row：<br><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">explain</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> order_exp <span class="token keyword">WHERE</span> expire_time<span class="token operator">></span> <span class="token string">'2021-03-22 18:28:28'</span> <span class="token operator">AND</span> expire_time<span class="token operator">&lt;=</span> <span class="token string">'2021-03-22 18:35:09'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>读取这 39 条二级索引记录需要付出的 <code>CPU 成本</code>就是:<br><pre class="line-numbers language-none"><code class="language-none">39 x 0.2 + 0.01 &#x3D; 7.81<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><br>其中 <code>39</code> 是需要读取的二级索引<code>记录条数</code>，<code>0.2</code>是读取一条记录成本常数，<code>0.01</code>是微调。</p><p>再计算<code>I/O成本</code>。</p><p>在通过二级索引获取到记录之后，还需要干<code>两件事儿</code>:<br>1）根据这些记录里的主键值到聚簇索引中做<code>回表</code>操作<br>MySQL评估<code>回表操作</code>的<code>I/O成本</code>依旧很简单粗暴，其认为每次回表操作都相当于<code>访问一个页面</code>，也就是说二级索引范围区间有多少记录，就需要进行多少次回表操作，也就是需要进行多少次页面 <code>I/O</code>。</p><p>上面得到了39条记录，需要进行39次的回表，因而得出<code>I/O成本</code>为：<br><pre class="line-numbers language-none"><code class="language-none">39 * 1.0 &#x3D; 39 .0<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><br>其中 <code>39</code> 是预计的二级索引<code>记录数</code>，<code>1.0</code>是一个页面的 <code>I/O 成本常数</code>。</p><p>2）回表操作后得到的完整用户记录，然后再检测其他搜索条件是否成立<br><code>回表操作</code>的<code>本质</code>就是通过二级索引记录的主键值到聚簇索引中找到完整的用户记录，然后再检测除 <code>expire_time&gt; &#39;2021-03-22 18:28:28&#39; AND expire_time&lt; &#39;2021-03-22 18:35:09&#39;</code>这个搜索条件以外的搜索条件<code>是否成立</code>。</p><p>因为我们通过范围区间获取到二级索引记录共 <code>39 条</code>，也就对应着聚簇索引中 39 条完整的用户记录，读取并检测这些完整的用户记录是否符合其余的搜索条件的 <code>CPU 成本</code>如下:<br><pre class="line-numbers language-none"><code class="language-none">39 * 0.2 &#x3D;7.8<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><br>其中 <code>39</code> 是待检测记录的条数，<code>0.2</code> 是检测一条记录是否符合给定的搜索条件的成本常数。</p><p>所以本例中使用 <code>idx_expire_time</code> 执行查询的成本就如下所示：</p><ul><li>I/O 成本：<code>1.0 + 39 * 1.0 = 40 .0</code> (范围区间的数量 + 预估的二级索引记录条数)</li><li>CPU 成本：<code>39 * 0.2 + 0.01 + 39 * 0.2 = 15.61</code> (读取二级索引记录的成本 + 读取并检测回表后聚簇索引记录的成本)</li></ul><p>综上所述，使用 <code>idx_expire_time</code> 执行查询的总成本就是: <code>40 .0 + 15.61 = 55.61</code></p><h5 id="3-2-2-3-2-使用-idx-order-no-执行查询的成本分析"><a href="#3-2-2-3-2-使用-idx-order-no-执行查询的成本分析" class="headerlink" title="3.2.2.3.2 使用 idx_order_no 执行查询的成本分析"></a>3.2.2.3.2 使用 <code>idx_order_no</code> 执行查询的成本分析</h5><p><code>idx_order_no</code> 对应的搜索条件是：<code>order_no IN (&#39;DD00_6S&#39;, &#39;DD00_9S&#39;, &#39;DD00_10S&#39;)</code>，也就是说相当于 <code>3 个单点区间</code>。</p><p>与使用 <code>idx_expire_time</code> 的情况类似，我们也需要计算使用 <code>idx_order_no</code> 时需要访问的<code>范围区间数量</code>以及<code>需要回表的记录数</code>，计算过程与上面类似，我们不详列所有计算步骤和说明了。</p><ul><li>范围区间数量<br>使用 <code>idx_order_no</code> 执行查询时很显然有 <code>3 个单点区间</code>，所以访问这 3 个范围区间的二级索引付出的 <code>I/O 成本</code>就是：<pre class="line-numbers language-none"><code class="language-none">3 * 1.0 &#x3D; 3.0<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li>需要回表的记录数<br>由于使用 <code>idx_expire_time</code> 时有 3 个单点区间，所以每个单点区间都需要查找一遍对应的二级索引记录数，三个单点区间总共需要回表的记录数是<code>58</code>。语句如下：<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">explain</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> order_exp <span class="token keyword">WHERE</span> order_no <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token string">'DD00_6S'</span><span class="token punctuation">,</span> <span class="token string">'DD00_9S'</span><span class="token punctuation">,</span> <span class="token string">'DD00_10S'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>读取这些二级索引记录的 <code>CPU 成本</code>就是：<pre class="line-numbers language-none"><code class="language-none">58 * 0.2 + 0.01 &#x3D; 11.61<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ul><p>再计算<code>I/O成本</code>。</p><p>根据这些记录里的主键值到聚簇索引中做回表操作，所需的 <code>I/O 成本</code>就是:<br><pre class="line-numbers language-none"><code class="language-none">58 * 1.0 &#x3D; 58.0<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>回表操作后得到的完整用户记录，然后再比较其他搜索条件是否成立。此步骤对应的 <code>CPU 成本</code>就是:<br><pre class="line-numbers language-none"><code class="language-none">58 * 0.2 &#x3D; 11.6<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>综上，使用 <code>idx_order_no</code> 执行查询的成本就如下所示:</p><ul><li>I/O 成本：<code>3.0 + 58 x 1.0 = 61.0</code> (范围区间的数量 + 预估的二级索引记录条数)</li><li>CPU 成本：<code>58 x 0.2 + 58 x 0.2 + 0.01 = 23.21</code> (读取二级索引记录的成本 + 读取并检测回表后聚簇索引记录的成本)</li></ul><p>综上所述，使用 <code>idx_order_no</code> 执行查询的<code>总成本</code>就是: <code>61.0 + 23.21 = 84.21</code></p><h5 id="3-2-2-3-3-是否有可能使用索引合并-Index-Merge"><a href="#3-2-2-3-3-是否有可能使用索引合并-Index-Merge" class="headerlink" title="3.2.2.3.3 是否有可能使用索引合并(Index Merge)"></a>3.2.2.3.3 是否有可能使用索引合并(Index Merge)</h5><p>本例中有关 <code>order_no</code> 和 <code>expire_time</code> 的搜索条件是使用 <code>AND</code> 连接起来的，而对于 <code>idx_order_no</code> 和 <code>idx_expire_time</code> 都是<code>范围查询</code>，也就是说查找到的二级索引记录并不是按照<code>主键值</code>进行排序的，并<code>不满足</code>使用 <code>Intersection 索引合并</code>的条件，所以并不会使用索引合并。而且 MySQL 查询优化器计算<code>索引合并成本</code>的算法也比较麻烦，所以我们也不会细说。</p><h3 id="3-2-3-对比各种方案，找出成本最低的那一个"><a href="#3-2-3-对比各种方案，找出成本最低的那一个" class="headerlink" title="3.2.3 对比各种方案，找出成本最低的那一个"></a>3.2.3 对比各种方案，找出成本最低的那一个</h3><p>下边把执行本例中的查询的各种可执行方案以及它们对应的成本列出来:</p><ul><li>全表扫描的成本：<code>2148.7</code></li><li>使用 <code>idx_expire_time</code> 的成本：<code>55.61</code></li><li>使用 <code>idx_order_no</code> 的成本：<code>84.21</code></li></ul><p>很显然，使用 <code>idx_expire_time</code> 的成本最低，所以当然选择 <code>idx_expire_time</code> 来执行查询。</p><blockquote><p>Warning:</p><ul><li>MySQL 的源码中对成本的计算实际要更复杂，但是基本思想和算法是没错的。</li><li><p>在 MySQL 的实际计算中，在和全文扫描比较成本时，使用索引的成本会<strong>去除</strong><code>读取并检测回表后聚簇索引记录的成本</code>，也就是说，我们通过 MySQL 看到的成本将会是：</p><ul><li><code>idx_expire_time</code> 为<code>47.81</code>(55.61-7.8)，</li><li><code>idx_order_no</code> 为 <code>72.61</code>(84.21-11.6)。</li></ul><p>但是 MySQL 比较完成本后，会再计算一次使用索引的成本，此时就会<strong>加上</strong><code>读取并检测回表后聚簇索引记录的成本</code>，也就是我们计算出来的值。</p><h1 id="4-InnoDB-中的统计数据"><a href="#4-InnoDB-中的统计数据" class="headerlink" title="4 InnoDB 中的统计数据"></a>4 InnoDB 中的统计数据</h1></li></ul></blockquote><h1 id="5-MySQL-的查询重写规则"><a href="#5-MySQL-的查询重写规则" class="headerlink" title="5 MySQL 的查询重写规则"></a>5 MySQL 的查询重写规则</h1><h1 id="6-再深入查询优化"><a href="#6-再深入查询优化" class="headerlink" title="6 再深入查询优化"></a>6 再深入查询优化</h1></div><hr><div class="reprint" id="reprint-statement"><div class="reprint__author"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-user">文章作者:</i></span> <span class="reprint-info"><a href="/about" rel="external nofollow noreferrer">Kezade</a></span></div><div class="reprint__type"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-link">文章链接:</i></span> <span class="reprint-info"><a href="https://zyxelva.github.io/posts/3501501421.html">https://zyxelva.github.io/posts/3501501421.html</a></span></div><div class="reprint__notice"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-copyright">版权声明:</i></span> <span class="reprint-info">本博客所有文章除特別声明外，均采用 <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a> 许可协议。转载请注明来源 <a href="/about" target="_blank">Kezade</a> !</span></div></div><script async defer>function navToReprintStatement(){$("html, body").animate({scrollTop:$("#reprint-statement").offset().top-80},800)}document.addEventListener("copy",function(t){M.toast({html:'<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>'})})</script><div class="tag_share" style="display:block"><div class="post-meta__tag-list" style="display:inline-block"><div class="article-tag"><a href="/tags/MySQL/"><span class="chip bg-color">MySQL</span></a> <a href="/tags/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/"><span class="chip bg-color">性能优化</span></a></div></div><div class="post_share" style="zoom:80%;width:fit-content;display:inline-block;float:right;margin:-.15rem 0"><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/share/css/share.min.css"><div id="article-share"><div class="social-share" data-sites="google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/share/js/social-share.min.js"></script></div></div></div><div id="reward"><a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a><div id="rewardModal" class="modal"><div class="modal-content"><a class="close modal-close"><i class="fas fa-times"></i></a><h4 class="reward-title">你的赏识是我前进的动力</h4><div class="reward-content"><div class="reward-tabs"><ul class="tabs row"><li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li><li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li></ul><div id="alipay"><img src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码"></div><div id="wechat"><img src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码"></div></div></div></div></div></div><script>$(function(){$(".tabs").tabs()})</script></div></div><style>.twikoo-card{margin:1.5rem auto}.twikoo-card .card-content{padding:20px}#tcomments textarea{box-sizing:border-box;background:url("/") 100% 100% no-repeat}#tcomments p{margin:2px 2px 10px;font-size:1.05rem;line-height:1.78rem;text-align:left}#tcomments blockquote p{text-indent:.2rem}#tcomments a{padding:0 2px;color:#4cbf30;font-weight:500;text-decoration:none}#tcomments img{max-width:100%;height:auto;cursor:pointer}#tcomments ol li{list-style-type:decimal}#tcomments ol,ul{display:block;padding-left:2em;word-spacing:0.05rem}#tcomments ul li,ol li{display:list-item;line-height:1.8rem;font-size:1rem}#tcomments ul li{list-style-type:disc}#tcomments ul ul li{list-style-type:circle}#tcomments table,td,th{padding:12px 13px;border:1px solid #dfe2e5}#tcomments table,td,th{border:0}table tr:nth-child(2n),thead{background-color:#fafafa}#tcomments table th{background-color:#f2f2f2;min-width:80px}#tcomments table td{min-width:80px}#tcomments h1{font-size:1.85rem;font-weight:700;line-height:2.2rem}#tcomments h2{font-size:1.65rem;font-weight:700;line-height:1.9rem}#tcomments h3{font-size:1.45rem;font-weight:700;line-height:1.7rem}#tcomments h4{font-size:1.25rem;font-weight:700;line-height:1.5rem}#tcomments h5{font-size:1.1rem;font-weight:700;line-height:1.4rem}#tcomments h6{font-size:1rem;line-height:1.3rem}#tcomments p{font-size:1rem;line-height:1.5rem}#tcomments hr{margin:12px 0;border:0;border-top:1px solid #ccc}#tcomments blockquote{margin:15px 0;border-left:5px solid #42b983;padding:1rem .8rem .3rem .8rem;color:#666;background-color:rgba(66,185,131,.1)}#tcomments pre{font-family:monospace,monospace;padding:1.2em;margin:.5em 0;background:#272822;overflow:auto;border-radius:.3em;tab-size:4}#tcomments code{font-family:monospace,monospace;padding:1px 3px;font-size:.92rem;color:#e96900;background-color:#f8f8f8;border-radius:2px}#tcomments pre code{font-family:monospace,monospace;padding:0;color:#e8eaf6;background-color:#272822}#tcomments pre[class*=language-]{padding:1.2em;margin:.5em 0}#tcomments code[class*=language-],pre[class*=language-]{color:#e8eaf6}#tcomments [type=checkbox]:not(:checked),[type=checkbox]:checked{position:inherit;margin-left:-1.3rem;margin-right:.4rem;margin-top:-1px;vertical-align:middle;left:unset;visibility:visible}#tcomments b,strong{font-weight:700}#tcomments dfn{font-style:italic}#tcomments small{font-size:85%}#tcomments cite{font-style:normal}#tcomments mark{background-color:#fcf8e3;padding:.2em}#tcomments table,td,th{padding:12px 13px;border:1px solid #dfe2e5}table tr:nth-child(2n),thead{background-color:#fafafa}#tcomments table th{background-color:#f2f2f2;min-width:80px}#tcomments table td{min-width:80px}#tcomments [type=checkbox]:not(:checked),[type=checkbox]:checked{position:inherit;margin-left:-1.3rem;margin-right:.4rem;margin-top:-1px;vertical-align:middle;left:unset;visibility:visible}</style><div class="card twikoo-card" data-aos="fade-up"><div class="comment_headling" style="font-size:20px;font-weight:700;position:relative;padding-left:20px;top:15px;padding-bottom:5px"><i class="fas fa-comments fa-fw" aria-hidden="true"></i> <span>评论</span></div><div class="card-content" style="display:grid"><div id="tcomments"></div></div></div><script src="https://gcore.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js"></script><script>twikoo.init({envId:"https://kezadetwikoo.netlify.app/.netlify/functions/twikoo",el:"#tcomments",region:"",path:""}).then(function(){for(var t=document.querySelector("#twikoo").getElementsByTagName("input"),e=0;e<t.length;e++)t[e]&&t[e].classList.add("browser-default")})</script><article id="prenext-posts" class="prev-next articles"><div class="row article-row"><div class="article col s12 m6" data-aos="fade-up"><div class="article-badge left-badge text-color"><i class="fas fa-chevron-left"></i> &nbsp;上一篇</div><div class="card"><a href="/posts/1598177646.html"><div class="card-image"><img src="/images/uploads/123f761ecece285af724e41f.jpg" class="responsive-img" alt="【Hexo】Github博客内容管理解决方案 - netlifycms"> <span class="card-title">【Hexo】Github博客内容管理解决方案 - netlifycms</span></div></a><div class="card-content article-content"><div class="summary block-with-text">这个是个从CMS撰写页面的实现方案</div><div class="publish-info"><span class="publish-date"><i class="far fa-clock fa-fw icon-date"></i> 2023-06-08</span><span class="publish-author"><i class="fas fa-bookmark fa-fw icon-category"></i> <a href="/categories/Hexo/" class="post-category">Hexo</a></span></div></div><div class="card-action article-tags"><a href="/tags/Hexo/"><span class="chip bg-color">Hexo</span></a></div></div></div><div class="article col s12 m6" data-aos="fade-up"><div class="article-badge right-badge text-color">下一篇&nbsp;<i class="fas fa-chevron-right"></i></div><div class="card"><a href="/posts/2839790799.html"><div class="card-image"><img src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/medias/featureimages/10.jpg" class="responsive-img" alt="【Hexo】GitHub Action自动部署Hexo"> <span class="card-title">【Hexo】GitHub Action自动部署Hexo</span></div></a><div class="card-content article-content"><div class="summary block-with-text">密码是300400</div><div class="publish-info"><span class="publish-date"><i class="far fa-clock fa-fw icon-date"></i> 2023-06-07</span><span class="publish-author"><i class="fas fa-bookmark fa-fw icon-category"></i> <a href="/categories/Hexo/" class="post-category">Hexo</a></span></div></div><div class="card-action article-tags"><a href="/tags/GitHub-Actions/"><span class="chip bg-color">GitHub Actions</span></a> <a href="/tags/Hexo%E5%8D%9A%E5%AE%A2/"><span class="chip bg-color">Hexo博客</span></a></div></div></div></div></article></div><script>$("#articleContent").on("copy",function(e){if(void 0!==window.getSelection){var n=window.getSelection();if(!((""+n).length<Number.parseInt("120"))){var t=document.getElementsByTagName("body")[0],o=document.createElement("div");o.style.position="absolute",o.style.left="-99999px",t.appendChild(o),o.appendChild(n.getRangeAt(0).cloneContents()),"PRE"!==n.getRangeAt(0).commonAncestorContainer.nodeName&&"CODE"!==n.getRangeAt(0).commonAncestorContainer.nodeName||(o.innerHTML="<pre>"+o.innerHTML+"</pre>");var i=document.location.href;o.innerHTML+='<br />来源: Kezade<br />文章作者: Kezade<br />文章链接: <a href="'+i+'">'+i+"</a><br />本文章著作权归作者所有，任何形式的转载都请注明出处。",n.selectAllChildren(o),window.setTimeout(function(){t.removeChild(o)},200)}}})</script><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/codeBlock/codeBlockFuction.js"></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/prism/prism.min.js"></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/codeBlock/codeLang.js"></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/codeBlock/codeCopy.js"></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/codeBlock/codeShrink.js"></script></div><div id="toc-aside" class="expanded col l3 hide-on-med-and-down"><div class="toc-widget card" style="background-color:#fff"><div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div><div id="toc-content"></div></div></div></div><div id="floating-toc-btn" class="hide-on-med-and-down"><a class="btn-floating btn-large bg-color"><i class="fas fa-list-ul"></i></a></div><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/tocbot/tocbot.min.js"></script><script>$(function(){tocbot.init({tocSelector:"#toc-content",contentSelector:"#articleContent",headingsOffset:-(.4*$(window).height()-45),collapseDepth:Number("0"),headingSelector:"h1, h2, h3, h4, h5"});let t=parseInt(.4*$(window).height()-64),e=$(".toc-widget");$(window).scroll(function(){$(window).scrollTop()>t?e.addClass("toc-fixed"):e.removeClass("toc-fixed")});const o="expanded";let n=$("#toc-aside"),i=$("#main-content");$("#floating-toc-btn .btn-floating").click(function(){n.hasClass(o)?(n.removeClass(o).hide(),i.removeClass("l9")):(n.addClass(o).show(),i.addClass("l9")),function(t,e){let o=$("#"+t);if(0===o.length)return;let n=o.width();n+=n>=450?21:n>=350&&n<450?18:n>=300&&n<350?16:14,$("#"+e).width(n)}("artDetail","prenext-posts")})})</script></main><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script>MathJax.Hub.Config({tex2jax:{inlineMath:[["$","$"],["\\(","\\)"]]}})</script><footer class="page-footer bg-color"><div class="container row center-align" style="margin-bottom:15px!important"><div class="col s12 m8 l8 copy-right">Copyright&nbsp;&copy; <span id="year">2019-2025</span> <a href="/about" target="_blank">Kezade</a> |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a> |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a><br><br><span id="sitetime">Loading ...</span><script>var calcSiteTime=function(){var e=6e4,t=36e5,n=864e5,a=365*n,i=new Date,r="2019",o=i.getFullYear(),s=i.getMonth()+1,l=i.getDate(),m=i.getHours(),c=i.getMinutes(),d=i.getSeconds(),g=Date.UTC(r,"6","28","0","0","0"),h=Date.UTC(o,s,l,m,c,d)-g,u=Math.floor(h/a),M=Math.floor(h/n-365*u),T=Math.floor((h-(365*u+M)*n)/t),f=Math.floor((h-(365*u+M)*n-T*t)/e),y=Math.floor((h-(365*u+M)*n-T*t-f*e)/1e3);if(r===String(o)){document.getElementById("year").innerHTML=o;var v="This site has been running for "+M+" days";v="本站已运行 "+M+" 天",document.getElementById("sitetime").innerHTML=v}else{document.getElementById("year").innerHTML=r+" - "+o;var H="This site has been running for "+u+" years and "+M+" days "+T+" hours "+f+" mins "+y+" seconds";H="本站已苟且偷生 "+u+" 年 "+M+" 天 "+T+" 小时 "+f+" 分钟 "+y+" 秒",document.getElementById("sitetime").innerHTML=H}};calcSiteTime(),setInterval(calcSiteTime,1e3)</script><br></div><div class="col s12 m4 l4 social-link"><a href="https://github.com/zyxelva" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50"><i class="fab fa-github"></i></a><a href="mailto:zyxelva@gmail.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50"><i class="fas fa-envelope-open"></i></a><a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=1807401971" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 1807401971" data-position="top" data-delay="50"><i class="fab fa-qq"></i></a> <a href="https://www.zhihu.com/people/kezade" class="tooltipped" target="_blank" data-tooltip="关注我的知乎: https://www.zhihu.com/people/kezade" data-position="top" data-delay="50"><i class="fab fa-zhihu1">知</i></a><a href="../rss2.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50"><i class="fas fa-rss"></i></a></div></div></footer><div class="progress-bar"></div><div id="searchModal" class="modal"><div class="modal-content"><div class="search-header"><span class="title"><i class="fas fa-search"></i> &nbsp;&nbsp;搜索</span> <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字" class="search-input"></div><div id="searchResult"></div></div></div><script>$(function(){!function(t,e,r){"use strict";$.ajax({url:t,dataType:"xml",success:function(t){var n=$("entry",t).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get(),a=document.getElementById(e),s=document.getElementById(r);a.addEventListener("input",function(){var t='<ul class="search-result-list">',e=this.value.trim().toLowerCase().split(/[\s\-]+/);s.innerHTML="",this.value.trim().length<=0||(n.forEach(function(r){var n=!0,a=r.title.trim().toLowerCase(),s=r.content.trim().replace(/<[^>]+>/g,"").toLowerCase(),i=r.url;i=0===i.indexOf("/")?r.url:"/"+i;var l=-1,c=-1,u=-1;if(""!==a&&""!==s&&e.forEach(function(t,e){l=a.indexOf(t),c=s.indexOf(t),l<0&&c<0?n=!1:(c<0&&(c=0),0===e&&(u=c))}),n){t+="<li><a href='"+i+"' class='search-result-title'>"+a+"</a>";var o=r.content.trim().replace(/<[^>]+>/g,"");if(u>=0){var h=u-20,f=u+80;h<0&&(h=0),0===h&&(f=100),f>o.length&&(f=o.length);var m=o.substr(h,f);e.forEach(function(t){var e=new RegExp(t,"gi");m=m.replace(e,'<em class="search-keyword">'+t+"</em>")}),t+='<p class="search-result">'+m+"...</p>"}t+="</li>"}}),t+="</ul>",s.innerHTML=t)})}})}("/search.xml","searchInput","searchResult")})</script><div class="stars-con"><div id="stars"></div><div id="stars2"></div><div id="stars3"></div></div><script>function switchNightMode(){$('<div class="Cuteen_DarkSky"><div class="Cuteen_DarkPlanet"></div></div>').appendTo($("body")),setTimeout(function(){$("body").hasClass("DarkMode")?($("body").removeClass("DarkMode"),localStorage.setItem("isDark","0"),$("#sum-moon-icon").removeClass("fa-sun").addClass("fa-moon")):($("body").addClass("DarkMode"),localStorage.setItem("isDark","1"),$("#sum-moon-icon").addClass("fa-sun").removeClass("fa-moon")),setTimeout(function(){$(".Cuteen_DarkSky").fadeOut(1e3,function(){$(this).remove()})},2e3)})}</script><div id="backTop" class="top-scroll"><a class="btn-floating btn-large waves-effect waves-light" href="#!"><i class="fas fa-arrow-up"></i></a></div><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/materialize/materialize.min.js"></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/masonry/masonry.pkgd.min.js"></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/aos/aos.js"></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/scrollprogress/scrollProgress.min.js"></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/lightGallery/js/lightgallery-all.min.js"></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/js/matery.js"></script><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/mermaid/mermaid.min.css"><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/mermaid/mermaid.min.js"></script><script>window.mermaid&&mermaid.initialize({theme:"forest"})</script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/background/ribbon-dynamic.js" async></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/instantpage/instantpage.js" type="module"></script></body></html>
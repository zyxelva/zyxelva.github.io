<!DOCTYPE HTML><html lang="zh-CN"><head><meta charset="utf-8"><meta name="keywords" content="【Redis学习】4.高可用之Sentinel, Back-End Dev Java"><meta name="description" content="1 前言上一章，主要讲述了高可用基础方案-主从复制。读者可能会有这样一种疑问：若主节点挂掉了，谁来处理写操作啊？这个问题显而易见，单节点问题马上显现，因而需要一种机制，能够自动进行故障恢复，而不是需要人工去手动恢复，要是这样，运维估计要骂街"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><meta name="renderer" content="webkit|ie-stand|ie-comp"><meta name="mobile-web-app-capable" content="yes"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="referrer" content="no-referrer-when-downgrade"><title>【Redis学习】4.高可用之Sentinel | Kezade</title><link rel="icon" type="image/jpeg" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/medias/avatar/avatar2.jpg"><style>body{background-image:url(https://it-ark-dev.oss-cn-shenzhen.aliyuncs.com/464e9ac7a5a729ae67f91f7cf0cf6fe2.jpg);background-repeat:no-repeat;background-attachment:fixed;background-size:cover;background-position:center center}</style><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/awesome/css/all.min.css"><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/materialize/materialize.min.css"><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/aos/aos.css"><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/animate/animate.min.css"><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/lightGallery/css/lightgallery.min.css"><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/picgo@v3.1/css/matery.css?v3"><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/css/my.css"><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/css/dark.css" media="none" onload='"all"!=media&&(media="all")'><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/tocbot/tocbot.css"><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/css/post.css"><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/css/reward.css"><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/jquery/jquery-3.6.0.min.js"></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/picgo@v3.3/js/function.js?v88"></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/picgo@v1.3/js/imgStatus.min.js"></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/picgo@v1.3/js/waterfall.min.js"></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/picgo@v1.3/js/lately.min.js"></script><script>var memos={host:"https://s.dusays.com/",limit:"10",creatorId:"49",username:"zyxelva",name:"Kezade",domId:"#memos",path:"api/v1/memo"},douban={api:"https://douban-api.edui.fun/"}</script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/rss2.xml" title="Kezade" type="application/rss+xml"></head><body><header class="navbar-fixed"><nav id="headNav" class="bg-color nav-transparent"><div id="navContainer" class="nav-wrapper container"><div class="brand-logo"><a href="/" class="waves-effect waves-light"><img src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/medias/avatar/avatar2.jpg" class="logo-img k-avatar" alt="LOGO"> <span class="logo-span">Kezade</span></a></div><a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a><ul class="right nav-menu"><li class="hide-on-med-and-down nav-item"><a href="/" class="waves-effect waves-light"><i class="fas fa-home" style="zoom:0.6"></i> <span>首页</span></a></li><li class="hide-on-med-and-down nav-item"><a href="" class="waves-effect waves-light"><i class="fa-solid fa-newspaper" style="zoom:0.6"></i> <span>文章</span><i class="fas fa-chevron-down" aria-hidden="true" style="zoom:0.6"></i></a><ul class="sub-nav menus_item_child"><li><a href="/tags"><i class="fas fa-tags" style="margin-top:-20px;zoom:0.6"></i> <span>标签</span></a></li><li><a href="/categories"><i class="fas fa-bookmark" style="margin-top:-20px;zoom:0.6"></i> <span>分类</span></a></li><li><a href="/archives"><i class="fas fa-archive" style="margin-top:-20px;zoom:0.6"></i> <span>归档</span></a></li></ul></li><li class="hide-on-med-and-down nav-item"><a href="" class="waves-effect waves-light"><i class="fa-solid fa-sitemap" style="zoom:0.6"></i> <span>系列</span><i class="fas fa-chevron-down" aria-hidden="true" style="zoom:0.6"></i></a><ul class="sub-nav menus_item_child"><li><a href="/categories/%E7%AE%97%E6%B3%95"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>算法学习</span></a></li><li><a href="/categories/RocketMQ%E5%AD%A6%E4%B9%A0"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>RMQ学习</span></a></li><li><a href="/categories/Netty%E5%AD%A6%E4%B9%A0"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>Netty学习</span></a></li><li><a href="/categories/Spring%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>Spring学习</span></a></li><li><a href="/categories/JVM%E5%AD%A6%E4%B9%A0"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>JVM学习</span></a></li><li><a href="/categories/MySQL%E5%AD%A6%E4%B9%A0"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>MySQL学习</span></a></li><li><a href="/categories/MyBatis%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>MyBatis学习</span></a></li><li><a href="/categories/Zookeeper%E5%AD%A6%E4%B9%A0"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>ZK学习</span></a></li><li><a href="/categories/Hexo"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>Hexo学习</span></a></li><li><a href="/categories/Redis%E5%AD%A6%E4%B9%A0"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>Redis学习</span></a></li><li><a href="/categories/Docker%E5%AD%A6%E4%B9%A0"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>Docker学习</span></a></li><li><a href="/categories/AP-Calculus"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>AP学习</span></a></li><li><a href="/categories/A-Level"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>A-Level学习</span></a></li><li><a href="/categories/SAT"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>SAT学习</span></a></li><li><a href="/categories/%E8%80%83%E7%A0%94"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>考研</span></a></li><li><a href="/categories/OSSD"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>OSSD</span></a></li><li><a href="/categories/%E9%AB%98%E8%80%83"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>高考</span></a></li></ul></li><li class="hide-on-med-and-down nav-item"><a href="" class="waves-effect waves-light"><i class="fa-solid fa-place-of-worship" style="zoom:0.6"></i> <span>我的</span><i class="fas fa-chevron-down" aria-hidden="true" style="zoom:0.6"></i></a><ul class="sub-nav menus_item_child"><li><a href="/galleries"><i class="fas fa-image" style="margin-top:-20px;zoom:0.6"></i> <span>相册</span></a></li><li><a href="/bibi"><i class="fa-fw fa-solid fa-cloud-rain" style="margin-top:-20px;zoom:0.6"></i> <span>哔哔</span></a></li><li><a href="/todolist"><i class="fa-fw fa-solid fa-circle-check" style="margin-top:-20px;zoom:0.6"></i> <span>清单</span></a></li><li><a href="/musics"><i class="fas fa-music" style="margin-top:-20px;zoom:0.6"></i> <span>音乐</span></a></li></ul></li><li class="hide-on-med-and-down nav-item"><a href="" class="waves-effect waves-light"><i class="fa-solid fa-circle-info" style="zoom:0.6"></i> <span>更多</span><i class="fas fa-chevron-down" aria-hidden="true" style="zoom:0.6"></i></a><ul class="sub-nav menus_item_child"><li><a href="/contact"><i class="fas fa-comments" style="margin-top:-20px;zoom:0.6"></i> <span>留言</span></a></li><li><a href="/friends"><i class="fa-solid fa-link" style="margin-top:-20px;zoom:0.6"></i> <span>友链</span></a></li><li><a href="/friend-circle"><i class="fa-solid fa-rss" style="margin-top:-20px;zoom:0.6"></i> <span>圈圈</span></a></li><li><a href="/about"><i class="fas fa-user-circle" style="margin-top:-20px;zoom:0.6"></i> <span>关于</span></a></li></ul></li><li><a href="#searchModal" class="modal-trigger waves-effect waves-light"><i id="searchIcon" class="fas fa-search" title="搜索" style="zoom:0.85"></i></a></li><li><a href="javascript:;" class="waves-effect waves-light" onclick="switchNightMode()" title="深色/浅色模式"><i id="sum-moon-icon" class="fas fa-sun" style="zoom:0.85"></i></a></li></ul><div id="mobile-nav" class="side-nav sidenav"><div class="mobile-head bg-color"><img src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/medias/avatar/avatar2.jpg" class="logo-img circle responsive-img"><div class="logo-name">Kezade</div><div class="logo-desc">7 年 Java 开发经验，其中 3 年以上大型系统架构设计经验，以及 2 年以上的团队管理经验 | 具有分布式、高并发、高可用、大数据量的系统架构设计以及研发经验 | 对 Zookeeper、Netty、Dubbo、Spring Cloud、 Spring 等开源框架源码有过深入研究，并且有一定的框架定制开发经验</div></div><ul class="menu-list mobile-menu-list"><li class="m-nav-item"><a href="/" class="waves-effect waves-light"><i class="fa-fw fas fa-home"></i> 首页</a></li><li class="m-nav-item"><a href="javascript:;"><i class="fa-fw fa-solid fa-newspaper"></i> 文章<span class="m-icon"><i class="fas fa-chevron-right"></i></span></a><ul><li><a href="/tags" style="margin-left:75px"><i class="fa fas fa-tags" style="position:absolute;left:50px"></i> <span>标签</span></a></li><li><a href="/categories" style="margin-left:75px"><i class="fa fas fa-bookmark" style="position:absolute;left:50px"></i> <span>分类</span></a></li><li><a href="/archives" style="margin-left:75px"><i class="fa fas fa-archive" style="position:absolute;left:50px"></i> <span>归档</span></a></li></ul></li><li class="m-nav-item"><a href="javascript:;"><i class="fa-fw fa-solid fa-sitemap"></i> 系列<span class="m-icon"><i class="fas fa-chevron-right"></i></span></a><ul><li><a href="/categories/%E7%AE%97%E6%B3%95" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>算法学习</span></a></li><li><a href="/categories/RocketMQ%E5%AD%A6%E4%B9%A0" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>RMQ学习</span></a></li><li><a href="/categories/Netty%E5%AD%A6%E4%B9%A0" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>Netty学习</span></a></li><li><a href="/categories/Spring%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>Spring学习</span></a></li><li><a href="/categories/JVM%E5%AD%A6%E4%B9%A0" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>JVM学习</span></a></li><li><a href="/categories/MySQL%E5%AD%A6%E4%B9%A0" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>MySQL学习</span></a></li><li><a href="/categories/MyBatis%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>MyBatis学习</span></a></li><li><a href="/categories/Zookeeper%E5%AD%A6%E4%B9%A0" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>ZK学习</span></a></li><li><a href="/categories/Hexo" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>Hexo学习</span></a></li><li><a href="/categories/Redis%E5%AD%A6%E4%B9%A0" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>Redis学习</span></a></li><li><a href="/categories/Docker%E5%AD%A6%E4%B9%A0" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>Docker学习</span></a></li><li><a href="/categories/AP-Calculus" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>AP学习</span></a></li><li><a href="/categories/A-Level" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>A-Level学习</span></a></li><li><a href="/categories/SAT" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>SAT学习</span></a></li><li><a href="/categories/%E8%80%83%E7%A0%94" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>考研</span></a></li><li><a href="/categories/OSSD" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>OSSD</span></a></li><li><a href="/categories/%E9%AB%98%E8%80%83" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>高考</span></a></li></ul></li><li class="m-nav-item"><a href="javascript:;"><i class="fa-fw fa-solid fa-place-of-worship"></i> 我的<span class="m-icon"><i class="fas fa-chevron-right"></i></span></a><ul><li><a href="/galleries" style="margin-left:75px"><i class="fa fas fa-image" style="position:absolute;left:50px"></i> <span>相册</span></a></li><li><a href="/bibi" style="margin-left:75px"><i class="fa fa-fw fa-solid fa-cloud-rain" style="position:absolute;left:50px"></i> <span>哔哔</span></a></li><li><a href="/todolist" style="margin-left:75px"><i class="fa fa-fw fa-solid fa-circle-check" style="position:absolute;left:50px"></i> <span>清单</span></a></li><li><a href="/musics" style="margin-left:75px"><i class="fa fas fa-music" style="position:absolute;left:50px"></i> <span>音乐</span></a></li></ul></li><li class="m-nav-item"><a href="javascript:;"><i class="fa-fw fa-solid fa-circle-info"></i> 更多<span class="m-icon"><i class="fas fa-chevron-right"></i></span></a><ul><li><a href="/contact" style="margin-left:75px"><i class="fa fas fa-comments" style="position:absolute;left:50px"></i> <span>留言</span></a></li><li><a href="/friends" style="margin-left:75px"><i class="fa fa-solid fa-link" style="position:absolute;left:50px"></i> <span>友链</span></a></li><li><a href="/friend-circle" style="margin-left:75px"><i class="fa fa-solid fa-rss" style="position:absolute;left:50px"></i> <span>圈圈</span></a></li><li><a href="/about" style="margin-left:75px"><i class="fa fas fa-user-circle" style="position:absolute;left:50px"></i> <span>关于</span></a></li></ul></li><li><div class="divider"></div></li><li><a href="https://github.com/blinkfox/hexo-theme-matery" class="waves-effect waves-light" target="_blank"><i class="fab fa-github-square fa-fw"></i> Fork Me</a></li></ul></div></div><style>.nav-transparent .github-corner{display:none!important}.github-corner{position:absolute;z-index:10;top:0;right:0;border:0;transform:scale(1.1)}.github-corner svg{color:#0f9d58;fill:#fff;height:64px;width:64px}.github-corner:hover .octo-arm{animation:a .56s ease-in-out}.github-corner .octo-arm{animation:none}@keyframes a{0%,to{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}</style><a href="https://github.com/blinkfox/hexo-theme-matery" class="github-corner tooltipped hide-on-med-and-down" target="_blank" data-tooltip="Fork Me" data-position="left" data-delay="50"><svg viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a></nav></header><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/cryptojs/crypto-js.min.js"></script><script></script><style>:root{--post-bg-image:url('https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/medias/featureimages/20.jpg')}</style><div class="bg-cover pd-header post-cover"><div class="container" style="right:0;left:0"><div class="row"><div class="col s12 m12 l12"><div class="brand"><h1 class="description center-align post-title">【Redis学习】4.高可用之Sentinel</h1></div></div></div></div></div><main class="post-container content"><div class="row"><div id="main-content" class="col s12 m12 l9"><div id="artDetail"><div class="card"><div class="card-content article-info"><div class="row tag-cate"><div class="col s7"><div class="article-tag"><a href="/tags/Redis/"><span class="chip bg-color">Redis</span></a> <a href="/tags/%E5%93%A8%E5%85%B5%E6%A8%A1%E5%BC%8F/"><span class="chip bg-color">哨兵模式</span></a></div></div><div class="col s5 right-align"><div class="post-cate"><i class="fas fa-bookmark fa-fw icon-category"></i> <a href="/categories/Redis%E5%AD%A6%E4%B9%A0/" class="post-category">Redis学习</a></div></div></div><div class="post-info"><div class="post-date info-break-policy"><i class="far fa-calendar-minus fa-fw"></i> 发布日期:&nbsp;&nbsp; 2023-08-30</div><div class="info-break-policy"><i class="far fa-file-word fa-fw"></i> 文章字数:&nbsp;&nbsp; 4.5k</div><div class="info-break-policy"><i class="far fa-clock fa-fw"></i> 阅读时长:&nbsp;&nbsp; 16 分</div></div></div><hr class="clearfix"><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/prism/prism.min.css"><div class="card-content article-card-content"><div id="articleContent"><h1 id="1-前言"><a href="#1-前言" class="headerlink" title="1 前言"></a>1 前言</h1><p>上一章，主要讲述了高可用基础方案-<code>主从复制</code>。读者可能会有这样一种疑问：若主节点挂掉了，谁来处理写操作啊？这个问题显而易见，单节点问题马上显现，因而需要一种机制，能够自动进行故障恢复，而不是需要人工去手动恢复，要是这样，运维估计要骂街了。<br><img src="https://gcore.jsdelivr.net/gh/zyxelva/picgo/markdown/Redis-Replication-Down.jpg"></p><div class="caption"><b class="center-caption">主从复制主节点宕机</b></div><br>Redis提供了几种实现高可用方案的架构，比如本章要介绍的<code>哨兵模式</code>。该模式下，通过监控主节点的状态，可以在主节点宕机后实现自动故障恢复，通过选举实现主备切换。<p></p><blockquote><p>Redis实现<code>高可用相关的技术</code>。它们包括：<code>持久化</code>、<code>复制</code>、<code>哨兵</code>和<code>集群</code>，其主要作用和解决的问题是：</p><ul><li>持久化：持久化是最简单的高可用方法(有时甚至不被归为高可用的手段)，主要作用是数据备份，即将数据存储在硬盘，保证数据不会因进程退出而丢失。</li><li>复制：复制是<strong>高可用Redis的基础</strong>，哨兵和集群都是在复制基础上实现高可用的。复制主要实现了数据的多机备份，以及对于读操作的负载均衡和简单的故障恢复。<code>缺陷</code>：<strong>故障恢复无法自动化</strong>；<strong>写操作无法负载均衡</strong>；<strong>存储能力受到单机的限制</strong>。</li><li>哨兵：在复制的基础上，哨兵实现了自动化的故障恢复。<code>缺陷</code>：<strong>写操作无法负载均衡</strong>；<strong>存储能力受到单机的限制</strong>。</li><li>集群：通过集群，Redis<strong>解决</strong>了<code>写操作无法负载均衡</code>，以及<code>存储能力受到单机限制</code>的问题，实现了较为完善的高可用方案。</li></ul></blockquote><h1 id="2-机制"><a href="#2-机制" class="headerlink" title="2 机制"></a>2 机制</h1><p><code>Redis Sentinel</code>，即Redis哨兵，在<code>Redis 2.8版本</code>开始引入。哨兵的<code>核心功能</code>是<strong>主节点的自动故障转移</strong>。下面是Redis官方文档对于哨兵功能的描述：</p><ul><li>监控（Monitoring）：哨兵会不断地检查主节点和从节点是否运作正常。</li><li>自动故障转移（Automatic failover）：当主节点不能正常工作时，哨兵会开始自动故障转移操作，它会将<code>失效主节点</code>的其中一个<code>从节点</code>升级为<code>新的主节点</code>，并让其他从节点改为复制新的主节点。</li><li>配置提供者（Configuration provider）：客户端在初始化时，通过<code>连接哨兵</code>来获得当前Redis服务的主节点地址。</li><li>通知（Notification）：哨兵可以将故障转移的结果发送给客户端。</li></ul><p>其中，<code>监控</code>和<code>自动故障转移</code>功能，使得哨兵可以及时发现主节点故障并完成转移；而<code>配置提供者</code>和<code>通知</code>功能，则需要在与客户端的交互中才能体现。</p><p>因而，对于哨兵模式下的Sentinel节点，其主要作用有三个：监控、选主、通知。</p><blockquote><p>Sentinel节点，即哨兵节点，本身也是一种Redis节点，最大不同就是<code>不存储数据</code>，工作职能就是监控主节点，实际上，每个Sentinel节点会对<code>Redis数据节点</code>和<code>其余Sentinel节点</code>进行监控。</p></blockquote><p>一个典型的哨兵集群监控的逻辑图如下所示：<br><img src="https://gcore.jsdelivr.net/gh/zyxelva/picgo/markdown/Redis-Sentinel-Arch.png"></p><div class="caption"><b class="center-caption">哨兵模式经典架构</b></div><p></p><h1 id="3-Sentinel集群组建"><a href="#3-Sentinel集群组建" class="headerlink" title="3 Sentinel集群组建"></a>3 Sentinel集群组建</h1><p>Sentinel实例之间可以相互发现，要归功于 Redis 提供的 <code>pub/sub 机制</code>，也就是<code>发布/订阅机制</code>。</p><p>Sentinel节点启动命令：<br><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">sentinel monitor <span class="token operator">&lt;</span>master-name<span class="token operator">></span> <span class="token operator">&lt;</span>ip<span class="token operator">></span> <span class="token operator">&lt;</span>redis-port<span class="token operator">></span> <span class="token operator">&lt;</span>quorum<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><br>其中：</p><ul><li><code>master-name</code>：表示Redis主节点名称；</li><li><code>ip</code>：主节点的 IP 地址；</li><li><code>redis-port</code>：主节点的端口号；</li><li><code>quorum</code>：法定投票数，即Sentinel主节点需达到quorum才有资格选举为Sentinel主节点，还有就是需达到此投票数，主节点才会判定为<code>客观下线</code>。</li></ul><p>另外，在Redis主节点中，有一个公共频道<code>__sentinel__:hello</code>，不同哨兵就是通过它来相互发现，实现互相通信的。</p><p>在下图中，<code>Sentinel A</code>把自己的 IP 地址（192.168.50.1）和端口（26379）的信息发布到<code>__sentinel__:hello</code>频道上，<code>Sentinel B</code>（192.168.50.2:26380）和<code>Sentinel C</code>（192.168.50.3:26381）订阅了该频道。那么此时，<code>Sentinel B</code> 和 <code>Sentinel C</code> 就可以从这个频道直接获取<code>Sentinel A</code> 的 IP 地址和端口号。然后，<code>Sentinel B</code>、<code>Sentinel C</code> 可以和<code>Sentinel A</code> 建立网络连接。<br><img src="https://gcore.jsdelivr.net/gh/zyxelva/picgo/markdown/Redis-Sentinel-PubSub.png"></p><div class="caption"><b class="center-caption">Sentinel集群发现</b></div><p></p><h1 id="4-三个定时任务"><a href="#4-三个定时任务" class="headerlink" title="4 三个定时任务"></a>4 三个定时任务</h1><p>本小节，我将从<code>三个定时任务</code>来说明Sentinel模式下，Sentinel节点如何对Redis进行监控、选主、通知，实现自动故障转移。</p><h2 id="4-1-10秒-SMS"><a href="#4-1-10秒-SMS" class="headerlink" title="4.1 10秒(SMS)"></a>4.1 10秒(SMS)</h2><p>这里，为了方便记忆，我将这个<code>每隔10秒</code>执行的定时任务命名为：<code>SMS</code>，意思为<code>Sentinel-Master-Slave</code>。</p><p>通过向主节点发送<code>info replication</code>命令，Sentinel节点可以获取到<code>所有从节点信息列表</code>；接着，Sentinel节点就可以根据从节点列表中的连接信息，和每个从节点建立连接，并在这个连接上持续地对从节点进行监控。<code>Sentinel A</code> 和 <code>Sentinel C</code>可以通过相同的方法和从节点建立连接。<br><img src="https://gcore.jsdelivr.net/gh/zyxelva/picgo/markdown/Redis-Sentinel-SMS.png"></p><div class="caption"><b class="center-caption">"SMS" 每隔10秒的定时任务</b></div><p></p><blockquote><p>这也是为什么Sentinel节点不需要显式配置监控从节点的原因。</p></blockquote><p>这个定时任务的<code>作用</code>具体可以表现在<code>三个方面</code>：</p><ul><li>通过向<code>主节点</code>执行<code>info</code>命令，获取从节点的信息，这也是为什么Sentinel节点不需要显式配置监控从节点。</li><li>当有<code>新的从节点</code>加入时都可以立刻感知出来。</li><li>节点不可达或者故障转移后，可以通过<code>info命令</code>实时更新节点拓扑信息。</li></ul><h2 id="4-2-2秒-SM"><a href="#4-2-2秒-SM" class="headerlink" title="4.2 2秒(SM)"></a>4.2 2秒(SM)</h2><p><code>SM</code>意思是：<code>Sentinel-Master</code>，即每个Sentinel节点会向Redis数据节点的<code>__sentinel__:hello</code>频道上发送该Sentinel节点对于<code>主节点的判断</code>以及<code>当前Sentinel节点的信息</code>，同时每个Sentinel节点也会订阅该频道，来了解其他Sentinel节点以及它们对主节点的判断。<br><img src="https://gcore.jsdelivr.net/gh/zyxelva/picgo/markdown/Redis-Sentinel-SM.png"></p><div class="caption"><b class="center-caption">"SM" 每隔2秒的定时任务</b></div><p></p><p>这个定时任务可以完成以下<code>两个工作</code>：</p><ul><li>发现新的Sentinel节点：通过订阅主节点的<code>__sentinel__:hello</code>了解其他的Sentinel节点信息，如果是新加入的Sentinel节点，将该Sentinel节点信息保存起来，并与该Sentinel节点创建连接。</li><li>Sentinel节点之间交换主节点的状态，作为后面<code>客观下线</code>以及<code>Leader选举</code>的依据。</li></ul><h2 id="4-3-1秒-S-ALL"><a href="#4-3-1秒-S-ALL" class="headerlink" title="4.3 1秒(S-ALL)"></a>4.3 1秒(S-ALL)</h2><p><code>S-ALL</code>意思是：Sentinel节点与所有节点，包括<code>其他Sentinel节点</code>，<code>Redis主从节点</code>的定时任务，即心跳机制。</p><p><code>每隔1秒</code>，每个Sentinel节点会向<code>主节点</code>、<code>从节点</code>、<code>其余Sentinel节点</code>发送一条<code>ping命令</code>做一次<code>心跳检测</code>，来确认这些节点当前是否可达。如图所示。<br><img src="https://gcore.jsdelivr.net/gh/zyxelva/picgo/markdown/Redis-Sentinel-S-ALL.png"></p><div class="caption"><b class="center-caption">"S-ALL" 每隔1秒的定时任务</b></div><br>通过上面的定时任务，Sentinel节点对主节点、从节点、其余Sentinel节点都建立起连接，实现了对每个节点的监控，这个定时任务是节点失败判定的重要依据。<p></p><blockquote><p>对<code>ping命令</code>的回复可以分为以下两种情况：</p><ul><li>有效回复：返回<code>+PONG</code>、<code>-LOADING</code>、<code>-MASTERDOWN</code>三种回复的其中一种；</li><li>无效回复：返回除上述三种回复之外的<code>其他回复</code>，或者在指定时限内(<code>down-after-milliseconds</code>)没有返回任何回复。<h2 id="4-4-选举"><a href="#4-4-选举" class="headerlink" title="4.4 选举"></a>4.4 选举</h2><h3 id="4-4-1-下线"><a href="#4-4-1-下线" class="headerlink" title="4.4.1 下线"></a>4.4.1 下线</h3>下线有两种类型：</li><li><code>主观下线</code>：即Sentinel节点对于发送出去的心跳，超过<code>down-after-milliseconds</code>没有进行有效回复，Sentinel节点就会对该节点做失败判定，<code>主观判定</code>Redis节点下线。</li><li><code>客观下线</code>：如果主观判定下线的节点为主节点，则该Sentinel节点会向其他Sentinel节点发送<code>sentinel is-master-down-by-addr</code>命令，询问它们对该主节点的判断结果，当超过<code>quorum</code>个数，Sentinel节点认为主节点确实有问题，这时该Sentinel节点会做出<code>客观下线</code>的决定。</li></ul><p><code>从节点</code>、<code>Sentinel节点</code>在<strong>主观下线</strong>后，<strong>没有</strong>后续的<code>故障转移</code>操作。</p></blockquote><p>这里有必要对<code>sentinel is-master-down-by-addr</code>命令做一个介绍，它的使用方法如下：<br><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">sentinel is-master-down-by-addr <span class="token operator">&lt;</span>ip<span class="token operator">></span> <span class="token operator">&lt;</span>port<span class="token operator">></span> <span class="token operator">&lt;</span>current_epoch<span class="token operator">></span> <span class="token operator">&lt;</span>runid<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><br>其中：</p><ul><li><code>ip</code>：Redis主节点IP。</li><li><code>port</code>：Redis主节点端口。</li><li><code>current_epoch</code>：当前配置纪元。</li><li><code>runid</code>：此参数有两种类型，不同类型决定了此API作用的不同：<ul><li>当<code>runid等于“*”</code>时，作用是Sentinel节点直接交换对<code>主节点下线的判定</code>。</li><li>当<code>runid等于当前Sentinel节点的runid</code>时，作用是当前Sentinel节点希望目标Sentinel节点同意自己成为领导者(Leader)的请求，有关Sentinel <code>Leader选举</code>，后面会进行介绍。</li></ul></li></ul><p>返回结果包含<code>三个参数</code>，如下所示：</p><ul><li><code>down_state</code>：目标Sentinel节点对于主节点的下线判断，<code>1是下线</code>，<code>0是在线</code>。</li><li><code>leader_runid</code>：当<code>leader_runid</code>等于<code>“*”</code>时，代表返回结果是用来做主节点是否不可达；当<code>leader_runid</code>等于具体的<code>runid</code>，代表目标节点同意<code>runid</code>成为Leader。</li><li><code>leader_epoch</code>：领导者纪元。<h4 id="4-4-1-1-主观下线"><a href="#4-4-1-1-主观下线" class="headerlink" title="4.4.1.1 主观下线"></a>4.4.1.1 主观下线</h4>示意图如下所示：<img src="https://gcore.jsdelivr.net/gh/zyxelva/picgo/markdown/Redis-Sentinel-Subjective2.png"><div class="caption"><b class="center-caption">主观下线</b></div></li></ul><p>主要通过4.3节的<code>S-ALL</code>定时任务，倘若心跳发出去后，在<code>down-after-milliseconds</code>（单位：毫秒）时间内没有收到目标节点的回复，则该Sentinel节点会对目标节点做出<code>主观下线</code>的判定。</p><h4 id="4-4-1-2-客观下线"><a href="#4-4-1-2-客观下线" class="headerlink" title="4.4.1.2 客观下线"></a>4.4.1.2 客观下线</h4><p>如果Sentinel节点对目标节点是<code>Redis主节点</code>的判定是<code>主观下线</code>，则该Sentinel会通过<code>sentinel is-master-down-by-addr</code>命令，向其他Sentinel节点发出询问，若其他Sentinel节点对于目标主节点判定<code>主观下线</code>的投票数超过<code>quorum</code>，则该节点就会判定为<code>客观下线</code>。</p><blockquote><p>这里再次强调下：是对<code>Redis主节点</code>判定是<code>主观下线</code>，才会有这步动作，如果目标节点是<code>Sentinel节点</code>或者是<code>Redis从节点</code>，则不会有此步<code>问询</code>动作，更不会有<code>故障转移</code>动作。</p><p>简而述之，<code>客观下线只适用于主节点</code>。</p></blockquote><img src="https://gcore.jsdelivr.net/gh/zyxelva/picgo/markdown/Redis-Sentinel-Objective.png"><div class="caption"><b class="center-caption">客观下线</b></div><p>当这个Sentinel节点的赞同票数达到Sentinel节点配置文件中的 <code>quorum</code> 配置项设定的值后，这时主节点就会被该Sentinel节点标记为<code>「客观下线」</code>。</p><h3 id="4-4-2-选举"><a href="#4-4-2-选举" class="headerlink" title="4.4.2 选举"></a>4.4.2 选举</h3><p>判断完Redis主节点下线后，故障转移的工作只需要<code>一个Sentinel节点</code>来完成即可，由哪个Sentinel节点来<strong>执行</strong>主从切换，进而完成故障转移呢？这里就需要<code>Sentinel集群</code>的<code>选举机制</code>了。</p><p>Sentinel节点要想成为<code>Leader</code>，必须满足以下<code>三个条件</code>：</p><ul><li>成为<code>候选人</code>，所谓的候选人就是想当 <code>Leader</code> 的Sentinel节点；</li><li>拿到<code>半数以上</code>的赞成票；</li><li>拿到的票数同时还需要<code>大于等于</code>Sentinel配置文件中的 <code>quorum</code> 值。</li></ul><p>先说第一个条件，成为候选人。 一句话总结：</p><blockquote><p>哪个Sentinel节点判断Redis主节点为<code>「客观下线」</code>，这个Sentinel节点就是候选人。</p></blockquote><p>第二、三个条件，当Sentinel节点对目标主节点判定为主观下线后，会向其他Sentinel节点发送命令：<br><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">sentinel is-master-down-by-addr <span class="token operator">&lt;</span>目标主节点ip<span class="token operator">></span> <span class="token operator">&lt;</span>目标主节点port<span class="token operator">></span> <span class="token operator">&lt;</span>current_epoch<span class="token operator">></span> <span class="token operator">&lt;</span>当前Sentinel节点的runid<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><br>，其中包含<code>当前Sentinel节点的runid</code>，其目的就想让其他Sentinel节点选举自己为Leader。</p><p>当其他Sentinel节点收到后，如果没有同意过其他Sentinel节点的<code>sentinel is-master-down-by-addr</code>命令，将同意该请求，否则拒绝。这样，就会出现两种结果：</p><ul><li>如果该Sentinel节点发现自己的票数已经<strong>大于等于</strong><code>max（quorum，num（sentinels）/2+1）</code>，那么它将成为Leader；</li><li>否则，进行下一次选举。</li></ul><blockquote><p>以 3 个Sentinel节点为例，假设此时的 <code>quorum</code> 设置为 <code>2</code>，那么，任何一个想成为 Leader 的Sentinel节点只要拿到 <code>2 张赞成票</code>，就可以了。</p><p>选举使用的算法是<code>Raft算法</code>.</p><p>Raft算法的基本思路是<code>先到先得</code>：即在一轮选举中，哨兵A向B发送成为Leader的申请，如果B没有同意过其他哨兵，则会同意A成为Leader。</p><p>选举的具体过程这里不做详细描述，一般来说，哨兵选择的过程很快，<strong>谁先完成客观下线，一般就能成为Leader</strong>。</p></blockquote><p>这里有个很容易混淆的过程：即<code>判定客观下线</code>和<code>是否能够主从切换</code>（选举制度），均涉及投票。</p><p>再举一个例子。Redis 1主4从，5个Sentinel节点部署，Sentinel配置<code>quorum=2</code>，如果<code>3个</code>Sentinel故障，当主节点宕机时，Sentinel能否判断主库“客观下线”？能否自动切换？</p><p>经过实际测试：<br>1、结论：Sentinel集群<code>可以判定</code>主库“客观下线”。<br>由于<code>quorum=2</code>，所以当一个Sentinel判断主库“主观下线”后，询问另外一个Sentinel后也会得到同样的结果，<code>2个</code>Sentinel都判定“主观下线”，达到了<code>quorum</code>的值，因此，Sentinel集群可以判定主库为“客观下线”。</p><p>2、但Sentinel<code>不能完成</code>主从切换。<br>Sentinel标记主库“客观下线”后，在选举“Sentinel领导者”时，一个Sentinel必须拿到<code>超过多数</code>的选票，即<code>5/2+1=3</code>票)。但目前只有<code>2个</code>Sentinel活着，无论怎么投票，一个Sentinel<code>最多只能拿到2票</code>，永远无法达到<code>N/2+1</code>选票的结果。</p><p>所以，<code>quorum</code> 的值建议设置为<code>N/2+1</code>，其中<code>N</code>为Sentinel节点个数，例如 3 个Sentinel节点就设置 2，5 个Sentinel节点设置为 3，而且Sentinel节点的数量<code>N</code>应该是<code>奇数</code>。</p><h3 id="4-4-3-主从切换（故障转移）"><a href="#4-4-3-主从切换（故障转移）" class="headerlink" title="4.4.3 主从切换（故障转移）"></a>4.4.3 主从切换（故障转移）</h3><p>完成上述的Sentinel Leader选举后，接下来，Sentinel Leader就需要进行Redis主节点切换了，选取主节点需要从现有的从节点中进行，主从故障转移操作包含以下<code>四个步骤</code>：</p><ul><li>第一步：在已下线主节点（旧主节点）属下的所有<code>「从节点」</code>里面，挑选出一个从节点，并将其转换为主节点。</li><li>第二步：让已下线主节点属下的所有<code>「从节点」</code>修改复制目标，修改为复制「新主节点」；</li><li>第三步：将新主节点的 IP 地址和信息，通过「发布者/订阅者机制」通知给客户端；</li><li>第四步：继续监视旧主节点，当这个旧主节点重新上线时，将它设置为新主节点的从节点；</li></ul><img src="https://gcore.jsdelivr.net/gh/zyxelva/picgo/markdown/Redis-Sentinel-Selection.png"><div class="caption"><b class="center-caption">主从切换选主步骤</b></div><p>其中，过滤过程主要是过滤掉这些从节点：</p><ul><li>“不健康”（主观下线、断线）；</li><li>5秒内没有回复过Sentinel节点ping响应；</li><li>与主节点失联超过<code>down-after-milliseconds*10</code>秒。</li></ul><img src="https://gcore.jsdelivr.net/gh/zyxelva/picgo/markdown/Redis-Sentinel-Selection21.png"><div class="caption"><b class="center-caption">故障转移</b></div><p>转移之后，整个节点逻辑图如下：<br><img src="https://gcore.jsdelivr.net/gh/zyxelva/picgo/markdown/Redis-Sentinel-Selection22.png"></p><div class="caption"><b class="center-caption">故障转移之后</b></div><p></p><h1 id="5-总结"><a href="#5-总结" class="headerlink" title="5 总结"></a>5 总结</h1><p>Redis 在 <code>2.8版本以后</code>提供的哨兵（Sentinel）机制，它的作用是实现<code>主从节点故障转移</code>。它会监测主节点是否存活，如果发现主节点挂了，它就会选举一个从节点切换为主节点，并且把新主节点的相关信息通知给从节点和客户端。</p><p>Sentinel一般是以集群的方式部署，<code>至少</code>需要 <code>3 个</code>Sentinel节点，Sentinel集群主要负责三件事情：<code>监控</code>、<code>选主</code>、<code>通知</code>。</p><p>Sentinel节点通过 Redis 的<code>发布者/订阅者</code>机制，Sentinel之间可以相互感知，相互连接，然后组成Sentinel集群，同时Sentinel又通过 INFO 命令，在主节点里获得了所有从节点连接信息，于是就能和从节点建立连接，并进行监控了。</p><h2 id="5-1-第一轮投票：判断主节点下线"><a href="#5-1-第一轮投票：判断主节点下线" class="headerlink" title="5.1 第一轮投票：判断主节点下线"></a>5.1 第一轮投票：判断主节点下线</h2><p>当Sentinel集群中的某个Sentinel节点判定主节点下线（主观下线）后，就会向其他Sentinel节点发起命令，其他Sentinel节点收到这个命令后，就会根据自身和主节点的网络状况，做出赞成投票或者拒绝投票的响应。</p><p>当这个Sentinel节点的赞同票数达到Sentinel节点配置文件中的 <code>quorum</code> 配置项设定的值后，这时主节点就会被该Sentinel节点标记为<code>「客观下线」</code>。</p><h2 id="5-2-第二轮投票：选出Sentinel-Leader"><a href="#5-2-第二轮投票：选出Sentinel-Leader" class="headerlink" title="5.2 第二轮投票：选出Sentinel Leader"></a>5.2 第二轮投票：选出Sentinel Leader</h2><p>某个Sentinel节点判定主节点<code>客观下线</code>后，该Sentinel节点就会发起投票，告诉其他Sentinel节点，它想成为 leader。要想成为 leader 的Sentinel节点，要满足<code>三个条件</code>：</p><ul><li>成为候选人；</li><li>拿到半数以上的赞成票；</li><li>拿到的票数同时还需要<code>大于等于</code>Sentinel节点配置文件中的 <code>quorum</code> 值。<h2 id="5-3-由Sentinel-leader-进行主从故障转移"><a href="#5-3-由Sentinel-leader-进行主从故障转移" class="headerlink" title="5.3 由Sentinel leader 进行主从故障转移"></a>5.3 由Sentinel leader 进行主从故障转移</h2></li></ul><p>选举出了Sentinel leader 后，就可以进行<code>主从故障转移</code>的过程了。该操作包含以下<code>四个步骤</code>：</p><ul><li>第一步：在已下线主节点（旧主节点）属下的所有「从节点」里面，挑选出一个从节点，并将其转换为主节点，选择的规则：<ul><li>过滤掉已经离线的从节点；</li><li>过滤掉历史网络连接状态不好的从节点；</li><li>将剩下的从节点，进行三轮考察：<code>优先级</code>、<code>复制进度offset</code>、<code>runId</code> 。在每一轮考察过程中，如果找到了一个胜出的从节点，就将其作为新主节点。</li></ul></li><li>第二步：让已下线主节点属下的所有<code>「从节点」</code>修改复制目标，修改为复制<code>「新主节点」</code>；</li><li>第三步：将新主节点的 <code>IP 地址</code>和<code>信息</code>，通过<code>「发布者/订阅者机制」</code>通知给客户端；</li><li>第四步：继续监视<code>旧主节点</code>，当这个旧主节点<code>重新上线</code>时，将它设置为<code>新主节点的从节点</code>；</li></ul><h1 id="6-参考"><a href="#6-参考" class="headerlink" title="6 参考"></a>6 参考</h1><ul><li><a target="_blank" rel="noopener" href="https://www.xiaolincoding.com/redis/cluster/sentinel.html#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E6%9C%89%E5%93%A8%E5%85%B5%E6%9C%BA%E5%88%B6">为什么要有哨兵？</a></li><li><a target="_blank" rel="noopener" href="https://pdai.tech/md/db/nosql-redis/db-redis-x-sentinel.html">高可用：哨兵机制（Redis Sentinel）详解</a></li><li>张益军（付磊）. 《Redis 开发与运维》第9章。</li></ul></div><hr><div class="reprint" id="reprint-statement"><div class="reprint__author"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-user">文章作者:</i></span> <span class="reprint-info"><a href="/about" rel="external nofollow noreferrer">Kezade</a></span></div><div class="reprint__type"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-link">文章链接:</i></span> <span class="reprint-info"><a href="https://zyxelva.github.io/posts/1235835282.html">https://zyxelva.github.io/posts/1235835282.html</a></span></div><div class="reprint__notice"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-copyright">版权声明:</i></span> <span class="reprint-info">本博客所有文章除特別声明外，均采用 <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a> 许可协议。转载请注明来源 <a href="/about" target="_blank">Kezade</a> !</span></div></div><script async defer>function navToReprintStatement(){$("html, body").animate({scrollTop:$("#reprint-statement").offset().top-80},800)}document.addEventListener("copy",function(t){M.toast({html:'<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>'})})</script><div class="tag_share" style="display:block"><div class="post-meta__tag-list" style="display:inline-block"><div class="article-tag"><a href="/tags/Redis/"><span class="chip bg-color">Redis</span></a> <a href="/tags/%E5%93%A8%E5%85%B5%E6%A8%A1%E5%BC%8F/"><span class="chip bg-color">哨兵模式</span></a></div></div><div class="post_share" style="zoom:80%;width:fit-content;display:inline-block;float:right;margin:-.15rem 0"><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/share/css/share.min.css"><div id="article-share"><div class="social-share" data-sites="google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/share/js/social-share.min.js"></script></div></div></div><div id="reward"><a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a><div id="rewardModal" class="modal"><div class="modal-content"><a class="close modal-close"><i class="fas fa-times"></i></a><h4 class="reward-title">你的赏识是我前进的动力</h4><div class="reward-content"><div class="reward-tabs"><ul class="tabs row"><li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li><li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li></ul><div id="alipay"><img src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码"></div><div id="wechat"><img src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码"></div></div></div></div></div></div><script>$(function(){$(".tabs").tabs()})</script></div></div><style>.twikoo-card{margin:1.5rem auto}.twikoo-card .card-content{padding:20px}#tcomments textarea{box-sizing:border-box;background:url("/") 100% 100% no-repeat}#tcomments p{margin:2px 2px 10px;font-size:1.05rem;line-height:1.78rem;text-align:left}#tcomments blockquote p{text-indent:.2rem}#tcomments a{padding:0 2px;color:#4cbf30;font-weight:500;text-decoration:none}#tcomments img{max-width:100%;height:auto;cursor:pointer}#tcomments ol li{list-style-type:decimal}#tcomments ol,ul{display:block;padding-left:2em;word-spacing:0.05rem}#tcomments ul li,ol li{display:list-item;line-height:1.8rem;font-size:1rem}#tcomments ul li{list-style-type:disc}#tcomments ul ul li{list-style-type:circle}#tcomments table,td,th{padding:12px 13px;border:1px solid #dfe2e5}#tcomments table,td,th{border:0}table tr:nth-child(2n),thead{background-color:#fafafa}#tcomments table th{background-color:#f2f2f2;min-width:80px}#tcomments table td{min-width:80px}#tcomments h1{font-size:1.85rem;font-weight:700;line-height:2.2rem}#tcomments h2{font-size:1.65rem;font-weight:700;line-height:1.9rem}#tcomments h3{font-size:1.45rem;font-weight:700;line-height:1.7rem}#tcomments h4{font-size:1.25rem;font-weight:700;line-height:1.5rem}#tcomments h5{font-size:1.1rem;font-weight:700;line-height:1.4rem}#tcomments h6{font-size:1rem;line-height:1.3rem}#tcomments p{font-size:1rem;line-height:1.5rem}#tcomments hr{margin:12px 0;border:0;border-top:1px solid #ccc}#tcomments blockquote{margin:15px 0;border-left:5px solid #42b983;padding:1rem .8rem .3rem .8rem;color:#666;background-color:rgba(66,185,131,.1)}#tcomments pre{font-family:monospace,monospace;padding:1.2em;margin:.5em 0;background:#272822;overflow:auto;border-radius:.3em;tab-size:4}#tcomments code{font-family:monospace,monospace;padding:1px 3px;font-size:.92rem;color:#e96900;background-color:#f8f8f8;border-radius:2px}#tcomments pre code{font-family:monospace,monospace;padding:0;color:#e8eaf6;background-color:#272822}#tcomments pre[class*=language-]{padding:1.2em;margin:.5em 0}#tcomments code[class*=language-],pre[class*=language-]{color:#e8eaf6}#tcomments [type=checkbox]:not(:checked),[type=checkbox]:checked{position:inherit;margin-left:-1.3rem;margin-right:.4rem;margin-top:-1px;vertical-align:middle;left:unset;visibility:visible}#tcomments b,strong{font-weight:700}#tcomments dfn{font-style:italic}#tcomments small{font-size:85%}#tcomments cite{font-style:normal}#tcomments mark{background-color:#fcf8e3;padding:.2em}#tcomments table,td,th{padding:12px 13px;border:1px solid #dfe2e5}table tr:nth-child(2n),thead{background-color:#fafafa}#tcomments table th{background-color:#f2f2f2;min-width:80px}#tcomments table td{min-width:80px}#tcomments [type=checkbox]:not(:checked),[type=checkbox]:checked{position:inherit;margin-left:-1.3rem;margin-right:.4rem;margin-top:-1px;vertical-align:middle;left:unset;visibility:visible}</style><div class="card twikoo-card" data-aos="fade-up"><div class="comment_headling" style="font-size:20px;font-weight:700;position:relative;padding-left:20px;top:15px;padding-bottom:5px"><i class="fas fa-comments fa-fw" aria-hidden="true"></i> <span>评论</span></div><div class="card-content" style="display:grid"><div id="tcomments"></div></div></div><script src="https://gcore.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js"></script><script>twikoo.init({envId:"https://kezadetwikoo.netlify.app/.netlify/functions/twikoo",el:"#tcomments",region:"",path:""}).then(function(){for(var t=document.querySelector("#twikoo").getElementsByTagName("input"),e=0;e<t.length;e++)t[e]&&t[e].classList.add("browser-default")})</script><article id="prenext-posts" class="prev-next articles"><div class="row article-row"><div class="article col s12 m6" data-aos="fade-up"><div class="article-badge left-badge text-color"><i class="fas fa-chevron-left"></i> &nbsp;上一篇</div><div class="card"><a href="/posts/2973021972.html"><div class="card-image"><img src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/medias/featureimages/13.jpg" class="responsive-img" alt="【Redis学习】5.高可用之集群"> <span class="card-title">【Redis学习】5.高可用之集群</span></div></a><div class="card-content article-content"><div class="summary block-with-text"></div><div class="publish-info"><span class="publish-date"><i class="far fa-clock fa-fw icon-date"></i> 2023-08-30</span><span class="publish-author"><i class="fas fa-bookmark fa-fw icon-category"></i> <a href="/categories/Redis%E5%AD%A6%E4%B9%A0/" class="post-category">Redis学习</a></span></div></div><div class="card-action article-tags"><a href="/tags/Redis/"><span class="chip bg-color">Redis</span></a> <a href="/tags/%E9%9B%86%E7%BE%A4%E6%A8%A1%E5%BC%8F/"><span class="chip bg-color">集群模式</span></a></div></div></div><div class="article col s12 m6" data-aos="fade-up"><div class="article-badge right-badge text-color">下一篇&nbsp;<i class="fas fa-chevron-right"></i></div><div class="card"><a href="/posts/2876861881.html"><div class="card-image"><img src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/medias/featureimages/5.jpg" class="responsive-img" alt="【Redis学习】3.高可用之主从复制"> <span class="card-title">【Redis学习】3.高可用之主从复制</span></div></a><div class="card-content article-content"><div class="summary block-with-text"></div><div class="publish-info"><span class="publish-date"><i class="far fa-clock fa-fw icon-date"></i> 2023-08-30</span><span class="publish-author"><i class="fas fa-bookmark fa-fw icon-category"></i> <a href="/categories/Redis%E5%AD%A6%E4%B9%A0/" class="post-category">Redis学习</a></span></div></div><div class="card-action article-tags"><a href="/tags/Redis/"><span class="chip bg-color">Redis</span></a> <a href="/tags/%E4%B8%BB%E4%BB%8E%E6%A8%A1%E5%BC%8F/"><span class="chip bg-color">主从模式</span></a></div></div></div></div></article></div><script>$("#articleContent").on("copy",function(e){if(void 0!==window.getSelection){var n=window.getSelection();if(!((""+n).length<Number.parseInt("120"))){var t=document.getElementsByTagName("body")[0],o=document.createElement("div");o.style.position="absolute",o.style.left="-99999px",t.appendChild(o),o.appendChild(n.getRangeAt(0).cloneContents()),"PRE"!==n.getRangeAt(0).commonAncestorContainer.nodeName&&"CODE"!==n.getRangeAt(0).commonAncestorContainer.nodeName||(o.innerHTML="<pre>"+o.innerHTML+"</pre>");var i=document.location.href;o.innerHTML+='<br />来源: Kezade<br />文章作者: Kezade<br />文章链接: <a href="'+i+'">'+i+"</a><br />本文章著作权归作者所有，任何形式的转载都请注明出处。",n.selectAllChildren(o),window.setTimeout(function(){t.removeChild(o)},200)}}})</script><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/codeBlock/codeBlockFuction.js"></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/prism/prism.min.js"></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/codeBlock/codeLang.js"></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/codeBlock/codeCopy.js"></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/codeBlock/codeShrink.js"></script></div><div id="toc-aside" class="expanded col l3 hide-on-med-and-down"><div class="toc-widget card" style="background-color:#fff"><div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div><div id="toc-content"></div></div></div></div><div id="floating-toc-btn" class="hide-on-med-and-down"><a class="btn-floating btn-large bg-color"><i class="fas fa-list-ul"></i></a></div><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/tocbot/tocbot.min.js"></script><script>$(function(){tocbot.init({tocSelector:"#toc-content",contentSelector:"#articleContent",headingsOffset:-(.4*$(window).height()-45),collapseDepth:Number("0"),headingSelector:"h1, h2, h3, h4, h5"});let t=parseInt(.4*$(window).height()-64),e=$(".toc-widget");$(window).scroll(function(){$(window).scrollTop()>t?e.addClass("toc-fixed"):e.removeClass("toc-fixed")});const o="expanded";let n=$("#toc-aside"),i=$("#main-content");$("#floating-toc-btn .btn-floating").click(function(){n.hasClass(o)?(n.removeClass(o).hide(),i.removeClass("l9")):(n.addClass(o).show(),i.addClass("l9")),function(t,e){let o=$("#"+t);if(0===o.length)return;let n=o.width();n+=n>=450?21:n>=350&&n<450?18:n>=300&&n<350?16:14,$("#"+e).width(n)}("artDetail","prenext-posts")})})</script></main><footer class="page-footer bg-color"><div class="container row center-align" style="margin-bottom:15px!important"><div class="col s12 m8 l8 copy-right">Copyright&nbsp;&copy; <span id="year">2019-2025</span> <a href="/about" target="_blank">Kezade</a> |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a> |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a><br><br><span id="sitetime">Loading ...</span><script>var calcSiteTime=function(){var e=6e4,t=36e5,n=864e5,a=365*n,i=new Date,r="2019",o=i.getFullYear(),s=i.getMonth()+1,l=i.getDate(),m=i.getHours(),c=i.getMinutes(),d=i.getSeconds(),g=Date.UTC(r,"6","28","0","0","0"),h=Date.UTC(o,s,l,m,c,d)-g,u=Math.floor(h/a),M=Math.floor(h/n-365*u),T=Math.floor((h-(365*u+M)*n)/t),f=Math.floor((h-(365*u+M)*n-T*t)/e),y=Math.floor((h-(365*u+M)*n-T*t-f*e)/1e3);if(r===String(o)){document.getElementById("year").innerHTML=o;var v="This site has been running for "+M+" days";v="本站已运行 "+M+" 天",document.getElementById("sitetime").innerHTML=v}else{document.getElementById("year").innerHTML=r+" - "+o;var H="This site has been running for "+u+" years and "+M+" days "+T+" hours "+f+" mins "+y+" seconds";H="本站已苟且偷生 "+u+" 年 "+M+" 天 "+T+" 小时 "+f+" 分钟 "+y+" 秒",document.getElementById("sitetime").innerHTML=H}};calcSiteTime(),setInterval(calcSiteTime,1e3)</script><br></div><div class="col s12 m4 l4 social-link"><a href="https://github.com/zyxelva" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50"><i class="fab fa-github"></i></a><a href="mailto:zyxelva@gmail.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50"><i class="fas fa-envelope-open"></i></a><a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=1807401971" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 1807401971" data-position="top" data-delay="50"><i class="fab fa-qq"></i></a> <a href="https://www.zhihu.com/people/kezade" class="tooltipped" target="_blank" data-tooltip="关注我的知乎: https://www.zhihu.com/people/kezade" data-position="top" data-delay="50"><i class="fab fa-zhihu1">知</i></a><a href="../rss2.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50"><i class="fas fa-rss"></i></a></div></div></footer><div class="progress-bar"></div><div id="searchModal" class="modal"><div class="modal-content"><div class="search-header"><span class="title"><i class="fas fa-search"></i> &nbsp;&nbsp;搜索</span> <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字" class="search-input"></div><div id="searchResult"></div></div></div><script>$(function(){!function(t,e,r){"use strict";$.ajax({url:t,dataType:"xml",success:function(t){var n=$("entry",t).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get(),a=document.getElementById(e),s=document.getElementById(r);a.addEventListener("input",function(){var t='<ul class="search-result-list">',e=this.value.trim().toLowerCase().split(/[\s\-]+/);s.innerHTML="",this.value.trim().length<=0||(n.forEach(function(r){var n=!0,a=r.title.trim().toLowerCase(),s=r.content.trim().replace(/<[^>]+>/g,"").toLowerCase(),i=r.url;i=0===i.indexOf("/")?r.url:"/"+i;var l=-1,c=-1,u=-1;if(""!==a&&""!==s&&e.forEach(function(t,e){l=a.indexOf(t),c=s.indexOf(t),l<0&&c<0?n=!1:(c<0&&(c=0),0===e&&(u=c))}),n){t+="<li><a href='"+i+"' class='search-result-title'>"+a+"</a>";var o=r.content.trim().replace(/<[^>]+>/g,"");if(u>=0){var h=u-20,f=u+80;h<0&&(h=0),0===h&&(f=100),f>o.length&&(f=o.length);var m=o.substr(h,f);e.forEach(function(t){var e=new RegExp(t,"gi");m=m.replace(e,'<em class="search-keyword">'+t+"</em>")}),t+='<p class="search-result">'+m+"...</p>"}t+="</li>"}}),t+="</ul>",s.innerHTML=t)})}})}("/search.xml","searchInput","searchResult")})</script><div class="stars-con"><div id="stars"></div><div id="stars2"></div><div id="stars3"></div></div><script>function switchNightMode(){$('<div class="Cuteen_DarkSky"><div class="Cuteen_DarkPlanet"></div></div>').appendTo($("body")),setTimeout(function(){$("body").hasClass("DarkMode")?($("body").removeClass("DarkMode"),localStorage.setItem("isDark","0"),$("#sum-moon-icon").removeClass("fa-sun").addClass("fa-moon")):($("body").addClass("DarkMode"),localStorage.setItem("isDark","1"),$("#sum-moon-icon").addClass("fa-sun").removeClass("fa-moon")),setTimeout(function(){$(".Cuteen_DarkSky").fadeOut(1e3,function(){$(this).remove()})},2e3)})}</script><div id="backTop" class="top-scroll"><a class="btn-floating btn-large waves-effect waves-light" href="#!"><i class="fas fa-arrow-up"></i></a></div><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/materialize/materialize.min.js"></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/masonry/masonry.pkgd.min.js"></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/aos/aos.js"></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/scrollprogress/scrollProgress.min.js"></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/lightGallery/js/lightgallery-all.min.js"></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/js/matery.js"></script><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/mermaid/mermaid.min.css"><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/mermaid/mermaid.min.js"></script><script>window.mermaid&&mermaid.initialize({theme:"forest"})</script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/background/ribbon-dynamic.js" async></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/instantpage/instantpage.js" type="module"></script></body></html>
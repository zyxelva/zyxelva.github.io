<!DOCTYPE HTML><html lang="zh-CN"><head><meta charset="utf-8"><meta name="keywords" content="【JVM学习】7.JVM调优, Back-End Dev Java"><meta name="description" content="1 前言本章将主要介绍调优工具及各自的使用方法，最后给出实战案例。
2 工具2.1 JDK工具假如你自己手动安装过JDK，那一定不会对下表中的工具感到陌生。比如用的最多的java。Windows下的JDK工具集合
不同平台，其对应的名字相差"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><meta name="renderer" content="webkit|ie-stand|ie-comp"><meta name="mobile-web-app-capable" content="yes"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="referrer" content="no-referrer-when-downgrade"><title>【JVM学习】7.JVM调优 | Kezade</title><link rel="icon" type="image/jpeg" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/medias/avatar/avatar2.jpg"><style>body{background-image:url(https://it-ark-dev.oss-cn-shenzhen.aliyuncs.com/464e9ac7a5a729ae67f91f7cf0cf6fe2.jpg);background-repeat:no-repeat;background-attachment:fixed;background-size:cover;background-position:center center}</style><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/awesome/css/all.min.css"><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/materialize/materialize.min.css"><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/aos/aos.css"><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/animate/animate.min.css"><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/lightGallery/css/lightgallery.min.css"><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/picgo@v3.1/css/matery.css?v3"><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/css/my.css"><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/css/dark.css" media="none" onload='"all"!=media&&(media="all")'><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/tocbot/tocbot.css"><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/css/post.css"><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/css/reward.css"><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/jquery/jquery-3.6.0.min.js"></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/picgo@v3.3/js/function.js?v88"></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/picgo@v1.3/js/imgStatus.min.js"></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/picgo@v1.3/js/waterfall.min.js"></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/picgo@v1.3/js/lately.min.js"></script><script>var memos={host:"https://s.dusays.com/",limit:"10",creatorId:"49",username:"zyxelva",name:"Kezade",domId:"#memos",path:"api/v1/memo"},douban={api:"https://douban-api.edui.fun/"}</script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/rss2.xml" title="Kezade" type="application/rss+xml"></head><body><header class="navbar-fixed"><nav id="headNav" class="bg-color nav-transparent"><div id="navContainer" class="nav-wrapper container"><div class="brand-logo"><a href="/" class="waves-effect waves-light"><img src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/medias/avatar/avatar2.jpg" class="logo-img k-avatar" alt="LOGO"> <span class="logo-span">Kezade</span></a></div><a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a><ul class="right nav-menu"><li class="hide-on-med-and-down nav-item"><a href="/" class="waves-effect waves-light"><i class="fas fa-home" style="zoom:0.6"></i> <span>首页</span></a></li><li class="hide-on-med-and-down nav-item"><a href="" class="waves-effect waves-light"><i class="fa-solid fa-newspaper" style="zoom:0.6"></i> <span>文章</span><i class="fas fa-chevron-down" aria-hidden="true" style="zoom:0.6"></i></a><ul class="sub-nav menus_item_child"><li><a href="/tags"><i class="fas fa-tags" style="margin-top:-20px;zoom:0.6"></i> <span>标签</span></a></li><li><a href="/categories"><i class="fas fa-bookmark" style="margin-top:-20px;zoom:0.6"></i> <span>分类</span></a></li><li><a href="/archives"><i class="fas fa-archive" style="margin-top:-20px;zoom:0.6"></i> <span>归档</span></a></li></ul></li><li class="hide-on-med-and-down nav-item"><a href="" class="waves-effect waves-light"><i class="fa-solid fa-sitemap" style="zoom:0.6"></i> <span>系列</span><i class="fas fa-chevron-down" aria-hidden="true" style="zoom:0.6"></i></a><ul class="sub-nav menus_item_child"><li><a href="/categories/%E7%AE%97%E6%B3%95"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>算法学习</span></a></li><li><a href="/categories/RocketMQ%E5%AD%A6%E4%B9%A0"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>RMQ学习</span></a></li><li><a href="/categories/Netty%E5%AD%A6%E4%B9%A0"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>Netty学习</span></a></li><li><a href="/categories/Spring%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>Spring学习</span></a></li><li><a href="/categories/JVM%E5%AD%A6%E4%B9%A0"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>JVM学习</span></a></li><li><a href="/categories/MySQL%E5%AD%A6%E4%B9%A0"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>MySQL学习</span></a></li><li><a href="/categories/MyBatis%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>MyBatis学习</span></a></li><li><a href="/categories/Zookeeper%E5%AD%A6%E4%B9%A0"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>ZK学习</span></a></li><li><a href="/categories/Hexo"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>Hexo学习</span></a></li><li><a href="/categories/Redis%E5%AD%A6%E4%B9%A0"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>Redis学习</span></a></li><li><a href="/categories/Docker%E5%AD%A6%E4%B9%A0"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>Docker学习</span></a></li><li><a href="/categories/AP-Calculus"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>AP学习</span></a></li><li><a href="/categories/A-Level"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>A-Level学习</span></a></li><li><a href="/categories/SAT"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>SAT学习</span></a></li><li><a href="/categories/%E8%80%83%E7%A0%94"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>考研</span></a></li><li><a href="/categories/OSSD"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>OSSD</span></a></li><li><a href="/categories/%E9%AB%98%E8%80%83"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>高考</span></a></li></ul></li><li class="hide-on-med-and-down nav-item"><a href="" class="waves-effect waves-light"><i class="fa-solid fa-place-of-worship" style="zoom:0.6"></i> <span>我的</span><i class="fas fa-chevron-down" aria-hidden="true" style="zoom:0.6"></i></a><ul class="sub-nav menus_item_child"><li><a href="/galleries"><i class="fas fa-image" style="margin-top:-20px;zoom:0.6"></i> <span>相册</span></a></li><li><a href="/bibi"><i class="fa-fw fa-solid fa-cloud-rain" style="margin-top:-20px;zoom:0.6"></i> <span>哔哔</span></a></li><li><a href="/todolist"><i class="fa-fw fa-solid fa-circle-check" style="margin-top:-20px;zoom:0.6"></i> <span>清单</span></a></li><li><a href="/musics"><i class="fas fa-music" style="margin-top:-20px;zoom:0.6"></i> <span>音乐</span></a></li></ul></li><li class="hide-on-med-and-down nav-item"><a href="" class="waves-effect waves-light"><i class="fa-solid fa-circle-info" style="zoom:0.6"></i> <span>更多</span><i class="fas fa-chevron-down" aria-hidden="true" style="zoom:0.6"></i></a><ul class="sub-nav menus_item_child"><li><a href="/contact"><i class="fas fa-comments" style="margin-top:-20px;zoom:0.6"></i> <span>留言</span></a></li><li><a href="/friends"><i class="fa-solid fa-link" style="margin-top:-20px;zoom:0.6"></i> <span>友链</span></a></li><li><a href="/friend-circle"><i class="fa-solid fa-rss" style="margin-top:-20px;zoom:0.6"></i> <span>圈圈</span></a></li><li><a href="/about"><i class="fas fa-user-circle" style="margin-top:-20px;zoom:0.6"></i> <span>关于</span></a></li></ul></li><li><a href="#searchModal" class="modal-trigger waves-effect waves-light"><i id="searchIcon" class="fas fa-search" title="搜索" style="zoom:0.85"></i></a></li><li><a href="javascript:;" class="waves-effect waves-light" onclick="switchNightMode()" title="深色/浅色模式"><i id="sum-moon-icon" class="fas fa-sun" style="zoom:0.85"></i></a></li></ul><div id="mobile-nav" class="side-nav sidenav"><div class="mobile-head bg-color"><img src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/medias/avatar/avatar2.jpg" class="logo-img circle responsive-img"><div class="logo-name">Kezade</div><div class="logo-desc">7 年 Java 开发经验，其中 3 年以上大型系统架构设计经验，以及 2 年以上的团队管理经验 | 具有分布式、高并发、高可用、大数据量的系统架构设计以及研发经验 | 对 Zookeeper、Netty、Dubbo、Spring Cloud、 Spring 等开源框架源码有过深入研究，并且有一定的框架定制开发经验</div></div><ul class="menu-list mobile-menu-list"><li class="m-nav-item"><a href="/" class="waves-effect waves-light"><i class="fa-fw fas fa-home"></i> 首页</a></li><li class="m-nav-item"><a href="javascript:;"><i class="fa-fw fa-solid fa-newspaper"></i> 文章<span class="m-icon"><i class="fas fa-chevron-right"></i></span></a><ul><li><a href="/tags" style="margin-left:75px"><i class="fa fas fa-tags" style="position:absolute;left:50px"></i> <span>标签</span></a></li><li><a href="/categories" style="margin-left:75px"><i class="fa fas fa-bookmark" style="position:absolute;left:50px"></i> <span>分类</span></a></li><li><a href="/archives" style="margin-left:75px"><i class="fa fas fa-archive" style="position:absolute;left:50px"></i> <span>归档</span></a></li></ul></li><li class="m-nav-item"><a href="javascript:;"><i class="fa-fw fa-solid fa-sitemap"></i> 系列<span class="m-icon"><i class="fas fa-chevron-right"></i></span></a><ul><li><a href="/categories/%E7%AE%97%E6%B3%95" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>算法学习</span></a></li><li><a href="/categories/RocketMQ%E5%AD%A6%E4%B9%A0" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>RMQ学习</span></a></li><li><a href="/categories/Netty%E5%AD%A6%E4%B9%A0" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>Netty学习</span></a></li><li><a href="/categories/Spring%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>Spring学习</span></a></li><li><a href="/categories/JVM%E5%AD%A6%E4%B9%A0" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>JVM学习</span></a></li><li><a href="/categories/MySQL%E5%AD%A6%E4%B9%A0" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>MySQL学习</span></a></li><li><a href="/categories/MyBatis%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>MyBatis学习</span></a></li><li><a href="/categories/Zookeeper%E5%AD%A6%E4%B9%A0" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>ZK学习</span></a></li><li><a href="/categories/Hexo" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>Hexo学习</span></a></li><li><a href="/categories/Redis%E5%AD%A6%E4%B9%A0" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>Redis学习</span></a></li><li><a href="/categories/Docker%E5%AD%A6%E4%B9%A0" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>Docker学习</span></a></li><li><a href="/categories/AP-Calculus" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>AP学习</span></a></li><li><a href="/categories/A-Level" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>A-Level学习</span></a></li><li><a href="/categories/SAT" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>SAT学习</span></a></li><li><a href="/categories/%E8%80%83%E7%A0%94" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>考研</span></a></li><li><a href="/categories/OSSD" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>OSSD</span></a></li><li><a href="/categories/%E9%AB%98%E8%80%83" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>高考</span></a></li></ul></li><li class="m-nav-item"><a href="javascript:;"><i class="fa-fw fa-solid fa-place-of-worship"></i> 我的<span class="m-icon"><i class="fas fa-chevron-right"></i></span></a><ul><li><a href="/galleries" style="margin-left:75px"><i class="fa fas fa-image" style="position:absolute;left:50px"></i> <span>相册</span></a></li><li><a href="/bibi" style="margin-left:75px"><i class="fa fa-fw fa-solid fa-cloud-rain" style="position:absolute;left:50px"></i> <span>哔哔</span></a></li><li><a href="/todolist" style="margin-left:75px"><i class="fa fa-fw fa-solid fa-circle-check" style="position:absolute;left:50px"></i> <span>清单</span></a></li><li><a href="/musics" style="margin-left:75px"><i class="fa fas fa-music" style="position:absolute;left:50px"></i> <span>音乐</span></a></li></ul></li><li class="m-nav-item"><a href="javascript:;"><i class="fa-fw fa-solid fa-circle-info"></i> 更多<span class="m-icon"><i class="fas fa-chevron-right"></i></span></a><ul><li><a href="/contact" style="margin-left:75px"><i class="fa fas fa-comments" style="position:absolute;left:50px"></i> <span>留言</span></a></li><li><a href="/friends" style="margin-left:75px"><i class="fa fa-solid fa-link" style="position:absolute;left:50px"></i> <span>友链</span></a></li><li><a href="/friend-circle" style="margin-left:75px"><i class="fa fa-solid fa-rss" style="position:absolute;left:50px"></i> <span>圈圈</span></a></li><li><a href="/about" style="margin-left:75px"><i class="fa fas fa-user-circle" style="position:absolute;left:50px"></i> <span>关于</span></a></li></ul></li><li><div class="divider"></div></li><li><a href="https://github.com/blinkfox/hexo-theme-matery" class="waves-effect waves-light" target="_blank"><i class="fab fa-github-square fa-fw"></i> Fork Me</a></li></ul></div></div><style>.nav-transparent .github-corner{display:none!important}.github-corner{position:absolute;z-index:10;top:0;right:0;border:0;transform:scale(1.1)}.github-corner svg{color:#0f9d58;fill:#fff;height:64px;width:64px}.github-corner:hover .octo-arm{animation:a .56s ease-in-out}.github-corner .octo-arm{animation:none}@keyframes a{0%,to{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}</style><a href="https://github.com/blinkfox/hexo-theme-matery" class="github-corner tooltipped hide-on-med-and-down" target="_blank" data-tooltip="Fork Me" data-position="left" data-delay="50"><svg viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a></nav></header><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/cryptojs/crypto-js.min.js"></script><script></script><style>:root{--post-bg-image:url('https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/medias/JVM.png')}</style><div class="bg-cover pd-header post-cover"><div class="container" style="right:0;left:0"><div class="row"><div class="col s12 m12 l12"><div class="brand"><h1 class="description center-align post-title">【JVM学习】7.JVM调优</h1></div></div></div></div></div><main class="post-container content"><div class="row"><div id="main-content" class="col s12 m12 l9"><div id="artDetail"><div class="card"><div class="card-content article-info"><div class="row tag-cate"><div class="col s7"><div class="article-tag"><a href="/tags/JVM/"><span class="chip bg-color">JVM</span></a> <a href="/tags/JVM%E8%B0%83%E4%BC%98/"><span class="chip bg-color">JVM调优</span></a></div></div><div class="col s5 right-align"><div class="post-cate"><i class="fas fa-bookmark fa-fw icon-category"></i> <a href="/categories/JVM%E5%AD%A6%E4%B9%A0/" class="post-category">JVM学习</a></div></div></div><div class="post-info"><div class="post-date info-break-policy"><i class="far fa-calendar-minus fa-fw"></i> 发布日期:&nbsp;&nbsp; 2023-07-10</div><div class="info-break-policy"><i class="far fa-file-word fa-fw"></i> 文章字数:&nbsp;&nbsp; 13.2k</div><div class="info-break-policy"><i class="far fa-clock fa-fw"></i> 阅读时长:&nbsp;&nbsp; 62 分</div></div></div><hr class="clearfix"><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/prism/prism.min.css"><div class="card-content article-card-content"><div id="articleContent"><h1 id="1-前言"><a href="#1-前言" class="headerlink" title="1 前言"></a>1 前言</h1><p>本章将主要介绍调优工具及各自的使用方法，最后给出实战案例。</p><h1 id="2-工具"><a href="#2-工具" class="headerlink" title="2 工具"></a>2 工具</h1><h2 id="2-1-JDK工具"><a href="#2-1-JDK工具" class="headerlink" title="2.1 JDK工具"></a>2.1 JDK工具</h2><p>假如你自己手动安装过JDK，那一定不会对下表中的工具感到陌生。比如用的最多的<code>java</code>。<br><img src="https://gcore.jsdelivr.net/gh/zyxelva/picgo/markdown/JDK-Tools-in-Windows.png"></p><div class="caption"><b class="center-caption">Windows下的JDK工具集合</b></div><p></p><p>不同平台，其对应的名字相差无几，只是后缀名不同。比如我自己的MAC OS版本：<br><img src="https://gcore.jsdelivr.net/gh/zyxelva/picgo/markdown/JDK-Tools-in-MacOS.png"></p><div class="caption"><b class="center-caption">MacOS下的JDK工具集合</b></div><p></p><p>在 Linux 中，一般自带了<code>OpenJdk</code>，一般情况下 <code>JPS</code> 等命令不能用，要么选择去安装 JPS 等插件，要么把 <code>OpenJdk</code> 卸载，去重新安装 Oracle 的 JDK，我推荐后者。</p><blockquote><p>PS：本机JDK版本：<code>1.8.0_181</code></p><h3 id="2-1-1-jps"><a href="#2-1-1-jps" class="headerlink" title="2.1.1 jps"></a>2.1.1 jps</h3><ul><li>作用：列出当前机器上正在运行的虚拟机进程。</li><li>参数：<ul><li><code>-q</code>：仅显示进程</li><li><code>-m</code>：输出主函数传入的参数</li><li><code>-l</code>：输出应用程序主类完整 <code>package</code> 名称或 <code>jar</code> 完整名称</li><li><code>-v</code>：列出 <code>jvm</code> 参数，如：<code>-Xms1024m -Xmx1024m</code> 是启动<code>IDEA</code>指定的 jvm 参数<pre class="line-numbers language-none"><code class="language-none">1892  -Xms1024m -Xmx1024m -XX:ReservedCodeCacheSize&#x3D;512m -XX:+IgnoreUnrecognizedVMOptions -XX:+UseG1GC -XX:SoftRefLRUPolicyMSPerMB&#x3D;50 -XX:CICompilerCount&#x3D;2 -XX:+HeapDumpOnOutOfMemoryError<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ul></li></ul></blockquote><h3 id="2-1-2-jstat"><a href="#2-1-2-jstat" class="headerlink" title="2.1.2 jstat"></a>2.1.2 jstat</h3><ul><li>作用：用于监视虚拟机各种<code>运行状态信息</code>的命令行工具。它可以显示本地或者远程虚拟机进程中的<code>类装载</code>、<code>内存</code>、<code>垃圾收集</code>、<code>JIT 编译</code>等运行数据。是无<code>GUI</code>界面时的首选。</li><li>参数：<ul><li><code>-class</code>：类加载统计。<ul><li>Loaded：加载class的数量</li><li>Bytes：所占用空间大小</li><li>Unloaded：未加载数量</li><li>Bytes：未加载占用空间</li><li>Time：时间</li></ul></li><li><code>-compiler</code>：编译统计<ul><li>Compiled：编译数量。</li><li>Failed：失败数量</li><li>Invalid：不可用数量</li><li>Time：时间</li><li>FailedType：失败类型</li><li>FailedMethod：失败的方法</li></ul></li><li><code>-gc</code> (GC 堆状态)</li><li><code>-gccapacity</code> (各区大小)</li><li><code>-gccause</code> (最近一次 GC 统计和原因)</li><li><code>-gcnew</code> (新区统计)</li><li><code>-gcnewcapacity</code> (新区大小)</li><li><code>-gcold</code> (老区统计)</li><li><code>-gcoldcapacity</code> (老区大小)</li><li><code>-gcpermcapacity</code> (永久区大小)</li><li><code>-gcutil</code> (GC 统计汇总)</li></ul></li></ul><p>比如：<code>jstat -gc &lt;pid&gt;</code><br><pre class="line-numbers language-none"><code class="language-none">[zyxelva@MacBook-Pro 15:58:19 ~&#x2F;Documents&#x2F;MyGit&#x2F;JVM]$ jstat -gc 2085
 S0C       S1C       S0U    S1U      EC       EU            OC            OU       MC         MU        CCSC   CCSU   YGC  YGCT  FGC  FGCT     GCT   
10752.0 29184.0  0.0    0.0   476160.0 141011.1  167936.0   60198.8   98496.0 93078.6 13440.0 12512.2   16    0.825   4       0.809    1.634<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></p><p>各字段意义如下表所示：</p><div class="table-container"><table><thead><tr><th>字段</th><th>含义</th></tr></thead><tbody><tr><td>S0C</td><td>survivor0区的总容量</td></tr><tr><td>S1C</td><td>survivor1区的总容量</td></tr><tr><td>S0U</td><td>survivor0区已使用的容量</td></tr><tr><td>S1U</td><td>survivor1区已使用的容量</td></tr><tr><td>EC</td><td>Eden区的总容量</td></tr><tr><td>EU</td><td>Eden区已使用的容量</td></tr><tr><td>OC</td><td>Old区的总容量</td></tr><tr><td>OU</td><td>Old区已使用的容量</td></tr><tr><td>MC</td><td>Metaspace的总容量</td></tr><tr><td>MU</td><td>Metaspace已使用的容量</td></tr><tr><td>CCSC</td><td>压缩类空间容量</td></tr><tr><td>CCSU</td><td>压缩类空间已使用的容量</td></tr><tr><td>YGC</td><td>新生代垃圾回收次数</td></tr><tr><td>YGCT</td><td>新生代垃圾回收时间</td></tr><tr><td>FGC</td><td>Full GC次数</td></tr><tr><td>FGCT</td><td>Full GC时间</td></tr><tr><td>GCT</td><td>垃圾回收总消耗时间</td></tr></tbody></table></div><p>其他带参数命令的字段意义，可参考<a target="_blank" rel="noopener" href="https://blog.csdn.net/maosijunzi/article/details/46049117">java高分局之jstat命令使用</a>.</p><h3 id="2-1-3-jmap"><a href="#2-1-3-jmap" class="headerlink" title="2.1.3 jmap"></a>2.1.3 jmap</h3><ul><li>作用：用于生成<code>堆转储快照</code>(一般称为 <code>heapdump</code> 或 <code>dump 文件</code>)；查询 <code>finalize 执行队列</code>、<code>Java 堆</code>和<code>永久代</code>的详细信息，如<code>空间使用率</code>、<code>当前用的是哪种垃圾收集器</code>等。</li><li>参数：<ul><li><code>-heap &lt;pid&gt;</code>：打印 heap 的概要信息，GC 使用的算法，heap的配置及wise heap 的使用情况。</li><li><code>-histo:live &lt;pid&gt;</code>：打印<code>每个 class 的实例数目</code>，<code>内存占用</code>，<code>类全名信息</code>；如果 <code>live</code> 子参数加上后，只统计<code>活的</code>对象数量。</li><li><code>-dump &lt;pid&gt;</code>：生成的堆转储快照。一般这么用：<code>jmap -dump:live,format=b,file=heap.bin &lt;pid&gt;</code>.</li></ul></li></ul><blockquote><p>PS：<code>jmap</code> 有不少功能在 <code>Windows</code> 平台下都是受限的，除了生成 dump 文件的 <code>-dump</code> 选项和用于查看每个类的实例、空间占用统计的<code>-histo</code> 选项在所有操作系统都提供之外，其余选项都只能在 <code>Linux/Solaris</code> 下使用。<br>本机系统为<code>macOS Catalina 10.15.7</code>，玩不了这个命令，据百度、Google说，要升级到至少9才能用。我特么……</p></blockquote><p>借用别人的机子来解释下各个字段的意思。<br><img src="https://gcore.jsdelivr.net/gh/zyxelva/picgo/markdown/jmap-heap.png"></p><div class="caption"><b class="center-caption">jmap-heap</b></div><br>例：<code>jmap -heap 15756</code><br><pre class="line-numbers language-none"><code class="language-none">Heap Configuration: ##堆配置情况，也就是 JVM 参数配置的结果[平常说的 tomcat 配置 JVM 参数，就是在配置这些] 
    MinHeapFreeRatio &#x3D; 40 ##最小堆使用比例
    MaxHeapFreeRatio &#x3D; 70 ##最大堆可用比例      
    MaxHeapSize &#x3D; 2147483648 (2048.0MB) ##最大堆空间大小
    NewSize &#x3D; 268435456 (256.0MB) ##新生代分配大小 
    MaxNewSize &#x3D; 268435456 (256.0MB) ##最大可新生代分配大小
    OldSize &#x3D; 5439488 (5.1875MB) ##老年代大小 
    NewRatio &#x3D; 2 ##新生代比例
    SurvivorRatio  &#x3D; 8 ##新生代与 suvivor 的比例 
    PermSize &#x3D; 134217728 (128.0MB) ##perm区永久代大小
    MaxPermSize &#x3D; 134217728 (128.0MB) ##最大可分配 perm 区，也就是永久代大小      

Heap Usage: ##堆使用情况【堆内存实际的使用情况】
  New Generation (Eden + 1 Survivor Space): ##新生代(伊甸区 Eden 区 + 幸存区 survior(1+2)空间) 
      capacity &#x3D; 241631232 (230.4375MB) ##伊甸区容量
      used &#x3D; 77776272 (74.17323303222656MB) ##已经使用大小 
      free &#x3D; 163854960 (156.26426696777344MB) ##剩余容量 
      32.188004570534986% used ##使用比例
  Eden Space: ##伊甸区 
      capacity &#x3D; 214827008 (204.875MB) ##伊甸区容量
      used &#x3D; 74442288 (70.99369812011719MB) ##伊甸区使用
      free &#x3D; 140384720 (133.8813018798828MB) ##伊甸区当前剩余容量 
      34.65220164496263% used ##伊甸区使用情况 
  From Space: ##survior1 区 
      capacity &#x3D; 26804224 (25.5625MB) ##survior1 区容量
      used &#x3D; 3333984 (3.179534912109375MB) ##surviror1 区已使用情况
      free &#x3D; 23470240 (22.382965087890625MB) ##surviror1 区剩余容量 
      12.43827838477995% used ##survior1 区使用比例
  To Space: ##survior2 区 
      capacity &#x3D; 26804224 (25.5625MB) ##survior2 区容量
      used &#x3D; 0 (0.0MB) ##survior2 区已使用情况
      free &#x3D; 26804224 (25.5625MB) ##survior2 区剩余容量 
      0.0% used ## survior2 区使用比例
  PS Old Generation: ##老年代使用情况 
      capacity &#x3D; 1879048192 (1792.0MB) ##老年代容量
      used &#x3D; 30847928 (29.41887664794922MB) ##老年代已使用容量 
      free &#x3D; 1848200264 (1762.5811233520508MB) ##老年代剩余容量 
      1.6416783843721663% used ##老年代使用比例<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p></p><h3 id="2-1-4-jhat"><a href="#2-1-4-jhat" class="headerlink" title="2.1.4 jhat"></a>2.1.4 jhat</h3><ul><li>作用：分析 <code>jmap</code> 生成的 <code>dump</code>。</li><li>参数：</li></ul><p>常和<code>jmap</code>配合，命令<code>jhat [options] &lt;heap-dump-file-name&gt;</code>，比如：利用<code>jmap</code>生成了文件名为<code>heapDump</code>的<code>dump</code>日志，<br><pre class="line-numbers language-none"><code class="language-none">HollisMacBook-Air:apaas hollis$ jhat heapDump
Reading from heapDump...
Dump file created Thu Jan 21 18:59:51 CST 2016
Snapshot read, resolving...
Resolving 341297 objects...
Chasing references, expect 68 dots....................................................................
Eliminating duplicate references....................................................................
Snapshot resolved.
Started HTTP server on port 7000
Server is ready.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>使用<code>jhat命令</code>，就启动了一个<code>http服务</code>，端口是<code>7000</code>，然后在访问<code>http://localhost:7000/</code>。<br><img src="https://gcore.jsdelivr.net/gh/zyxelva/picgo/markdown/jhat-dump-web.png"></p><div class="caption"><b class="center-caption">jhat界面</b></div><p></p><h3 id="2-1-5-jstack"><a href="#2-1-5-jstack" class="headerlink" title="2.1.5 jstack"></a>2.1.5 jstack</h3><ul><li>作用：用于生成虚拟机当前时刻的线程快照。</li><li>参数：</li></ul><blockquote><p>线程快照就是当前虚拟机内每一条线程正在执行的<code>方法堆栈的集合</code>，生成线程快照的<strong>主要目的</strong>是<code>定位线程出现长时间停顿的原因</code>，如线程间死锁、死循环、请求外部资源导致的长时间等待等都是导致线程长时间停顿的常见原因。一般来说 <code>jstack</code> 主要是用来排查<code>是否有死锁的情况</code>。</p><h3 id="2-1-6-jinfo"><a href="#2-1-6-jinfo" class="headerlink" title="2.1.6 jinfo"></a>2.1.6 jinfo</h3><ul><li>作用：实时查看和调整虚拟机运行参数。</li><li>参数：<ul><li><code>–sysprops &lt;pid&gt;</code>：可以查看由<code>System.getProperties()</code>取得的参数</li><li><code>–flag &lt;pid&gt;</code>：未被显式指定的参数的系统默认值</li><li><code>–flags &lt;pid&gt;</code>：注意 <code>s</code>，显示虚拟机的参数<h3 id="2-1-7-命令行工具总结"><a href="#2-1-7-命令行工具总结" class="headerlink" title="2.1.7 命令行工具总结"></a>2.1.7 命令行工具总结</h3></li></ul></li><li>生产服务器推荐开启：<ul><li><code>-XX:-HeapDumpOnOutOfMemoryError</code>：默认关闭，建议开启，在 <code>java.lang.OutOfMemoryError</code> 异常出现时，输出一个 <code>dump 文件</code>，记录当时的堆内存快照。</li><li><code>-XX:HeapDumpPath=./java_pid&lt;pid&gt;.hprof</code>：用来设置堆内存快照的存储文件路径，默认是java进程启动位置。</li></ul></li><li>调优之前开启、调优之后关闭：<ul><li><code>-XX:+PrintGC</code>：调试跟踪之打印简单的 GC 信息参数</li><li><code>-XX:+PrintGCDetails</code>, <code>+XX:+PrintGCTimeStamps</code>：打印详细的 GC 信息</li><li><code>-Xlogger:logpath</code>：设置 gc 的日志路，如: <code>-Xlogger:log/gc.log</code>， 将 <code>gc.log</code> 的路径设置到<code>当前目录的 log 目录下</code>。将 GC 的日志独立写入日志文件，将 GC 日志与系统业务日志进行了分离，方便开发人员进行追踪分析。</li></ul></li><li>考虑使用：<ul><li><code>-XX:+PrintHeapAtGC</code>：打印推信息，获取 Heap 在每次垃圾回收前后的使用状况。</li><li><code>-XX:+TraceClassLoading</code>：在系统控制台信息中看到 class 加载的过程和具体的 class 信息，可用以分析类的加载顺序以及是否可进行精简操作。</li><li><code>-XX:+DisableExplicitGC</code>：禁止在运行期显式地调用<code>System.gc()</code><h2 id="2-2-可视化工具"><a href="#2-2-可视化工具" class="headerlink" title="2.2 可视化工具"></a>2.2 可视化工具</h2><h3 id="2-2-1-Jconsole"><a href="#2-2-1-Jconsole" class="headerlink" title="2.2.1 Jconsole"></a>2.2.1 Jconsole</h3>“A JMX-compliant graphical tool for monitoring a Java virtual machine. It can monitor both local and remote JVMs. It can also monitor and manage an application.”<br>意思很直白，就是一个<code>JMX编译而成的监控JVM的图形化工具</code>。</li></ul></li></ul></blockquote><p>举例：先启动一个Java应用，我这里启动了一个Eureka注册中心，单节点。然后找到Java安装目录下的<code>bin</code>目录，双击<code>jconsole</code>，默认会打开<code>新建连接</code>页面，选中刚刚启动的<code>Eureka</code>即可，界面如下：<br><img src="https://gcore.jsdelivr.net/gh/zyxelva/picgo/markdown/jconsole-for-eureka.png"></p><div class="caption"><b class="center-caption">jconsole界面</b></div><p></p><p>通过切换tab，可以查看你所需要的东西，比如<br>内存：<br><img src="https://gcore.jsdelivr.net/gh/zyxelva/picgo/markdown/jconsole-memory.png"></p><div class="caption"><b class="center-caption">jconsole界面之内存</b></div><p></p><p>线程：<br><img src="https://gcore.jsdelivr.net/gh/zyxelva/picgo/markdown/jconsole-thread.png"></p><div class="caption"><b class="center-caption">jconsole界面之线程</b></div><p></p><p>类：<br><img src="https://gcore.jsdelivr.net/gh/zyxelva/picgo/markdown/jconsole-class.png"></p><div class="caption"><b class="center-caption">jconsole界面之类</b></div><p></p><p>VM概要：<br><img src="https://gcore.jsdelivr.net/gh/zyxelva/picgo/markdown/jconsole-VM-overview.png"></p><div class="caption"><b class="center-caption">jconsole界面之线程</b></div><p></p><h3 id="2-2-2-jvisualvm"><a href="#2-2-2-jvisualvm" class="headerlink" title="2.2.2 jvisualvm"></a>2.2.2 jvisualvm</h3><p>启动方式同上。<br><img src="https://gcore.jsdelivr.net/gh/zyxelva/picgo/markdown/jvisualvm.png"></p><div class="caption"><b class="center-caption">jvisualvm界面</b></div><p></p><p>一般来说，这个工具是<code>本机调试用</code>，一般生产上来说，你一般是用不了的(除非启用远程连接)。</p><p>监视：<br><img src="https://gcore.jsdelivr.net/gh/zyxelva/picgo/markdown/jvisualvm-monitor.png"></p><div class="caption"><b class="center-caption">jvisualvm界面之监视</b></div><br>其中，<code>堆dump</code>类似于<code>jmap</code>。<p></p><p>线程：<br><img src="https://gcore.jsdelivr.net/gh/zyxelva/picgo/markdown/jvisualvm-thread.png"></p><div class="caption"><b class="center-caption">jvisualvm界面之线程</b></div><br>其中，<code>线程Dump</code>类似于<code>jstack</code>工具中的栈跟踪。<p></p><p>抽样器：<br><img src="https://gcore.jsdelivr.net/gh/zyxelva/picgo/markdown/jvisualvm-sample.png"></p><div class="caption"><b class="center-caption">jvisualvm界面之抽样器</b></div><p></p><p>profiler：<br><img src="https://gcore.jsdelivr.net/gh/zyxelva/picgo/markdown/jvisualvm-profiler.png"></p><div class="caption"><b class="center-caption">jvisualvm界面之profiler</b></div><p></p><h2 id="2-3-Arthas"><a href="#2-3-Arthas" class="headerlink" title="2.3 Arthas"></a>2.3 Arthas</h2><p>Arthas 是一款线上监控诊断产品，通过全局视角实时查看应用 load、内存、gc、线程的状态信息，并能在不修改应用代码的情况下，对业务问题进行诊断，包括查看方法调用的出入参、异常，监测方法执行耗时，类加载信息等，大大提升线上问题排查效率。</p><h3 id="2-3-1-安装"><a href="#2-3-1-安装" class="headerlink" title="2.3.1 安装"></a>2.3.1 安装</h3><p>参见<a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/install-detail.html">官网文档</a>.</p><blockquote><p>本机采用手动下载jar包和启动文件<code>as.sh</code>方式。<br><pre class="line-numbers language-none"><code class="language-none">[zyxelva@172-104-123-96 10:56:11 ~&#x2F;Documents&#x2F;Arthas]$ .&#x2F;as.sh
Arthas script version: 3.6.9
[INFO] JAVA_HOME: &#x2F;Library&#x2F;Java&#x2F;JavaVirtualMachines&#x2F;jdk1.8.0_181.jdk&#x2F;Contents&#x2F;Home
Found existing java process, please choose one and input the serial number of the process, eg : 1. Then hit ENTER.
* [1]: 1219 com.taeyeon.adminclient.AdminServerApplication
  [2]: 2196 org.jetbrains.jps.cmdline.Launcher
  [3]: 1149
  [4]: 1181 com.taeyeon.eureka.SpringCloudEurekaApplication
4
Arthas home: &#x2F;Users&#x2F;zyxelva&#x2F;.arthas&#x2F;lib&#x2F;3.6.9&#x2F;arthas
Calculating attach execution time...
Attaching to 1181 using version &#x2F;Users&#x2F;zyxelva&#x2F;.arthas&#x2F;lib&#x2F;3.6.9&#x2F;arthas...

real	0m1.963s
user	0m0.399s
sys	0m0.049s
Attach success.
telnet connecting to arthas server... current timestamp is 1689044193
Trying 127.0.0.1...
Connected to localhost.
Escape character is &#39;^]&#39;.
  ,---.  ,------. ,--------.,--.  ,--.  ,---.   ,---.
 &#x2F;  O  \ |  .--. &#39;&#39;--.  .--&#39;|  &#39;--&#39;  | &#x2F;  O  \ &#39;   .-&#39;
|  .-.  ||  &#39;--&#39;.&#39;   |  |   |  .--.  ||  .-.  |&#96;.  &#96;-.
|  | |  ||  |\  \    |  |   |  |  |  ||  | |  |.-&#39;    |
&#96;--&#39; &#96;--&#39;&#96;--&#39; &#39;--&#39;   &#96;--&#39;   &#96;--&#39;  &#96;--&#39;&#96;--&#39; &#96;--&#39;&#96;-----&#39;

wiki       https:&#x2F;&#x2F;arthas.aliyun.com&#x2F;doc
tutorials  https:&#x2F;&#x2F;arthas.aliyun.com&#x2F;doc&#x2F;arthas-tutorials.html
version    3.6.9
main_class com.taeyeon.eureka.SpringCloudEurekaApplication
pid        1181
time       2023-07-11 10:56:32

[arthas@1181]$<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></blockquote><p>启动后，首先会让你选择<code>attach</code>一个进程，这里同样监控<code>eureka</code>实例，即<code>pid</code>为<code>1181</code>的那个。接下来通过介绍各个命令参数来使用arthas。</p><blockquote><p>如果想在浏览器使用命令玩转arthas，也可用在启动后，通过访问<code>http://127.0.0.1:8563/</code>，使用<code>Web Console</code>。也可以填入 IP，<code>远程连接</code>其它机器上的 arthas。</p></blockquote><img src="https://gcore.jsdelivr.net/gh/zyxelva/picgo/markdown/Web-Console.png"><div class="caption"><b class="center-caption">Web Console</b></div><h3 id="2-3-2-入门"><a href="#2-3-2-入门" class="headerlink" title="2.3.2 入门"></a>2.3.2 入门</h3><h4 id="2-3-2-1-dashboard"><a href="#2-3-2-1-dashboard" class="headerlink" title="2.3.2.1 dashboard"></a>2.3.2.1 dashboard</h4><p>输入<code>dashboard</code>，按<code>回车/enter</code>，会展示当前<code>attach</code>进程的信息，按ctrl+c可以中断执行。<br><img src="https://gcore.jsdelivr.net/gh/zyxelva/picgo/markdown/arthas-dashboard.png"></p><div class="caption"><b class="center-caption">dashboard</b></div><p></p><blockquote><p>当运行在 <code>Ali-tomcat</code> 时，会显示当前 <code>tomcat</code> 的实时信息，如 HTTP 请求的 qps, rt, 错误数, 线程池信息等等。</p></blockquote><p>更多详情，可参阅<a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/dashboard.html">dashboard官方文档</a>.</p><h4 id="2-3-2-2-Thread"><a href="#2-3-2-2-Thread" class="headerlink" title="2.3.2.2 Thread"></a>2.3.2.2 Thread</h4><p>这个命令和 <code>jstack</code> 很相似，但是功能更加强大，主要是<code>查看当前 JVM 的线程堆栈信息</code>，同时可以结合使用 <code>thread –b</code> 来进行<code>死锁的排查</code>。</p><p>参数解释：</p><ul><li><code>-n</code>：指定最忙的前 n 个线程并打印堆栈</li><li><code>-b</code>：找出阻塞当前线程的线程</li><li><code>-i</code>：指定 cpu 占比统计的采样间隔，单位为<code>毫秒</code></li></ul><p>例1：查看当前最忙的前 N 个线程并打印堆栈：<br><pre class="line-numbers language-none"><code class="language-none">$ thread -n 3
&quot;C1 CompilerThread0&quot; [Internal] cpuUsage&#x3D;1.63% deltaTime&#x3D;3ms time&#x3D;1170ms


&quot;arthas-command-execute&quot; Id&#x3D;23 cpuUsage&#x3D;0.11% deltaTime&#x3D;0ms time&#x3D;401ms RUNNABLE
    at java.management@11.0.7&#x2F;sun.management.ThreadImpl.dumpThreads0(Native Method)
    at java.management@11.0.7&#x2F;sun.management.ThreadImpl.getThreadInfo(ThreadImpl.java:466)
    at com.taobao.arthas.core.command.monitor200.ThreadCommand.processTopBusyThreads(ThreadCommand.java:199)
    at com.taobao.arthas.core.command.monitor200.ThreadCommand.process(ThreadCommand.java:122)
    at com.taobao.arthas.core.shell.command.impl.AnnotatedCommandImpl.process(AnnotatedCommandImpl.java:82)
    at com.taobao.arthas.core.shell.command.impl.AnnotatedCommandImpl.access$100(AnnotatedCommandImpl.java:18)
    at com.taobao.arthas.core.shell.command.impl.AnnotatedCommandImpl$ProcessHandler.handle(AnnotatedCommandImpl.java:111)
    at com.taobao.arthas.core.shell.command.impl.AnnotatedCommandImpl$ProcessHandler.handle(AnnotatedCommandImpl.java:108)
    at com.taobao.arthas.core.shell.system.impl.ProcessImpl$CommandProcessTask.run(ProcessImpl.java:385)
    at java.base@11.0.7&#x2F;java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:515)
    at java.base@11.0.7&#x2F;java.util.concurrent.FutureTask.run(FutureTask.java:264)
    at java.base@11.0.7&#x2F;java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:304)
    at java.base@11.0.7&#x2F;java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)
    at java.base@11.0.7&#x2F;java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)
    at java.base@11.0.7&#x2F;java.lang.Thread.run(Thread.java:834)


&quot;VM Periodic Task Thread&quot; [Internal] cpuUsage&#x3D;0.07% deltaTime&#x3D;0ms time&#x3D;584ms
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>例2：当没有参数时，显示第一页线程的信息：<br><pre class="line-numbers language-none"><code class="language-none">[arthas@1181]$ thread
Threads Total: 65, NEW: 0, RUNNABLE: 25, BLOCKED: 0, WAITING: 19, TIMED_WAITING: 11, TERMINATED: 0, Internal threads: 10              
ID    NAME                             GROUP            PRIORITY   STATE      %CPU       DELTA_TIME  TIME       INTERRUPTE DAEMON     
-1    C1 CompilerThread2               -                -1         -          1.16       0.002       0:8.016    false      true       
130   arthas-command-execute           system           5          RUNNABLE   0.47       0.000       0:0.024    false      true       
54    Eureka-CacheFillTimer            main             5          TIMED_WAIT 0.1        0.000       0:0.244    false      true       
-1    VM Periodic Task Thread          -                -1         -          0.08       0.000       0:6.228    false      true       
42    Catalina-utility-2               main             1          TIMED_WAIT 0.05       0.000       0:0.843    false      false      
-1    C2 CompilerThread1               -                -1         -          0.05       0.000       0:0.235    false      true       
-1    C2 CompilerThread0               -                -1         -          0.02       0.000       0:0.238    false      true       
41    Catalina-utility-1               main             1          WAITING    0.02       0.000       0:0.864    false      false      
2     Reference Handler                system           10         WAITING    0.0        0.000       0:0.293    false      true       
3     Finalizer                        system           8          WAITING    0.0        0.000       0:0.031    false      true       
4     Signal Dispatcher                system           9          RUNNABLE   0.0        0.000       0:0.000    false      true       
13    RMI TCP Accept-0                 system           5          RUNNABLE   0.0        0.000       0:0.054    false      true       
14    Attach Listener                  system           9          RUNNABLE   0.0        0.000       0:0.886    false      true       
16    RMI Scheduler(0)                 system           5          WAITING    0.0        0.000       0:0.011    false      true       
106   arthas-timer                     system           9          WAITING    0.0        0.000       0:0.000    false      true       
109   arthas-NettyHttpTelnetBootstrap- system           5          RUNNABLE   0.0        0.000       0:0.029    false      true       
110   arthas-NettyWebsocketTtyBootstra system           5          RUNNABLE   0.0        0.000       0:0.018    false      true       
111   arthas-NettyWebsocketTtyBootstra system           5          RUNNABLE   0.0        0.000       0:0.002    false      true       
112   arthas-shell-server              system           9          TIMED_WAIT 0.0        0.000       0:0.008    false      true       
113   arthas-session-manager           system           9          TIMED_WAIT 0.0        0.000       0:0.004    false      true       
114   arthas-UserStat                  system           9          WAITING    0.0        0.000       0:0.000    false      true       
116   arthas-NettyHttpTelnetBootstrap- system           5          RUNNABLE   0.0        0.000       0:0.084    false      true       
117   arthas-NettyWebsocketTtyBootstra system           5          RUNNABLE   0.0        0.000       0:0.106    false      true       
118   arthas-TermServer-1-1            system           5          RUNNABLE   0.0        0.000       0:0.004    false      true       
119   arthas-NettyWebsocketTtyBootstra system           5          RUNNABLE   0.0        0.000       0:0.009    false      true       
120   arthas-TermServer-1-2            system           5          RUNNABLE   0.0        0.000       0:0.011    false      true       
121   arthas-NettyWebsocketTtyBootstra system           5          RUNNABLE   0.0        0.000       0:0.007    false      true       
122   arthas-NettyWebsocketTtyBootstra system           5          RUNNABLE   0.0        0.000       0:0.009    false      true       
123   arthas-TermServer-1-3            system           5          RUNNABLE   0.0        0.000       0:0.003    false      true       
124   arthas-NettyWebsocketTtyBootstra system           5          RUNNABLE   0.0        0.000       0:0.008    false      true       
[arthas@1181]$ <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><blockquote><p>更多介绍，参阅<a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/thread.html">thread官方文档</a>.</p></blockquote><h4 id="2-3-2-3-jvm"><a href="#2-3-2-3-jvm" class="headerlink" title="2.3.2.3 jvm"></a>2.3.2.3 jvm</h4><p>查看当前 JVM 信息.<br><pre class="line-numbers language-none"><code class="language-none">[arthas@1181]$ jvm
 RUNTIME                                                                                                                              
--------------------------------------------------------------------------------------------------------------------------------------
 MACHINE-NAME                          1181@172-104-123-96.ip.linodeusercontent.com                                                   
 JVM-START-TIME                        2023-07-11 09:27:13                                                                            
 MANAGEMENT-SPEC-VERSION               1.2                                                                                            
 SPEC-NAME                             Java Virtual Machine Specification                                                             
 SPEC-VENDOR                           Oracle Corporation                                                                             
 SPEC-VERSION                          1.8                                                                                            
 VM-NAME                               Java HotSpot(TM) 64-Bit Server VM                                                              
 VM-VENDOR                             Oracle Corporation                                                                             
 VM-VERSION                            25.181-b13                                                                                     
 INPUT-ARGUMENTS                       -agentlib:jdwp&#x3D;transport&#x3D;dt_socket,address&#x3D;127.0.0.1:50075,suspend&#x3D;y,server&#x3D;n                  
                                       -XX:TieredStopAtLevel&#x3D;1                                                                        
                                       -Xverify:none                                                                                  
                                       -Dspring.output.ansi.enabled&#x3D;always                                                            
                                       -javaagent:&#x2F;Users&#x2F;zyxelva&#x2F;Library&#x2F;Caches&#x2F;JetBrains&#x2F;IntelliJIdea2021.3&#x2F;captureAgent&#x2F;debugger-ag 
                                       ent.jar                                                                                        
                                       -Dcom.sun.management.jmxremote                                                                 
                                       -Dspring.jmx.enabled&#x3D;true                                                                      
                                       -Dspring.liveBeansView.mbeanDomain                                                             
                                       -Dspring.application.admin.enabled&#x3D;true                                                        
                                       -Dfile.encoding&#x3D;UTF-8                                                                          
 CLASS-PATH                            &#x2F;Library&#x2F;Java&#x2F;JavaVirtualMachines&#x2F;jdk1.8.0_181.jdk&#x2F;Contents&#x2F;Home&#x2F;jre&#x2F;lib&#x2F;charsets.jar:&#x2F;Library 
                                       &#x2F;Java&#x2F;JavaVirtualMachines&#x2F;jdk1.8.0_181.jdk&#x2F;Contents&#x2F;Home&#x2F;jre&#x2F;lib&#x2F;deploy.jar:&#x2F;Library&#x2F;Java&#x2F;Java 
                                       VirtualMachines&#x2F;jdk1.8.0_181.jdk&#x2F;Contents&#x2F;Home&#x2F;jre&#x2F;lib&#x2F;ext&#x2F;cldrdata.jar:&#x2F;Library&#x2F;Java&#x2F;JavaVirt 
                                       ualMachines&#x2F;jdk1.8.0_181.jdk&#x2F;Contents&#x2F;Home&#x2F;jre&#x2F;lib&#x2F;ext&#x2F;dnsns.jar:&#x2F;Library&#x2F;Java&#x2F;JavaVirtualMach 
                                       ines&#x2F;jdk1.8.0_181.jdk&#x2F;Contents&#x2F;Home&#x2F;jre&#x2F;lib&#x2F;ext&#x2F;jaccess.jar:&#x2F;Library&#x2F;Java&#x2F;JavaVirtualMachines&#x2F; 
                                       jdk1.8.0_181.jdk&#x2F;Contents&#x2F;Home&#x2F;jre&#x2F;lib&#x2F;ext&#x2F;jfxrt.jar:&#x2F;Library&#x2F;Java&#x2F;JavaVirtualMachines&#x2F;jdk1.8. 
                                       0_181.jdk&#x2F;Contents&#x2F;Home&#x2F;jre&#x2F;lib&#x2F;ext&#x2F;localedata.jar:此处省略一万字符                                                                         
 BOOT-CLASS-PATH                       &#x2F;Library&#x2F;Java&#x2F;JavaVirtualMachines&#x2F;jdk1.8.0_181.jdk&#x2F;Contents&#x2F;Home&#x2F;jre&#x2F;lib&#x2F;resources.jar:&#x2F;Librar 
                                       y&#x2F;Java&#x2F;JavaVirtualMachines&#x2F;jdk1.8.0_181.jdk&#x2F;Contents&#x2F;Home&#x2F;jre&#x2F;lib&#x2F;rt.jar:&#x2F;Library&#x2F;Java&#x2F;JavaVir 
                                       tualMachines&#x2F;jdk1.8.0_181.jdk&#x2F;Contents&#x2F;Home&#x2F;jre&#x2F;lib&#x2F;sunrsasign.jar:&#x2F;Library&#x2F;Java&#x2F;JavaVirtualMa 
                                       chines&#x2F;jdk1.8.0_181.jdk&#x2F;Contents&#x2F;Home&#x2F;jre&#x2F;lib&#x2F;jsse.jar:&#x2F;Library&#x2F;Java&#x2F;JavaVirtualMachines&#x2F;jdk1. 
                                       8.0_181.jdk&#x2F;Contents&#x2F;Home&#x2F;jre&#x2F;lib&#x2F;jce.jar:&#x2F;Library&#x2F;Java&#x2F;JavaVirtualMachines&#x2F;jdk1.8.0_181.jdk&#x2F;C 
                                       ontents&#x2F;Home&#x2F;jre&#x2F;lib&#x2F;charsets.jar:&#x2F;Library&#x2F;Java&#x2F;JavaVirtualMachines&#x2F;jdk1.8.0_181.jdk&#x2F;Contents&#x2F; 
                                       Home&#x2F;jre&#x2F;lib&#x2F;jfr.jar:&#x2F;Library&#x2F;Java&#x2F;JavaVirtualMachines&#x2F;jdk1.8.0_181.jdk&#x2F;Contents&#x2F;Home&#x2F;jre&#x2F;clas 
                                       ses:&#x2F;Users&#x2F;zyxelva&#x2F;Library&#x2F;Caches&#x2F;JetBrains&#x2F;IntelliJIdea2021.3&#x2F;captureAgent&#x2F;debugger-agent.jar 
 LIBRARY-PATH                          &#x2F;Users&#x2F;zyxelva&#x2F;Library&#x2F;Java&#x2F;Extensions:&#x2F;Library&#x2F;Java&#x2F;Extensions:&#x2F;Network&#x2F;Library&#x2F;Java&#x2F;Extensio 
                                       ns:&#x2F;System&#x2F;Library&#x2F;Java&#x2F;Extensions:&#x2F;usr&#x2F;lib&#x2F;java:.                                             
                                                                                                                                      
--------------------------------------------------------------------------------------------------------------------------------------
 CLASS-LOADING                                                                                                                        
--------------------------------------------------------------------------------------------------------------------------------------
 LOADED-CLASS-COUNT                    30462                                                                                          
 TOTAL-LOADED-CLASS-COUNT              30485                                                                                          
 UNLOADED-CLASS-COUNT                  23                                                                                             
 IS-VERBOSE                            false                                                                                          
                                                                                                                                      
--------------------------------------------------------------------------------------------------------------------------------------
 COMPILATION                                                                                                                          
--------------------------------------------------------------------------------------------------------------------------------------
 NAME                                  HotSpot 64-Bit Tiered Compilers                                                                
 TOTAL-COMPILE-TIME                    23630                                                                                          
 [time (ms)]                                                                                                                          
                                                                                                                                      
--------------------------------------------------------------------------------------------------------------------------------------
 GARBAGE-COLLECTORS                                                                                                                   
--------------------------------------------------------------------------------------------------------------------------------------
 PS Scavenge                           name : PS Scavenge                                                                             
 [count&#x2F;time (ms)]                     collectionCount : 25                                                                           
                                       collectionTime : 984                                                                           
 PS MarkSweep                          name : PS MarkSweep                                                                            
 [count&#x2F;time (ms)]                     collectionCount : 12                                                                           
                                       collectionTime : 2333                                                                          
                                                                                                                                      
--------------------------------------------------------------------------------------------------------------------------------------
 MEMORY-MANAGERS                                                                                                                      
--------------------------------------------------------------------------------------------------------------------------------------
 CodeCacheManager                      Code Cache                                                                                     
 Metaspace Manager                     Metaspace                                                                                      
                                       Compressed Class Space                                                                         
 PS Scavenge                           PS Eden Space                                                                                  
                                       PS Survivor Space                                                                              
 PS MarkSweep                          PS Eden Space                                                                                  
                                       PS Survivor Space                                                                              
                                       PS Old Gen                                                                                     
                                                                                                                                      
--------------------------------------------------------------------------------------------------------------------------------------
 MEMORY                                                                                                                               
--------------------------------------------------------------------------------------------------------------------------------------
 HEAP-MEMORY-USAGE                     init : 134217728(128.0 MiB)                                                                    
 [memory in bytes]                     used : 277785000(264.9 MiB)                                                                    
                                       committed : 1059061760(1010.0 MiB)                                                             
                                       max : 1908932608(1.8 GiB)                                                                      
 NO-HEAP-MEMORY-USAGE                  init : 2555904(2.4 MiB)                                                                        
 [memory in bytes]                     used : 198825896(189.6 MiB)                                                                    
                                       committed : 208535552(198.9 MiB)                                                               
                                       max : -1(-1 B)                                                                                 
 PENDING-FINALIZE-COUNT                0                                                                                              
                                                                                                                                      
--------------------------------------------------------------------------------------------------------------------------------------
 OPERATING-SYSTEM                                                                                                                     
--------------------------------------------------------------------------------------------------------------------------------------
 OS                                    Mac OS X                                                                                       
 ARCH                                  x86_64                                                                                         
 PROCESSORS-COUNT                      4                                                                                              
 LOAD-AVERAGE                          2.37109375                                                                                     
 VERSION                               10.15.7                                                                                        
                                                                                                                                      
--------------------------------------------------------------------------------------------------------------------------------------
 THREAD                                                                                                                               
--------------------------------------------------------------------------------------------------------------------------------------
 COUNT                                 55                                                                                             
 DAEMON-COUNT                          51                                                                                             
 PEAK-COUNT                            56                                                                                             
 STARTED-COUNT                         120                                                                                            
 DEADLOCK-COUNT                        0                                                                                              
                                                                                                                                      
--------------------------------------------------------------------------------------------------------------------------------------
 FILE-DESCRIPTOR                                                                                                                      
--------------------------------------------------------------------------------------------------------------------------------------
 MAX-FILE-DESCRIPTOR-COUNT             10240                                                                                          
 OPEN-FILE-DESCRIPTOR-COUNT            273                                                                                            
                                           <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="2-3-2-4-Jad"><a href="#2-3-2-4-Jad" class="headerlink" title="2.3.2.4 Jad"></a>2.3.2.4 Jad</h4><p>反编译指定已加载类的源码。<br><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
[arthas@1181]$ jad com.taeyeon.eureka.SpringCloudEurekaApplication

ClassLoader:                                                                                                                          
 +-sun.misc.Launcher$AppClassLoader@18b4aac2
 +-sun.misc.Launcher$ExtClassLoader@1df82230                                                                                         

Location:                                                                                                                             
/Users/zyxelva/Documents/xxx/xxx/spring-boot-interview-eureka/target/classes/                                                 
*/</span>
       <span class="token comment">/*
        * Decompiled with CFR.
        */</span>
       <span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>taeyeon<span class="token punctuation">.</span>eureka</span><span class="token punctuation">;</span>
       
       <span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Logger</span></span><span class="token punctuation">;</span>
       <span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">LoggerFactory</span></span><span class="token punctuation">;</span>
       <span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span></span><span class="token class-name">SpringApplication</span></span><span class="token punctuation">;</span>
       <span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span></span><span class="token class-name">SpringBootApplication</span></span><span class="token punctuation">;</span>
       <span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>netflix<span class="token punctuation">.</span>eureka<span class="token punctuation">.</span>server<span class="token punctuation">.</span></span><span class="token class-name">EnableEurekaServer</span></span><span class="token punctuation">;</span>
       
       <span class="token annotation punctuation">@SpringBootApplication</span>
       <span class="token annotation punctuation">@EnableEurekaServer</span>
       <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringCloudEurekaApplication</span> <span class="token punctuation">&#123;</span>
           <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Logger</span> log <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">SpringCloudEurekaApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       
           <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token comment">/*18*/</span>         log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"------------------------SpringCloudEurekaApplication 开始启动------------------------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/*19*/</span>         <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">SpringCloudEurekaApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/*20*/</span>         log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"------------------------SpringCloudEurekaApplication 启动成功------------------------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token punctuation">&#125;</span>
       <span class="token punctuation">&#125;</span>

<span class="token comment">//Affect(row-cnt:2) cost in 1454 ms.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h3 id="2-3-3-命令汇总"><a href="#2-3-3-命令汇总" class="headerlink" title="2.3.3 命令汇总"></a>2.3.3 命令汇总</h3><div class="table-container"><table><thead><tr><th>命令</th><th>介绍</th></tr></thead><tbody><tr><td>dashboard</td><td>当前系统的实时数据面板</td></tr><tr><td>thread</td><td>查看当前 JVM 的线程堆栈信息</td></tr><tr><td>watch</td><td>方法执行数据观测</td></tr><tr><td>trace</td><td>方法内部调用路径，并输出方法路径上的每个节点上耗时</td></tr><tr><td>stack</td><td>输出当前方法被调用的调用路径</td></tr><tr><td>tt</td><td>方法执行数据的时空隧道，记录下指定方法每次调用的入参和返回信息，并能对这些不同的时间下调用进行观测</td></tr><tr><td>monitor</td><td>方法执行监控</td></tr><tr><td>jvm</td><td>查看当前 JVM 信息</td></tr><tr><td>vmoption</td><td>查看，更新 JVM 诊断相关的参数</td></tr><tr><td>sc</td><td>查看 JVM 已加载的类信息</td></tr><tr><td>sm</td><td>查看已加载类的方法信息</td></tr><tr><td>jad</td><td>反编译指定已加载类的源码</td></tr><tr><td>classloader</td><td>查看 classloader 的继承树，urls，类加载信息</td></tr><tr><td>heapdump</td><td>类似 jmap 命令的 heap dump 功能</td></tr></tbody></table></div><blockquote><p>更多命令使用，参阅<a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/commands.html">命令列表</a>.</p></blockquote><h1 id="3-调优"><a href="#3-调优" class="headerlink" title="3 调优"></a>3 调优</h1><h2 id="3-1-内存优化"><a href="#3-1-内存优化" class="headerlink" title="3.1 内存优化"></a>3.1 内存优化</h2><h3 id="3-1-1-AB压测"><a href="#3-1-1-AB压测" class="headerlink" title="3.1.1 AB压测"></a>3.1.1 AB压测</h3><p>压测工具<code>AB</code>(Apache Bench)测试工具是 Apache 提供的一款测试工具，具有简单易上手的特点，在测试 Web 服务时非常实用。</p><p>ab 一般都是在 Linux 上用。安装非常简单，只需要在 Linux 系统中输入 <code>yum -y install httpd-tools</code> 命令，就可以了。</p><blockquote><p>本机macOS自带了，所以，怎么安装，请自行Google。</p></blockquote><p>安装成功后，输入 ab 命令，可以看到以下信息：<br><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>zyxelva@Taeyeons-MacBook-Pro 09:58:45 ~<span class="token punctuation">]</span>$ ab
ab: wrong number of arguments
Usage: ab <span class="token punctuation">[</span>options<span class="token punctuation">]</span> <span class="token punctuation">[</span>http<span class="token punctuation">[</span>s<span class="token punctuation">]</span>://<span class="token punctuation">]</span>hostname<span class="token punctuation">[</span>:port<span class="token punctuation">]</span>/path
Options are:
    <span class="token parameter variable">-n</span> requests     Number of requests to perform
    <span class="token parameter variable">-c</span> concurrency  Number of multiple requests to <span class="token function">make</span> at a <span class="token function">time</span>
    <span class="token parameter variable">-t</span> timelimit    Seconds to max. to spend on benchmarking
                    This implies <span class="token parameter variable">-n</span> <span class="token number">50000</span>
    <span class="token parameter variable">-s</span> <span class="token function">timeout</span>      Seconds to max. <span class="token function">wait</span> <span class="token keyword">for</span> each response
                    Default is <span class="token number">30</span> seconds
    <span class="token parameter variable">-b</span> windowsize   Size of TCP send/receive buffer, <span class="token keyword">in</span> bytes
    <span class="token parameter variable">-B</span> address      Address to <span class="token builtin class-name">bind</span> to when making outgoing connections
    <span class="token parameter variable">-p</span> postfile     File containing data to POST. Remember also to <span class="token builtin class-name">set</span> <span class="token parameter variable">-T</span>
    <span class="token parameter variable">-u</span> putfile      File containing data to PUT. Remember also to <span class="token builtin class-name">set</span> <span class="token parameter variable">-T</span>
    <span class="token parameter variable">-T</span> content-type Content-type header to use <span class="token keyword">for</span> POST/PUT data, eg.
                    <span class="token string">'application/x-www-form-urlencoded'</span>
                    Default is <span class="token string">'text/plain'</span>
    <span class="token parameter variable">-v</span> verbosity    How much troubleshooting info to print
    <span class="token parameter variable">-w</span>              Print out results <span class="token keyword">in</span> HTML tables
    <span class="token parameter variable">-i</span>              Use HEAD instead of GET
    <span class="token parameter variable">-x</span> attributes   String to insert as table attributes
    <span class="token parameter variable">-y</span> attributes   String to insert as <span class="token function">tr</span> attributes
    <span class="token parameter variable">-z</span> attributes   String to insert as td or th attributes
    <span class="token parameter variable">-C</span> attribute    Add cookie, eg. <span class="token string">'Apache=1234'</span><span class="token builtin class-name">.</span> <span class="token punctuation">(</span>repeatable<span class="token punctuation">)</span>
    <span class="token parameter variable">-H</span> attribute    Add Arbitrary header line, eg. <span class="token string">'Accept-Encoding: gzip'</span>
                    Inserted after all normal header lines. <span class="token punctuation">(</span>repeatable<span class="token punctuation">)</span>
    <span class="token parameter variable">-A</span> attribute    Add Basic WWW Authentication, the attributes
                    are a colon separated username and password.
    <span class="token parameter variable">-P</span> attribute    Add Basic Proxy Authentication, the attributes
                    are a colon separated username and password.
    <span class="token parameter variable">-X</span> proxy:port   Proxyserver and port number to use
    <span class="token parameter variable">-V</span>              Print version number and <span class="token builtin class-name">exit</span>
    <span class="token parameter variable">-k</span>              Use HTTP KeepAlive feature
    <span class="token parameter variable">-d</span>              Do not show percentiles served table.
    <span class="token parameter variable">-S</span>              Do not show confidence estimators and warnings.
    <span class="token parameter variable">-q</span>              Do not show progress when doing <span class="token function">more</span> than <span class="token number">150</span> requests
    <span class="token parameter variable">-l</span>              Accept variable document length <span class="token punctuation">(</span>use this <span class="token keyword">for</span> dynamic pages<span class="token punctuation">)</span>
    <span class="token parameter variable">-g</span> filename     Output collected data to gnuplot <span class="token function">format</span> file.
    <span class="token parameter variable">-e</span> filename     Output CSV <span class="token function">file</span> with percentages served
    <span class="token parameter variable">-r</span>              Don't <span class="token builtin class-name">exit</span> on socket receive errors.
    <span class="token parameter variable">-m</span> method       Method name
    <span class="token parameter variable">-h</span>              Display usage information <span class="token punctuation">(</span>this message<span class="token punctuation">)</span>
    <span class="token parameter variable">-I</span>              Disable TLS Server Name Indication <span class="token punctuation">(</span>SNI<span class="token punctuation">)</span> extension
    <span class="token parameter variable">-Z</span> ciphersuite  Specify SSL/TLS cipher suite <span class="token punctuation">(</span>See openssl ciphers<span class="token punctuation">)</span>
    <span class="token parameter variable">-f</span> protocol     Specify SSL/TLS protocol
                    <span class="token punctuation">(</span>TLS1, TLS1.1, TLS1.2 or ALL<span class="token punctuation">)</span>
    <span class="token parameter variable">-E</span> certfile     Specify optional client certificate chain and private key<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><ul><li>测试Get请求：<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ab <span class="token parameter variable">-c</span> <span class="token number">10</span> <span class="token parameter variable">-n</span> <span class="token number">100</span> http://www.test.api.com/test/login?userName<span class="token operator">=</span>test<span class="token operator">&amp;</span><span class="token assign-left variable">password</span><span class="token operator">=</span>test<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li>测试Post请求：<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ab <span class="token parameter variable">-n</span> <span class="token number">100</span> <span class="token parameter variable">-c</span> <span class="token number">10</span> <span class="token parameter variable">-p</span> <span class="token string">'post.txt'</span> <span class="token parameter variable">-T</span> <span class="token string">'application/x-www-form-urlencoded'</span> <span class="token string">'http://test.api.com/test/register'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>其中，<code>post.txt</code>存放了该接口的参数，格式为：<code>usernanme=test&amp;password=test&amp;sex=1</code>。</li><li>参数的含义：<ul><li><code>-n</code>：总请求次数(最小默认为 1);</li><li><code>-c</code>：并发次数(最小默认为 1 且不能大于总请求次数，例如：10 个请求，10 个并发，实际就是 1 人请求 1 次);</li><li><code>-p</code>：post 参数文档路径(<code>-p</code>和<code>-T</code>参数要配合使用);</li><li><code>-T</code>：header 头内容类型(<strong>此处切记是大写英文字母 T</strong>);</li></ul></li><li>性能指标参考：<ul><li><code>Requests per second</code>：吞吐率，指某个并发用户数下单位时间内处理的请求数;</li><li><code>Time per request</code>：上面的是用户平均请求等待时间，指处理完成所有请求数所花费的时间 /(总请求数 / 并发用户数);</li><li><code>Time per request</code>：下面的是服务器平均请求处理时间，指处理完成所有请求数所花费的时间 / 总请求数;</li><li><code>Percentage of the requests served within a certain time</code>：每秒请求时间分布情况，指在整个请求中，每个请求的时间长度的分布情况，例如有 50% 的请求 响应在 8ms 内，66% 的请求响应在 10ms 内，说明有 16% 的请求在 8ms~10ms 之间。</li></ul></li></ul><h3 id="3-1-2-JVM-内存分配的调优案例"><a href="#3-1-2-JVM-内存分配的调优案例" class="headerlink" title="3.1.2 JVM 内存分配的调优案例"></a>3.1.2 JVM 内存分配的调优案例</h3><p>本人的<code>老苹果</code>快8年了，扛不住10万的并发了，这里只是抛砖引玉，模拟一万并发，各位看官不要唏嘘mac的性能哈。</p><h4 id="3-1-2-1-测试接口"><a href="#3-1-2-1-测试接口" class="headerlink" title="3.1.2.1 测试接口"></a>3.1.2.1 测试接口</h4><p>以下代码为待压测的接口：<br><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/neo"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ApiController</span> <span class="token punctuation">&#123;</span>
  <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/heap"</span><span class="token punctuation">)</span>
  <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">List</span><span class="token operator">&lt;</span><span class="token class-name">Byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span><span class="token class-name">Byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Byte</span><span class="token punctuation">[</span><span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token string">"success"</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="3-1-2-2-样例"><a href="#3-1-2-2-样例" class="headerlink" title="3.1.2.2 样例"></a>3.1.2.2 样例</h4><p>对应用服务进行压力测试，模拟不同并发用户数下的服务的响应情况：</p><ul><li>10 个并发用户/1万请求量(总)：<code>ab -c 10 -n 10000 http://127.0.0.1:8088/neo/heap</code></li><li>100 个并发用户/1万请求量(总)：<code>ab -c 100 -n 10000 http://127.0.0.1:8088/neo/heap</code></li><li>1000 个并发用户/1万请求量(总)：<code>ab -c 1000 -n 10000 http://127.0.0.1:8088/neo/heap</code></li></ul><h4 id="3-1-2-3-监控"><a href="#3-1-2-3-监控" class="headerlink" title="3.1.2.3 监控"></a>3.1.2.3 监控</h4><ul><li>GC 监控<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">jstat <span class="token parameter variable">-gc</span> <span class="token number">1816</span> <span class="token number">5000</span> <span class="token number">20</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'&#123;print $13,$14,$15,$16,$17&#125;'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>其中，<code>1816</code>为应用进程ID。<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>zyxelva@Taeyeons-MacBook-Pro <span class="token number">10</span>:28:15 ~<span class="token punctuation">]</span>$ jps
<span class="token number">1816</span> spring-boot-interview-api-gateway.jar
<span class="token number">1755</span> Jps<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li>堆监控<br>在默认不配置 JVM 堆内存大小的情况下，JVM 根据<code>默认值</code>来配置当前内存大小。 我们可以通过以下命令来查看堆内存配置的默认值：<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>zyxelva@Taeyeons-MacBook-Pro <span class="token number">10</span>:30:12 ~<span class="token punctuation">]</span>$ <span class="token function">java</span> <span class="token parameter variable">-XX:+PrintFlagsFinal</span> <span class="token parameter variable">-version</span> <span class="token operator">|</span> <span class="token function">grep</span> HeapSize
  uintx ErgoHeapSizeLimit                         <span class="token operator">=</span> <span class="token number">0</span>                                   <span class="token punctuation">&#123;</span>product<span class="token punctuation">&#125;</span>
  uintx HeapSizePerGCThread                       <span class="token operator">=</span> <span class="token number">87241520</span>                            <span class="token punctuation">&#123;</span>product<span class="token punctuation">&#125;</span>
  uintx InitialHeapSize                          :<span class="token operator">=</span> <span class="token number">134217728</span>                           <span class="token punctuation">&#123;</span>product<span class="token punctuation">&#125;</span>
  uintx LargePageHeapSizeThreshold                <span class="token operator">=</span> <span class="token number">134217728</span>                           <span class="token punctuation">&#123;</span>product<span class="token punctuation">&#125;</span>
  uintx MaxHeapSize                              :<span class="token operator">=</span> <span class="token number">2147483648</span>                          <span class="token punctuation">&#123;</span>product<span class="token punctuation">&#125;</span>
<span class="token function">java</span> version <span class="token string">"1.8.0_181"</span>
Java<span class="token punctuation">(</span>TM<span class="token punctuation">)</span> SE Runtime Environment <span class="token punctuation">(</span>build <span class="token number">1.8</span>.0_181-b13<span class="token punctuation">)</span>
Java HotSpot<span class="token punctuation">(</span>TM<span class="token punctuation">)</span> <span class="token number">64</span>-Bit Server VM <span class="token punctuation">(</span>build <span class="token number">25.181</span>-b13, mixed mode<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>可以看出，这台机器上启动的 JVM 默认<code>最大堆内存</code>大约为 2GB，初始化大小大约为 130MB。</li></ul><h4 id="3-1-2-4-压测结果"><a href="#3-1-2-4-压测结果" class="headerlink" title="3.1.2.4 压测结果"></a>3.1.2.4 压测结果</h4><h5 id="3-1-2-4-1-10-个并发用户-1万请求量-总"><a href="#3-1-2-4-1-10-个并发用户-1万请求量-总" class="headerlink" title="3.1.2.4.1 10 个并发用户/1万请求量(总)"></a>3.1.2.4.1 10 个并发用户/1万请求量(总)</h5><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>zyxelva@Taeyeons-MacBook-Pro <span class="token number">10</span>:43:36 ~<span class="token punctuation">]</span>$ ab <span class="token parameter variable">-c</span> <span class="token number">10</span> <span class="token parameter variable">-n</span> <span class="token number">10000</span> http://127.0.0.1:8088/neo/heap
This is ApacheBench, Version <span class="token number">2.3</span> <span class="token operator">&lt;</span><span class="token variable">$Revision</span><span class="token builtin class-name">:</span> <span class="token number">1879490</span> $<span class="token operator">></span>
Copyright <span class="token number">1996</span> Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/
Licensed to The Apache Software Foundation, http://www.apache.org/

Benchmarking <span class="token number">127.0</span>.0.1 <span class="token punctuation">(</span>be patient<span class="token punctuation">)</span>
Completed <span class="token number">1000</span> requests
Completed <span class="token number">2000</span> requests
Completed <span class="token number">3000</span> requests
Completed <span class="token number">4000</span> requests
Completed <span class="token number">5000</span> requests
Completed <span class="token number">6000</span> requests
Completed <span class="token number">7000</span> requests
Completed <span class="token number">8000</span> requests
Completed <span class="token number">9000</span> requests
Completed <span class="token number">10000</span> requests
Finished <span class="token number">10000</span> requests


Server Software:
Server Hostname:        <span class="token number">127.0</span>.0.1
Server Port:            <span class="token number">8088</span>

Document Path:          /neo/heap
Document Length:        <span class="token number">7</span> bytes

Concurrency Level:      <span class="token number">10</span>
Time taken <span class="token keyword">for</span> tests:   <span class="token number">14.078</span> seconds
Complete requests:      <span class="token number">10000</span>
Failed requests:        <span class="token number">0</span>
Total transferred:      <span class="token number">1390000</span> bytes
HTML transferred:       <span class="token number">70000</span> bytes
Requests per second:    <span class="token number">710.30</span> <span class="token punctuation">[</span><span class="token comment">#/sec] (mean)</span>
Time per request:       <span class="token number">14.078</span> <span class="token punctuation">[</span>ms<span class="token punctuation">]</span> <span class="token punctuation">(</span>mean<span class="token punctuation">)</span>
Time per request:       <span class="token number">1.408</span> <span class="token punctuation">[</span>ms<span class="token punctuation">]</span> <span class="token punctuation">(</span>mean, across all concurrent requests<span class="token punctuation">)</span>
Transfer rate:          <span class="token number">96.42</span> <span class="token punctuation">[</span>Kbytes/sec<span class="token punctuation">]</span> received

Connection Times <span class="token punctuation">(</span>ms<span class="token punctuation">)</span>
min  mean<span class="token punctuation">[</span>+/-sd<span class="token punctuation">]</span> median   max
Connect:        <span class="token number">0</span>    <span class="token number">4</span>   <span class="token number">4.3</span>      <span class="token number">4</span>     <span class="token number">271</span>
Processing:     <span class="token number">2</span>    <span class="token number">9</span>  <span class="token number">13.5</span>      <span class="token number">8</span>     <span class="token number">390</span>
Waiting:        <span class="token number">0</span>    <span class="token number">7</span>  <span class="token number">13.0</span>      <span class="token number">6</span>     <span class="token number">390</span>
Total:          <span class="token number">3</span>   <span class="token number">13</span>  <span class="token number">13.9</span>     <span class="token number">12</span>     <span class="token number">390</span>

Percentage of the requests served within a certain <span class="token function">time</span> <span class="token punctuation">(</span>ms<span class="token punctuation">)</span>
<span class="token number">50</span>%     <span class="token number">12</span>
<span class="token number">66</span>%     <span class="token number">13</span>
<span class="token number">75</span>%     <span class="token number">14</span>
<span class="token number">80</span>%     <span class="token number">15</span>
<span class="token number">90</span>%     <span class="token number">16</span>
<span class="token number">95</span>%     <span class="token number">19</span>
<span class="token number">98</span>%     <span class="token number">25</span>
<span class="token number">99</span>%     <span class="token number">39</span>
<span class="token number">100</span>%    <span class="token number">390</span> <span class="token punctuation">(</span>longest request<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>GC情况：<br><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>zyxelva@172-104-123-96 <span class="token number">10</span>:47:54 ~<span class="token punctuation">]</span>$ jstat <span class="token parameter variable">-gc</span> <span class="token number">1816</span> <span class="token number">5000</span> <span class="token number">20</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'&#123;print $13,$14,$15,$16,$17 &#125;'</span>
YGC YGCT FGC FGCT GCT
<span class="token number">79</span> <span class="token number">0.625</span> <span class="token number">3</span> <span class="token number">0.287</span> <span class="token number">0.912</span>
<span class="token number">80</span> <span class="token number">0.625</span> <span class="token number">3</span> <span class="token number">0.287</span> <span class="token number">0.912</span>
<span class="token number">111</span> <span class="token number">0.890</span> <span class="token number">3</span> <span class="token number">0.287</span> <span class="token number">1.177</span>
<span class="token number">139</span> <span class="token number">1.100</span> <span class="token number">3</span> <span class="token number">0.287</span> <span class="token number">1.387</span>
<span class="token number">141</span> <span class="token number">1.119</span> <span class="token number">3</span> <span class="token number">0.287</span> <span class="token number">1.406</span>
<span class="token number">141</span> <span class="token number">1.119</span> <span class="token number">3</span> <span class="token number">0.287</span> <span class="token number">1.406</span>
<span class="token number">141</span> <span class="token number">1.119</span> <span class="token number">3</span> <span class="token number">0.287</span> <span class="token number">1.406</span>
<span class="token number">141</span> <span class="token number">1.119</span> <span class="token number">3</span> <span class="token number">0.287</span> <span class="token number">1.406</span>
<span class="token number">141</span> <span class="token number">1.119</span> <span class="token number">3</span> <span class="token number">0.287</span> <span class="token number">1.406</span>
<span class="token number">141</span> <span class="token number">1.119</span> <span class="token number">3</span> <span class="token number">0.287</span> <span class="token number">1.406</span>
<span class="token number">141</span> <span class="token number">1.119</span> <span class="token number">3</span> <span class="token number">0.287</span> <span class="token number">1.406</span>
<span class="token number">141</span> <span class="token number">1.119</span> <span class="token number">3</span> <span class="token number">0.287</span> <span class="token number">1.406</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>测试结果显示：</p><ul><li>用户的吞吐量大于在710.3/秒左右</li><li>JVM服务器平均请求处理时间1.408ms左右</li><li>JVM服务器发生了141次YGC，耗时1.119秒，还有3次FGC，0.287秒左右，加在一起GC耗时1.406秒.<h5 id="3-1-2-4-2-100-个并发用户-1万请求量-总"><a href="#3-1-2-4-2-100-个并发用户-1万请求量-总" class="headerlink" title="3.1.2.4.2 100 个并发用户/1万请求量(总)"></a>3.1.2.4.2 100 个并发用户/1万请求量(总)</h5><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>zyxelva@Taeyeons-MacBook-Pro <span class="token number">10</span>:49:49 ~<span class="token punctuation">]</span>$ ab <span class="token parameter variable">-c</span> <span class="token number">100</span> <span class="token parameter variable">-n</span> <span class="token number">10000</span> http://127.0.0.1:8088/neo/heap
This is ApacheBench, Version <span class="token number">2.3</span> <span class="token operator">&lt;</span><span class="token variable">$Revision</span><span class="token builtin class-name">:</span> <span class="token number">1879490</span> $<span class="token operator">></span>
Copyright <span class="token number">1996</span> Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/
Licensed to The Apache Software Foundation, http://www.apache.org/

Benchmarking <span class="token number">127.0</span>.0.1 <span class="token punctuation">(</span>be patient<span class="token punctuation">)</span>
Completed <span class="token number">1000</span> requests
Completed <span class="token number">2000</span> requests
Completed <span class="token number">3000</span> requests
Completed <span class="token number">4000</span> requests
Completed <span class="token number">5000</span> requests
Completed <span class="token number">6000</span> requests
Completed <span class="token number">7000</span> requests
Completed <span class="token number">8000</span> requests
Completed <span class="token number">9000</span> requests
Completed <span class="token number">10000</span> requests
Finished <span class="token number">10000</span> requests


Server Software:
Server Hostname:        <span class="token number">127.0</span>.0.1
Server Port:            <span class="token number">8088</span>

Document Path:          /neo/heap
Document Length:        <span class="token number">7</span> bytes

Concurrency Level:      <span class="token number">100</span>
Time taken <span class="token keyword">for</span> tests:   <span class="token number">10.264</span> seconds
Complete requests:      <span class="token number">10000</span>
Failed requests:        <span class="token number">0</span>
Total transferred:      <span class="token number">1390000</span> bytes
HTML transferred:       <span class="token number">70000</span> bytes
Requests per second:    <span class="token number">974.30</span> <span class="token punctuation">[</span><span class="token comment">#/sec] (mean)</span>
Time per request:       <span class="token number">102.638</span> <span class="token punctuation">[</span>ms<span class="token punctuation">]</span> <span class="token punctuation">(</span>mean<span class="token punctuation">)</span>
Time per request:       <span class="token number">1.026</span> <span class="token punctuation">[</span>ms<span class="token punctuation">]</span> <span class="token punctuation">(</span>mean, across all concurrent requests<span class="token punctuation">)</span>
Transfer rate:          <span class="token number">132.25</span> <span class="token punctuation">[</span>Kbytes/sec<span class="token punctuation">]</span> received

Connection Times <span class="token punctuation">(</span>ms<span class="token punctuation">)</span>
              min  mean<span class="token punctuation">[</span>+/-sd<span class="token punctuation">]</span> median   max
Connect:        <span class="token number">0</span>   <span class="token number">36</span>  <span class="token number">18.4</span>     <span class="token number">37</span>     <span class="token number">194</span>
Processing:     <span class="token number">4</span>   <span class="token number">66</span>  <span class="token number">22.7</span>     <span class="token number">63</span>     <span class="token number">233</span>
Waiting:        <span class="token number">1</span>   <span class="token number">47</span>  <span class="token number">19.9</span>     <span class="token number">46</span>     <span class="token number">208</span>
Total:          <span class="token number">6</span>  <span class="token number">102</span>  <span class="token number">29.8</span>    <span class="token number">104</span>     <span class="token number">289</span>

Percentage of the requests served within a certain <span class="token function">time</span> <span class="token punctuation">(</span>ms<span class="token punctuation">)</span>
  <span class="token number">50</span>%    <span class="token number">104</span>
  <span class="token number">66</span>%    <span class="token number">113</span>
  <span class="token number">75</span>%    <span class="token number">118</span>
  <span class="token number">80</span>%    <span class="token number">120</span>
  <span class="token number">90</span>%    <span class="token number">130</span>
  <span class="token number">95</span>%    <span class="token number">144</span>
  <span class="token number">98</span>%    <span class="token number">161</span>
  <span class="token number">99</span>%    <span class="token number">212</span>
 <span class="token number">100</span>%    <span class="token number">289</span> <span class="token punctuation">(</span>longest request<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><p>GC情况：<br><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>zyxelva@172-104-123-96 <span class="token number">10</span>:49:41 ~<span class="token punctuation">]</span>$ jstat <span class="token parameter variable">-gc</span> <span class="token number">1816</span> <span class="token number">5000</span> <span class="token number">20</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'&#123;print $13,$14,$15,$16,$17 &#125;'</span>
YGC YGCT FGC FGCT GCT
<span class="token number">79</span>        <span class="token number">1.149</span>   <span class="token number">6</span>       <span class="token number">0.553</span>    <span class="token number">1.702</span>
<span class="token number">79</span>        <span class="token number">1.149</span>   <span class="token number">6</span>       <span class="token number">0.553</span>    <span class="token number">1.702</span>
<span class="token number">79</span>        <span class="token number">1.149</span>   <span class="token number">6</span>       <span class="token number">0.553</span>    <span class="token number">1.702</span>
<span class="token number">97</span>        <span class="token number">1.282</span>   <span class="token number">6</span>       <span class="token number">0.553</span>    <span class="token number">1.834</span>
<span class="token number">123</span>      <span class="token number">1.459</span>   <span class="token number">6</span>       <span class="token number">0.553</span>    <span class="token number">2.011</span>
<span class="token number">142</span>      <span class="token number">1.567</span>   <span class="token number">6</span>       <span class="token number">0.553</span>    <span class="token number">2.119</span>
<span class="token number">142</span>      <span class="token number">1.567</span>   <span class="token number">6</span>       <span class="token number">0.553</span>    <span class="token number">2.119</span>
<span class="token number">142</span>      <span class="token number">1.567</span>   <span class="token number">6</span>       <span class="token number">0.553</span>    <span class="token number">2.119</span>
<span class="token number">142</span>      <span class="token number">1.567</span>   <span class="token number">6</span>       <span class="token number">0.553</span>    <span class="token number">2.119</span>
<span class="token number">142</span>      <span class="token number">1.567</span>   <span class="token number">6</span>       <span class="token number">0.553</span>    <span class="token number">2.119</span>
<span class="token number">142</span>      <span class="token number">1.567</span>   <span class="token number">6</span>       <span class="token number">0.553</span>    <span class="token number">2.119</span>
<span class="token number">142</span>      <span class="token number">1.567</span>   <span class="token number">6</span>       <span class="token number">0.553</span>    <span class="token number">2.119</span>
<span class="token number">142</span>      <span class="token number">1.567</span>   <span class="token number">6</span>       <span class="token number">0.553</span>    <span class="token number">2.119</span>
<span class="token number">142</span>      <span class="token number">1.567</span>   <span class="token number">6</span>       <span class="token number">0.553</span>    <span class="token number">2.119</span>
<span class="token number">142</span>      <span class="token number">1.567</span>   <span class="token number">6</span>       <span class="token number">0.553</span>    <span class="token number">2.119</span>
<span class="token number">142</span>      <span class="token number">1.567</span>   <span class="token number">6</span>       <span class="token number">0.553</span>    <span class="token number">2.119</span>
<span class="token number">142</span>      <span class="token number">1.567</span>   <span class="token number">6</span>       <span class="token number">0.553</span>    <span class="token number">2.119</span>
<span class="token number">142</span>      <span class="token number">1.567</span>   <span class="token number">6</span>       <span class="token number">0.553</span>    <span class="token number">2.119</span>
<span class="token number">142</span>      <span class="token number">1.567</span>   <span class="token number">6</span>       <span class="token number">0.553</span>    <span class="token number">2.119</span>
<span class="token number">142</span>      <span class="token number">1.567</span>   <span class="token number">6</span>       <span class="token number">0.553</span>    <span class="token number">2.119</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>测试结果显示：</p><ul><li>用户的吞吐量大于在974.30/秒左右</li><li>JVM服务器平均请求处理时间1.026ms左右</li><li>JVM服务器发生了142多次YGC，耗时1.567秒，还有6次FGC，0.553秒左右，加在一起GC耗时2.12秒.</li></ul><h5 id="3-1-2-4-3-1000-个并发用户-1万请求量-总"><a href="#3-1-2-4-3-1000-个并发用户-1万请求量-总" class="headerlink" title="3.1.2.4.3 1000 个并发用户/1万请求量(总)"></a>3.1.2.4.3 1000 个并发用户/1万请求量(总)</h5><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>zyxelva@Taeyeons-MacBook-Pro <span class="token number">10</span>:49:49 ~<span class="token punctuation">]</span>$ ab <span class="token parameter variable">-c</span> <span class="token number">1000</span> <span class="token parameter variable">-n</span> <span class="token number">10000</span> http://127.0.0.1:8088/neo/heap
This is ApacheBench, Version <span class="token number">2.3</span> <span class="token operator">&lt;</span><span class="token variable">$Revision</span><span class="token builtin class-name">:</span> <span class="token number">1879490</span> $<span class="token operator">></span>
Copyright <span class="token number">1996</span> Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/
Licensed to The Apache Software Foundation, http://www.apache.org/

Benchmarking <span class="token number">127.0</span>.0.1 <span class="token punctuation">(</span>be patient<span class="token punctuation">)</span>
Completed <span class="token number">1000</span> requests
Completed <span class="token number">2000</span> requests
Completed <span class="token number">3000</span> requests
Completed <span class="token number">4000</span> requests
Completed <span class="token number">5000</span> requests
Completed <span class="token number">6000</span> requests
Completed <span class="token number">7000</span> requests
Completed <span class="token number">8000</span> requests
Completed <span class="token number">9000</span> requests
Completed <span class="token number">10000</span> requests
Finished <span class="token number">10000</span> requests


Server Software:
Server Hostname:        <span class="token number">127.0</span>.0.1
Server Port:            <span class="token number">8088</span>

Document Path:          /neo/heap
Document Length:        <span class="token number">7</span> bytes

Concurrency Level:      <span class="token number">1000</span>
Time taken <span class="token keyword">for</span> tests:   <span class="token number">8.364</span> seconds
Complete requests:      <span class="token number">10000</span>
Failed requests:        <span class="token number">0</span>
Total transferred:      <span class="token number">1390000</span> bytes
HTML transferred:       <span class="token number">70000</span> bytes
Requests per second:    <span class="token number">1262.37</span> <span class="token punctuation">[</span><span class="token comment">#/sec] (mean)</span>
Time per request:       <span class="token number">78.638</span> <span class="token punctuation">[</span>ms<span class="token punctuation">]</span> <span class="token punctuation">(</span>mean<span class="token punctuation">)</span>
Time per request:       <span class="token number">0.786</span> <span class="token punctuation">[</span>ms<span class="token punctuation">]</span> <span class="token punctuation">(</span>mean, across all concurrent requests<span class="token punctuation">)</span>
Transfer rate:          <span class="token number">169.25</span> <span class="token punctuation">[</span>Kbytes/sec<span class="token punctuation">]</span> received

Connection Times <span class="token punctuation">(</span>ms<span class="token punctuation">)</span>
                    min  mean<span class="token punctuation">[</span>+/-sd<span class="token punctuation">]</span> median   max
Connect:        <span class="token number">0</span>    <span class="token number">1</span>    <span class="token number">0.6</span>      <span class="token number">1</span>       <span class="token number">8</span>
Processing:    <span class="token number">1</span>    <span class="token number">78</span>  <span class="token number">85.0</span>    <span class="token number">53</span>     <span class="token number">1006</span>
Waiting:         <span class="token number">1</span>   <span class="token number">77</span>   <span class="token number">84.8</span>    <span class="token number">52</span>     <span class="token number">1005</span>
Total:             <span class="token number">1</span>   <span class="token number">79</span>   <span class="token number">85.0</span>    <span class="token number">54</span>     <span class="token number">1006</span>

Percentage of the requests served within a certain <span class="token function">time</span> <span class="token punctuation">(</span>ms<span class="token punctuation">)</span>
  <span class="token number">50</span>%    <span class="token number">54</span>
  <span class="token number">66</span>%    <span class="token number">69</span>
  <span class="token number">75</span>%    <span class="token number">83</span>
  <span class="token number">80</span>%    <span class="token number">95</span>
  <span class="token number">90</span>%    <span class="token number">152</span>
  <span class="token number">95</span>%    <span class="token number">260</span>
  <span class="token number">98</span>%    <span class="token number">386</span>
  <span class="token number">99</span>%    <span class="token number">458</span>
 <span class="token number">100</span>%   <span class="token number">1006</span> <span class="token punctuation">(</span>longest request<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="3-1-2-4-4-结果分析"><a href="#3-1-2-4-4-结果分析" class="headerlink" title="3.1.2.4.4 结果分析"></a>3.1.2.4.4 结果分析</h5><ul><li>GC 频率：高频的<code>Full GC</code>会给系统带来非常大的性能消耗，虽然<code>Minor GC</code>相对<code>Full GC</code>来说好了许多，但过多的<code>Minor GC</code>仍会给系统带来压力。</li><li>内存：这里的内存指的是<code>堆内存大小</code>，堆内存又分为<code>年轻代内存</code>和<code>老年代内存</code>。堆内存不足，会增加<code>Minor GC</code>，影响系统性能。</li><li>吞吐量：频繁的 GC 将会引起线程的上下文切换，增加系统的性能开销，从而影响每次处理的线程请求，最终导致系统的吞吐量下降。</li><li>延时：JVM 的 GC 持续时间也会影响到每次请求的响应时间。</li></ul><h3 id="3-1-3-调优方案"><a href="#3-1-3-调优方案" class="headerlink" title="3.1.3 调优方案"></a>3.1.3 调优方案</h3><h4 id="3-1-3-1-调整方案一"><a href="#3-1-3-1-调整方案一" class="headerlink" title="3.1.3.1 调整方案一"></a>3.1.3.1 调整方案一</h4><p><code>调整堆内存空间减少GC</code>，通过分析，堆内存基本被用完了，而且存在大量<code>Minor GC</code>和<code>Full GC</code>，这意味着我们的堆内存严重不足，这个时候我们需要调大堆内存空间。<br><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 堆空间加大到 3.0G</span>
<span class="token function">java</span> <span class="token parameter variable">-jar</span> <span class="token parameter variable">-Xms3000m</span> <span class="token parameter variable">-Xmx3000m</span> spring-boot-interview-api-gateway.jar<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p><h5 id="3-1-3-1-1-10-个并发用户-1万请求量-总"><a href="#3-1-3-1-1-10-个并发用户-1万请求量-总" class="headerlink" title="3.1.3.1.1 10 个并发用户/1万请求量(总)"></a>3.1.3.1.1 10 个并发用户/1万请求量(总)</h5><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>zyxelva@172-104-123-96 <span class="token number">14</span>:43:53 ~<span class="token punctuation">]</span>$ ab <span class="token parameter variable">-c</span> <span class="token number">10</span> <span class="token parameter variable">-n</span> <span class="token number">10000</span> http://127.0.0.1:8088/neo/heap
This is ApacheBench, Version <span class="token number">2.3</span> <span class="token operator">&lt;</span><span class="token variable">$Revision</span><span class="token builtin class-name">:</span> <span class="token number">1879490</span> $<span class="token operator">></span>
Copyright <span class="token number">1996</span> Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/
Licensed to The Apache Software Foundation, http://www.apache.org/

Benchmarking <span class="token number">127.0</span>.0.1 <span class="token punctuation">(</span>be patient<span class="token punctuation">)</span>
Completed <span class="token number">1000</span> requests
Completed <span class="token number">2000</span> requests
Completed <span class="token number">3000</span> requests
Completed <span class="token number">4000</span> requests
Completed <span class="token number">5000</span> requests
Completed <span class="token number">6000</span> requests
Completed <span class="token number">7000</span> requests
Completed <span class="token number">8000</span> requests
Completed <span class="token number">9000</span> requests
Completed <span class="token number">10000</span> requests
Finished <span class="token number">10000</span> requests


Server Software:
Server Hostname:        <span class="token number">127.0</span>.0.1
Server Port:            <span class="token number">8088</span>

Document Path:          /neo/heap
Document Length:        <span class="token number">7</span> bytes

Concurrency Level:      <span class="token number">10</span>
Time taken <span class="token keyword">for</span> tests:   <span class="token number">10.096</span> seconds
Complete requests:      <span class="token number">10000</span>
Failed requests:        <span class="token number">0</span>
Total transferred:      <span class="token number">1390000</span> bytes
HTML transferred:       <span class="token number">70000</span> bytes
Requests per second:    <span class="token number">990.53</span> <span class="token punctuation">[</span><span class="token comment">#/sec] (mean)</span>
Time per request:       <span class="token number">10.096</span> <span class="token punctuation">[</span>ms<span class="token punctuation">]</span> <span class="token punctuation">(</span>mean<span class="token punctuation">)</span>
Time per request:       <span class="token number">1.010</span> <span class="token punctuation">[</span>ms<span class="token punctuation">]</span> <span class="token punctuation">(</span>mean, across all concurrent requests<span class="token punctuation">)</span>
Transfer rate:          <span class="token number">134.46</span> <span class="token punctuation">[</span>Kbytes/sec<span class="token punctuation">]</span> received

Connection Times <span class="token punctuation">(</span>ms<span class="token punctuation">)</span>
              min  mean<span class="token punctuation">[</span>+/-sd<span class="token punctuation">]</span> median   max
Connect:        <span class="token number">0</span>    <span class="token number">3</span>   <span class="token number">3.4</span>      <span class="token number">3</span>     <span class="token number">213</span>
Processing:     <span class="token number">1</span>    <span class="token number">6</span>   <span class="token number">6.3</span>      <span class="token number">6</span>     <span class="token number">217</span>
Waiting:        <span class="token number">0</span>    <span class="token number">5</span>   <span class="token number">4.0</span>      <span class="token number">4</span>     <span class="token number">213</span>
Total:          <span class="token number">2</span>   <span class="token number">10</span>   <span class="token number">7.3</span>      <span class="token number">9</span>     <span class="token number">222</span>

Percentage of the requests served within a certain <span class="token function">time</span> <span class="token punctuation">(</span>ms<span class="token punctuation">)</span>
  <span class="token number">50</span>%      <span class="token number">9</span>
  <span class="token number">66</span>%     <span class="token number">10</span>
  <span class="token number">75</span>%     <span class="token number">11</span>
  <span class="token number">80</span>%     <span class="token number">12</span>
  <span class="token number">90</span>%     <span class="token number">13</span>
  <span class="token number">95</span>%     <span class="token number">14</span>
  <span class="token number">98</span>%     <span class="token number">16</span>
  <span class="token number">99</span>%     <span class="token number">18</span>
 <span class="token number">100</span>%    <span class="token number">222</span> <span class="token punctuation">(</span>longest request<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>GC情况：<br><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>zyxelva@172-104-123-96 <span class="token number">14</span>:43:48 ~<span class="token punctuation">]</span>$ jstat <span class="token parameter variable">-gc</span> <span class="token number">3757</span> <span class="token number">5000</span> <span class="token number">20</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'&#123;print $13,$14,$15,$16,$17 &#125;'</span>
YGC YGCT FGC FGCT GCT
<span class="token number">131</span> <span class="token number">1.011</span> <span class="token number">2</span> <span class="token number">0.111</span> <span class="token number">1.122</span>
<span class="token number">139</span> <span class="token number">1.049</span> <span class="token number">2</span> <span class="token number">0.111</span> <span class="token number">1.160</span>
<span class="token number">161</span> <span class="token number">1.152</span> <span class="token number">2</span> <span class="token number">0.111</span> <span class="token number">1.263</span>
<span class="token number">173</span> <span class="token number">1.219</span> <span class="token number">2</span> <span class="token number">0.111</span> <span class="token number">1.330</span>
<span class="token number">173</span> <span class="token number">1.219</span> <span class="token number">2</span> <span class="token number">0.111</span> <span class="token number">1.330</span>
<span class="token number">173</span> <span class="token number">1.219</span> <span class="token number">2</span> <span class="token number">0.111</span> <span class="token number">1.330</span>
<span class="token number">173</span> <span class="token number">1.219</span> <span class="token number">2</span> <span class="token number">0.111</span> <span class="token number">1.330</span>
<span class="token number">173</span> <span class="token number">1.219</span> <span class="token number">2</span> <span class="token number">0.111</span> <span class="token number">1.330</span>
<span class="token number">173</span> <span class="token number">1.219</span> <span class="token number">2</span> <span class="token number">0.111</span> <span class="token number">1.330</span>
<span class="token number">173</span> <span class="token number">1.219</span> <span class="token number">2</span> <span class="token number">0.111</span> <span class="token number">1.330</span>
<span class="token number">173</span> <span class="token number">1.219</span> <span class="token number">2</span> <span class="token number">0.111</span> <span class="token number">1.330</span>
<span class="token number">173</span> <span class="token number">1.219</span> <span class="token number">2</span> <span class="token number">0.111</span> <span class="token number">1.330</span>
<span class="token number">173</span> <span class="token number">1.219</span> <span class="token number">2</span> <span class="token number">0.111</span> <span class="token number">1.330</span>
<span class="token number">173</span> <span class="token number">1.219</span> <span class="token number">2</span> <span class="token number">0.111</span> <span class="token number">1.330</span>
<span class="token number">173</span> <span class="token number">1.219</span> <span class="token number">2</span> <span class="token number">0.111</span> <span class="token number">1.330</span>
<span class="token number">173</span> <span class="token number">1.219</span> <span class="token number">2</span> <span class="token number">0.111</span> <span class="token number">1.330</span>
<span class="token number">173</span> <span class="token number">1.219</span> <span class="token number">2</span> <span class="token number">0.111</span> <span class="token number">1.330</span>
<span class="token number">173</span> <span class="token number">1.219</span> <span class="token number">2</span> <span class="token number">0.111</span> <span class="token number">1.330</span>
<span class="token number">173</span> <span class="token number">1.219</span> <span class="token number">2</span> <span class="token number">0.111</span> <span class="token number">1.330</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>测试结果显示：</p><ul><li>用户的吞吐量大于在990.53/秒左右</li><li>JVM服务器平均请求处理时间1.010ms左右</li><li>JVM服务器发生了173次YGC，耗时1.219秒，还有2次FGC，0.111秒左右，加在一起GC耗时1.33秒.<h5 id="3-1-3-1-2-100-个并发用户-1万请求量-总"><a href="#3-1-3-1-2-100-个并发用户-1万请求量-总" class="headerlink" title="3.1.3.1.2 100 个并发用户/1万请求量(总)"></a>3.1.3.1.2 100 个并发用户/1万请求量(总)</h5><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>zyxelva@172-104-123-96 <span class="token number">14</span>:19:07 ~<span class="token punctuation">]</span>$ ab <span class="token parameter variable">-c</span> <span class="token number">100</span> <span class="token parameter variable">-n</span> <span class="token number">10000</span> http://127.0.0.1:8088/neo/heap
This is ApacheBench, Version <span class="token number">2.3</span> <span class="token operator">&lt;</span><span class="token variable">$Revision</span><span class="token builtin class-name">:</span> <span class="token number">1879490</span> $<span class="token operator">></span>
Copyright <span class="token number">1996</span> Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/
Licensed to The Apache Software Foundation, http://www.apache.org/

Benchmarking <span class="token number">127.0</span>.0.1 <span class="token punctuation">(</span>be patient<span class="token punctuation">)</span>
Completed <span class="token number">1000</span> requests
Completed <span class="token number">2000</span> requests
Completed <span class="token number">3000</span> requests
Completed <span class="token number">4000</span> requests
Completed <span class="token number">5000</span> requests
Completed <span class="token number">6000</span> requests
Completed <span class="token number">7000</span> requests
Completed <span class="token number">8000</span> requests
Completed <span class="token number">9000</span> requests
Completed <span class="token number">10000</span> requests
Finished <span class="token number">10000</span> requests


Server Software:
Server Hostname:        <span class="token number">127.0</span>.0.1
Server Port:            <span class="token number">8088</span>

Document Path:          /neo/heap
Document Length:        <span class="token number">7</span> bytes

Concurrency Level:      <span class="token number">100</span>
Time taken <span class="token keyword">for</span> tests:   <span class="token number">13.893</span> seconds
Complete requests:      <span class="token number">10000</span>
Failed requests:        <span class="token number">0</span>
Total transferred:      <span class="token number">1390000</span> bytes
HTML transferred:       <span class="token number">70000</span> bytes
Requests per second:    <span class="token number">719.80</span> <span class="token punctuation">[</span><span class="token comment">#/sec] (mean)</span>
Time per request:       <span class="token number">138.927</span> <span class="token punctuation">[</span>ms<span class="token punctuation">]</span> <span class="token punctuation">(</span>mean<span class="token punctuation">)</span>
Time per request:       <span class="token number">1.389</span> <span class="token punctuation">[</span>ms<span class="token punctuation">]</span> <span class="token punctuation">(</span>mean, across all concurrent requests<span class="token punctuation">)</span>
Transfer rate:          <span class="token number">97.71</span> <span class="token punctuation">[</span>Kbytes/sec<span class="token punctuation">]</span> received

Connection Times <span class="token punctuation">(</span>ms<span class="token punctuation">)</span>
                    min  mean<span class="token punctuation">[</span>+/-sd<span class="token punctuation">]</span> median   max
Connect:        <span class="token number">0</span>   <span class="token number">44</span>  <span class="token number">24.3</span>     <span class="token number">46</span>     <span class="token number">211</span>
Processing:    <span class="token number">4</span>   <span class="token number">93</span>  <span class="token number">45.9</span>     <span class="token number">84</span>     <span class="token number">479</span>
Waiting:        <span class="token number">1</span>   <span class="token number">67</span>  <span class="token number">43.6</span>     <span class="token number">60</span>     <span class="token number">477</span>
Total:            <span class="token number">5</span>  <span class="token number">137</span>  <span class="token number">44.5</span>    <span class="token number">130</span>     <span class="token number">481</span>

Percentage of the requests served within a certain <span class="token function">time</span> <span class="token punctuation">(</span>ms<span class="token punctuation">)</span>
  <span class="token number">50</span>%    <span class="token number">130</span>
  <span class="token number">66</span>%    <span class="token number">142</span>
  <span class="token number">75</span>%    <span class="token number">150</span>
  <span class="token number">80</span>%    <span class="token number">154</span>
  <span class="token number">90</span>%    <span class="token number">176</span>
  <span class="token number">95</span>%    <span class="token number">200</span>
  <span class="token number">98</span>%    <span class="token number">282</span>
  <span class="token number">99</span>%    <span class="token number">348</span>
 <span class="token number">100</span>%    <span class="token number">481</span> <span class="token punctuation">(</span>longest request<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><p>GC情况：<br><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>zyxelva@172-104-123-96 <span class="token number">14</span>:20:18 ~<span class="token punctuation">]</span>$ jstat <span class="token parameter variable">-gc</span> <span class="token number">3757</span> <span class="token number">5000</span> <span class="token number">20</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'&#123;print $13,$14,$15,$16,$17 &#125;'</span>
YGC YGCT FGC FGCT GCT
<span class="token number">2</span>           <span class="token number">0.026</span>   <span class="token number">2</span>     <span class="token number">0.111</span> <span class="token number">0.137</span>
<span class="token number">2</span>           <span class="token number">0.026</span>   <span class="token number">2</span>     <span class="token number">0.111</span> <span class="token number">0.137</span>
<span class="token number">20</span>         <span class="token number">0.436</span>   <span class="token number">2</span>     <span class="token number">0.111</span> <span class="token number">0.547</span>
<span class="token number">37</span>         <span class="token number">0.568</span>   <span class="token number">2</span>     <span class="token number">0.111</span> <span class="token number">0.679</span>
<span class="token number">47</span>         <span class="token number">0.622</span>   <span class="token number">2</span>     <span class="token number">0.111</span> <span class="token number">0.733</span>
<span class="token number">47</span>         <span class="token number">0.622</span>   <span class="token number">2</span>     <span class="token number">0.111</span> <span class="token number">0.733</span>
<span class="token number">47</span>         <span class="token number">0.622</span>   <span class="token number">2</span>     <span class="token number">0.111</span> <span class="token number">0.733</span>
<span class="token number">47</span>         <span class="token number">0.622</span>   <span class="token number">2</span>     <span class="token number">0.111</span> <span class="token number">0.733</span>
<span class="token number">47</span>         <span class="token number">0.622</span>   <span class="token number">2</span>     <span class="token number">0.111</span> <span class="token number">0.733</span>
<span class="token number">47</span>         <span class="token number">0.622</span>   <span class="token number">2</span>     <span class="token number">0.111</span> <span class="token number">0.733</span>
<span class="token number">47</span>         <span class="token number">0.622</span>   <span class="token number">2</span>     <span class="token number">0.111</span> <span class="token number">0.733</span>
<span class="token number">47</span>         <span class="token number">0.622</span>   <span class="token number">2</span>     <span class="token number">0.111</span> <span class="token number">0.733</span>
<span class="token number">47</span>         <span class="token number">0.622</span>   <span class="token number">2</span>     <span class="token number">0.111</span> <span class="token number">0.733</span>
<span class="token number">47</span>         <span class="token number">0.622</span>   <span class="token number">2</span>     <span class="token number">0.111</span> <span class="token number">0.733</span>
<span class="token number">47</span>         <span class="token number">0.622</span>   <span class="token number">2</span>     <span class="token number">0.111</span> <span class="token number">0.733</span>
<span class="token number">47</span>         <span class="token number">0.622</span>   <span class="token number">2</span>     <span class="token number">0.111</span> <span class="token number">0.733</span>
<span class="token number">47</span>         <span class="token number">0.622</span>   <span class="token number">2</span>     <span class="token number">0.111</span> <span class="token number">0.733</span>
<span class="token number">47</span>         <span class="token number">0.622</span>   <span class="token number">2</span>     <span class="token number">0.111</span> <span class="token number">0.733</span>
<span class="token number">47</span>         <span class="token number">0.622</span>   <span class="token number">2</span>     <span class="token number">0.111</span> <span class="token number">0.733</span>
<span class="token number">47</span>         <span class="token number">0.622</span>   <span class="token number">2</span>     <span class="token number">0.111</span> <span class="token number">0.733</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>测试结果显示：</p><ul><li>用户的吞吐量大于在719.8/秒左右</li><li>JVM服务器平均请求处理时间1.389ms左右</li><li>JVM服务器发生了47多次YGC，耗时1.622秒，还有2次FGC，0.111秒左右，加在一起GC耗时0.733秒.<h5 id="3-1-3-1-3-1000-个并发用户-1万请求量-总"><a href="#3-1-3-1-3-1000-个并发用户-1万请求量-总" class="headerlink" title="3.1.3.1.3 1000 个并发用户/1万请求量(总)"></a>3.1.3.1.3 1000 个并发用户/1万请求量(总)</h5></li></ul><h4 id="3-1-3-2-调整方案二"><a href="#3-1-3-2-调整方案二" class="headerlink" title="3.1.3.2 调整方案二"></a>3.1.3.2 调整方案二</h4><p>增大新生代比例，新生代内部比例：8:1:1<br><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">java</span> <span class="token parameter variable">-jar</span> <span class="token parameter variable">-Xms3000m</span> <span class="token parameter variable">-Xmx3000m</span> <span class="token parameter variable">-Xmn2000m</span> <span class="token parameter variable">-XX:SurvivorRatio</span><span class="token operator">=</span><span class="token number">8</span> spring-boot-interview-api-gateway.jar<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><h5 id="3-1-3-2-1-10-个并发用户-1万请求量-总"><a href="#3-1-3-2-1-10-个并发用户-1万请求量-总" class="headerlink" title="3.1.3.2.1 10 个并发用户/1万请求量(总)"></a>3.1.3.2.1 10 个并发用户/1万请求量(总)</h5><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>zyxelva@172-104-123-96 <span class="token number">15</span>:01:53 ~<span class="token punctuation">]</span>$ ab <span class="token parameter variable">-c</span> <span class="token number">10</span> <span class="token parameter variable">-n</span> <span class="token number">10000</span> http://127.0.0.1:8088/neo/heap
This is ApacheBench, Version <span class="token number">2.3</span> <span class="token operator">&lt;</span><span class="token variable">$Revision</span><span class="token builtin class-name">:</span> <span class="token number">1879490</span> $<span class="token operator">></span>
Copyright <span class="token number">1996</span> Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/
Licensed to The Apache Software Foundation, http://www.apache.org/

Benchmarking <span class="token number">127.0</span>.0.1 <span class="token punctuation">(</span>be patient<span class="token punctuation">)</span>
Completed <span class="token number">1000</span> requests
Completed <span class="token number">2000</span> requests
Completed <span class="token number">3000</span> requests
Completed <span class="token number">4000</span> requests
Completed <span class="token number">5000</span> requests
Completed <span class="token number">6000</span> requests
Completed <span class="token number">7000</span> requests
Completed <span class="token number">8000</span> requests
Completed <span class="token number">9000</span> requests
Completed <span class="token number">10000</span> requests
Finished <span class="token number">10000</span> requests


Server Software:
Server Hostname:        <span class="token number">127.0</span>.0.1
Server Port:            <span class="token number">8088</span>

Document Path:          /neo/heap
Document Length:        <span class="token number">7</span> bytes

Concurrency Level:      <span class="token number">10</span>
Time taken <span class="token keyword">for</span> tests:   <span class="token number">13.771</span> seconds
Complete requests:      <span class="token number">10000</span>
Failed requests:        <span class="token number">0</span>
Total transferred:      <span class="token number">1390000</span> bytes
HTML transferred:       <span class="token number">70000</span> bytes
Requests per second:    <span class="token number">726.15</span> <span class="token punctuation">[</span><span class="token comment">#/sec] (mean)</span>
Time per request:       <span class="token number">13.771</span> <span class="token punctuation">[</span>ms<span class="token punctuation">]</span> <span class="token punctuation">(</span>mean<span class="token punctuation">)</span>
Time per request:       <span class="token number">1.377</span> <span class="token punctuation">[</span>ms<span class="token punctuation">]</span> <span class="token punctuation">(</span>mean, across all concurrent requests<span class="token punctuation">)</span>
Transfer rate:          <span class="token number">98.57</span> <span class="token punctuation">[</span>Kbytes/sec<span class="token punctuation">]</span> received

Connection Times <span class="token punctuation">(</span>ms<span class="token punctuation">)</span>
              min  mean<span class="token punctuation">[</span>+/-sd<span class="token punctuation">]</span> median   max
Connect:        <span class="token number">0</span>    <span class="token number">4</span>   <span class="token number">4.4</span>      <span class="token number">4</span>     <span class="token number">277</span>
Processing:     <span class="token number">1</span>    <span class="token number">9</span>  <span class="token number">15.1</span>      <span class="token number">7</span>     <span class="token number">281</span>
Waiting:        <span class="token number">0</span>    <span class="token number">7</span>  <span class="token number">15.2</span>      <span class="token number">5</span>     <span class="token number">277</span>
Total:          <span class="token number">2</span>   <span class="token number">13</span>  <span class="token number">15.3</span>     <span class="token number">11</span>     <span class="token number">285</span>

Percentage of the requests served within a certain <span class="token function">time</span> <span class="token punctuation">(</span>ms<span class="token punctuation">)</span>
  <span class="token number">50</span>%     <span class="token number">11</span>
  <span class="token number">66</span>%     <span class="token number">12</span>
  <span class="token number">75</span>%     <span class="token number">13</span>
  <span class="token number">80</span>%     <span class="token number">13</span>
  <span class="token number">90</span>%     <span class="token number">15</span>
  <span class="token number">95</span>%     <span class="token number">19</span>
  <span class="token number">98</span>%     <span class="token number">42</span>
  <span class="token number">99</span>%     <span class="token number">73</span>
 <span class="token number">100</span>%    <span class="token number">285</span> <span class="token punctuation">(</span>longest request<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>GC情况：<br><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>zyxelva@172-104-123-96 <span class="token number">15</span>:03:07 ~<span class="token punctuation">]</span>$ jstat <span class="token parameter variable">-gc</span> <span class="token number">4057</span> <span class="token number">5000</span> <span class="token number">20</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'&#123;print $13,$14,$15,$16,$17 &#125;'</span>
YGC YGCT FGC FGCT GCT
<span class="token number">24</span> <span class="token number">0.534</span> <span class="token number">2</span> <span class="token number">0.122</span> <span class="token number">0.656</span>
<span class="token number">25</span> <span class="token number">0.556</span> <span class="token number">2</span> <span class="token number">0.122</span> <span class="token number">0.678</span>
<span class="token number">34</span> <span class="token number">0.615</span> <span class="token number">2</span> <span class="token number">0.122</span> <span class="token number">0.737</span>
<span class="token number">42</span> <span class="token number">0.662</span> <span class="token number">2</span> <span class="token number">0.122</span> <span class="token number">0.785</span>
<span class="token number">44</span> <span class="token number">0.675</span> <span class="token number">2</span> <span class="token number">0.122</span> <span class="token number">0.797</span>
<span class="token number">44</span> <span class="token number">0.675</span> <span class="token number">2</span> <span class="token number">0.122</span> <span class="token number">0.797</span>
<span class="token number">44</span> <span class="token number">0.675</span> <span class="token number">2</span> <span class="token number">0.122</span> <span class="token number">0.797</span>
<span class="token number">44</span> <span class="token number">0.675</span> <span class="token number">2</span> <span class="token number">0.122</span> <span class="token number">0.797</span>
<span class="token number">44</span> <span class="token number">0.675</span> <span class="token number">2</span> <span class="token number">0.122</span> <span class="token number">0.797</span>
<span class="token number">44</span> <span class="token number">0.675</span> <span class="token number">2</span> <span class="token number">0.122</span> <span class="token number">0.797</span>
<span class="token number">44</span> <span class="token number">0.675</span> <span class="token number">2</span> <span class="token number">0.122</span> <span class="token number">0.797</span>
<span class="token number">44</span> <span class="token number">0.675</span> <span class="token number">2</span> <span class="token number">0.122</span> <span class="token number">0.797</span>
<span class="token number">44</span> <span class="token number">0.675</span> <span class="token number">2</span> <span class="token number">0.122</span> <span class="token number">0.797</span>
<span class="token number">44</span> <span class="token number">0.675</span> <span class="token number">2</span> <span class="token number">0.122</span> <span class="token number">0.797</span>
<span class="token number">44</span> <span class="token number">0.675</span> <span class="token number">2</span> <span class="token number">0.122</span> <span class="token number">0.797</span>
<span class="token number">44</span> <span class="token number">0.675</span> <span class="token number">2</span> <span class="token number">0.122</span> <span class="token number">0.797</span>
<span class="token number">44</span> <span class="token number">0.675</span> <span class="token number">2</span> <span class="token number">0.122</span> <span class="token number">0.797</span>
<span class="token number">44</span> <span class="token number">0.675</span> <span class="token number">2</span> <span class="token number">0.122</span> <span class="token number">0.797</span>
<span class="token number">44</span> <span class="token number">0.675</span> <span class="token number">2</span> <span class="token number">0.122</span> <span class="token number">0.797</span>
<span class="token number">44</span> <span class="token number">0.675</span> <span class="token number">2</span> <span class="token number">0.122</span> <span class="token number">0.797</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>测试结果显示：</p><ul><li>用户的吞吐量大于在726.15/秒左右</li><li>JVM服务器平均请求处理时间1.377ms左右</li><li>JVM服务器发生了44次YGC，耗时0.675秒，还有2次FGC，0.122秒左右，加在一起GC耗时0.8秒.</li></ul><h5 id="3-1-3-2-2-100-个并发用户-1万请求量-总"><a href="#3-1-3-2-2-100-个并发用户-1万请求量-总" class="headerlink" title="3.1.3.2.2 100 个并发用户/1万请求量(总)"></a>3.1.3.2.2 100 个并发用户/1万请求量(总)</h5><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>zyxelva@172-104-123-96 <span class="token number">15</span>:13:11 ~<span class="token punctuation">]</span>$ ab <span class="token parameter variable">-c</span> <span class="token number">100</span> <span class="token parameter variable">-n</span> <span class="token number">10000</span> http://127.0.0.1:8088/neo/heapThis is ApacheBench, Version <span class="token number">2.3</span> <span class="token operator">&lt;</span><span class="token variable">$Revision</span><span class="token builtin class-name">:</span> <span class="token number">1879490</span> $<span class="token operator">></span>
Copyright <span class="token number">1996</span> Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/
Licensed to The Apache Software Foundation, http://www.apache.org/

Benchmarking <span class="token number">127.0</span>.0.1 <span class="token punctuation">(</span>be patient<span class="token punctuation">)</span>
Completed <span class="token number">1000</span> requests
Completed <span class="token number">2000</span> requests
Completed <span class="token number">3000</span> requests
Completed <span class="token number">4000</span> requests
Completed <span class="token number">5000</span> requests
Completed <span class="token number">6000</span> requests
Completed <span class="token number">7000</span> requests
Completed <span class="token number">8000</span> requests
Completed <span class="token number">9000</span> requests
Completed <span class="token number">10000</span> requests
Finished <span class="token number">10000</span> requests


Server Software:
Server Hostname:        <span class="token number">127.0</span>.0.1
Server Port:            <span class="token number">8088</span>

Document Path:          /neo/heap
Document Length:        <span class="token number">7</span> bytes

Concurrency Level:      <span class="token number">100</span>
Time taken <span class="token keyword">for</span> tests:   <span class="token number">13.431</span> seconds
Complete requests:      <span class="token number">10000</span>
Failed requests:        <span class="token number">0</span>
Total transferred:      <span class="token number">1390000</span> bytes
HTML transferred:       <span class="token number">70000</span> bytes
Requests per second:    <span class="token number">744.56</span> <span class="token punctuation">[</span><span class="token comment">#/sec] (mean)</span>
Time per request:       <span class="token number">134.308</span> <span class="token punctuation">[</span>ms<span class="token punctuation">]</span> <span class="token punctuation">(</span>mean<span class="token punctuation">)</span>
Time per request:       <span class="token number">1.343</span> <span class="token punctuation">[</span>ms<span class="token punctuation">]</span> <span class="token punctuation">(</span>mean, across all concurrent requests<span class="token punctuation">)</span>
Transfer rate:          <span class="token number">101.07</span> <span class="token punctuation">[</span>Kbytes/sec<span class="token punctuation">]</span> received

Connection Times <span class="token punctuation">(</span>ms<span class="token punctuation">)</span>
              min  mean<span class="token punctuation">[</span>+/-sd<span class="token punctuation">]</span> median   max
Connect:        <span class="token number">0</span>   <span class="token number">35</span>  <span class="token number">18.4</span>     <span class="token number">36</span>     <span class="token number">119</span>
Processing:     <span class="token number">4</span>   <span class="token number">98</span> <span class="token number">202.7</span>     <span class="token number">58</span>    <span class="token number">2008</span>
Waiting:        <span class="token number">1</span>   <span class="token number">81</span> <span class="token number">203.3</span>     <span class="token number">44</span>    <span class="token number">1976</span>
Total:          <span class="token number">7</span>  <span class="token number">133</span> <span class="token number">201.7</span>     <span class="token number">98</span>    <span class="token number">2059</span>

Percentage of the requests served within a certain <span class="token function">time</span> <span class="token punctuation">(</span>ms<span class="token punctuation">)</span>
  <span class="token number">50</span>%     <span class="token number">98</span>
  <span class="token number">66</span>%    <span class="token number">116</span>
  <span class="token number">75</span>%    <span class="token number">132</span>
  <span class="token number">80</span>%    <span class="token number">140</span>
  <span class="token number">90</span>%    <span class="token number">163</span>
  <span class="token number">95</span>%    <span class="token number">186</span>
  <span class="token number">98</span>%    <span class="token number">787</span>
  <span class="token number">99</span>%   <span class="token number">1667</span>
 <span class="token number">100</span>%   <span class="token number">2059</span> <span class="token punctuation">(</span>longest request<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>GC情况：<br><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>zyxelva@172-104-123-96 <span class="token number">15</span>:14:38 ~<span class="token punctuation">]</span>$ jstat <span class="token parameter variable">-gc</span> <span class="token number">4057</span> <span class="token number">5000</span> <span class="token number">20</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'&#123;print $13,$14,$15,$16,$17 &#125;'</span>
YGC YGCT FGC FGCT GCT
<span class="token number">130</span> <span class="token number">10.348</span> <span class="token number">2</span> <span class="token number">0.122</span> <span class="token number">10.470</span>
<span class="token number">131</span> <span class="token number">10.348</span> <span class="token number">2</span> <span class="token number">0.122</span> <span class="token number">10.470</span>
<span class="token number">136</span> <span class="token number">11.977</span> <span class="token number">3</span> <span class="token number">0.976</span> <span class="token number">12.953</span>
<span class="token number">147</span> <span class="token number">12.923</span> <span class="token number">3</span> <span class="token number">0.976</span> <span class="token number">13.900</span>
<span class="token number">151</span> <span class="token number">13.261</span> <span class="token number">3</span> <span class="token number">0.976</span> <span class="token number">14.237</span>
<span class="token number">151</span> <span class="token number">13.261</span> <span class="token number">3</span> <span class="token number">0.976</span> <span class="token number">14.237</span>
<span class="token number">151</span> <span class="token number">13.261</span> <span class="token number">3</span> <span class="token number">0.976</span> <span class="token number">14.237</span>
<span class="token number">151</span> <span class="token number">13.261</span> <span class="token number">3</span> <span class="token number">0.976</span> <span class="token number">14.237</span>
<span class="token number">151</span> <span class="token number">13.261</span> <span class="token number">3</span> <span class="token number">0.976</span> <span class="token number">14.237</span>
<span class="token number">151</span> <span class="token number">13.261</span> <span class="token number">3</span> <span class="token number">0.976</span> <span class="token number">14.237</span>
<span class="token number">151</span> <span class="token number">13.261</span> <span class="token number">3</span> <span class="token number">0.976</span> <span class="token number">14.237</span>
<span class="token number">151</span> <span class="token number">13.261</span> <span class="token number">3</span> <span class="token number">0.976</span> <span class="token number">14.237</span>
<span class="token number">151</span> <span class="token number">13.261</span> <span class="token number">3</span> <span class="token number">0.976</span> <span class="token number">14.237</span>
<span class="token number">151</span> <span class="token number">13.261</span> <span class="token number">3</span> <span class="token number">0.976</span> <span class="token number">14.237</span>
<span class="token number">151</span> <span class="token number">13.261</span> <span class="token number">3</span> <span class="token number">0.976</span> <span class="token number">14.237</span>
<span class="token number">151</span> <span class="token number">13.261</span> <span class="token number">3</span> <span class="token number">0.976</span> <span class="token number">14.237</span>
<span class="token number">151</span> <span class="token number">13.261</span> <span class="token number">3</span> <span class="token number">0.976</span> <span class="token number">14.237</span>
<span class="token number">151</span> <span class="token number">13.261</span> <span class="token number">3</span> <span class="token number">0.976</span> <span class="token number">14.237</span>
<span class="token number">151</span> <span class="token number">13.261</span> <span class="token number">3</span> <span class="token number">0.976</span> <span class="token number">14.237</span>
<span class="token number">151</span> <span class="token number">13.261</span> <span class="token number">3</span> <span class="token number">0.976</span> <span class="token number">14.237</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><br>测试结果显示：</p><ul><li>用户的吞吐量大于在744.56/秒左右</li><li>JVM服务器平均请求处理时间1.343ms左右</li><li>JVM服务器发生了151次YGC，耗时13.261秒，还有3次FGC，0.976秒左右，加在一起GC耗时14.237秒.</li></ul><h3 id="3-1-4-总结"><a href="#3-1-4-总结" class="headerlink" title="3.1.4 总结"></a>3.1.4 总结</h3><p>本次测试只能做个参考，让大家理解下平时开发人员是怎样用AB来进行压测的，其他工具还有jmeter；另外，由于本机为笔记本，性能着实有限，实际开发过程中，应该利用单独的测试机，尽可能地避免其他因素干扰。这样做出来的结果才值得参考。</p><p>这里给出之前上课时，老师给的结果，他的机子比较牛，测试的是10万请求。仅供参考！</p><table border="0" cellpadding="0" cellspacing="0" width="674" style="border-collapse:collapse;table-layout:fixed;width:505pt"><colgroup><col width="136" style="mso-width-source:userset;mso-width-alt:4352;width:102pt"><col width="87" style="mso-width-source:userset;mso-width-alt:2773;width:65pt"><col width="143" style="mso-width-source:userset;mso-width-alt:4565;width:107pt"><col width="151" style="mso-width-source:userset;mso-width-alt:4821;width:113pt"><col width="157" style="mso-width-source:userset;mso-width-alt:5034;width:118pt"><tr height="52" style="height:39pt"><td height="52" class="xl65" width="136" style="height:39pt;width:102pt">VM参数配置</td><td class="xl65" width="87" style="border-left:none;width:65pt">性能指标</td><td class="xl65" width="143" style="border-left:none;width:143pt">10 个并发/10万总请求</td><td class="xl65" width="151" style="border-left:none;width:151pt">100 个并发/10万总请求</td><td class="xl65" width="157" style="border-left:none;width:157pt">1000 个并发/10万总请求</td></tr><tr height="35" style="height:26pt"><td rowspan="3" height="122" class="xl66" width="136" style="height:91pt;border-top:none;width:102pt">默认:<br>最大堆内存为 480MB，<br>初始化大小为 32MB。<br>Eden 区 103m<br>From、To 3~4M<br>OLd =18</td><td class="xl66" width="87" style="border-top:none;border-left:none;width:65pt">吞吐量<br></td><td class="xl66" width="143" style="border-top:none;border-left:none;width:107pt">1426/s<br></td><td class="xl66" width="151" style="border-top:none;border-left:none;width:113pt">1262/s<br></td><td class="xl66" width="157" style="border-top:none;border-left:none;width:118pt">1145/s<br></td></tr><tr height="52" style="height:39pt"><td height="52" class="xl66" width="87" style="height:39pt;border-top:none;border-left:none;width:65pt">平均处理时间<br></td><td class="xl66" width="143" style="border-top:none;border-left:none;width:107pt">0.7ms<br></td><td class="xl66" width="151" style="border-top:none;border-left:none;width:113pt">0.8ms<br></td><td class="xl66" width="157" style="border-top:none;border-left:none;width:118pt">0.8ms<br></td></tr><tr height="35" style="height:26pt"><td height="35" class="xl66" width="87" style="height:26pt;border-top:none;border-left:none;width:65pt">GC 耗时<br></td><td class="xl66" width="143" style="border-top:none;border-left:none;width:107pt">17s<br></td><td class="xl66" width="151" style="border-top:none;border-left:none;width:113pt">33s<br></td><td class="xl66" width="157" style="border-top:none;border-left:none;width:118pt">42s<br></td></tr><tr height="35" style="height:26pt"><td rowspan="3" height="122" class="xl66" width="136" style="height:91pt;border-top:none;width:102pt">最大堆内存为 1.5G，<br>初始化大小为 1.5G<br>Eden 区 375m<br>From、To 62M<br>OLd =1000M</td><td class="xl66" width="87" style="border-top:none;border-left:none;width:65pt">吞吐量<br></td><td class="xl66" width="143" style="border-top:none;border-left:none;width:107pt">1205/s<br></td><td class="xl66" width="151" style="border-top:none;border-left:none;width:113pt">989/s<br></td><td class="xl66" width="157" style="border-top:none;border-left:none;width:118pt">749/s<br></td></tr><tr height="52" style="height:39pt"><td height="52" class="xl66" width="87" style="height:39pt;border-top:none;border-left:none;width:65pt">平均处理时间<br></td><td class="xl66" width="143" style="border-top:none;border-left:none;width:107pt">0.83ms<br></td><td class="xl66" width="151" style="border-top:none;border-left:none;width:113pt">1.01ms<br></td><td class="xl66" width="157" style="border-top:none;border-left:none;width:118pt">1.3ms<br></td></tr><tr height="35" style="height:26pt"><td height="35" class="xl66" width="87" style="height:26pt;border-top:none;border-left:none;width:65pt">GC 耗时<br></td><td class="xl66" width="143" style="border-top:none;border-left:none;width:107pt">34s<br></td><td class="xl66" width="151" style="border-top:none;border-left:none;width:113pt">52s<br></td><td class="xl66" width="157" style="border-top:none;border-left:none;width:118pt">75s<br></td></tr><tr height="35" style="height:26pt"><td rowspan="2" height="87" class="xl66" width="136" style="height:65pt;border-top:none;width:102pt">最大堆内存为 1.5G，<br>初始化大小为 1.5G<br>Eden 区 800m</td><td class="xl66" width="87" style="border-top:none;border-left:none;width:65pt">吞吐量<br></td><td class="xl66" width="143" style="border-top:none;border-left:none;width:107pt">1780/s<br></td><td class="xl66" width="151" style="border-top:none;border-left:none;width:113pt">1927/s<br></td><td class="xl66" width="157" style="border-top:none;border-left:none;width:118pt">1657/s<br></td></tr><tr height="52" style="height:39pt"><td height="52" class="xl66" width="87" style="height:39pt;border-top:none;border-left:none;width:65pt">平均处理时间<br></td><td class="xl66" width="143" style="border-top:none;border-left:none;width:107pt">0.56ms<br></td><td class="xl66" width="151" style="border-top:none;border-left:none;width:113pt">0.51ms<br></td><td class="xl66" width="157" style="border-top:none;border-left:none;width:118pt">0.6ms<br></td></tr></colgroup></table><p>一般情况下，高并发业务场景中，需要一个比较大的<code>堆空间</code>，而默认参数情况下，堆空间不会很大。所以我们有必要进行调整。</p><p><strong>但是不要单纯的调整堆的总大小，要调整新生代和老年代的比例，以及 Eden 区还有 From 区、To 区的比例</strong>。 所以在我们上述的测试中，调整方案二（不是我的，是老师的方案），得到结果是最好的。在三种测试情况下都能够有非常好的性能指标，同时 GC 耗时相对控制也较好。</p><ul><li>对于调整方案一，就是单纯地加大堆空间，里面的比例不适合高并发场景，反而导致堆空间变大，没有明显减少 GC 的次数，但是每次 GC 需要检索对象的堆空间更大，所以 GC 耗时更长。</li><li>而方案二：调整为一个很大的新生代和一个较小的老年代。原因是<strong>这样可以尽可能回收掉大部分短期对象，减少中期的对象，而老年代尽存放长期存活对象</strong>。</li></ul><p>由于新生代空间较小，Eden 区很快被填满，就会导致频繁 Minor GC，因此我们可以通过增大新生代空间来降低 Minor GC 的频率。详见3.2.2.1节。</p><h3 id="3-1-4-推荐策略"><a href="#3-1-4-推荐策略" class="headerlink" title="3.1.4 推荐策略"></a>3.1.4 推荐策略</h3><h4 id="3-1-4-1-新生代大小选择"><a href="#3-1-4-1-新生代大小选择" class="headerlink" title="3.1.4.1 新生代大小选择"></a>3.1.4.1 新生代大小选择</h4><ul><li><code>响应时间优先的应用</code>：尽可能设大，直到接近系统的最低响应时间限制(根据实际情况选择)。在此种情况下，新生代收集发生的频率也是最小的。同时，减少到达老年代的对象。</li><li><code>吞吐量优先的应用</code>：尽可能地设置大，可能到达<code>Gbit</code>的程度。因为对响应时间没有要求，垃圾收集可以并行进行，一般适合8CPU以上的应用。</li><li><code>避免设置过小</code>：当新生代设置过小时会导致：<ul><li>MinorGC 次数更加频繁</li><li>可能导致<code>Minor GC</code>对象直接进入老年代，如果此时老年代满了，会触发Full GC。<h4 id="3-1-4-2-老年代大小选择"><a href="#3-1-4-2-老年代大小选择" class="headerlink" title="3.1.4.2 老年代大小选择"></a>3.1.4.2 老年代大小选择</h4></li></ul></li><li><code>响应时间优先的应用</code>：老年代使用并发收集器，所以其大小需要小心设置，一般要考虑并发会话率和会话持续时间等一些参数。如果堆设置小了，可以会造成内存碎片，高回收频率以及应用暂停而使用传统的标记清除方式;如果堆大了，则需要较长的收集时间。最优化的方案，一般需要参考以下数据获得：并发垃圾收集信息、持久代并发收集次数、传统GC信息、花在新生代和老年代回收上的时间比例。</li><li><code>吞吐量优先的应用</code>：一般吞吐量优先的应用都有一个很大的新生代和一个较小的老年代。原因是，这样可以尽可能回收掉大部分短期对象，减少中期的对象，而老年代尽存放长期存活对象。</li></ul><h2 id="3-2-GC优化"><a href="#3-2-GC优化" class="headerlink" title="3.2 GC优化"></a>3.2 GC优化</h2><h3 id="3-2-1-GC性能衡量指标"><a href="#3-2-1-GC性能衡量指标" class="headerlink" title="3.2.1 GC性能衡量指标"></a>3.2.1 GC性能衡量指标</h3><h4 id="3-2-1-1-内存占用"><a href="#3-2-1-1-内存占用" class="headerlink" title="3.2.1.1 内存占用"></a>3.2.1.1 内存占用</h4><p>垃圾回收过程，收集器也需要占用一定空间的内存，它是指为保证垃圾收集能够顺利高效地进行而存储的额外信息。比如<code>CMS</code>和<code>G1</code>中的<code>RSet</code>(详见<a href="/posts/514811746.html" title="【JVM学习】5.HostSpot的细节">2.4节</a>)，特别是<code>G1</code>，根据经验，<code>G1</code>至少要耗费大约相当于<code>Java堆容量10%至20%</code>的额外内存来维持收集器工作。</p><p>随着计算机硬件的发展、性能的提升，我们越来越能容忍收集器多占用一点点内存；</p><p>硬件性能增长，对软件系统的处理能力是有直接助益的，硬件的规格和性能越高，也有助于降低收集器运行时对应用程序的影响，换句话说，吞吐量会更高。</p><h4 id="3-2-1-2-吞吐量"><a href="#3-2-1-2-吞吐量" class="headerlink" title="3.2.1.2 吞吐量"></a>3.2.1.2 吞吐量</h4><p>这里的衡量吞吐量是指<code>应用程序所花费的时间</code>和<code>系统总运行时间</code>的<code>比值</code>。我们可以按照这个公式来计算 GC 的吞吐量：</p><blockquote><p><code>系统总运行时间</code> = <code>应用程序耗时</code> + <code>GC 耗时</code>。<br>如果系统运行了 <code>100 分钟</code>，GC 耗时 <code>1 分钟</code>，则系统吞吐量为 <code>99%</code>。<br>GC 的吞吐量一般<code>不能低于 95%</code>。</p></blockquote><h4 id="3-2-1-3-延迟"><a href="#3-2-1-3-延迟" class="headerlink" title="3.2.1.3 延迟"></a>3.2.1.3 延迟</h4><p>现阶段GC越来越看重延迟时间，假如一个垃圾收集器<code>Stop the World</code>太长，显然对于应用或者用户来说是比较难受的。就如同打游戏，内存就那么大，假如要清理一些垃圾而要暂停游戏一下，恐怕砸手机的心都有。</p><p>特别的，如同<code>3.2.1.1节</code>提到的，硬件性能增长，虽然吞吐量上去了，内存占用影响降低了，但对于延迟来说，反而是负面影响增大了。虚拟机要回收完整的<code>1TB</code>的堆内 存，毫无疑问要比回收<code>1GB</code>的堆内存耗费更多时间。</p><p>对于<code>串行收集器</code>而言，停顿时间可能会比较长；而使用<code>并发收集器</code>，由于垃圾收集器和应用程序交替运行，程序的停顿时间就会变短，但其效率很可能不如独占垃圾收集器，系统的吞吐量也很可能会降低。</p><p>下图中，<code>浅色阶段</code>表示<strong>必须</strong>挂起用户线程，<code>深色</code>则表示收集器线程与用户线程是<code>并发</code>工作的。<br><img src="https://gcore.jsdelivr.net/gh/zyxelva/picgo/markdown/GC-Concurrency-Overview.png"></p><div class="caption"><b class="center-caption">各收集器并发情况一览</b></div><p></p><p>由图可见：</p><ul><li>在<code>CMS</code>和<code>G1</code>之前的全部收集器，其工作的所有步骤都会产生<code>Stop The World</code>式的停顿；</li><li><code>CMS</code>和<code>G1</code>分别使用<code>增量更新</code>和<code>原始快照</code>(见<a href="/posts/514811746.html" title="【JVM学习】5.HostSpot的细节">2.2节</a>)技术，实现了<code>标记阶段的并发</code>，不会因管理的堆内存变大，要标记的对象变多而导致停顿时间随之增长。但是对于<code>标记阶段之后</code>的处理，仍未得到妥善解决。<ul><li><code>CMS</code>使用<code>标记-清除</code>算法，虽然避免了整理阶段收集器带来的停顿，但是<code>清除算法</code>不论如何优化改进，在设计原理上避免不了<code>空间碎片</code>的产生，随着空间碎片不断淤积最终依然逃不过<code>Stop The World</code>的命运。</li><li><code>G1</code>虽然可以按更小的粒度进行回收，从而抑制<code>整理阶段</code>出现时间过长地停顿，但毕竟也还是要暂停的。</li></ul></li><li>最后的两款收集器，<code>Shenandoah</code>和<code>ZGC</code>，几乎整个工作过程<code>全部都是并发的</code>，只有<code>初始标记</code>、<code>最终标记</code>这些阶段有短暂地停顿，这部分停顿的时间基本上是固定的，与<code>堆的容量</code>、<code>堆中对象的数量</code><strong>没有</strong>正比例关系。实际上，它们都可以在任意可管理的堆容量下，实现垃圾收集的停顿都<code>不超过十毫秒</code>这种以前听起来是天方夜谭、匪夷所思的目标。</li></ul><h4 id="3-2-1-4-垃圾回收频率"><a href="#3-2-1-4-垃圾回收频率" class="headerlink" title="3.2.1.4 垃圾回收频率"></a>3.2.1.4 垃圾回收频率</h4><p>通常垃圾回收的频率越低越好，<code>增大堆内存空间</code>可以有效降低垃圾回收发生的频率，但同时也意味着堆积的回收对象越多，最终也会增加回收时的<code>停顿时间</code>。所以我们需要适当地增大堆内存空间，保证正常的垃圾回收频率即可。</p><h3 id="3-2-2-GC调优策略"><a href="#3-2-2-GC调优策略" class="headerlink" title="3.2.2 GC调优策略"></a>3.2.2 GC调优策略</h3><h4 id="3-2-2-1-降低-Minor-GC-频率"><a href="#3-2-2-1-降低-Minor-GC-频率" class="headerlink" title="3.2.2.1 降低 Minor GC 频率"></a>3.2.2.1 降低 Minor GC 频率</h4><p>由于新生代空间较小，Eden 区很快被填满，就会导致频繁 <code>Minor GC</code>，因此我们可以通过<code>增大新生代空间</code>来降低 Minor GC 的频率。</p><blockquote><p><code>单次 Minor GC 时间</code>是由两部分组成：<code>T1</code>(扫描新生代)和 <code>T2</code>(复制存活对象)。</p></blockquote><ul><li>情况 1：假设一个对象在 Eden 区的存活时间为 <code>500ms</code>，Minor GC 的时间间隔是 <code>300ms</code>，因为这个对象<code>存活时间&gt;间隔时间</code>，那么正常情况下，Minor GC 的时间为：<code>T1+T2</code>。</li><li>情况 2：当我们<code>增大新生代空间</code>，Minor GC 的时间间隔可能会扩大到 <code>600ms</code>，此时一个存活 <code>500ms</code> 的对象就会在 Eden 区中被回收掉，此时就不存在复制存活对象了，所以再发生 Minor GC 的时间为：<code>T1*2(空间大了)+T2*0</code><br>可见，扩容后，Minor GC 时增加了 <code>T1</code>，但省去了 <code>T2</code> 的时间。</li></ul><p>在 JVM 中，<code>复制对象的成本</code>要<strong>远高于</strong><code>扫描成本</code>。如果在堆内存中存在较多的长期存活的对象，此时增加年轻代空间，反而会增加 Minor GC 的时间。如果堆中的短期对象很多，那么扩容新生代，单次 Minor GC 时间不会显著增加。因此，<code>单次 Minor GC 时间</code>更多取决于 <code>GC 后存活对象的数量</code>，而非 Eden 区的大小。</p><h4 id="3-2-2-2-降低-Full-GC-频率"><a href="#3-2-2-2-降低-Full-GC-频率" class="headerlink" title="3.2.2.2 降低 Full GC 频率"></a>3.2.2.2 降低 Full GC 频率</h4><p>由于<code>堆内存空间不足</code>或<code>老年代对象太多</code>，会触发 <code>Full GC</code>，频繁的 Full GC 会带来上下文切换，增加系统的性能开销。 常用措施有：</p><ul><li><code>减少创建大对象</code>：在平常的业务场景中，我们一次性从数据库中查询出一个大对象用于 web 端显示。比如，一次性查询出 60 个字段的业务操作，这种大对象如果超过年轻代最大对象阈值，会被直接创建在老年代；即使被创建在了年轻代，由于年轻代的内存空间有限，通过 Minor GC 之后也会进入到老年代。这种大对象很容易产生较多的 Full GC。</li><li><code>增大堆内存空间</code>：在堆内存不足的情况下，增大堆内存空间，且设置初始化堆内存为最大堆内存，也可以降低 Full GC 的频率。</li></ul><h4 id="3-2-2-3-选择合适的GC收集器"><a href="#3-2-2-3-选择合适的GC收集器" class="headerlink" title="3.2.2.3 选择合适的GC收集器"></a>3.2.2.3 选择合适的GC收集器</h4><p>如果要求每次操作的响应时间必须在 <code>500ms</code> 以内。这个时候我们一般会选择响应速度较快的 GC 收集器，</p><ul><li>堆内存比较小的情况下(&lt;6G)选择 <code>CMS</code>收集器</li><li>堆内存比较大的情况下(&gt;8G)<code>G1</code>收集器.</li></ul><h2 id="3-3-预估调优"><a href="#3-3-预估调优" class="headerlink" title="3.3 预估调优"></a>3.3 预估调优</h2><h3 id="3-3-1-调优分类"><a href="#3-3-1-调优分类" class="headerlink" title="3.3.1 调优分类"></a>3.3.1 调优分类</h3><h4 id="3-3-1-1-JVM-预调优"><a href="#3-3-1-1-JVM-预调优" class="headerlink" title="3.3.1.1 JVM 预调优"></a>3.3.1.1 JVM 预调优</h4><p>包括<code>业务场景设定</code>、<code>无监控不优化</code>（要压测），具体步骤可拆分为：</p><ul><li>计算内存需求：并不是分配的内存越大越好，越大虽然可能对吞吐量或者内存吃紧带来正面影响，但响应时间（延迟）却不一定了。<blockquote><p>虚拟机栈的大小在高并发情况下可以变小。<br>元空间(方法区)保险起见还是设定一个最大的值(默认情况下元空间是没有大小限制的)，一般限定<code>几百 M</code> 就够用了.</p></blockquote></li><li>选定 CPU</li><li>选择合适的垃圾收集器</li><li>设定新生代大小、分代年龄</li><li>设定日志参数<h4 id="3-3-1-2-优化-JVM-运行环境-慢、卡顿等"><a href="#3-3-1-2-优化-JVM-运行环境-慢、卡顿等" class="headerlink" title="3.3.1.2 优化 JVM 运行环境(慢、卡顿等)"></a>3.3.1.2 优化 JVM 运行环境(慢、卡顿等)</h4>一般造成 JVM 卡或者慢的原因无非两个部分，一个是 CPU 占用过高，一个是内存占用过高。所以这个时候需要我们进行问题的排查，进行具体的故障分析。<h4 id="3-3-1-3-解决-JVM-中的问题-OOM-等"><a href="#3-3-1-3-解决-JVM-中的问题-OOM-等" class="headerlink" title="3.3.1.3 解决 JVM 中的问题(OOM 等)"></a>3.3.1.3 解决 JVM 中的问题(OOM 等)</h4>比如<code>栈溢出</code>、<code>堆溢出</code>、<code>方法区溢出</code>、<code>本机直接内存溢出</code>等。</li></ul><blockquote><p>前面两节的<code>内存优化</code>与 <code>GC 优化</code>主要就是做的第一种（3.3.1.1节）和第二种（3.3.1.2节）工作。</p></blockquote><h1 id="4-实战"><a href="#4-实战" class="headerlink" title="4 实战"></a>4 实战</h1><p>有空再搞。</p><h1 id="5-总结"><a href="#5-总结" class="headerlink" title="5 总结"></a>5 总结</h1><ul><li>具体问题具体分析，实事求是：GC 调优是个很复杂、很细致的过程，要根据实际情况调整，不同的机器、不同的应用、不同的性能要求调优的手段都是不同的，这些都需要大家平时去积累，去观察，去实践。</li><li>明确调优思路：<code>测试</code> - <code>分析</code> - <code>调优</code>三步走。</li><li>任何调优都需要结合场景，明确已知问题和性能目标，<code>不能为了调优而调优</code>，以免引入新的 Bug，带来风险和弊端。</li></ul></div><hr><div class="reprint" id="reprint-statement"><div class="reprint__author"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-user">文章作者:</i></span> <span class="reprint-info"><a href="/about" rel="external nofollow noreferrer">Kezade</a></span></div><div class="reprint__type"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-link">文章链接:</i></span> <span class="reprint-info"><a href="https://zyxelva.github.io/posts/4017704765.html">https://zyxelva.github.io/posts/4017704765.html</a></span></div><div class="reprint__notice"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-copyright">版权声明:</i></span> <span class="reprint-info">本博客所有文章除特別声明外，均采用 <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a> 许可协议。转载请注明来源 <a href="/about" target="_blank">Kezade</a> !</span></div></div><script async defer>function navToReprintStatement(){$("html, body").animate({scrollTop:$("#reprint-statement").offset().top-80},800)}document.addEventListener("copy",function(t){M.toast({html:'<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>'})})</script><div class="tag_share" style="display:block"><div class="post-meta__tag-list" style="display:inline-block"><div class="article-tag"><a href="/tags/JVM/"><span class="chip bg-color">JVM</span></a> <a href="/tags/JVM%E8%B0%83%E4%BC%98/"><span class="chip bg-color">JVM调优</span></a></div></div><div class="post_share" style="zoom:80%;width:fit-content;display:inline-block;float:right;margin:-.15rem 0"><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/share/css/share.min.css"><div id="article-share"><div class="social-share" data-sites="google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/share/js/social-share.min.js"></script></div></div></div><div id="reward"><a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a><div id="rewardModal" class="modal"><div class="modal-content"><a class="close modal-close"><i class="fas fa-times"></i></a><h4 class="reward-title">你的赏识是我前进的动力</h4><div class="reward-content"><div class="reward-tabs"><ul class="tabs row"><li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li><li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li></ul><div id="alipay"><img src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码"></div><div id="wechat"><img src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码"></div></div></div></div></div></div><script>$(function(){$(".tabs").tabs()})</script></div></div><style>.twikoo-card{margin:1.5rem auto}.twikoo-card .card-content{padding:20px}#tcomments textarea{box-sizing:border-box;background:url("/") 100% 100% no-repeat}#tcomments p{margin:2px 2px 10px;font-size:1.05rem;line-height:1.78rem;text-align:left}#tcomments blockquote p{text-indent:.2rem}#tcomments a{padding:0 2px;color:#4cbf30;font-weight:500;text-decoration:none}#tcomments img{max-width:100%;height:auto;cursor:pointer}#tcomments ol li{list-style-type:decimal}#tcomments ol,ul{display:block;padding-left:2em;word-spacing:0.05rem}#tcomments ul li,ol li{display:list-item;line-height:1.8rem;font-size:1rem}#tcomments ul li{list-style-type:disc}#tcomments ul ul li{list-style-type:circle}#tcomments table,td,th{padding:12px 13px;border:1px solid #dfe2e5}#tcomments table,td,th{border:0}table tr:nth-child(2n),thead{background-color:#fafafa}#tcomments table th{background-color:#f2f2f2;min-width:80px}#tcomments table td{min-width:80px}#tcomments h1{font-size:1.85rem;font-weight:700;line-height:2.2rem}#tcomments h2{font-size:1.65rem;font-weight:700;line-height:1.9rem}#tcomments h3{font-size:1.45rem;font-weight:700;line-height:1.7rem}#tcomments h4{font-size:1.25rem;font-weight:700;line-height:1.5rem}#tcomments h5{font-size:1.1rem;font-weight:700;line-height:1.4rem}#tcomments h6{font-size:1rem;line-height:1.3rem}#tcomments p{font-size:1rem;line-height:1.5rem}#tcomments hr{margin:12px 0;border:0;border-top:1px solid #ccc}#tcomments blockquote{margin:15px 0;border-left:5px solid #42b983;padding:1rem .8rem .3rem .8rem;color:#666;background-color:rgba(66,185,131,.1)}#tcomments pre{font-family:monospace,monospace;padding:1.2em;margin:.5em 0;background:#272822;overflow:auto;border-radius:.3em;tab-size:4}#tcomments code{font-family:monospace,monospace;padding:1px 3px;font-size:.92rem;color:#e96900;background-color:#f8f8f8;border-radius:2px}#tcomments pre code{font-family:monospace,monospace;padding:0;color:#e8eaf6;background-color:#272822}#tcomments pre[class*=language-]{padding:1.2em;margin:.5em 0}#tcomments code[class*=language-],pre[class*=language-]{color:#e8eaf6}#tcomments [type=checkbox]:not(:checked),[type=checkbox]:checked{position:inherit;margin-left:-1.3rem;margin-right:.4rem;margin-top:-1px;vertical-align:middle;left:unset;visibility:visible}#tcomments b,strong{font-weight:700}#tcomments dfn{font-style:italic}#tcomments small{font-size:85%}#tcomments cite{font-style:normal}#tcomments mark{background-color:#fcf8e3;padding:.2em}#tcomments table,td,th{padding:12px 13px;border:1px solid #dfe2e5}table tr:nth-child(2n),thead{background-color:#fafafa}#tcomments table th{background-color:#f2f2f2;min-width:80px}#tcomments table td{min-width:80px}#tcomments [type=checkbox]:not(:checked),[type=checkbox]:checked{position:inherit;margin-left:-1.3rem;margin-right:.4rem;margin-top:-1px;vertical-align:middle;left:unset;visibility:visible}</style><div class="card twikoo-card" data-aos="fade-up"><div class="comment_headling" style="font-size:20px;font-weight:700;position:relative;padding-left:20px;top:15px;padding-bottom:5px"><i class="fas fa-comments fa-fw" aria-hidden="true"></i> <span>评论</span></div><div class="card-content" style="display:grid"><div id="tcomments"></div></div></div><script src="https://gcore.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js"></script><script>twikoo.init({envId:"https://kezadetwikoo.netlify.app/.netlify/functions/twikoo",el:"#tcomments",region:"",path:""}).then(function(){for(var t=document.querySelector("#twikoo").getElementsByTagName("input"),e=0;e<t.length;e++)t[e]&&t[e].classList.add("browser-default")})</script><article id="prenext-posts" class="prev-next articles"><div class="row article-row"><div class="article col s12 m6" data-aos="fade-up"><div class="article-badge left-badge text-color"><i class="fas fa-chevron-left"></i> &nbsp;上一篇</div><div class="card"><a href="/posts/2603907002.html"><div class="card-image"><img src="/medias/LeetCode.jpg" class="responsive-img" alt="【LeetCode】437.路径总和 III"> <span class="card-title">【LeetCode】437.路径总和 III</span></div></a><div class="card-content article-content"><div class="summary block-with-text"></div><div class="publish-info"><span class="publish-date"><i class="far fa-clock fa-fw icon-date"></i> 2023-07-11</span><span class="publish-author"><i class="fas fa-bookmark fa-fw icon-category"></i> <a href="/categories/%E7%AE%97%E6%B3%95/" class="post-category">算法</a></span></div></div><div class="card-action article-tags"><a href="/tags/LeetCode/"><span class="chip bg-color">LeetCode</span></a> <a href="/tags/DFS/"><span class="chip bg-color">DFS</span></a></div></div></div><div class="article col s12 m6" data-aos="fade-up"><div class="article-badge right-badge text-color">下一篇&nbsp;<i class="fas fa-chevron-right"></i></div><div class="card"><a href="/posts/3334433468.html"><div class="card-image"><img src="/medias/JVM.png" class="responsive-img" alt="【JVM学习】6.玩转类加载与类加载器"> <span class="card-title">【JVM学习】6.玩转类加载与类加载器</span></div></a><div class="card-content article-content"><div class="summary block-with-text"></div><div class="publish-info"><span class="publish-date"><i class="far fa-clock fa-fw icon-date"></i> 2023-07-07</span><span class="publish-author"><i class="fas fa-bookmark fa-fw icon-category"></i> <a href="/categories/JVM%E5%AD%A6%E4%B9%A0/" class="post-category">JVM学习</a></span></div></div><div class="card-action article-tags"><a href="/tags/JVM/"><span class="chip bg-color">JVM</span></a> <a href="/tags/%E7%B1%BB%E5%8A%A0%E8%BD%BD/"><span class="chip bg-color">类加载</span></a> <a href="/tags/%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8/"><span class="chip bg-color">类加载器</span></a> <a href="/tags/%E7%B1%BB%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/"><span class="chip bg-color">类的生命周期</span></a></div></div></div></div></article></div><script>$("#articleContent").on("copy",function(e){if(void 0!==window.getSelection){var n=window.getSelection();if(!((""+n).length<Number.parseInt("120"))){var t=document.getElementsByTagName("body")[0],o=document.createElement("div");o.style.position="absolute",o.style.left="-99999px",t.appendChild(o),o.appendChild(n.getRangeAt(0).cloneContents()),"PRE"!==n.getRangeAt(0).commonAncestorContainer.nodeName&&"CODE"!==n.getRangeAt(0).commonAncestorContainer.nodeName||(o.innerHTML="<pre>"+o.innerHTML+"</pre>");var i=document.location.href;o.innerHTML+='<br />来源: Kezade<br />文章作者: Kezade<br />文章链接: <a href="'+i+'">'+i+"</a><br />本文章著作权归作者所有，任何形式的转载都请注明出处。",n.selectAllChildren(o),window.setTimeout(function(){t.removeChild(o)},200)}}})</script><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/codeBlock/codeBlockFuction.js"></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/prism/prism.min.js"></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/codeBlock/codeLang.js"></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/codeBlock/codeCopy.js"></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/codeBlock/codeShrink.js"></script></div><div id="toc-aside" class="expanded col l3 hide-on-med-and-down"><div class="toc-widget card" style="background-color:#fff"><div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div><div id="toc-content"></div></div></div></div><div id="floating-toc-btn" class="hide-on-med-and-down"><a class="btn-floating btn-large bg-color"><i class="fas fa-list-ul"></i></a></div><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/tocbot/tocbot.min.js"></script><script>$(function(){tocbot.init({tocSelector:"#toc-content",contentSelector:"#articleContent",headingsOffset:-(.4*$(window).height()-45),collapseDepth:Number("0"),headingSelector:"h1, h2, h3, h4, h5"});let t=parseInt(.4*$(window).height()-64),e=$(".toc-widget");$(window).scroll(function(){$(window).scrollTop()>t?e.addClass("toc-fixed"):e.removeClass("toc-fixed")});const o="expanded";let n=$("#toc-aside"),i=$("#main-content");$("#floating-toc-btn .btn-floating").click(function(){n.hasClass(o)?(n.removeClass(o).hide(),i.removeClass("l9")):(n.addClass(o).show(),i.addClass("l9")),function(t,e){let o=$("#"+t);if(0===o.length)return;let n=o.width();n+=n>=450?21:n>=350&&n<450?18:n>=300&&n<350?16:14,$("#"+e).width(n)}("artDetail","prenext-posts")})})</script></main><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script>MathJax.Hub.Config({tex2jax:{inlineMath:[["$","$"],["\\(","\\)"]]}})</script><footer class="page-footer bg-color"><div class="container row center-align" style="margin-bottom:15px!important"><div class="col s12 m8 l8 copy-right">Copyright&nbsp;&copy; <span id="year">2019-2025</span> <a href="/about" target="_blank">Kezade</a> |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a> |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a><br><br><span id="sitetime">Loading ...</span><script>var calcSiteTime=function(){var e=6e4,t=36e5,n=864e5,a=365*n,i=new Date,r="2019",o=i.getFullYear(),s=i.getMonth()+1,l=i.getDate(),m=i.getHours(),c=i.getMinutes(),d=i.getSeconds(),g=Date.UTC(r,"6","28","0","0","0"),h=Date.UTC(o,s,l,m,c,d)-g,u=Math.floor(h/a),M=Math.floor(h/n-365*u),T=Math.floor((h-(365*u+M)*n)/t),f=Math.floor((h-(365*u+M)*n-T*t)/e),y=Math.floor((h-(365*u+M)*n-T*t-f*e)/1e3);if(r===String(o)){document.getElementById("year").innerHTML=o;var v="This site has been running for "+M+" days";v="本站已运行 "+M+" 天",document.getElementById("sitetime").innerHTML=v}else{document.getElementById("year").innerHTML=r+" - "+o;var H="This site has been running for "+u+" years and "+M+" days "+T+" hours "+f+" mins "+y+" seconds";H="本站已苟且偷生 "+u+" 年 "+M+" 天 "+T+" 小时 "+f+" 分钟 "+y+" 秒",document.getElementById("sitetime").innerHTML=H}};calcSiteTime(),setInterval(calcSiteTime,1e3)</script><br></div><div class="col s12 m4 l4 social-link"><a href="https://github.com/zyxelva" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50"><i class="fab fa-github"></i></a><a href="mailto:zyxelva@gmail.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50"><i class="fas fa-envelope-open"></i></a><a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=1807401971" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 1807401971" data-position="top" data-delay="50"><i class="fab fa-qq"></i></a> <a href="https://www.zhihu.com/people/kezade" class="tooltipped" target="_blank" data-tooltip="关注我的知乎: https://www.zhihu.com/people/kezade" data-position="top" data-delay="50"><i class="fab fa-zhihu1">知</i></a><a href="../rss2.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50"><i class="fas fa-rss"></i></a></div></div></footer><div class="progress-bar"></div><div id="searchModal" class="modal"><div class="modal-content"><div class="search-header"><span class="title"><i class="fas fa-search"></i> &nbsp;&nbsp;搜索</span> <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字" class="search-input"></div><div id="searchResult"></div></div></div><script>$(function(){!function(t,e,r){"use strict";$.ajax({url:t,dataType:"xml",success:function(t){var n=$("entry",t).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get(),a=document.getElementById(e),s=document.getElementById(r);a.addEventListener("input",function(){var t='<ul class="search-result-list">',e=this.value.trim().toLowerCase().split(/[\s\-]+/);s.innerHTML="",this.value.trim().length<=0||(n.forEach(function(r){var n=!0,a=r.title.trim().toLowerCase(),s=r.content.trim().replace(/<[^>]+>/g,"").toLowerCase(),i=r.url;i=0===i.indexOf("/")?r.url:"/"+i;var l=-1,c=-1,u=-1;if(""!==a&&""!==s&&e.forEach(function(t,e){l=a.indexOf(t),c=s.indexOf(t),l<0&&c<0?n=!1:(c<0&&(c=0),0===e&&(u=c))}),n){t+="<li><a href='"+i+"' class='search-result-title'>"+a+"</a>";var o=r.content.trim().replace(/<[^>]+>/g,"");if(u>=0){var h=u-20,f=u+80;h<0&&(h=0),0===h&&(f=100),f>o.length&&(f=o.length);var m=o.substr(h,f);e.forEach(function(t){var e=new RegExp(t,"gi");m=m.replace(e,'<em class="search-keyword">'+t+"</em>")}),t+='<p class="search-result">'+m+"...</p>"}t+="</li>"}}),t+="</ul>",s.innerHTML=t)})}})}("/search.xml","searchInput","searchResult")})</script><div class="stars-con"><div id="stars"></div><div id="stars2"></div><div id="stars3"></div></div><script>function switchNightMode(){$('<div class="Cuteen_DarkSky"><div class="Cuteen_DarkPlanet"></div></div>').appendTo($("body")),setTimeout(function(){$("body").hasClass("DarkMode")?($("body").removeClass("DarkMode"),localStorage.setItem("isDark","0"),$("#sum-moon-icon").removeClass("fa-sun").addClass("fa-moon")):($("body").addClass("DarkMode"),localStorage.setItem("isDark","1"),$("#sum-moon-icon").addClass("fa-sun").removeClass("fa-moon")),setTimeout(function(){$(".Cuteen_DarkSky").fadeOut(1e3,function(){$(this).remove()})},2e3)})}</script><div id="backTop" class="top-scroll"><a class="btn-floating btn-large waves-effect waves-light" href="#!"><i class="fas fa-arrow-up"></i></a></div><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/materialize/materialize.min.js"></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/masonry/masonry.pkgd.min.js"></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/aos/aos.js"></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/scrollprogress/scrollProgress.min.js"></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/lightGallery/js/lightgallery-all.min.js"></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/js/matery.js"></script><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/mermaid/mermaid.min.css"><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/mermaid/mermaid.min.js"></script><script>window.mermaid&&mermaid.initialize({theme:"forest"})</script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/background/ribbon-dynamic.js" async></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/instantpage/instantpage.js" type="module"></script></body></html>
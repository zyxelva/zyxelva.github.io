<!DOCTYPE HTML><html lang="zh-CN"><head><meta charset="utf-8"><meta name="keywords" content="【Redis学习】6.理解内存, Back-End Dev Java"><meta name="description" content="1 内存消耗内存是个精贵且非常重要的计算组成部分，如何利用有限的资源完成高效且快速数据的存取，那首先我们得了解Redis在内存中的布局，看看消耗内存空间的位置，其次才能针对性的进行内存管理，分配，优化。这样，才能使得利用更小内存，获得更大存"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><meta name="renderer" content="webkit|ie-stand|ie-comp"><meta name="mobile-web-app-capable" content="yes"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="referrer" content="no-referrer-when-downgrade"><title>【Redis学习】6.理解内存 | Kezade</title><link rel="icon" type="image/jpeg" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/medias/avatar/avatar2.jpg"><style>body{background-image:url(https://it-ark-dev.oss-cn-shenzhen.aliyuncs.com/464e9ac7a5a729ae67f91f7cf0cf6fe2.jpg);background-repeat:no-repeat;background-attachment:fixed;background-size:cover;background-position:center center}</style><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/awesome/css/all.min.css"><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/materialize/materialize.min.css"><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/aos/aos.css"><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/animate/animate.min.css"><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/lightGallery/css/lightgallery.min.css"><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/picgo@v3.1/css/matery.css?v3"><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/css/my.css"><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/css/dark.css" media="none" onload='"all"!=media&&(media="all")'><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/tocbot/tocbot.css"><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/css/post.css"><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/css/reward.css"><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/jquery/jquery-3.6.0.min.js"></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/picgo@v3.3/js/function.js?v88"></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/picgo@v1.3/js/imgStatus.min.js"></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/picgo@v1.3/js/waterfall.min.js"></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/picgo@v1.3/js/lately.min.js"></script><script>var memos={host:"https://s.dusays.com/",limit:"10",creatorId:"49",username:"zyxelva",name:"Kezade",domId:"#memos",path:"api/v1/memo"},douban={api:"https://douban-api.edui.fun/"}</script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/rss2.xml" title="Kezade" type="application/rss+xml"></head><body><header class="navbar-fixed"><nav id="headNav" class="bg-color nav-transparent"><div id="navContainer" class="nav-wrapper container"><div class="brand-logo"><a href="/" class="waves-effect waves-light"><img src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/medias/avatar/avatar2.jpg" class="logo-img k-avatar" alt="LOGO"> <span class="logo-span">Kezade</span></a></div><a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a><ul class="right nav-menu"><li class="hide-on-med-and-down nav-item"><a href="/" class="waves-effect waves-light"><i class="fas fa-home" style="zoom:0.6"></i> <span>首页</span></a></li><li class="hide-on-med-and-down nav-item"><a href="" class="waves-effect waves-light"><i class="fa-solid fa-newspaper" style="zoom:0.6"></i> <span>文章</span><i class="fas fa-chevron-down" aria-hidden="true" style="zoom:0.6"></i></a><ul class="sub-nav menus_item_child"><li><a href="/tags"><i class="fas fa-tags" style="margin-top:-20px;zoom:0.6"></i> <span>标签</span></a></li><li><a href="/categories"><i class="fas fa-bookmark" style="margin-top:-20px;zoom:0.6"></i> <span>分类</span></a></li><li><a href="/archives"><i class="fas fa-archive" style="margin-top:-20px;zoom:0.6"></i> <span>归档</span></a></li></ul></li><li class="hide-on-med-and-down nav-item"><a href="" class="waves-effect waves-light"><i class="fa-solid fa-sitemap" style="zoom:0.6"></i> <span>系列</span><i class="fas fa-chevron-down" aria-hidden="true" style="zoom:0.6"></i></a><ul class="sub-nav menus_item_child"><li><a href="/categories/%E7%AE%97%E6%B3%95"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>算法学习</span></a></li><li><a href="/categories/RocketMQ%E5%AD%A6%E4%B9%A0"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>RMQ学习</span></a></li><li><a href="/categories/Netty%E5%AD%A6%E4%B9%A0"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>Netty学习</span></a></li><li><a href="/categories/Spring%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>Spring学习</span></a></li><li><a href="/categories/JVM%E5%AD%A6%E4%B9%A0"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>JVM学习</span></a></li><li><a href="/categories/MySQL%E5%AD%A6%E4%B9%A0"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>MySQL学习</span></a></li><li><a href="/categories/MyBatis%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>MyBatis学习</span></a></li><li><a href="/categories/Zookeeper%E5%AD%A6%E4%B9%A0"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>ZK学习</span></a></li><li><a href="/categories/Hexo"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>Hexo学习</span></a></li><li><a href="/categories/Redis%E5%AD%A6%E4%B9%A0"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>Redis学习</span></a></li><li><a href="/categories/Docker%E5%AD%A6%E4%B9%A0"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>Docker学习</span></a></li><li><a href="/categories/AP-Calculus"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>AP学习</span></a></li><li><a href="/categories/A-Level"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>A-Level学习</span></a></li><li><a href="/categories/SAT"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>SAT学习</span></a></li><li><a href="/categories/%E8%80%83%E7%A0%94"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>考研</span></a></li><li><a href="/categories/OSSD"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>OSSD</span></a></li><li><a href="/categories/%E9%AB%98%E8%80%83"><i class="fa-solid fa-rocket" style="margin-top:-20px;zoom:0.6"></i> <span>高考</span></a></li></ul></li><li class="hide-on-med-and-down nav-item"><a href="" class="waves-effect waves-light"><i class="fa-solid fa-place-of-worship" style="zoom:0.6"></i> <span>我的</span><i class="fas fa-chevron-down" aria-hidden="true" style="zoom:0.6"></i></a><ul class="sub-nav menus_item_child"><li><a href="/galleries"><i class="fas fa-image" style="margin-top:-20px;zoom:0.6"></i> <span>相册</span></a></li><li><a href="/bibi"><i class="fa-fw fa-solid fa-cloud-rain" style="margin-top:-20px;zoom:0.6"></i> <span>哔哔</span></a></li><li><a href="/todolist"><i class="fa-fw fa-solid fa-circle-check" style="margin-top:-20px;zoom:0.6"></i> <span>清单</span></a></li><li><a href="/musics"><i class="fas fa-music" style="margin-top:-20px;zoom:0.6"></i> <span>音乐</span></a></li></ul></li><li class="hide-on-med-and-down nav-item"><a href="" class="waves-effect waves-light"><i class="fa-solid fa-circle-info" style="zoom:0.6"></i> <span>更多</span><i class="fas fa-chevron-down" aria-hidden="true" style="zoom:0.6"></i></a><ul class="sub-nav menus_item_child"><li><a href="/contact"><i class="fas fa-comments" style="margin-top:-20px;zoom:0.6"></i> <span>留言</span></a></li><li><a href="/friends"><i class="fa-solid fa-link" style="margin-top:-20px;zoom:0.6"></i> <span>友链</span></a></li><li><a href="/friend-circle"><i class="fa-solid fa-rss" style="margin-top:-20px;zoom:0.6"></i> <span>圈圈</span></a></li><li><a href="/about"><i class="fas fa-user-circle" style="margin-top:-20px;zoom:0.6"></i> <span>关于</span></a></li></ul></li><li><a href="#searchModal" class="modal-trigger waves-effect waves-light"><i id="searchIcon" class="fas fa-search" title="搜索" style="zoom:0.85"></i></a></li><li><a href="javascript:;" class="waves-effect waves-light" onclick="switchNightMode()" title="深色/浅色模式"><i id="sum-moon-icon" class="fas fa-sun" style="zoom:0.85"></i></a></li></ul><div id="mobile-nav" class="side-nav sidenav"><div class="mobile-head bg-color"><img src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/medias/avatar/avatar2.jpg" class="logo-img circle responsive-img"><div class="logo-name">Kezade</div><div class="logo-desc">7 年 Java 开发经验，其中 3 年以上大型系统架构设计经验，以及 2 年以上的团队管理经验 | 具有分布式、高并发、高可用、大数据量的系统架构设计以及研发经验 | 对 Zookeeper、Netty、Dubbo、Spring Cloud、 Spring 等开源框架源码有过深入研究，并且有一定的框架定制开发经验</div></div><ul class="menu-list mobile-menu-list"><li class="m-nav-item"><a href="/" class="waves-effect waves-light"><i class="fa-fw fas fa-home"></i> 首页</a></li><li class="m-nav-item"><a href="javascript:;"><i class="fa-fw fa-solid fa-newspaper"></i> 文章<span class="m-icon"><i class="fas fa-chevron-right"></i></span></a><ul><li><a href="/tags" style="margin-left:75px"><i class="fa fas fa-tags" style="position:absolute;left:50px"></i> <span>标签</span></a></li><li><a href="/categories" style="margin-left:75px"><i class="fa fas fa-bookmark" style="position:absolute;left:50px"></i> <span>分类</span></a></li><li><a href="/archives" style="margin-left:75px"><i class="fa fas fa-archive" style="position:absolute;left:50px"></i> <span>归档</span></a></li></ul></li><li class="m-nav-item"><a href="javascript:;"><i class="fa-fw fa-solid fa-sitemap"></i> 系列<span class="m-icon"><i class="fas fa-chevron-right"></i></span></a><ul><li><a href="/categories/%E7%AE%97%E6%B3%95" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>算法学习</span></a></li><li><a href="/categories/RocketMQ%E5%AD%A6%E4%B9%A0" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>RMQ学习</span></a></li><li><a href="/categories/Netty%E5%AD%A6%E4%B9%A0" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>Netty学习</span></a></li><li><a href="/categories/Spring%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>Spring学习</span></a></li><li><a href="/categories/JVM%E5%AD%A6%E4%B9%A0" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>JVM学习</span></a></li><li><a href="/categories/MySQL%E5%AD%A6%E4%B9%A0" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>MySQL学习</span></a></li><li><a href="/categories/MyBatis%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>MyBatis学习</span></a></li><li><a href="/categories/Zookeeper%E5%AD%A6%E4%B9%A0" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>ZK学习</span></a></li><li><a href="/categories/Hexo" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>Hexo学习</span></a></li><li><a href="/categories/Redis%E5%AD%A6%E4%B9%A0" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>Redis学习</span></a></li><li><a href="/categories/Docker%E5%AD%A6%E4%B9%A0" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>Docker学习</span></a></li><li><a href="/categories/AP-Calculus" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>AP学习</span></a></li><li><a href="/categories/A-Level" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>A-Level学习</span></a></li><li><a href="/categories/SAT" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>SAT学习</span></a></li><li><a href="/categories/%E8%80%83%E7%A0%94" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>考研</span></a></li><li><a href="/categories/OSSD" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>OSSD</span></a></li><li><a href="/categories/%E9%AB%98%E8%80%83" style="margin-left:75px"><i class="fa fa-solid fa-rocket" style="position:absolute;left:50px"></i> <span>高考</span></a></li></ul></li><li class="m-nav-item"><a href="javascript:;"><i class="fa-fw fa-solid fa-place-of-worship"></i> 我的<span class="m-icon"><i class="fas fa-chevron-right"></i></span></a><ul><li><a href="/galleries" style="margin-left:75px"><i class="fa fas fa-image" style="position:absolute;left:50px"></i> <span>相册</span></a></li><li><a href="/bibi" style="margin-left:75px"><i class="fa fa-fw fa-solid fa-cloud-rain" style="position:absolute;left:50px"></i> <span>哔哔</span></a></li><li><a href="/todolist" style="margin-left:75px"><i class="fa fa-fw fa-solid fa-circle-check" style="position:absolute;left:50px"></i> <span>清单</span></a></li><li><a href="/musics" style="margin-left:75px"><i class="fa fas fa-music" style="position:absolute;left:50px"></i> <span>音乐</span></a></li></ul></li><li class="m-nav-item"><a href="javascript:;"><i class="fa-fw fa-solid fa-circle-info"></i> 更多<span class="m-icon"><i class="fas fa-chevron-right"></i></span></a><ul><li><a href="/contact" style="margin-left:75px"><i class="fa fas fa-comments" style="position:absolute;left:50px"></i> <span>留言</span></a></li><li><a href="/friends" style="margin-left:75px"><i class="fa fa-solid fa-link" style="position:absolute;left:50px"></i> <span>友链</span></a></li><li><a href="/friend-circle" style="margin-left:75px"><i class="fa fa-solid fa-rss" style="position:absolute;left:50px"></i> <span>圈圈</span></a></li><li><a href="/about" style="margin-left:75px"><i class="fa fas fa-user-circle" style="position:absolute;left:50px"></i> <span>关于</span></a></li></ul></li><li><div class="divider"></div></li><li><a href="https://github.com/blinkfox/hexo-theme-matery" class="waves-effect waves-light" target="_blank"><i class="fab fa-github-square fa-fw"></i> Fork Me</a></li></ul></div></div><style>.nav-transparent .github-corner{display:none!important}.github-corner{position:absolute;z-index:10;top:0;right:0;border:0;transform:scale(1.1)}.github-corner svg{color:#0f9d58;fill:#fff;height:64px;width:64px}.github-corner:hover .octo-arm{animation:a .56s ease-in-out}.github-corner .octo-arm{animation:none}@keyframes a{0%,to{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}</style><a href="https://github.com/blinkfox/hexo-theme-matery" class="github-corner tooltipped hide-on-med-and-down" target="_blank" data-tooltip="Fork Me" data-position="left" data-delay="50"><svg viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a></nav></header><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/cryptojs/crypto-js.min.js"></script><script></script><style>:root{--post-bg-image:url('https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/medias/featureimages/20.jpg')}</style><div class="bg-cover pd-header post-cover"><div class="container" style="right:0;left:0"><div class="row"><div class="col s12 m12 l12"><div class="brand"><h1 class="description center-align post-title">【Redis学习】6.理解内存</h1></div></div></div></div></div><main class="post-container content"><div class="row"><div id="main-content" class="col s12 m12 l9"><div id="artDetail"><div class="card"><div class="card-content article-info"><div class="row tag-cate"><div class="col s7"><div class="article-tag"><a href="/tags/Redis/"><span class="chip bg-color">Redis</span></a> <a href="/tags/%E5%86%85%E5%AD%98%E7%BB%93%E6%9E%84/"><span class="chip bg-color">内存结构</span></a> <a href="/tags/%E5%9B%9E%E6%94%B6%E7%AD%96%E7%95%A5/"><span class="chip bg-color">回收策略</span></a> <a href="/tags/%E5%86%85%E5%AD%98%E4%BC%98%E5%8C%96/"><span class="chip bg-color">内存优化</span></a></div></div><div class="col s5 right-align"><div class="post-cate"><i class="fas fa-bookmark fa-fw icon-category"></i> <a href="/categories/Redis%E5%AD%A6%E4%B9%A0/" class="post-category">Redis学习</a></div></div></div><div class="post-info"><div class="post-date info-break-policy"><i class="far fa-calendar-minus fa-fw"></i> 发布日期:&nbsp;&nbsp; 2023-09-06</div><div class="info-break-policy"><i class="far fa-file-word fa-fw"></i> 文章字数:&nbsp;&nbsp; 4.7k</div><div class="info-break-policy"><i class="far fa-clock fa-fw"></i> 阅读时长:&nbsp;&nbsp; 16 分</div></div></div><hr class="clearfix"><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/prism/prism.min.css"><div class="card-content article-card-content"><div id="articleContent"><h1 id="1-内存消耗"><a href="#1-内存消耗" class="headerlink" title="1 内存消耗"></a>1 内存消耗</h1><p>内存是个精贵且非常重要的计算组成部分，如何利用有限的资源完成高效且快速数据的存取，那首先我们得了解Redis在内存中的布局，看看消耗内存空间的位置，其次才能针对性的进行内存管理，分配，优化。这样，才能使得<code>利用更小内存，获得更大存储</code>发挥功效，从而降低企业成本，获得更多收益。</p><h2 id="1-1-使用统计"><a href="#1-1-使用统计" class="headerlink" title="1.1 使用统计"></a>1.1 使用统计</h2><p>如何查看内存消耗呢？在启动Redis成功后，通过redis-cli连接上服务，运行命令<br><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">info memory<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><br>可以查看内存使用情况：<br><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> info memory
<span class="token comment"># Memory</span>
used_memory:1042576
used_memory_human:1018.14K
used_memory_rss:1277952
used_memory_rss_human:1.22M
used_memory_peak:1061856
used_memory_peak_human:1.01M
used_memory_peak_perc:98.18%
used_memory_overhead:1030734
used_memory_startup:981104
used_memory_dataset:11842
used_memory_dataset_perc:19.26%
total_system_memory:8589934592
total_system_memory_human:8.00G
used_memory_lua:37888
used_memory_lua_human:37.00K
maxmemory:0
maxmemory_human:0B
maxmemory_policy:noeviction
mem_fragmentation_ratio:1.23
mem_allocator:libc
active_defrag_running:0
lazyfree_pending_objects:0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><br>其中，<code>info命令</code>可以显示redis服务器的许多信息，包括服务器基本信息、CPU、内存、持久化、客户端连接信息等等；<code>memory</code>是参数，表示只显示<code>内存相关</code>的信息。</p><p>执行命令之后有这么几个<code>重要的指标</code>：</p><div class="table-container"><table><thead><tr><th>属性名</th><th>属性说明</th></tr></thead><tbody><tr><td>used_memory</td><td>Redis分配器分配的内存总量（单位：字节），包括使用的虚拟内存（即swap），指Redis存储的所有数据所占的内存</td></tr><tr><td>used_memory_human</td><td>以可读的形式返回user_memory</td></tr><tr><td>used_memory_rss</td><td>Redis进程占用的物理内存总量</td></tr><tr><td>used_memory_peak</td><td>used_memory使用的峰值</td></tr><tr><td>used_memory_peak_human</td><td>可读格式返回used_memory_peak</td></tr><tr><td>used_memory_lua</td><td>Lua引擎消耗的内存大小</td></tr><tr><td>mem_fragmentation_ratio</td><td>used_memory_rss/used_memory比值，内存碎片率</td></tr><tr><td>mem_allocator</td><td>Redis所使用的内存分配器，在编译时指定；可以是 libc 、jemalloc或者tcmalloc，默认jemalloc</td></tr></tbody></table></div><ul><li>used_memory_rss：与<code>top</code>及<code>ps</code>命令看到的值是一致的；除了分配器分配的内存之外，<code>used_memory_rss</code>还包括进程运行本身需要的内存、内存碎片等，但是<strong>不包括虚拟内存</strong>。</li><li>mem_fragmentation_ratio：一般来说，mem_fragmentation_ratio在<code>1.03左右</code>是比较健康的状态（对于jemalloc来说）。<ul><li>大于1：一般情况是大于1的，若该值很大，说明<code>used_memory_rss - used_memory</code>多出的部分内存并没有用于数据存储，而是被内存碎片所消耗，如果两者相差很大，说明碎片率严重；</li><li>小于1：一般出现在操作系统把Redis内存交换（Swap）到硬盘导致（虚拟内存媒介也是磁盘，比内存速度要慢很多），出现这种情况时要格外关注，由于硬盘速度远远慢于内存，Redis性能会变得很差，甚至僵死。可增加Redis节点、增加Redis服务器的内存、优化应用等。<h2 id="1-2-内存消耗划分"><a href="#1-2-内存消耗划分" class="headerlink" title="1.2 内存消耗划分"></a>1.2 内存消耗划分</h2>上图：<img src="https://gcore.jsdelivr.net/gh/zyxelva/picgo/markdown/Redis-Memory-Distribution.png"><div class="caption"><b class="center-caption">Redis内存划分示意图</b></div></li></ul></li></ul><h3 id="1-2-1-对象内存"><a href="#1-2-1-对象内存" class="headerlink" title="1.2.1 对象内存"></a>1.2.1 对象内存</h3><p><code>对象内存</code>是Redis内存占用<code>最大</code>的一块，存储着用户所有的数据。</p><p>Redis所有的数据都采用<code>key-value</code>数据类型，每次创建<code>键值对</code>时，至少创建两个类型对象：<code>key对象</code>和<code>value对象</code>。</p><p>对象内存消耗可以简单理解为<code>sizeof（keys）+sizeof（values）</code>：</p><ul><li>键对象都是字符串，在使用Redis时很容易忽略键对内存消耗的影响，应当避免使用过长的键。</li><li>value对象更复杂些，主要包含5种基本数据类型：<code>字符串</code>、<code>列表</code>、<code>哈希</code>、<code>集合</code>、<code>有序集合</code>。其他数据类型都是建立在这5种数据结构之上实现的，如：<code>Bitmaps</code>和<code>HyperLogLog</code>使用<code>字符串</code>实现，<code>GEO</code>使用<code>有序集合</code>实现等。每种value对象类型根据使用规模不同，占用内存不同。在使用时一定要合理预估并监控value对象占用情况，避免内存溢出。</li></ul><h3 id="1-2-2-自身内存"><a href="#1-2-2-自身内存" class="headerlink" title="1.2.2 自身内存"></a>1.2.2 自身内存</h3><p>Redis<code>主进程</code>本身运行肯定需要占用内存，如<code>代码</code>、<code>常量池</code>等等；这部分内存<code>大约几兆</code>，在大多数生产环境中与Redis数据占用的内存相比<code>可以忽略</code>。这部分内存<code>不是由jemalloc分配</code>，因此<strong>不会统计</strong>在<code>used_memory</code>中。</p><blockquote><p><code>used_memory_rss</code>在<code>3MB左右</code>，<code>used_memory</code>在<code>800KB左右</code>。</p></blockquote><p>这里的内存主要指<code>AOF/RDB</code>重写时Redis创建的<code>子进程</code>内存的消耗，Linux具有<code>写时复制技术</code>（copy-on-write），父子进程会共享相同的物理内存页，当父进程写请求时会对需要修改的页复制出一份副本来完成写操作。当然，这部分内存<code>不属于Redis进程</code>，也<strong>不会统计</strong>在<code>used_memory</code>和<code>used_memory_rss</code>中。</p><h3 id="1-2-3-缓冲内存"><a href="#1-2-3-缓冲内存" class="headerlink" title="1.2.3 缓冲内存"></a>1.2.3 缓冲内存</h3><p>主要包括：<code>客户端缓冲</code>、<code>复制积压缓冲区</code>、<code>AOF缓冲区</code>。</p><ul><li><code>客户端缓冲</code>：所有接入到Redis服务器TCP连接的<code>输入输出缓冲</code>。客户端包括：<code>普通的客户端</code>（大量连接），<code>从客户端</code>（主要是复制的时候，异地跨机房，或者主节点下有多个从节点），<code>订阅客户端</code>（发布订阅功能，生产大于消费就会造成积压）；</li><li><code>复制积压缓冲</code>：2.8版本之后提供的可重用的固定大小缓冲区用于实现部分复制功能，<code>默认1MB</code>，主要是在主从同步时用到；</li><li><code>AOF缓冲区</code>：持久化用的，会先写入到缓冲区，然后根据响应的策略向磁盘进行同步，消耗的内存用户无法控制，取决于写入的命令量和重写时间，通常很小。<blockquote><p>这部分内存由<code>jemalloc</code>分配，因此会统计在<code>used_memory</code>中。</p><h3 id="1-2-4-内存碎片"><a href="#1-2-4-内存碎片" class="headerlink" title="1.2.4 内存碎片"></a>1.2.4 内存碎片</h3><p>等于<code>used_memory_rss</code> 减去 <code>used_memory</code>。</p></blockquote></li></ul><p>Redis默认的内存分配器采用<code>jemalloc</code>，可选的分配器还有：<code>glibc</code>、<code>tcmalloc</code>。</p><p><code>jemalloc</code>针对碎片化问题专门做了优化，一般不会存在过度碎片化的问题，正常的<code>碎片率</code>（mem_fragmentation_ratio）在<code>1.03左右</code>。但是当存储的数据长短差异较大时，以下场景容易出现高内存碎片问题：</p><ul><li><code>频繁做更新操作</code>，例如频繁对已存在的键执行<code>append</code>、<code>setrange</code>等更新操作。</li><li><code>大量过期键删除</code>，键对象过期删除后，释放的空间无法得到充分利用，导致碎片率上升。</li></ul><p>解决方案：</p><ul><li><code>数据对齐</code>：在条件允许的情况下尽量做数据对齐，比如数据尽量采用<code>数字类型</code>或者<code>固定长度字符串</code>等，但是这要视具体的业务而定，有些场景无法做到。</li><li><code>安全重启</code>：重启节点可以做到内存碎片重新整理，因此可以利用高可用架构，如<code>Sentinel</code>或<code>Cluster</code>，将碎片率过高的主节点转换为从节点，进行安全重启。</li></ul><h1 id="2-内存管理"><a href="#2-内存管理" class="headerlink" title="2 内存管理"></a>2 内存管理</h1><h2 id="2-1-控制内存上限"><a href="#2-1-控制内存上限" class="headerlink" title="2.1 控制内存上限"></a>2.1 控制内存上限</h2><p>Redis使用<code>maxmemory</code>参数限制最大可用内存。</p><p>限制内存的<code>目的</code>主要有：</p><ul><li>用于缓存场景，当超出内存上限<code>maxmemory</code>时使用<code>LRU</code>等删除策略释放空间。</li><li>防止所用内存超过服务器物理内存。</li></ul><blockquote><p>有一点需要注意的是<code>maxmemory</code>配置的是Redis实际使用的内存量，即<code>used_memory</code>，由于有内存碎片的存在，所以实际的内存使用<code>比used_memory要大</code>。</p><p>比如一台<code>24GB</code>内存的服务器，为<code>系统预留4GB内存</code>，<code>预留4GB空闲内存</code>给其他进程或<code>Redis fork</code>进程，留给Redis<code>16GB</code>内存，这样可以部署4个<code>maxmemory=4GB</code>的Redis进程。</p></blockquote><img src="https://gcore.jsdelivr.net/gh/zyxelva/picgo/markdown/Redis-Memory-Dispatch.png"><div class="caption"><b class="center-caption">内存分配举例</b></div><p>Redis还可以动态的执行内存的调整，例，当发现<code>Redis-2</code>没有做好内存预估，实际只用了<code>不到2GB</code>内存，而<code>Redis-1</code>实例需要扩容到<code>6GB</code>内存才够用，这时可以分别执行如下命令进行调整：<br><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Redis-<span class="token operator"><span class="token file-descriptor important">1</span>></span>config <span class="token builtin class-name">set</span> maxmemory 6GB
Redis-<span class="token operator"><span class="token file-descriptor important">2</span>></span>config <span class="token builtin class-name">set</span> maxmemory 2GB<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><br><img src="https://gcore.jsdelivr.net/gh/zyxelva/picgo/markdown/Redis-Memory-Dispatch2.png"></p><div class="caption"><b class="center-caption">内存分配调整后</b></div><p></p><blockquote><p>这个例子过于理想化，如果此时<code>Redis-3</code>和<code>Redis-4</code>实例也需要分别扩容到<code>6GB</code>，这时超出系统物理内存限制就不能简单的通过调整<code>maxmemory</code>来达到扩容的目的，需要采用<code>在线迁移数据</code>或者通过<code>复制</code>切换服务器来达到扩容的目的。具体细节见前几章的<code>“哨兵”</code>和<code>“集群”</code>部分。</p><h2 id="2-2-回收策略"><a href="#2-2-回收策略" class="headerlink" title="2.2 回收策略"></a>2.2 回收策略</h2><p>Redis的内存回收机制主要体现在以下两个方面：</p><ul><li><code>删除</code>到达<code>过期时间</code>的键对象。</li><li>内存使用达到<code>maxmemory</code>上限时触发<code>内存溢出控制策略</code>。</li></ul></blockquote><h3 id="2-2-1-删除过期键对象"><a href="#2-2-1-删除过期键对象" class="headerlink" title="2.2.1 删除过期键对象"></a>2.2.1 删除过期键对象</h3><h4 id="2-2-1-1-惰性删除"><a href="#2-2-1-1-惰性删除" class="headerlink" title="2.2.1.1 惰性删除"></a>2.2.1.1 惰性删除</h4><p>当客户端读取<code>带有超时属性</code>的键时，如果已经超过键设置的过期时间，会执行删除操作并返回空。</p><p>缺点显而易见：单独使用存在内存泄漏，即一直没有客户端读取，就没法删除。因而还需要下面的<code>定时任务删除</code>这些一直无用的数据。</p><h4 id="2-2-1-2-定时任务删除"><a href="#2-2-1-2-定时任务删除" class="headerlink" title="2.2.1.2 定时任务删除"></a>2.2.1.2 定时任务删除</h4><p>Redis内部维护一个定时任务，默认<code>每秒运行10次</code>（通过配置hz控制）。</p><p>定时任务中删除过期键逻辑采用了<code>自适应算法</code>，根据键的过期比例、使用<code>快慢</code>两种速率模式回收键，流程如下图所示：<br><img src="https://gcore.jsdelivr.net/gh/zyxelva/picgo/markdown/Redis-Expire-Cron.jpg"></p><div class="caption"><b class="center-caption">Redis定时删除任务</b></div><p></p><h3 id="2-2-2-内存溢出控制策略"><a href="#2-2-2-内存溢出控制策略" class="headerlink" title="2.2.2 内存溢出控制策略"></a>2.2.2 内存溢出控制策略</h3><p>当Redis所用内存达到<code>maxmemory</code>上限时会触发相应的溢出控制策略。具体策略受<code>maxmemory-policy</code>参数控制，Redis支持6种策略，如下所示：</p><div class="table-container"><table><thead><tr><th>策略</th><th>说明</th></tr></thead><tbody><tr><td>noeviction</td><td>默认策略，不会删除任何数据，拒绝所有写入操作并返回客户端错误信息（error）<code>OOM command not allowed when used memory</code>，此时Redis只响应读操作。</td></tr><tr><td>volatile-lru</td><td>根据<code>LRU算法</code>删除设置了超时属性（expire）的键，直到腾出足够空间为止。如果没有可删除的键对象，回退到<code>noeviction</code>策略。</td></tr><tr><td>allkeys-lru</td><td>根据<code>LRU算法</code>删除键，不管数据有没有设置超时属性，直到腾出足够空间为止。</td></tr><tr><td>allkeys-random</td><td><code>随机删除</code>所有键，直到腾出足够空间为止。</td></tr><tr><td>volatile-random</td><td><code>随机删除</code>过期键，直到腾出足够空间为止。</td></tr><tr><td>volatile-ttl</td><td>根据键值对象的<code>ttl</code>属性，删除最近将要过期数据。如果没有，回退到<code>noeviction</code>策略。</td></tr></tbody></table></div><blockquote><p>内存溢出控制策略可以采用<code>config set maxmemory-policy&#123;policy&#125;</code>动态配置。</p></blockquote><h1 id="3-内存优化"><a href="#3-内存优化" class="headerlink" title="3 内存优化"></a>3 内存优化</h1><p>1.精简键值对大小，键值字面量精简，使用高效二进制序列化工具；</p><p>降低Redis内存使用最直接的方式就是缩减键（key）和值（value）的长度。</p><ul><li>key长度：如在设计键时，在完整描述业务情况下，键值越短越好。如<code>user:&#123;uid&#125;:friends:notify:&#123;fid&#125;</code>可以简化为<code>u:&#123;uid&#125;:fs:nt:&#123;fid&#125;</code>。</li><li>value长度：值对象缩减比较复杂，常见需求是把业务对象<code>序列化成二进制数组</code>放入Redis。<ul><li>首先应该在业务上精简业务对象，去掉不必要的属性避免存储无效数据。</li><li>其次在序列化工具选择上，应该选择更高效的序列化工具来降低字节数组大小。以Java为例，内置的序列化方式无论从速度还是压缩比都不尽如人意，这时可以选择更高效的序列化工具，如：<code>protostuff</code>、<code>kryo</code>等。</li></ul></li></ul><p>2.使用<code>共享对象池</code>优化小整数对象，数据优先使用整数，比字符串类型更节省空间；<br><code>共享对象池</code>是指Redis内部维护<code>[0-9999]</code>的<strong>整数对象池</strong>。创建大量的整数类型<code>redisObject</code>存在内存开销，每个<code>redisObject</code>内部结构<code>至少占16字节</code>，甚至超过了整数自身空间消耗。所以Redis内存维护一个<code>[0-9999]</code>的整数对象池，用于节约内存。除了整数值对象，其他类型如<code>list</code>、<code>hash</code>、<code>set</code>、<code>zset</code>内部元素也可以使用整数对象池。因此开发中在满足需求的前提下，尽量使用整数对象以节省内存。<br><img src="https://gcore.jsdelivr.net/gh/zyxelva/picgo/markdown/Redis-Optimize-Integer-SharedPool.jpg"></p><div class="caption"><b class="center-caption">是否使用整数对象池内存对比</b></div><p></p><blockquote><p>为什么开启maxmemory和LRU淘汰策略后对象池无效？</p></blockquote><p><code>LRU算法</code>需要获取对象<code>最后被访问时间</code>，以便淘汰最长未访问数据，每个对象最后访问时间存储在<code>redisObject</code>对象的<code>lru字段</code>。对象共享意味着多个引用<code>共享同一个redisObject</code>，这时lru字段也会被共享，导致<strong>无法获取</strong>每个对象的最后访问时间。如果没有设置<code>maxmemory</code>，直到内存被用尽Redis也不会触发内存回收，所以共享对象池可以正常工作。</p><p>综上所述，<code>共享对象池</code>与<code>maxmemory+LRU策略</code><strong>冲突</strong>，使用时需要注意。对于<code>ziplist编码</code>的值对象，即使内部数据为整数也<strong>无法使用</strong>共享对象池，因为<code>ziplist</code>使用压缩且内存连续的结构，对象共享判断成本过高。</p><blockquote><p>为什么只有整数对象池？</p><ul><li>首先整数对象池<code>复用的几率最大</code>；</li><li>其次对象共享的一个关键操作就是判断相等性，Redis之所以只有整数对象池，是因为整数比较算法时间复杂度为<code>O(1)</code>，只保留一万个整数为了防止对象池浪费；</li><li>再次，如果是字符串判断相等性，时间复杂度变为<code>O(n)</code>，特别是长字符串更消耗性能（浮点数在Redis内部使用字符串存储）。对于更复杂的数据结构如<code>hash</code>、<code>list</code>等，相等性判断需要O($n^2$)。对于单线程的Redis来说，这样的开销显然不合理，因此Redis只保留整数共享对象池。</li></ul></blockquote><p>3.优化字符串使用，避免<code>预分配</code>造成的内存浪费；<br>在开始学习Redis数据结构时，我们已经了解到Redis对于字符串的存储结构以及编码，对于字符串，其数据结构离不开SDS，如下图所示：<br><img src="https://gcore.jsdelivr.net/gh/zyxelva/picgo/markdown/Redis-SDS-Example3.png"></p><div class="caption"><b class="center-caption">SDS样例</b></div><p></p><p>Redis自身实现的字符串结构具有如下<code>特点</code>：</p><ul><li><code>O(1)</code>时间复杂度获取：<code>字符串长度</code>、<code>已用长度</code>、<code>未用长度</code>。</li><li>可用于保存字节数组，支持安全的二进制数据存储。</li><li>内部实现空间<code>预分配机制</code>，降低内存再分配次数。</li><li>惰性删除机制，字符串缩减后的空间不释放，作为预分配空间保留。</li></ul><p>因为字符串（SDS）存在<code>预分配机制</code>，日常开发中要小心预分配带来的内存浪费。</p><blockquote><p>之所以采用预分配的方式是<strong>防止修改操作需要不断重分配内存和字节数据拷贝</strong>。但这是一把<code>双刃剑</code>，同样也会造成内存的浪费。字符串预分配每次<code>并不都是翻倍扩容</code>，空间预分配规则如下：</p><ul><li>第一次创建<code>len</code>属性等于<code>数据实际大小</code>，<code>free</code>等于0，不做预分配。</li><li>修改后如果已有free空间不够且数据<code>小于1MB</code>，每次预分配一倍容量。如原有len=60byte，free=0，再追加60byte，预分配120byte，总占用空间：<code>60byte+60byte+120byte+1byte</code>。</li><li>修改后如果已有free空间不够且数据<code>大于1MB</code>，每次预分配1MB数据。如原有len=30MB，free=0，当再追加100byte，预分配1MB，总占用空间：<code>1MB+100byte+1MB+1byte</code>。</li></ul><p>开发提示：尽量减少字符串频繁修改操作，如<code>append</code>、<code>setrange</code>，改为直接使用set修改字符串，降低预分配带来的内存浪费和内存碎片化。</p></blockquote><p>4.使用<code>ziplist</code>压缩编码优化<code>hash</code>、<code>list</code>等结构，注重效率和空间的平衡；<br>编码形式多种多样，基本上每种数据结构，Redis作者都给出了至少两种方式，参见<a href="/posts/3971932782.html" title="【Redis学习】1.常用的数据结构">【Redis学习】1.常用的数据结构</a>。</p><blockquote><p>为什么对一种数据结构实现多种编码方式？</p></blockquote><p>主要原因是Redis作者想通过不同编码实现<code>效率</code>和<code>空间</code>的<strong>平衡</strong>。比如当我们的存储只有<code>10个元素的列表</code>，当使用<code>双向链表</code>数据结构时，必然需要维护大量的内部字段如每个元素需要：<code>前置指针</code>，<code>后置指针</code>，<code>数据指针</code>等，造成空间浪费，如果采用连续内存结构的<code>压缩列表</code>（ziplist），将会节省大量内存，而由于数据长度较小，存取操作时间复杂度即使为O($n^2$)性能也可满足需求。</p><blockquote><p>开发提示：针对性能要求较高的场景使用<code>ziplist</code>，建议长度<code>不要超过1000</code>，每个元素大小控制在<code>512字节以内</code>。</p></blockquote><p>5.使用<code>intset</code>编码优化整数集合；</p><blockquote><p>开发提示：使用intset编码的集合时，尽量保持整数范围一致，如都在<code>int-16</code>范围内。防止个别大整数触发集合升级操作，产生内存浪费。</p></blockquote><p>6.使用<code>ziplist</code>编码的<code>hash</code>结构降低小对象链规模。<br>这种内存优化技巧的关键点：</p><ul><li><code>hash类型</code>节省内存的原理是使用<code>ziplist编码</code>，如果使用<code>hashtable编码</code>方式反而会增加内存消耗。</li><li><code>ziplist</code>长度需要控制在<code>1000以内</code>，否则由于存取操作时间复杂度在O(n)到O($n^2$)之间，长列表会导致CPU消耗严重，得不偿失。</li><li><code>ziplist</code>适合存储<code>小对象</code>，对于大对象不但内存优化效果不明显还会增加命令操作耗时。</li><li>需要预估键的规模，从而确定每个<code>hash结构</code>需要存储的元素数量。</li><li>根据<code>hash长度</code>和<code>元素大小</code>，调整<code>hash-max-ziplist-entries</code>和<code>hash-max-ziplist-value</code>参数，确保hash类型使用<code>ziplist编码</code>。</li></ul><p>关于hash<code>键</code>和<code>field键</code>的设计：</p><ul><li>当<code>键</code>离散度较高时，可以按字符串位截取，把后三位作为哈希的<code>field</code>，之前部分作为哈希的键。如：key=1948480哈希key=group:hash:1948，哈希field=480。</li><li>当<code>键</code>离散度较低时，可以使用哈希算法打散键，如：使用<code>crc32(key)&amp;10000</code>函数把所有的键映射到<code>“0-9999”</code>整数范围内，哈希<code>field</code>存储键的原始值。</li><li>尽量减少hash<code>键</code>和<code>field</code>的长度，如使用部分键内容。</li></ul><blockquote><p>虽然可以大幅降低内存，但同样会带来问题，需要提前做好规避处理。</p><ul><li>客户端需要预估键的规模并设计hash分组规则，加重客户端开发成本。</li><li>hash重构后所有的键<code>无法再使用超时</code>（expire）和<code>LRU淘汰机制</code>自动删除，需要手动维护删除。</li><li>对于大对象，如<code>1KB以上</code>的对象，使用<code>hash-ziplist</code>结构控制键数量反而得不偿失。</li></ul></blockquote></div><hr><div class="reprint" id="reprint-statement"><div class="reprint__author"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-user">文章作者:</i></span> <span class="reprint-info"><a href="/about" rel="external nofollow noreferrer">Kezade</a></span></div><div class="reprint__type"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-link">文章链接:</i></span> <span class="reprint-info"><a href="https://zyxelva.github.io/posts/3918025932.html">https://zyxelva.github.io/posts/3918025932.html</a></span></div><div class="reprint__notice"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-copyright">版权声明:</i></span> <span class="reprint-info">本博客所有文章除特別声明外，均采用 <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a> 许可协议。转载请注明来源 <a href="/about" target="_blank">Kezade</a> !</span></div></div><script async defer>function navToReprintStatement(){$("html, body").animate({scrollTop:$("#reprint-statement").offset().top-80},800)}document.addEventListener("copy",function(t){M.toast({html:'<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>'})})</script><div class="tag_share" style="display:block"><div class="post-meta__tag-list" style="display:inline-block"><div class="article-tag"><a href="/tags/Redis/"><span class="chip bg-color">Redis</span></a> <a href="/tags/%E5%86%85%E5%AD%98%E7%BB%93%E6%9E%84/"><span class="chip bg-color">内存结构</span></a> <a href="/tags/%E5%9B%9E%E6%94%B6%E7%AD%96%E7%95%A5/"><span class="chip bg-color">回收策略</span></a> <a href="/tags/%E5%86%85%E5%AD%98%E4%BC%98%E5%8C%96/"><span class="chip bg-color">内存优化</span></a></div></div><div class="post_share" style="zoom:80%;width:fit-content;display:inline-block;float:right;margin:-.15rem 0"><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/share/css/share.min.css"><div id="article-share"><div class="social-share" data-sites="google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/share/js/social-share.min.js"></script></div></div></div><div id="reward"><a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a><div id="rewardModal" class="modal"><div class="modal-content"><a class="close modal-close"><i class="fas fa-times"></i></a><h4 class="reward-title">你的赏识是我前进的动力</h4><div class="reward-content"><div class="reward-tabs"><ul class="tabs row"><li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li><li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li></ul><div id="alipay"><img src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码"></div><div id="wechat"><img src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码"></div></div></div></div></div></div><script>$(function(){$(".tabs").tabs()})</script></div></div><style>.twikoo-card{margin:1.5rem auto}.twikoo-card .card-content{padding:20px}#tcomments textarea{box-sizing:border-box;background:url("/") 100% 100% no-repeat}#tcomments p{margin:2px 2px 10px;font-size:1.05rem;line-height:1.78rem;text-align:left}#tcomments blockquote p{text-indent:.2rem}#tcomments a{padding:0 2px;color:#4cbf30;font-weight:500;text-decoration:none}#tcomments img{max-width:100%;height:auto;cursor:pointer}#tcomments ol li{list-style-type:decimal}#tcomments ol,ul{display:block;padding-left:2em;word-spacing:0.05rem}#tcomments ul li,ol li{display:list-item;line-height:1.8rem;font-size:1rem}#tcomments ul li{list-style-type:disc}#tcomments ul ul li{list-style-type:circle}#tcomments table,td,th{padding:12px 13px;border:1px solid #dfe2e5}#tcomments table,td,th{border:0}table tr:nth-child(2n),thead{background-color:#fafafa}#tcomments table th{background-color:#f2f2f2;min-width:80px}#tcomments table td{min-width:80px}#tcomments h1{font-size:1.85rem;font-weight:700;line-height:2.2rem}#tcomments h2{font-size:1.65rem;font-weight:700;line-height:1.9rem}#tcomments h3{font-size:1.45rem;font-weight:700;line-height:1.7rem}#tcomments h4{font-size:1.25rem;font-weight:700;line-height:1.5rem}#tcomments h5{font-size:1.1rem;font-weight:700;line-height:1.4rem}#tcomments h6{font-size:1rem;line-height:1.3rem}#tcomments p{font-size:1rem;line-height:1.5rem}#tcomments hr{margin:12px 0;border:0;border-top:1px solid #ccc}#tcomments blockquote{margin:15px 0;border-left:5px solid #42b983;padding:1rem .8rem .3rem .8rem;color:#666;background-color:rgba(66,185,131,.1)}#tcomments pre{font-family:monospace,monospace;padding:1.2em;margin:.5em 0;background:#272822;overflow:auto;border-radius:.3em;tab-size:4}#tcomments code{font-family:monospace,monospace;padding:1px 3px;font-size:.92rem;color:#e96900;background-color:#f8f8f8;border-radius:2px}#tcomments pre code{font-family:monospace,monospace;padding:0;color:#e8eaf6;background-color:#272822}#tcomments pre[class*=language-]{padding:1.2em;margin:.5em 0}#tcomments code[class*=language-],pre[class*=language-]{color:#e8eaf6}#tcomments [type=checkbox]:not(:checked),[type=checkbox]:checked{position:inherit;margin-left:-1.3rem;margin-right:.4rem;margin-top:-1px;vertical-align:middle;left:unset;visibility:visible}#tcomments b,strong{font-weight:700}#tcomments dfn{font-style:italic}#tcomments small{font-size:85%}#tcomments cite{font-style:normal}#tcomments mark{background-color:#fcf8e3;padding:.2em}#tcomments table,td,th{padding:12px 13px;border:1px solid #dfe2e5}table tr:nth-child(2n),thead{background-color:#fafafa}#tcomments table th{background-color:#f2f2f2;min-width:80px}#tcomments table td{min-width:80px}#tcomments [type=checkbox]:not(:checked),[type=checkbox]:checked{position:inherit;margin-left:-1.3rem;margin-right:.4rem;margin-top:-1px;vertical-align:middle;left:unset;visibility:visible}</style><div class="card twikoo-card" data-aos="fade-up"><div class="comment_headling" style="font-size:20px;font-weight:700;position:relative;padding-left:20px;top:15px;padding-bottom:5px"><i class="fas fa-comments fa-fw" aria-hidden="true"></i> <span>评论</span></div><div class="card-content" style="display:grid"><div id="tcomments"></div></div></div><script src="https://gcore.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js"></script><script>twikoo.init({envId:"https://kezadetwikoo.netlify.app/.netlify/functions/twikoo",el:"#tcomments",region:"",path:""}).then(function(){for(var t=document.querySelector("#twikoo").getElementsByTagName("input"),e=0;e<t.length;e++)t[e]&&t[e].classList.add("browser-default")})</script><article id="prenext-posts" class="prev-next articles"><div class="row article-row"><div class="article col s12 m6" data-aos="fade-up"><div class="article-badge left-badge text-color"><i class="fas fa-chevron-left"></i> &nbsp;上一篇</div><div class="card"><a href="/posts/3851986962.html"><div class="card-image"><img src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/medias/featureimages/3.jpg" class="responsive-img" alt="【Redis学习】7.缓存设计"> <span class="card-title">【Redis学习】7.缓存设计</span></div></a><div class="card-content article-content"><div class="summary block-with-text"></div><div class="publish-info"><span class="publish-date"><i class="far fa-clock fa-fw icon-date"></i> 2023-09-07</span><span class="publish-author"><i class="fas fa-bookmark fa-fw icon-category"></i> <a href="/categories/Redis%E5%AD%A6%E4%B9%A0/" class="post-category">Redis学习</a></span></div></div><div class="card-action article-tags"><a href="/tags/Redis/"><span class="chip bg-color">Redis</span></a> <a href="/tags/%E7%BC%93%E5%AD%98%E7%A9%BF%E9%80%8F/"><span class="chip bg-color">缓存穿透</span></a> <a href="/tags/%E7%BC%93%E5%AD%98%E9%9B%AA%E5%B4%A9/"><span class="chip bg-color">缓存雪崩</span></a> <a href="/tags/%E7%BC%93%E5%AD%98%E5%87%BB%E7%A9%BF/"><span class="chip bg-color">缓存击穿</span></a></div></div></div><div class="article col s12 m6" data-aos="fade-up"><div class="article-badge right-badge text-color">下一篇&nbsp;<i class="fas fa-chevron-right"></i></div><div class="card"><a href="/posts/2973021972.html"><div class="card-image"><img src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/medias/featureimages/13.jpg" class="responsive-img" alt="【Redis学习】5.高可用之集群"> <span class="card-title">【Redis学习】5.高可用之集群</span></div></a><div class="card-content article-content"><div class="summary block-with-text"></div><div class="publish-info"><span class="publish-date"><i class="far fa-clock fa-fw icon-date"></i> 2023-08-30</span><span class="publish-author"><i class="fas fa-bookmark fa-fw icon-category"></i> <a href="/categories/Redis%E5%AD%A6%E4%B9%A0/" class="post-category">Redis学习</a></span></div></div><div class="card-action article-tags"><a href="/tags/Redis/"><span class="chip bg-color">Redis</span></a> <a href="/tags/%E9%9B%86%E7%BE%A4%E6%A8%A1%E5%BC%8F/"><span class="chip bg-color">集群模式</span></a></div></div></div></div></article></div><script>$("#articleContent").on("copy",function(e){if(void 0!==window.getSelection){var n=window.getSelection();if(!((""+n).length<Number.parseInt("120"))){var t=document.getElementsByTagName("body")[0],o=document.createElement("div");o.style.position="absolute",o.style.left="-99999px",t.appendChild(o),o.appendChild(n.getRangeAt(0).cloneContents()),"PRE"!==n.getRangeAt(0).commonAncestorContainer.nodeName&&"CODE"!==n.getRangeAt(0).commonAncestorContainer.nodeName||(o.innerHTML="<pre>"+o.innerHTML+"</pre>");var i=document.location.href;o.innerHTML+='<br />来源: Kezade<br />文章作者: Kezade<br />文章链接: <a href="'+i+'">'+i+"</a><br />本文章著作权归作者所有，任何形式的转载都请注明出处。",n.selectAllChildren(o),window.setTimeout(function(){t.removeChild(o)},200)}}})</script><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/codeBlock/codeBlockFuction.js"></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/prism/prism.min.js"></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/codeBlock/codeLang.js"></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/codeBlock/codeCopy.js"></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/codeBlock/codeShrink.js"></script></div><div id="toc-aside" class="expanded col l3 hide-on-med-and-down"><div class="toc-widget card" style="background-color:#fff"><div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div><div id="toc-content"></div></div></div></div><div id="floating-toc-btn" class="hide-on-med-and-down"><a class="btn-floating btn-large bg-color"><i class="fas fa-list-ul"></i></a></div><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/tocbot/tocbot.min.js"></script><script>$(function(){tocbot.init({tocSelector:"#toc-content",contentSelector:"#articleContent",headingsOffset:-(.4*$(window).height()-45),collapseDepth:Number("0"),headingSelector:"h1, h2, h3, h4, h5"});let t=parseInt(.4*$(window).height()-64),e=$(".toc-widget");$(window).scroll(function(){$(window).scrollTop()>t?e.addClass("toc-fixed"):e.removeClass("toc-fixed")});const o="expanded";let n=$("#toc-aside"),i=$("#main-content");$("#floating-toc-btn .btn-floating").click(function(){n.hasClass(o)?(n.removeClass(o).hide(),i.removeClass("l9")):(n.addClass(o).show(),i.addClass("l9")),function(t,e){let o=$("#"+t);if(0===o.length)return;let n=o.width();n+=n>=450?21:n>=350&&n<450?18:n>=300&&n<350?16:14,$("#"+e).width(n)}("artDetail","prenext-posts")})})</script></main><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script>MathJax.Hub.Config({tex2jax:{inlineMath:[["$","$"],["\\(","\\)"]]}})</script><footer class="page-footer bg-color"><div class="container row center-align" style="margin-bottom:15px!important"><div class="col s12 m8 l8 copy-right">Copyright&nbsp;&copy; <span id="year">2019-2025</span> <a href="/about" target="_blank">Kezade</a> |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a> |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a><br><br><span id="sitetime">Loading ...</span><script>var calcSiteTime=function(){var e=6e4,t=36e5,n=864e5,a=365*n,i=new Date,r="2019",o=i.getFullYear(),s=i.getMonth()+1,l=i.getDate(),m=i.getHours(),c=i.getMinutes(),d=i.getSeconds(),g=Date.UTC(r,"6","28","0","0","0"),h=Date.UTC(o,s,l,m,c,d)-g,u=Math.floor(h/a),M=Math.floor(h/n-365*u),T=Math.floor((h-(365*u+M)*n)/t),f=Math.floor((h-(365*u+M)*n-T*t)/e),y=Math.floor((h-(365*u+M)*n-T*t-f*e)/1e3);if(r===String(o)){document.getElementById("year").innerHTML=o;var v="This site has been running for "+M+" days";v="本站已运行 "+M+" 天",document.getElementById("sitetime").innerHTML=v}else{document.getElementById("year").innerHTML=r+" - "+o;var H="This site has been running for "+u+" years and "+M+" days "+T+" hours "+f+" mins "+y+" seconds";H="本站已苟且偷生 "+u+" 年 "+M+" 天 "+T+" 小时 "+f+" 分钟 "+y+" 秒",document.getElementById("sitetime").innerHTML=H}};calcSiteTime(),setInterval(calcSiteTime,1e3)</script><br></div><div class="col s12 m4 l4 social-link"><a href="https://github.com/zyxelva" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50"><i class="fab fa-github"></i></a><a href="mailto:zyxelva@gmail.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50"><i class="fas fa-envelope-open"></i></a><a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=1807401971" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 1807401971" data-position="top" data-delay="50"><i class="fab fa-qq"></i></a> <a href="https://www.zhihu.com/people/kezade" class="tooltipped" target="_blank" data-tooltip="关注我的知乎: https://www.zhihu.com/people/kezade" data-position="top" data-delay="50"><i class="fab fa-zhihu1">知</i></a><a href="../rss2.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50"><i class="fas fa-rss"></i></a></div></div></footer><div class="progress-bar"></div><div id="searchModal" class="modal"><div class="modal-content"><div class="search-header"><span class="title"><i class="fas fa-search"></i> &nbsp;&nbsp;搜索</span> <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字" class="search-input"></div><div id="searchResult"></div></div></div><script>$(function(){!function(t,e,r){"use strict";$.ajax({url:t,dataType:"xml",success:function(t){var n=$("entry",t).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get(),a=document.getElementById(e),s=document.getElementById(r);a.addEventListener("input",function(){var t='<ul class="search-result-list">',e=this.value.trim().toLowerCase().split(/[\s\-]+/);s.innerHTML="",this.value.trim().length<=0||(n.forEach(function(r){var n=!0,a=r.title.trim().toLowerCase(),s=r.content.trim().replace(/<[^>]+>/g,"").toLowerCase(),i=r.url;i=0===i.indexOf("/")?r.url:"/"+i;var l=-1,c=-1,u=-1;if(""!==a&&""!==s&&e.forEach(function(t,e){l=a.indexOf(t),c=s.indexOf(t),l<0&&c<0?n=!1:(c<0&&(c=0),0===e&&(u=c))}),n){t+="<li><a href='"+i+"' class='search-result-title'>"+a+"</a>";var o=r.content.trim().replace(/<[^>]+>/g,"");if(u>=0){var h=u-20,f=u+80;h<0&&(h=0),0===h&&(f=100),f>o.length&&(f=o.length);var m=o.substr(h,f);e.forEach(function(t){var e=new RegExp(t,"gi");m=m.replace(e,'<em class="search-keyword">'+t+"</em>")}),t+='<p class="search-result">'+m+"...</p>"}t+="</li>"}}),t+="</ul>",s.innerHTML=t)})}})}("/search.xml","searchInput","searchResult")})</script><div class="stars-con"><div id="stars"></div><div id="stars2"></div><div id="stars3"></div></div><script>function switchNightMode(){$('<div class="Cuteen_DarkSky"><div class="Cuteen_DarkPlanet"></div></div>').appendTo($("body")),setTimeout(function(){$("body").hasClass("DarkMode")?($("body").removeClass("DarkMode"),localStorage.setItem("isDark","0"),$("#sum-moon-icon").removeClass("fa-sun").addClass("fa-moon")):($("body").addClass("DarkMode"),localStorage.setItem("isDark","1"),$("#sum-moon-icon").addClass("fa-sun").removeClass("fa-moon")),setTimeout(function(){$(".Cuteen_DarkSky").fadeOut(1e3,function(){$(this).remove()})},2e3)})}</script><div id="backTop" class="top-scroll"><a class="btn-floating btn-large waves-effect waves-light" href="#!"><i class="fas fa-arrow-up"></i></a></div><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/materialize/materialize.min.js"></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/masonry/masonry.pkgd.min.js"></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/aos/aos.js"></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/scrollprogress/scrollProgress.min.js"></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/lightGallery/js/lightgallery-all.min.js"></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/js/matery.js"></script><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/mermaid/mermaid.min.css"><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/mermaid/mermaid.min.js"></script><script>window.mermaid&&mermaid.initialize({theme:"forest"})</script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/background/ribbon-dynamic.js" async></script><script src="https://gcore.jsdelivr.net/gh/zyxelva/zyxelva.github.io@main/libs/instantpage/instantpage.js" type="module"></script></body></html>
document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("neodb-movie"),n=document.querySelector("#lastUpdated")||"";function a(n,a){for(var t="",o=0,r=n.length;o<r&&o<a;o++){for(var l=n[o],s=l.item,i=s.display_title,c=s.rating||8,d=s.url,g=s.cover_image_url,v=!1,m="",p="",f="",u="",h=0;h<=8;h+=2)p+=c>h?'\n                         <span>\n                            <svg viewBox="0 0 24 24" width="24" height="24" class="stars">\n                                <path fill="none" d="M0 0h24v24H0z"></path>\n                                <path fill="currentColor"\n                                      d="M12 18.26l-7.053 3.948 1.575-7.928L.587 8.792l8.027-.952L12 .5l3.386 7.34 8.027.952-5.935 5.488 1.575 7.928z">\n                                </path>\n                            </svg>\n                         </span>':' <span>\n                    <svg viewBox="0 0 24 24" width="24" height="24" class="stars white">\n                    <path fill="none" d="M0 0h24v24H0z"></path>\n                    <path fill="currentcolor"\n                          d="M12 18.26l-7.053 3.948 1.575-7.928L.587 8.792l8.027-.952L12 .5l3.386 7.34 8.027.952-5.935 5.488 1.575 7.928z">\n                    </path>\n                    </svg>\n                    </span>';for(var $=0,_=s.external_resources.length;$<_;$++){let e=s.external_resources[$].url;e&&e.includes("douban")&&(v=!0,u+=`\n                     <a href="${e}" target="_blank" rel="noreferrer noopener nofollow">\n                         <img class="cover_image_url" src="${g}" loading="lazy" alt="${i}">\n                     </a>`,m+=`<a href="${e}" target="_blank" rel="noreferrer noopener nofollow">${i}</a>`),v||(m+=`<a href="https://neodb.social${d}" target="_blank" rel="noreferrer noopener nofollow">${i}</a>`),f+=`\n                    <span class="external-resource">\n                        <a href="${e}" target="_blank" rel="noreferrer noopener nofollow">\n                            <img src="/assets/${new URL(e).hostname}.png" loading="lazy" alt="${s.title}">\n                        </a>\n                 </span>`}t+=`<div class="movies sorting" data-marked="${l.created_time}" data-year='{{  dateFormat "2006-01-02 15:04:05" m.created_time }}' data-star="${l.rating_grade}" data-rating="${s.rating}" data-count="${s.rating_count}">\n                <div class="cover">\n                    <div class="cover__container">                    \n                        ${u}\n                    </div>\n                </div>\n                <div class="title">\n                    ${m}\n                </div>\n                <div class="rating">\n                    ${p}\n                     ${c}\n                    \x3c!-- ( 共 {{ item.rating_count }} 人评分) --\x3e\n                </div>\n                <div class="referrer">\n                    <span class="neodb">\n                        <a href="https://neodb.social${d}" target="_blank" rel="noreferrer noopener nofollow">\n                            <img src="/assets/neodbsocial.jpg" loading="lazy" alt="NeoDB">\n                        </a>\n                    </span>\n                     ${f}\n                </div>\n            </div>`}e.innerHTML=t}e&&function(e){let t=e||30;var o=JSON.parse(localStorage.getItem("localMovieCount"))||"",r=JSON.parse(localStorage.getItem("movieLastUpdatedTime"))||"",l=JSON.parse(localStorage.getItem("movieDatas"))||"";n.innerText="最后更新："+r,l?(a(l,t),console.log("neoMovie 本地数据加载成功")):localStorage.setItem("localMovieCount","");let s=null;"undefined"!=typeof myMovies&&(s=myMovies.url);if(null===s||""===s)return void console.warn("NeoDB Movie url is null or blank.");fetch(s).then(e=>e.json()).then(e=>{var r=e.count;if(r&&o!==r){var l=e.data,s=leonus.formatTimestamp(Date.parse(l[0].created_time)/1e3);n.innerText="最后更新："+s,a(l,t),localStorage.setItem("movieLastUpdatedTime",JSON.stringify(s)),localStorage.setItem("localMovieCount",JSON.stringify(r)),localStorage.setItem("movieDatas",JSON.stringify(l)),console.log("neoMovie 热更新完成")}else console.log("neoMovie API 数据未更新")})}(30)});